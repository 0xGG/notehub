{"version":3,"sources":["lib/crossnote.ts","i18n/i18n.ts","i18n/lang/enUS.ts","containers/crossnote.ts","components/PushNotebookDialog.tsx","components/EditImageDialog.tsx","components/Editor.tsx","utilities/preview.ts","components/AddNotebookDialog.tsx","components/NotebookTreeView.tsx","components/ConfigureNotebookDialog.tsx","components/NoteCard.tsx","components/Notes.tsx","components/NotesPanel.tsx","components/WikiPanel.tsx","pages/Home.tsx","utilities/image_uploader.ts","editor/widgets/Image.tsx","editor/widgets/Audio.tsx","editor/widgets/NeteaseMusic.tsx","editor/widgets/Video.tsx","editor/widgets/Bilibili.tsx","editor/widgets/Youtube.tsx","editor/widgets/OCR.tsx","editor/widgets/Kanban.tsx","editor/widgets/ABC.tsx","editor/index.ts","App.tsx","serviceWorker.ts","index.tsx","utilities/utils.ts","utilities/note.ts"],"names":["Crossnote","props","fs","readFile","writeFile","readdir","unlink","stats","mkdir","exists","rename","rmdir","notebookDB","this","setUpFSMethods","PouchDB","plugin","PouchdbFind","createIndex","index","fields","path","Promise","resolve","reject","encoding","error","data","toString","files","stat","oldPath","newPath","dirPath","a","i","length","file","filePath","isDirectory","name","corsProxy","gitURL","branch","username","password","depth","rememberCredentials","cloneNotebook","_id","randomID","dir","notebook","trim","gitBranch","gitCorsProxy","gitUsername","gitPassword","git","put","match","Error","http","url","ref","singleBranch","onAuth","auth","getDefaultNotebookNameFromGitURL","notebookID","get","remove","note","newFilePath","replace","endsWith","filepath","newDirPath","dirNames","split","slice","paths","j","push","join","authorName","authorEmail","message","onProgress","onMessage","onAuthFailure","onAuthSuccess","listFiles","ok","refs","pullNotebook","numConflicts","logs","latestSha","oid","author","email","restoreSHA","progress","pushResult","stagedFiles","cache","status","markdown","currentSha","markdownHasConflicts","LINEBREAKS","markerSize","ourName","theirName","ourContent","theirContent","baseContentBlobResult","baseContent","Buffer","from","blob","ours","base","theirs","result","diff3Merge","mergedText","hasConflict","item","conflict","repeat","b","m1","m2","m3","filepaths","force","getNote","newNote","find","selector","$gt","notebooks","docs","endFrontMatterOffset","frontMatter","startsWith","indexOf","frontMatterString","window","parse","content","yamlStr","stringify","absFilePath","isFile","noteConfig","createdAt","Date","ctimeMs","modifiedAt","mtimeMs","tags","matter","Object","assign","matterStringify","config","includeSubdirectories","notes","listNotes","concat","encryption","title","getHeaderFromMarkdown","AES","encrypt","JSON","rootDirectory","children","filePaths","Set","add","forEach","value","directory","subDirectory","filter","rootTagNode","tag","node","t","toLocaleLowerCase","offset","findIndex","c","newNode","sort","x","y","localeCompare","lastIndexOf","i18next","use","initReactI18next","init","interpolation","escapeValue","keySeparator","lng","localStorage","getItem","fallbackLng","resources","translation","Editor","EDITOR","Viewer","VIEWER","Admin","ADMIN","ARCHIVED","DELETED","PINNED","OTHERS","BOOKMARKS","SelectedSectionType","OrderBy","OrderDirection","CrossnoteContainer","createContainer","initialState","useTranslation","crossnote","useState","setNotebooks","selectedNotebook","setSelectedNotebook","notebookNotes","setNotebookNotes","notebookDirectories","setNotebookDirectories","notebookTagNode","setNotebookTagNode","setNotes","selectedNote","setSelectedNote","setIncludeSubdirectories","type","Notes","selectedSection","setSelectedSection","isAddingNotebook","setIsAddingNotebook","isPushingNotebook","setIsPushingNotebook","isPullingNotebook","setIsPullingNotebook","displayMobileEditor","setDisplayMobileEditor","needsToRefreshNotes","setNeedsToRefreshNotes","wikiTOCElement","setWikiTOCElement","isLoadingNotebook","setIsLoadingNotebook","hasSummaryMD","setHasSummaryMD","ModifiedAt","orderBy","setOrderBy","DESC","orderDirection","setOrderDirection","updateNoteMarkdown","useCallback","callback","writeNote","then","getStatus","deleteNote","newNotes","n","getNotebookDirectoriesFromNotes","directories","getNotebookTagNodeFromNotes","changeNoteFilePath","map","Noty","text","layout","theme","timeout","show","createNewNote","fileName","Today","Todo","Tagged","Untagged","Tag","id","addNotebook","gitRememberCredentials","updateNotebook","deleteNotebook","_setSelectedNotebook","pushNotebook","args","checkoutNote","updateNotebookTagNode","openNoteAtPath","useEffect","listNotebooks","selectedNotebookID","now","getTime","OneDay","Conflicted","Encrypted","Wiki","CreatedAt","Title","useInterval","setItem","PushNotebookDialog","crossnoteContainer","useContainer","setAuthorName","setAuthorEmail","setGitUsername","setGitPassword","commitMessage","setCommitMessage","onClose","catch","open","Dialog","DialogTitle","Box","Typography","variant","DialogContent","TextField","label","fullWidth","onChange","event","target","placeholder","DialogActions","Button","color","disabled","onClick","useStyles","makeStyles","createStyles","imageWrapper","textAlign","imagePreview","maxWidth","maxHeight","EditImageDialog","classes","editor","marker","imageElement","imageSrc","setImageSrc","imageAlt","setImageAlt","imageTitle","setImageTitle","deleteImage","pos","replaceRange","to","updateImage","src","alt","style","width","className","clsx","autoFocus","helperText","EditorMode","VickyMD","require","is","editorPanel","height","display","flexDirection","topPanel","position","padding","spacing","alignItems","justifyContent","borderBottom","overflow","bottomPanel","borderTop","controlBtn","palette","secondary","controlBtnSelected","primary","main","controlBtnSelectedSecondary","row","cursorPositionInfo","zIndex","editorWrapper","flex","breakpoints","down","fullScreen","left","top","preview","border","backBtn","marginRight","up","menuItemOverride","cursor","backgroundColor","menuItemTextField","paddingRight","textAreaElement","setTextAreaElement","setEditor","line","ch","cursorPosition","setCursorPosition","deleteDialogOpen","setDeleteDialogOpen","filePathDialogOpen","setFilePathDialogOpen","pushDialogOpen","setPushDialogOpen","setNewFilePath","editorMode","setEditorMode","previewElement","setPreviewElement","gitStatus","setGitStatus","fullScreenMode","setFullScreenMode","tagsMenuAnchorEl","setTagsMenuAnchorEl","tagName","setTagName","tagNames","setTagNames","toggleEncryptionDialogOpen","setToggleEncryptionDialogOpen","toggleEncryptionPassword","setToggleEncryptionPassword","decryptionDialogOpen","setDecryptionDialogOpen","decryptionPassword","setDecryptionPassword","isDecrypted","setIsDecrypted","needsToPrint","setNeedsToPrint","editImageElement","setEditImageElement","editImageTextMarker","setEditImageTextMarker","editImageDialogOpen","setEditImageDialogOpen","closeFilePathDialog","closeEncryptionDialog","closeDecryptionDialog","changeFilePath","console","log","addTag","newTagNames","getValue","deleteTag","toggleEncryption","bytes","CryptoJS","decrypt","json","Utf8","setValue","setOption","decryptNote","togglePin","pinned","openURL","fromTextArea","mode","hashtag","inputStyle","on","instance","getCursor","changesHandler","getOption","keyupHandler","linkIconClickedHandler","element","getAttribute","imageClickedHandler","setAttribute","off","switchToHyperMD","getWrapperElement","refresh","SourceCode","switchToNormal","Preview","handleLinksClickEvent","links","getElementsByTagName","link","onclick","preventDefault","renderPreview","childElementCount","toUpperCase","contentDocument","body","innerHTML","onChangeHandler","changeObject","showHint","closeOnUnfocus","completeSingle","hint","token","getTokenAt","start","string","end","currentWord","commands","displayText","date","filtered","toLowerCase","list","removed","lines","timerTexts","dataMatch","dataStr","datetime","currentTimerText","previousTimerText","duration","formatDistance","includeSeconds","newText","onCursorActivityHandler","printDone","bannerElement","VickyMDPrintPreview","printPreview","onChangesHandler","ButtonGroup","aria-label","Tooltip","marginLeft","currentTarget","desktop","Popover","Boolean","anchorEl","keepMounted","List","ListItem","stopPropagation","onKeyUp","which","key","IconButton","margin","right","DialogContentText","Hidden","smUp","AddNotebookDialog","notebookName","setNotebookName","expanded","setExpanded","setGitURL","setGitBranch","setGitCorsProxy","rememberCredentialsChecked","setRememberCredentialsChecked","marginBottom","ExpansionPanel","elevation","ExpansionPanelSummary","expandIcon","ExpansionPanelDetails","FormControlLabel","control","Checkbox","checked","Link","href","canCancel","treeItemRoot","paddingLeft","treeItemContent","userSelect","fontWeight","typography","fontWeightMedium","fontWeightRegular","treeItemGroup","treeItemExpanded","treeItemLabel","treeItemLabelRoot","treeItemLabelIcon","treeItemLabelText","flexGrow","NotebookTreeView","handleChange","nodes","TreeView","defaultExpandIcon","disableFocusRipple","disableRipple","size","defaultCollapseIcon","defaultEndIcon","onNodeToggle","TreeItem","nodeId","root","group","role","constructDirectoryTreeItems","endIcon","Directory","constructTagNodeTreeItems","tagNode","ConfigureNotebookDialog","clickDeleteCount","setClickDeleteCount","noteCard","selected","borderLeft","unselected","leftPanel","rightPanel","header","wordBreak","summary","lineHeight","textOverflow","images","imagesWrapper","image","backgroundSize","backgroundPosition","borderRadius","pin","marginTop","NoteCard","setHeader","setSummary","setImages","formatDistanceStrict","generateSummaryFromMarkdown","ButtonBase","formatRelative","arrow","backgroundImage","notesList","overflowY","paddingBottom","notesListElement","setNotesListElement","searchValue","unpinned","regexp","RegExp","keyDownHandler","currentIndex","addEventListener","removeEventListener","notesPanel","sectionName","search","shape","fade","common","white","searchIcon","pointerEvents","inputRoot","inputInput","transition","transitions","create","loading","transform","sortSelected","NotesPanel","sortMenuAnchorEl","setSortMenuAnchorEl","setSearchValue","notebookConfigurationDialogOpen","setNotebookConfigurationDialogOpen","Card","implementation","toggleDrawer","InputBase","input","inputProps","button","ListItemText","Divider","ListItemIcon","ASC","CircularProgress","wikiPanel","toc","WikiPanel","page","appBar","drawer","boxShadow","toolBar","displayNone","flexShrink","drawerPaper","menuButton","mainPanel","toolBarSpace","mixins","toolbar","Home","addNotebookDialogOpen","setAddNotebookDialogOpen","drawerOpen","setDrawerOpen","disablePadding","disableGutters","Paper","CssBaseline","Drawer","paper","ModalProps","xsDown","promises","FormData","append","fetch","method","headers","referrer","response","all","card","actionButtons","section","dropArea","ImageWidget","setURL","imageUploaderElement","setImageUploaderElement","uploadingImages","setUploadingImages","isPreview","removeSelf","Input","onKeyDown","replaceSelf","e","onchange","smmsUploadImages","urls","click","multiple","AudioWidget","attributes","source","setSource","autoplay","setAutoplay","controls","setControls","loop","setLoop","muted","setMuted","autoPlay","attrs","Switch","NeteaseMusicWidget","setID","videoWrapper","paddingTop","video","VideoWidget","poster","setPoster","errorMessage","BilibiliWidget","setError","scrolling","frameBorder","allowFullScreen","aid","YoutubeWidget","videoID","canvasWrapper","canvas","OCRWidget","setCanvas","setLink","imageDataURL","setImageDataURL","ocrDataURL","setOCRDataURL","imageDropAreaElement","setImageDropAreaElement","isProcessing","setIsProcessing","ocrProgresses","setOCRProgresses","getInitialLanguages","selectedLanguages","setSelectedLanguages","grayscaleChecked","setGrayscaleChecked","toggleLanguage","lang","splice","imageObject","Image","context","getContext","onload","clearRect","fillStyle","fillRect","globalCompositeOperation","drawImage","toDataURL","onerror","ListItemSecondaryAction","Math","floor","FormGroup","removeItem","worker","createWorker","logger","m","languagesArr","load","loadLanguage","initialize","recognize","terminate","ocr","startOCRFromLink","reader","FileReader","readAsDataURL","columnHeader","kanbanCard","textarea","KanbanColumnHeaderDisplay","column","board","refreshBoard","clickedTitle","setClickedTitle","titleValue","setTitleValue","onBlur","description","cards","columns","l","KanbanCardDisplay","React","setDescription","editorDialogOpen","setEditDialogOpen","focus","minWidth","KanbanWidget","setBoard","lanes","newBoard","setAttributes","renderColumnHeader","renderCard","dragging","allowAddColumn","allowAddCard","renderColumnAdder","wip","onNewColumnConfirm","newColumn","disableCardDrag","disableColumnDrag","onCardDragEnd","destination","fromPosition","fromColumnId","toPosition","toColumnId","fromColumn","toColumn","onColumnDragEnd","resize","saveBtn","ABCWidget","generateUUID","abcEditorID","abcWarningsID","abcCanvasID","abcAudioID","editorElement","setEditorElement","warningsElement","setWarningsElement","canvasElement","setCanvasElement","audioControlElement","setAudioControlElement","hideEditor","abc","setABC","setTimeout","abcjs","canvas_id","warnings_id","generate_warnings","synth","el","options","displayLoop","displayRestart","displayPlay","displayProgress","displayWarp","abcjsParams","generateDownload","readOnly","registerWidgetCreator","document","createElement","ReactDOM","render","createMuiTheme","blue","orange","App","handler","prompt","userChoice","choiceResult","ThemeProvider","isLocalhost","location","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","LightningFS","Provider","getElementById","URL","process","origin","contentType","ready","unregister","reload","checkValidServiceWorker","UUIDNil","d","d2","performance","r","random","s","reduce","charCodeAt","abs","parseFloat","hashCode","substr","titleMatch","contentString","aheadString","coverMatch","coverImagesMatch","mdImage","self","html"],"mappings":"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","file":"static/js/main.4dbd5994.chunk.js","sourcesContent":["import * as git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport * as path from \"path\";\nimport PouchDB from \"pouchdb\";\nimport PouchdbFind from \"pouchdb-find\";\n// @ts-ignore\nimport diff3Merge from \"diff3\";\nimport { randomID } from \"../utilities/utils\";\nimport AES from \"crypto-js/aes\";\nimport { Stats } from \"fs\";\nimport { getHeaderFromMarkdown } from \"../utilities/note\";\n\nexport interface Notebook {\n  _id: string;\n  dir: string;\n  name: string;\n\n  // git\n  gitURL: string;\n  gitBranch: string;\n  gitCorsProxy?: string;\n  gitUsername?: string;\n  gitPassword?: string;\n}\n\nexport interface Note {\n  notebook: Notebook;\n  filePath: string;\n  markdown: string;\n  config: NoteConfig;\n  // createdAt: Date; // <- Can't get modifiedAt time\n}\n\nexport interface Directory {\n  name: string;\n  path: string;\n  children?: Directory[];\n}\n\nexport interface TagNode {\n  name: string;\n  path: string;\n  children?: TagNode[];\n  // numNotes: number;\n}\n\nexport interface NoteConfigEncryption {\n  title: string;\n  // method: string;? // Default AES256\n}\n\nexport interface NoteConfig {\n  id?: string;\n  createdAt: Date;\n  modifiedAt: Date;\n  tags?: string[];\n  pinned?: boolean;\n  encryption?: NoteConfigEncryption;\n}\n\nexport interface NotebookConfig {\n  repository: string;\n  branch: string;\n  author: string;\n  contributors: string[];\n}\n\ninterface CrossnoteConstructorProps {\n  fs: any;\n}\ninterface CloneNotebookArgs {\n  name?: string;\n  corsProxy?: string;\n  gitURL: string;\n  branch?: string;\n  depth?: number;\n  username?: string;\n  password?: string;\n  rememberCredentials?: boolean;\n}\n\ninterface ListNotesArgs {\n  notebook: Notebook;\n  dir: string;\n  includeSubdirectories?: Boolean;\n}\ninterface MatterOutput {\n  data: any;\n  content: string;\n}\n\nexport interface PushNotebookArgs {\n  notebook: Notebook;\n  authorName?: string;\n  authorEmail?: string;\n  username?: string;\n  password?: string;\n  message?: string;\n  onProgress?: (progress: git.GitProgressEvent) => void;\n  onMessage?: (message: string) => void;\n  onAuthFailure?: (url: string) => void;\n  onAuthSuccess?: (url: string) => void;\n}\n\nexport interface PullNotebookArgs {\n  notebook: Notebook;\n  onProgress?: (progress: git.GitProgressEvent) => void;\n  onMessage?: (message: string) => void;\n  onAuthFailure?: (url: string) => void;\n  onAuthSuccess?: (url: string) => void;\n}\n\ninterface PullNotebookResult {\n  numConflicts: number;\n}\n\nexport default class Crossnote {\n  private fs: any;\n\n  private readFile: (path: string) => Promise<string>;\n  private writeFile: (path: string, data: string) => Promise<void>;\n  private readdir: (path: string) => Promise<string[]>;\n  private unlink: (path: string) => Promise<void>;\n  private stats: (path: string) => Promise<Stats>;\n  private mkdir: (path: string) => Promise<void>;\n  private exists: (path: string) => Promise<boolean>;\n  private rename: (oldPath: string, newPath: string) => Promise<void>;\n  private rmdir: (path: string) => Promise<void>;\n\n  private notebookDB: PouchDB.Database<Notebook>;\n\n  constructor(props: CrossnoteConstructorProps) {\n    this.fs = props.fs;\n    this.setUpFSMethods();\n\n    PouchDB.plugin(PouchdbFind);\n    this.notebookDB = new PouchDB(\"notebooks\");\n    this.notebookDB.createIndex({\n      index: {\n        fields: [\"gitURL\"]\n      }\n    });\n  }\n\n  private setUpFSMethods() {\n    this.readFile = (path: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.readFile(\n          path,\n          { encoding: \"utf8\" },\n          (error: Error, data: string) => {\n            if (error) {\n              return reject(error);\n            } else {\n              return resolve(data.toString());\n            }\n          }\n        );\n      });\n    };\n    this.writeFile = (path: string, data: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.writeFile(path, data, { encoding: \"utf8\" }, (error: Error) => {\n          if (error) {\n            return reject(error);\n          } else {\n            return resolve();\n          }\n        });\n      });\n    };\n    this.readdir = (path: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.readdir(path, (error: Error, files: string[]) => {\n          if (error) {\n            return reject(error);\n          } else {\n            return resolve(files);\n          }\n        });\n      });\n    };\n    this.unlink = (path: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.unlink(path, (error: Error) => {\n          if (error) {\n            return reject(error);\n          } else {\n            return resolve();\n          }\n        });\n      });\n    };\n    this.stats = (path: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.stat(path, (error: Error, stats: Stats) => {\n          if (error) {\n            return reject(error);\n          } else {\n            return resolve(stats);\n          }\n        });\n      });\n    };\n    this.mkdir = (path: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.mkdir(path, \"0777\", (error: Error) => {\n          if (error) {\n            return reject(error);\n          } else {\n            return resolve();\n          }\n        });\n      });\n    };\n    this.exists = (path: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.stat(path, (error: Error, stats: Stats) => {\n          if (error) {\n            return resolve(false);\n          } else {\n            return resolve(true);\n          }\n        });\n      });\n    };\n    this.rename = (oldPath: string, newPath: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.rename(oldPath, newPath, (error: Error) => {\n          if (error) {\n            return reject(error);\n          } else {\n            return resolve();\n          }\n        });\n      });\n    };\n\n    const rmdir = (path: string) => {\n      return new Promise((resolve, reject) => {\n        this.fs.rmdir(path, (error: Error) => {\n          if (error) {\n            return reject(error);\n          } else {\n            return resolve();\n          }\n        });\n      });\n    };\n    // Remove the directory recursively\n    this.rmdir = async (dirPath: string) => {\n      const files = await this.readdir(dirPath);\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        const filePath = path.resolve(dirPath, file);\n        const stats = await this.stats(filePath);\n        if (stats.isDirectory()) {\n          await this.rmdir(filePath);\n        } else {\n          await this.unlink(filePath);\n        }\n      }\n\n      await rmdir(dirPath);\n    };\n  }\n\n  public async addNotebook({\n    name = \"\",\n    corsProxy,\n    gitURL,\n    branch = \"master\",\n    username = \"\",\n    password = \"\",\n    depth = 3,\n    rememberCredentials = false\n  }: CloneNotebookArgs) {\n    if (gitURL) {\n      return await this.cloneNotebook({\n        name,\n        corsProxy,\n        gitURL,\n        branch,\n        username,\n        password,\n        depth,\n        rememberCredentials\n      });\n    } else {\n      const _id = randomID();\n      const dir = `/notebooks/${_id}`;\n      const notebook: Notebook = {\n        _id,\n        dir,\n        name: name.trim() || \"Unnamed\",\n        gitURL: gitURL.trim(),\n        gitBranch: branch.trim() || \"master\",\n        gitCorsProxy: corsProxy.trim(),\n        gitUsername: rememberCredentials ? username.trim() : \"\",\n        gitPassword: rememberCredentials ? password : \"\"\n      };\n      if (!(await this.exists(\"/notebooks\"))) {\n        await this.mkdir(\"/notebooks\");\n      }\n      if (!(await this.exists(dir))) {\n        await this.mkdir(dir);\n      }\n      await git.init({\n        fs: this.fs,\n        dir\n      });\n\n      // Save to DB\n      try {\n        await this.notebookDB.put(notebook);\n      } catch (error) {\n        // Failed to save to DB\n        await this.rmdir(dir);\n      }\n\n      return notebook;\n    }\n  }\n\n  public async cloneNotebook({\n    name = \"\",\n    corsProxy,\n    gitURL,\n    branch = \"master\",\n    username = \"\",\n    password = \"\",\n    depth = 10,\n    rememberCredentials = false\n  }: CloneNotebookArgs): Promise<Notebook> {\n    if (!gitURL.match(/^https?:\\/\\//)) {\n      throw new Error(\"error/invalid-git-url-prefix\");\n    }\n\n    // Check if gitURL exists\n    /*\n    let exists = false;\n    try {\n      const notebooks = await this.notebookDB.find({\n        selector: {\n          gitURL: { $eq: gitURL }\n        }\n      });\n      if (notebooks.docs && notebooks.docs.length) {\n        exists = true;\n      }\n    } catch (error) {\n      exists = false;\n    }\n\n    if (exists) {\n      throw new Error(\"error/repository-already-cloned\");\n    }*/\n\n    const _id = randomID();\n    const dir = `/notebooks/${_id}`;\n\n    await git.clone({\n      fs: this.fs,\n      http,\n      dir,\n      corsProxy,\n      url: gitURL,\n      ref: branch.trim() || \"master\",\n      depth: depth,\n      singleBranch: true,\n      onAuth: (url, auth) => {\n        return {\n          username,\n          password\n        };\n      }\n    });\n\n    const notebook: Notebook = {\n      _id,\n      dir,\n      name: name || this.getDefaultNotebookNameFromGitURL(gitURL),\n      gitURL: gitURL,\n      gitBranch: branch.trim() || \"master\",\n      gitCorsProxy: corsProxy,\n      gitUsername: rememberCredentials ? username : \"\",\n      gitPassword: rememberCredentials ? password : \"\"\n    };\n\n    // Save to DB\n    try {\n      await this.notebookDB.put(notebook);\n    } catch (error) {\n      // Failed to save to DB\n      await this.rmdir(dir);\n    }\n\n    return notebook;\n  }\n\n  public async exportNotebookToJSON(notebook: Notebook): Promise<string> {\n    return \"\";\n  }\n\n  public async importNotebookFromJSON(notebook: Notebook): Promise<string> {\n    return \"\";\n  }\n\n  public async deleteNotebook(notebookID: string) {\n    const notebook = await this.notebookDB.get(notebookID);\n    await this.rmdir(notebook.dir);\n    await this.notebookDB.remove(notebook);\n  }\n  public async updateNotebook(notebook: Notebook) {\n    await this.notebookDB.put(notebook);\n  }\n  /*\n  public async makeDirectoryForNotebook(notebook: Notebook, dir: string) {\n    await this.mkdir(path.resolve(notebook.dir, dir));\n  }\n  public async removeDirectoryForNotebook(notebook: Notebook, dir: string) {\n    const notes = await this.listNotes({\n      notebook,\n      dir,\n      includeSubdirectories: true\n    });\n    for (let i = 0; i < notes.length; i++) {\n      const note = notes[i];\n      await this.deleteNote(notebook, note.filePath);\n    }\n    await this.unlink(path.resolve(notebook.dir, dir));\n  }\n  */\n\n  public async changeNoteFilePath(\n    notebook: Notebook,\n    note: Note,\n    newFilePath: string\n  ) {\n    newFilePath = newFilePath.replace(/^\\/+/, \"\");\n    if (!newFilePath.endsWith(\".md\")) {\n      newFilePath = newFilePath + \".md\";\n    }\n\n    try {\n      await git.remove({\n        fs: this.fs,\n        dir: notebook.dir,\n        filepath: note.filePath\n      });\n    } catch (error) {}\n\n    const newDirPath = path.dirname(path.resolve(notebook.dir, newFilePath));\n    // Make directories recursively\n    const dirNames = newDirPath.split(\"/\").slice(1);\n    for (let i = 0; i < dirNames.length; i++) {\n      const paths = [\"/\"];\n      for (let j = 0; j <= i; j++) {\n        paths.push(dirNames[j]);\n      }\n      if (!(await this.exists(paths.join(\"/\")))) {\n        await this.mkdir(paths.join(\"/\"));\n      }\n    }\n\n    // TODO: Check if newFilePath already exists. If so don't overwrite\n    const exists = await this.exists(path.resolve(notebook.dir, newFilePath));\n    if (exists) {\n      throw new Error(\"target file already exists\");\n    }\n\n    await this.rename(\n      path.resolve(notebook.dir, note.filePath),\n      path.resolve(notebook.dir, newFilePath)\n    );\n    await git.add({\n      fs: this.fs,\n      dir: notebook.dir,\n      filepath: newFilePath\n    });\n  }\n\n  public async pushNotebook({\n    notebook,\n    authorName = \"crossnote\",\n    authorEmail = \"anonymous@crossnote.com\",\n    username,\n    password,\n    message = \"doc: Updated docs\",\n    onProgress,\n    onMessage,\n    onAuthFailure,\n    onAuthSuccess\n  }: PushNotebookArgs): Promise<null | git.PushResult> {\n    const stagedFiles = await this.listFiles(notebook);\n    if (!stagedFiles.length) {\n      return {\n        ok: true,\n        error: null,\n        refs: {}\n      };\n    }\n\n    // Pull notebook first\n    const pullNotebookResult = await this.pullNotebook({\n      notebook,\n      onProgress,\n      onAuthFailure,\n      onAuthSuccess,\n      onMessage\n    });\n\n    if (pullNotebookResult.numConflicts > 0) {\n      throw new Error(\"error/please-resolve-conflicts\");\n    }\n\n    const logs = await git.log({\n      fs: this.fs,\n      dir: notebook.dir,\n      ref: `origin/${notebook.gitBranch || \"master\"}`,\n      depth: 5\n    });\n    const latestSha = (logs && logs[0] && logs[0].oid) || \"\";\n\n    const sha = await git.commit({\n      fs: this.fs,\n      dir: notebook.dir,\n      author: {\n        name: authorName,\n        email: authorEmail\n      },\n      message\n    });\n\n    const restoreSHA = async () => {\n      const gitBranch = notebook.gitBranch || \"master\";\n      await this.writeFile(\n        path.resolve(notebook.dir, `.git/refs/heads/${gitBranch}`),\n        latestSha\n      );\n    };\n\n    // console.log(sha);\n    const pushResult = await git.push({\n      fs: this.fs,\n      http,\n      onAuth: (url, auth) => {\n        return {\n          username: username, // || notebook.gitUsername,\n          password: password // || notebook.gitPassword\n        };\n      },\n      onProgress: progress => {\n        if (onProgress) {\n          onProgress(progress);\n        }\n      },\n      onMessage: message => {\n        if (onMessage) {\n          onMessage(message);\n        }\n      },\n      onAuthFailure: (url, auth) => {\n        if (onAuthFailure) {\n          onAuthFailure(url);\n        }\n        restoreSHA();\n      },\n      onAuthSuccess: (url, auth) => {\n        if (onAuthSuccess) {\n          onAuthSuccess(url);\n        }\n      },\n      url: notebook.gitURL,\n      dir: notebook.dir,\n      ref: notebook.gitBranch,\n      corsProxy: notebook.gitCorsProxy\n    });\n\n    // console.log(\"pushResult: \", pushResult);\n\n    if (pushResult.error) {\n      restoreSHA();\n    }\n\n    if (pushResult.ok) {\n      /*\n      // NOTE: This is wrong. It will cause all files to be deleted in next push\n      // Unstage all files\n      for (let i = 0; i < stagedFiles.length; i++) {\n        await git.remove({\n          fs: this.fs,\n          dir: notebook.dir,\n          filepath: stagedFiles[i]\n        });\n      }*/\n    }\n    return pushResult;\n  }\n\n  public async pullNotebook({\n    notebook,\n    onProgress,\n    onAuthFailure,\n    onAuthSuccess,\n    onMessage\n  }: PullNotebookArgs): Promise<PullNotebookResult> {\n    // TODO: If has conflicted notes, prevent pulling.\n\n    // NOTE: Seems like diff3 not working as I expected. Therefore I might create my own type of diff\n    const stagedFiles = await git.listFiles({ fs: this.fs, dir: notebook.dir });\n    const cache: {\n      [key: string]: {\n        status: string;\n        markdown: string;\n      };\n    } = {};\n    for (let i = 0; i < stagedFiles.length; i++) {\n      const status = await git.status({\n        fs: this.fs,\n        dir: notebook.dir,\n        filepath: stagedFiles[i]\n      });\n      if (status.match(/^\\*?(modified|added)/)) {\n        cache[stagedFiles[i]] = {\n          status,\n          markdown: await this.readFile(\n            path.resolve(notebook.dir, stagedFiles[i])\n          )\n        };\n      }\n    }\n\n    let logs = await git.log({\n      fs: this.fs,\n      dir: notebook.dir,\n      ref: `origin/${notebook.gitBranch || \"master\"}`,\n      depth: 5\n    });\n    const currentSha = (logs && logs[0] && logs[0]).oid;\n\n    await git.pull({\n      fs: this.fs,\n      http,\n      dir: notebook.dir,\n      singleBranch: true,\n      corsProxy: notebook.gitCorsProxy,\n      ref: notebook.gitBranch || \"master\",\n      author: {\n        name: \"anonymous\",\n        email: \"anonymous@crossnote.app\"\n      },\n      // fastForwardOnly: true,\n      onAuth: (url, auth) => {\n        return {\n          username: notebook.gitUsername,\n          password: notebook.gitPassword\n        };\n      },\n      onProgress,\n      onAuthFailure,\n      onAuthSuccess,\n      onMessage\n    });\n\n    logs = await git.log({\n      fs: this.fs,\n      dir: notebook.dir,\n      ref: `origin/${notebook.gitBranch || \"master\"}`,\n      depth: 5\n    });\n    const latestSha = (logs && logs[0] && logs[0]).oid;\n\n    let numConflicts = 0;\n    if (currentSha === latestSha) {\n      // Restore from cache\n      // console.log(\"same\");\n      for (const filePath in cache) {\n        const markdown = cache[filePath].markdown;\n        await this.writeFile(path.resolve(notebook.dir, filePath), markdown);\n        await git.add({\n          fs: this.fs,\n          dir: notebook.dir,\n          filepath: filePath\n        });\n        if (this.markdownHasConflicts(markdown)) {\n          numConflicts += 1;\n        }\n      }\n    } else {\n      // Check conflicted notes\n      // console.log(\"check conflicted\");\n      const LINEBREAKS = /^.*(\\r?\\n|$)/gm;\n      const markerSize = 7;\n      const ourName = \"ours\";\n      const theirName = \"theirs\";\n      // const baseName = \"base\";\n      for (const filePath in cache) {\n        const ourContent = cache[filePath].markdown;\n        if (await this.exists(path.resolve(notebook.dir, filePath))) {\n          const theirContent = await this.readFile(\n            path.resolve(notebook.dir, filePath)\n          );\n          const baseContentBlobResult = await git.readBlob({\n            fs: this.fs,\n            dir: notebook.dir,\n            oid: currentSha,\n            filepath: filePath\n          });\n          const baseContent = Buffer.from(baseContentBlobResult.blob).toString(\n            \"utf8\"\n          );\n          // console.log(\"ourContent: \", ourContent);\n          // console.log(\"theirContent: \", theirContent);\n          // console.log(\"baseContent: \", baseContent);\n\n          // TODO: clean front-matter\n\n          // Refered from https://github.com/isomorphic-git/isomorphic-git/blob/4e66704d05042624bbc78b85ee5110d5ee7ec3e2/src/utils/mergeFile.js\n          const ours = ourContent.match(LINEBREAKS);\n          const base = baseContent.match(LINEBREAKS);\n          const theirs = theirContent.match(LINEBREAKS);\n\n          // Here we let the diff3 library do the heavy lifting.\n          const result = diff3Merge(ours, base, theirs);\n\n          // Here we note whether there are conflicts and format the results\n          let mergedText = \"\";\n          let hasConflict = false;\n          for (const item of result) {\n            if (item.ok) {\n              mergedText += item.ok.join(\"\");\n            }\n            if (item.conflict) {\n              hasConflict = true;\n              mergedText += `\\\\<${\"<\".repeat(markerSize - 1)} ${ourName}\\n`;\n              mergedText += item.conflict.a.join(\"\");\n              // if (format === \"diff3\") {\n              //mergedText += `\\\\|${\"|\".repeat(markerSize - 1)} ${baseName}\\n`;\n              //mergedText += item.conflict.o.join(\"\");\n              // }\n              mergedText += `\\\\=${\"=\".repeat(markerSize - 1)}\\n`;\n              mergedText += item.conflict.b.join(\"\");\n              mergedText += `\\\\>${\">\".repeat(markerSize - 1)} ${theirName}\\n`;\n            }\n          }\n          if (hasConflict) {\n            numConflicts += 1;\n          }\n\n          // console.log(\"mergedText: \", mergedText);\n          await this.writeFile(\n            path.resolve(notebook.dir, filePath),\n            mergedText\n          );\n          await git.add({\n            fs: this.fs,\n            dir: notebook.dir,\n            filepath: filePath\n          });\n        } else {\n          const markdown = cache[filePath].markdown;\n          await this.writeFile(path.resolve(notebook.dir, filePath), markdown);\n          await git.add({\n            fs: this.fs,\n            dir: notebook.dir,\n            filepath: filePath\n          });\n        }\n      }\n    }\n    return {\n      numConflicts\n    };\n  }\n\n  public markdownHasConflicts(markdown: string): boolean {\n    const m1 = markdown.match(/^\\\\<+\\s/gm);\n    const m2 = markdown.match(/^\\\\=+\\s/gm);\n    const m3 = markdown.match(/^\\\\>+\\s/gm);\n    return m1 && m1.length > 0 && m2 && m2.length > 0 && m3 && m3.length > 0;\n  }\n\n  public async checkoutNote(note: Note): Promise<Note> {\n    try {\n      await git.checkout({\n        fs: this.fs,\n        dir: note.notebook.dir,\n        // ref: \"HEAD\"\n        // ref: note.notebook.gitBranch,\n        filepaths: [note.filePath],\n        force: true\n      });\n      if (await this.exists(path.resolve(note.notebook.dir, note.filePath))) {\n        await git.add({\n          // .remove is wrong\n          fs: this.fs,\n          dir: note.notebook.dir,\n          filepath: note.filePath\n        });\n      }\n      const newNote = await this.getNote(note.notebook, note.filePath);\n      return newNote;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  public async listNotebooks(): Promise<Notebook[]> {\n    const notebooks = (\n      await this.notebookDB.find({\n        selector: {\n          gitURL: { $gt: null }\n        }\n      })\n    ).docs;\n    // console.log(notebooks);\n\n    // Restore to remote ref\n    for (let i = 0; i < notebooks.length; i++) {\n      const notebook = notebooks[i];\n      if (notebook.gitURL.trim().length <= 0) {\n        // no remote set\n        continue;\n      }\n      const gitBranch = notebook.gitBranch || \"master\";\n      const logs = await git.log({\n        fs: this.fs,\n        dir: notebook.dir,\n        ref: `origin/${gitBranch}`,\n        depth: 5\n      });\n      const latestSha = (logs && logs[0] && logs[0].oid) || \"\";\n      await this.writeFile(\n        path.resolve(notebook.dir, `.git/refs/heads/${gitBranch}`),\n        latestSha\n      );\n    }\n\n    return notebooks;\n  }\n\n  public async listFiles(notebook: Notebook) {\n    return await git.listFiles({\n      fs: this.fs,\n      dir: notebook.dir\n    });\n  }\n\n  private matter(markdown: string): MatterOutput {\n    let endFrontMatterOffset = 0;\n    let frontMatter = {};\n    if (\n      markdown.startsWith(\"---\") &&\n      /* tslint:disable-next-line:no-conditional-assignment */\n      (endFrontMatterOffset = markdown.indexOf(\"\\n---\")) > 0\n    ) {\n      const frontMatterString = markdown.slice(3, endFrontMatterOffset);\n      try {\n        frontMatter = (window as any)[\"YAML\"].parse(frontMatterString);\n      } catch (error) {}\n      markdown = markdown\n        .slice(endFrontMatterOffset + 4)\n        .replace(/^[ \\t]*\\n/, \"\");\n    }\n    return {\n      data: frontMatter,\n      content: markdown\n    };\n  }\n\n  private matterStringify(markdown: string, frontMatter: any) {\n    frontMatter = frontMatter || {};\n    const yamlStr = (window as any)[\"YAML\"].stringify(frontMatter).trim();\n    if (yamlStr === \"{}\" || !yamlStr) {\n      return markdown;\n    } else {\n      return `---\n${yamlStr}\n---\n${markdown}`;\n    }\n  }\n\n  public async getNote(\n    notebook: Notebook,\n    filePath: string,\n    stats?: Stats\n  ): Promise<Note> {\n    const absFilePath = path.resolve(notebook.dir, filePath);\n    if (!stats) {\n      try {\n        stats = await this.stats(absFilePath);\n      } catch (error) {\n        return null;\n      }\n    }\n    if (stats.isFile() && filePath.endsWith(\".md\")) {\n      let markdown = await this.readFile(absFilePath);\n      // console.log(\"read: \", filePath, markdown);\n\n      // Read the noteConfig, which is like <!-- note {...} --> at the end of the markdown file\n      let noteConfig: NoteConfig = {\n        // id: \"\",\n        createdAt: new Date(stats.ctimeMs),\n        modifiedAt: new Date(stats.mtimeMs),\n        tags: []\n      };\n\n      try {\n        const data = this.matter(markdown);\n        noteConfig = Object.assign(noteConfig, data.data[\"note\"] || {});\n        const frontMatter: any = Object.assign({}, data.data);\n        delete frontMatter[\"note\"];\n        // markdown = matter.stringify(data.content, frontMatter); // <= NOTE: I think gray-matter has bug. Although I delete \"note\" section from front-matter, it still includes it.\n        markdown = this.matterStringify(data.content, frontMatter);\n      } catch (error) {\n        // Do nothing\n        markdown =\n          \"Please fix front-matter. (👈 Don't forget to delete this line)\\n\\n\" +\n          markdown;\n      }\n\n      // Create note\n      const note: Note = {\n        notebook: notebook,\n        filePath: path.relative(notebook.dir, absFilePath),\n        markdown,\n        config: noteConfig\n      };\n      return note;\n    } else {\n      return null;\n    }\n  }\n\n  public async listNotes({\n    notebook,\n    dir = \"./\",\n    includeSubdirectories = false\n  }: ListNotesArgs): Promise<Note[]> {\n    let notes: Note[] = [];\n    let files: string[] = [];\n    try {\n      files = await this.readdir(path.resolve(notebook.dir, dir));\n    } catch (error) {\n      files = [];\n    }\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      const absFilePath = path.resolve(notebook.dir, dir, file);\n      const stats = await this.stats(absFilePath);\n      const note = await this.getNote(\n        notebook,\n        path.relative(notebook.dir, absFilePath),\n        stats\n      );\n      if (note) {\n        notes.push(note);\n      }\n\n      if (stats.isDirectory() && file !== \".git\" && includeSubdirectories) {\n        notes = notes.concat(\n          await this.listNotes({\n            notebook,\n            dir: path.relative(notebook.dir, absFilePath),\n            includeSubdirectories\n          })\n        );\n      }\n    }\n\n    // console.log(\"listNotes: \", notes);\n    return notes;\n  }\n  public async writeNote(\n    notebook: Notebook,\n    filePath: string,\n    markdown: string,\n    noteConfig: NoteConfig,\n    password?: string\n  ): Promise<NoteConfig> {\n    noteConfig.modifiedAt = new Date();\n\n    try {\n      const data = this.matter(markdown);\n      if (data.data[\"note\"] && data.data[\"note\"] instanceof Object) {\n        noteConfig = Object.assign({}, noteConfig, data.data[\"note\"] || {});\n      }\n      const frontMatter = Object.assign(data.data || {}, { note: noteConfig });\n      markdown = data.content;\n      if (noteConfig.encryption) {\n        // TODO: Refactor\n        noteConfig.encryption.title = getHeaderFromMarkdown(markdown);\n        markdown = AES.encrypt(\n          JSON.stringify({ markdown }),\n          password || \"\"\n        ).toString();\n      }\n      markdown = this.matterStringify(markdown, frontMatter);\n    } catch (error) {\n      if (noteConfig.encryption) {\n        // TODO: Refactor\n        noteConfig.encryption.title = getHeaderFromMarkdown(markdown);\n        markdown = AES.encrypt(\n          JSON.stringify({ markdown }),\n          password || \"\"\n        ).toString();\n      }\n      markdown = this.matterStringify(markdown, { note: noteConfig });\n    }\n\n    await this.writeFile(path.resolve(notebook.dir, filePath), markdown);\n    await git.add({\n      fs: this.fs,\n      dir: notebook.dir,\n      filepath: filePath\n    });\n    return noteConfig;\n  }\n  public async deleteNote(notebook: Notebook, filePath: string) {\n    if (await this.exists(path.resolve(notebook.dir, filePath))) {\n      await git.remove({\n        fs: this.fs,\n        dir: notebook.dir,\n        filepath: filePath\n      });\n      await this.unlink(path.resolve(notebook.dir, filePath));\n    }\n  }\n\n  // public async moveNote(fromFilePath: string, toFilePath: string) {}\n  public async getNotebookDirectoriesFromNotes(\n    notes: Note[]\n  ): Promise<Directory> {\n    const rootDirectory: Directory = {\n      name: \".\",\n      path: \".\",\n      children: []\n    };\n\n    const filePaths = new Set<string>([]);\n    for (let i = 0; i < notes.length; i++) {\n      filePaths.add(path.dirname(notes[i].filePath));\n    }\n\n    filePaths.forEach(value => {\n      const dirNames = value.split(\"/\");\n      let directory = rootDirectory;\n      for (let i = 0; i < dirNames.length; i++) {\n        if (dirNames[i] === \".\") {\n          break;\n        } else {\n          let subDirectory = directory.children.filter(\n            directory => directory.name === dirNames[i]\n          )[0];\n          if (subDirectory) {\n            directory = subDirectory;\n          } else {\n            let paths: string[] = [];\n            for (let j = 0; j <= i; j++) {\n              paths.push(dirNames[j]);\n            }\n            subDirectory = {\n              name: dirNames[i],\n              path: paths.join(\"/\"),\n              children: []\n            };\n            directory.children.push(subDirectory);\n            directory = subDirectory;\n          }\n        }\n      }\n    });\n\n    return rootDirectory;\n  }\n\n  public getNotebookTagNodeFromNotes(notes: Note[]): TagNode {\n    const rootTagNode: TagNode = {\n      name: \".\",\n      path: \".\",\n      children: []\n    };\n\n    for (let i = 0; i < notes.length; i++) {\n      const note = notes[i];\n      const tags = note.config.tags || [];\n      tags.forEach(tag => {\n        let node = rootTagNode;\n        tag.split(\"/\").forEach((t, index) => {\n          t = t.toLocaleLowerCase().replace(/\\s+/g, \" \");\n          const offset = node.children.findIndex(c => c.name === t);\n          if (offset >= 0) {\n            node = node.children[offset];\n          } else {\n            const newNode: TagNode = {\n              name: t,\n              path: node.name === \".\" ? t : node.path + \"/\" + t,\n              children: []\n            };\n            node.children.push(newNode);\n            node.children.sort((x, y) => x.name.localeCompare(y.name));\n            node = newNode;\n          }\n        });\n      });\n    }\n\n    return rootTagNode;\n  }\n\n  public async hasSummaryMD(notebook: Notebook): Promise<boolean> {\n    if (!notebook || !notebook.dir) {\n      return false;\n    }\n    return await this.exists(path.resolve(notebook.dir, \"SUMMARY.md\"));\n  }\n\n  private getDefaultNotebookNameFromGitURL(gitURL: string) {\n    const i = gitURL.lastIndexOf(\"/\");\n    return gitURL.slice(i + 1).replace(/\\.git/, \"\");\n  }\n\n  public async getStatus(note: Note) {\n    return await git.status({\n      fs: this.fs,\n      dir: note.notebook.dir,\n      filepath: note.filePath\n    });\n  }\n}\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport { zhCN, enUS, zhTW, ja } from \"date-fns/locale\";\nimport { enUS as enUSLanguage } from \"./lang/enUS\";\n// import { zhCN as zhCNLanguage } from \"./lang/zhCN\";\n// import { zhTW as zhTWLanguage } from \"./lang/zhTW\";\n// import { jaJP as jaJPLanguage } from \"./lang/jaJP\";\n\ni18next.use(initReactI18next).init({\n  interpolation: {\n    // React already does escaping\n    escapeValue: false\n  },\n  keySeparator: false, // we do not use keys in form messages.welcome\n  lng: localStorage.getItem(\"language\") || \"en-US\", // \"en-US\" | \"zh-CN\"\n  fallbackLng: \"en-US\",\n  resources: {\n    \"en-US\": enUSLanguage\n    // TODO: Support other languages\n    // \"zh-CN\": zhCNLanguage,\n    // \"zh-TW\": zhTWLanguage,\n    // \"ja-JP\": jaJPLanguage\n  }\n});\n\nexport default i18next;\n\nexport function languageCodeToLanguageName(code: string) {\n  if (code === \"zh-CN\") {\n    return \"简体中文\";\n  } else if (code === \"zh-TW\") {\n    return \"繁体中文\";\n  } else if (code === \"ja-JP\") {\n    return \"日本語\";\n  } else {\n    return \"English\";\n  }\n}\n\nexport function languageCodeToDateFNSLocale(code: string) {\n  if (code === \"zh-CN\") {\n    return zhCN;\n  } else if (code === \"en-US\") {\n    return enUS;\n  } else if (code === \"zh-HK\") {\n    return zhTW;\n  } else if (code === \"ja-JP\") {\n    return ja;\n  } else {\n    return enUS;\n  }\n}\n","export const enUS = {\n  translation: {\n    \"title/Crossnote\": \"Crossnote\",\n    \"search/placeholder\": \"Search Notes\",\n\n    // Account\n    \"account/Anonymous\": \"Anonymous\",\n    \"account/anonymous\": \"anonymous\",\n\n    // General\n    \"general/go-back\": \"Go back\",\n    \"general/sending\": \"Sending\",\n    \"general/send\": \"Send\",\n    \"general/cancel\": \"Cancel\",\n    \"general/backed-up-at\": \"Backed up at\",\n    \"general/created-at\": \"Created at\",\n    \"general/modified-at\": \"Modified at\",\n    \"general/interacted-at\": \"Interacted at\",\n    \"general/date-created\": \"Date created\",\n    \"general/date-modified\": \"Date modified\",\n    \"general/date-interacted\": \"Date interacted\",\n    \"general/saved-at\": \"Saved at\",\n    \"general/loading\": \"Loading ...\",\n    \"general/loading-notifications\": \"Loading notifications ...\",\n    \"general/failed-to-set\": \"Failed to set\",\n    \"general/update\": \"Update\",\n    \"general/updated\": \"Updated\",\n    \"general/updating\": \"Updating\",\n    \"general/close\": \"Close\",\n    \"general/Note\": \"Note\",\n    \"general/notes\": \"notes\",\n    \"general/Settings\": \"Settings\",\n    \"general/Collaborators\": \"Collaborators\",\n    \"general/collaborators\": \"collaborators\",\n    \"general/Backups\": \"Backups\",\n    \"general/backups\": \"backups\",\n    \"general/Discussion\": \"Discussion\",\n    \"general/discussion\": \"discussion\",\n    \"general/Notifications\": \"Notifications\",\n    \"general/Username\": \"Username\",\n    \"general/Email\": \"Email\",\n    \"general/Password\": \"Password\",\n    \"general/confirm-password\": \"Confirm password\",\n    \"general/Continue\": \"Continue\",\n    \"general/enter-username\": \"Enter username\",\n    \"general/vickymd\": \"VickyMD\",\n    \"general/tags\": \"Tags\",\n    \"general/add-a-tag\": \"Add a tag\",\n    \"general/private\": \"Private\",\n    \"general/public\": \"Public\",\n    \"general/friends-only\": \"Friends only\",\n    \"general/anonymous\": \"Anonymous\",\n    \"general/onymous\": \"Onymous\",\n    \"general/Tag\": \"Tag\",\n    \"general/no-tags\": \"No tags\",\n    \"general/Untitled\": \"Untitled\",\n    \"general/untitled\": \"untitled\",\n    \"general/Unknown\": \"Unknown\",\n    \"general/unknown\": \"unknown\",\n    \"general/Agree\": \"Agree\",\n    \"general/Disagree\": \"Disagree\",\n    \"general/Print\": \"Print\",\n    Editor: \"Editor\",\n    EDITOR: \"EDITOR\",\n    Viewer: \"Viewer\",\n    VIEWER: \"VIEWER\",\n    Admin: \"Admin\",\n    ADMIN: \"ADMIN\",\n    ARCHIVED: \"ARCHIVED\",\n    \"ATTACHED NOTES\": \"ATTACHED NOTES\",\n    DELETED: \"DELETED\",\n    PINNED: \"PINNED\",\n    OTHERS: \"OTHERS\",\n    \"PUBLIC NOTES\": \"PUBLIC NOTES\",\n    \"FOLLOWINGS' NOTES\": \"FOLLOWINGS' NOTES\",\n    \"SHARED WITH ME\": \"SHARED WITH ME\",\n    BOOKMARKS: \"BOOKMARKS\",\n    \"MY TAGS\": \"MY TAGS\",\n    \"general/enter-fullscreen-mode\": \"Enter fullscreen mode\",\n    \"general/enter-presentation-mode\": \"Enter presentation mode\",\n    \"general/math-preview\": \"Math Preview\",\n    \"general/this-note-is-empty\": \"This note is empty\",\n    \"general/no-notes-found\": \"No notes found\",\n    \"general/no-notifications-found\": \"No notifications found\",\n    \"general/clear-all\": \"Clear all\",\n    \"general/Save\": \"Save\",\n    \"general/Delete\": \"Delete\",\n    \"general/Follow\": \"Follow\",\n    \"general/Following\": \"Following\",\n    \"general/Unfollow\": \"Unfollow\",\n    \"general/my-notes\": \"My notes\",\n    \"general/public-notes\": \"Public notes\",\n    \"general/followings-notes\": \"Followings' notes\",\n    \"general/shared-with-me\": \"Shared with me\",\n    \"general/Bookmarks\": \"Bookmarks\",\n    \"general/Archive\": \"Archive\",\n    \"general/Trash\": \"Trash\",\n    \"general/new-note\": \"New note\",\n    \"general/profile-updated\": \"Profile updated\",\n    \"general/ID\": \"ID\",\n    \"general/Audio\": \"Audio\",\n    \"general/Video\": \"Video\",\n    \"general/source-url\": \"Source URL\",\n    \"general/sign-in\": \"Sign in\",\n    \"general/sign-up\": \"Sign up\",\n    \"general/Link\": \"Link\",\n    \"general/Upload\": \"Upload\",\n    \"general/clicks\": \"clicks\",\n    \"general/Processing\": \"Processing...\",\n    \"general/please-wait\": \"please wait...\",\n    \"general/Languages\": \"Languages\",\n    \"general/track\": \"Track\",\n    \"general/Publish\": \"Publish\",\n    \"general/empty\": \"empty\",\n\n    // Note\n    \"note/unarchive-note\": \"Unarchive note\",\n    \"note/archive-note\": \"Archive note\",\n    \"note/delete-forever\": \"Delete forever\",\n    \"note/delete-note\": \"Delete note\",\n    \"note/restore-note\": \"Restore note\",\n    \"note/report-note\": \"Report note\",\n    \"note/open-in-crossnote-website\": \"Open in Crossnote website\",\n\n    // NoteTags\n    \"note-tags/send-suggestion-failure\": \"Failed to send suggestion\",\n    \"note-tags/suggestion-sent\": \"Suggestion sent\",\n    \"note-tags/suggest-a-tag-to-this-note\": \"Suggest a tag to this note\",\n\n    // UserTags\n    \"user-tags/follow-a-tag\": \"Follow a tag\",\n\n    // ChatMessage\n    \"chat-message/reply-to-this-user\": \"Reply to this user\",\n    \"chat-message/add-reaction-to-this-message\": \"Add reaction to this message\",\n    \"chat-message/edit-this-message\": \"Edit this message\",\n    \"chat-message/modified-message\": \"modified message\",\n\n    // ChatPanel\n    \"chat-panel/post-message-failure\": \"Failed to post message\",\n    \"chat-panel/unsubscribe-info\":\n      \"Unsubscribing from this chat group will stop you from receiving notifications unless someone mentions you\",\n    \"chat-panel/subscribe-info\":\n      \"Subscribing to this chat group will let you receive notifications whenever someone posts a message\",\n\n    // Notifications\n    \"notifications/refresh\": \"Refresh to see new notifications\",\n\n    // Settings\n    \"settings/about-this-project\": \"About this project 🤔\",\n    \"settings/uploading-cover-image\": \"Uploading cover image\",\n    \"settings/upload-image-failure\": \"Failed to upload image\",\n    \"settings/Cover\": \"Cover\",\n    \"settings/enter-cover-image-url\": \"Enter cover image URL\",\n    \"settings/upload-image\": \"Upload image\",\n    \"settings/Avatar\": \"Avatar\",\n    \"settings/enter-avatar-image-url\": \"Enter avatar image URL\",\n    \"settings/Name\": \"Name\",\n    \"settings/enter-name\": \"Enter your Name (this is not your username)\",\n    \"settings/editor-cursor-color\": \"Editor cursor color\",\n    \"settings/hello\": \"Hello, \",\n    \"settings/world\": \"world!\",\n    \"settings/linked-with-github-account\": \"Linked with GitHub account\",\n    \"settings/link-with-github-account\": \"Link with GitHub account\",\n    \"settings/log-out\": \"Log out\",\n\n    // Preview\n    \"preview/attach-a-note\": \"Attach a note\",\n    \"preview/crossnote-untitled\": \"Crossnote - Untitled\",\n    \"preview/edit-this-note\": \"Edit this note\",\n\n    // ProfileCard\n    \"profile-card/followings\": \"followings\",\n    \"profile-card/followers\": \"followers\",\n    \"profile-card/Followings\": \"Followings\",\n    \"profile-card/Followers\": \"Followers\",\n    \"profile-card/notes\": \"notes\",\n    \"profile-card/follow-user-failure\": \"Failed to follow user\",\n    \"profile-card/followed-user\": \"Followed user\",\n    \"profile-card/unfollow-user-failure\": \"Failed to unfollow user\",\n    \"profile-card/unfollowed-user\": \"Unfollowed user\",\n\n    // TagCard\n    \"tag-card/pin-to-my-notes-page\": \"Pin to my notes page\",\n\n    // Interaction panel\n    \"interaction-panel/show-attached-notes\": \"Show attached notes\",\n    \"interaction-panel/add-comment\": \"Add comment\",\n    \"interaction-panel/add-reaction\": \"Add reaction\",\n\n    // Editor\n    \"editor/loading-your-note\": \"Loading your note...\",\n    \"editor/sync-failure\": \"Failed to sync... Please refresh your page\",\n    \"editor/saving\": \"Saving...\",\n    \"editor/save-failure\": \"Failed to save\",\n    \"editor/saved\": \"Saved\",\n    \"editor/update-note-failure\": \"Failed to update note\",\n    \"editor/placeholder\": \"#  Hi 😀 Type '/' for commands\",\n\n    // * NoteControl\n    \"editor/note-control/allow-readers-to-suggest-note-tags\":\n      \"Allow readers to suggest note tags\",\n    \"editor/note-control/allow-readers-to-attach-notes-under-this-note\":\n      \"Allow readers to attach notes under this note\",\n    \"editor/note-control/inherit-parent-note-collaborators-list\":\n      \"Inherit parent note collaborators list\",\n    \"editor/note-control/note-visibility-hint\":\n      \"All collaborators will be able to see this note\",\n    \"editor/note-control/allow-readers-to-attach-notes-unchecked\":\n      \"Applies to you and collaborators that can edit and admin\",\n    \"editor/note-control/allow-readers-to-attach-notes-checked\":\n      \"Applies to anyone that can view this note\",\n    \"editor/note-control/enter-parent-note-id\": \"Enter parent note ID\",\n    \"editor/note-control/attach-note-failure\": \"Failed to attach note\",\n    \"editor/note-control/unattach-note-failure\": \"Failed to unattach note\",\n    \"editor/collaborator-hint\": \" - note will be visible to them\",\n    \"editor/shareable-link-hint\":\n      \"people with the link can view/edit this note with no need of login\",\n\n    // * BackupsControl\n    \"editor/backups-control/create-backup\": \"Create backup\",\n    \"editor/backups-control/delete-this-backup\": \"Delete this backup\",\n    \"editor/backups-control/create-backup-failure\": \"Failed to create backup\",\n    \"editor/backups-control/backup-created\": \"Backup created\",\n    \"editor/backups-control/delete-backup-failure\": \"Failed to delete backup\",\n    \"editor/backups-control/backup-deleted\": \"Backup deleted\",\n    \"editor/backups-control/cloud-version\": \"Cloud version\",\n    \"editor/backups-control/backup-name\": \"Backup name\",\n\n    // * CollaboratorasControl\n    \"editor/collaborators-control/set-collaborator-role-failure\":\n      \"Failed to set collaborator role\",\n    \"editor/collaborators-control/add-collaborator-failure\":\n      \"Failed to add collaborator\",\n    \"editor/collaborators-control/collaborator-removed\": \"Collaborator removed\",\n    \"editor/collaborators-control/collaborator-added\": \"Collaborator added\",\n    \"editor/collaborators-control/can-view\": \"Can view\",\n    \"editor/collaborators-control/can-edit\": \"Can edit\",\n    \"editor/collaborators-control/can-administrate\": \"Can administrate\",\n\n    // * EditorToolBar\n    \"editor/toolbar/insert-image\": \"Insert image\",\n    \"editor/toolbar/upload-local-images\": \"Upload local images\",\n    \"editor/toolbar/capture-webpage\": \"Capture the whole webpage\",\n    \"editor/toolbar/insert-clock\": \"Insert clock\",\n    \"editor/toolbar/insert-emoji\": \"Insert emoji\",\n    \"editor/toolbar/insert-media\": \"Insert media\",\n    \"editor/toolbar/audio-url\": \"Audio URL\",\n    \"editor/toolbar/netease-music\": \"Netease Music\",\n    \"editor/toolbar/video-url\": \"Video URL\",\n    \"editor/toolbar/youtube\": \"Youtube\",\n    \"editor/toolbar/bilibili\": \"Bilibili\",\n    \"editor/toolbar/insert-slide\": \"Insert slide\",\n    \"editor/toolbar/insert-ocr\": \"Insert OCR\",\n    \"editor/toolbar/insert-kanban\": \"Insert Kanban\",\n    \"editor/toolbar/insert-abc-notation\": \"Insert ABC notation\",\n    \"editor/toolbar/insert-header-1\": \"Insert header 1\",\n    \"editor/toolbar/insert-header-2\": \"Insert header 2\",\n    \"editor/toolbar/insert-header-3\": \"Insert header 3\",\n    \"editor/toolbar/insert-header-4\": \"Insert header 4\",\n    \"editor/toolbar/insert-header-5\": \"Insert header 5\",\n    \"editor/toolbar/insert-header-6\": \"Insert header 6\",\n    \"editor/toolbar/bold\": \"Bold\",\n    \"editor/toolbar/italic\": \"Italic\",\n    \"editor/toolbar/strikethrough\": \"Strikethrough\",\n    \"editor/toolbar/insert-inline-code\": \"Insert inline code\",\n    \"editor/toolbar/insert-blockquote\": \"Insert blockquote\",\n    \"editor/toolbar/insert-unordered-list\": \"Insert unordered list\",\n    \"editor/toolbar/insert-ordered-list\": \"Insert ordered list\",\n    \"editor/toolbar/insert-link\": \"Insert link\",\n    \"editor/toolbar/insert-table\": \"Insert table\",\n\n    // * NoteControl\n    \"editor/note-control/tag-added\": \"Tag added\",\n    \"editor/note-control/tag-deleted\": \"Tag deleted\",\n    \"editor/note-control/set-note-visibility-failure\":\n      \"Failed to set note visibility\",\n    \"editor/note-control/note-visibility-updated\": \"Note visibility updated\",\n    \"editor/note-control/set-author-visibility-failure\":\n      \"Failed to set author visibility\",\n    \"editor/note-control/author-visibility-updated\":\n      \"Author visibility updated\",\n    \"editor/note-control/editor-mode\": \"Editor mode\",\n    \"editor/note-control/source-code\": \"Source code\",\n    \"editor/note-control/preview\": \"Preview\",\n    \"editor/note-control/pin-preview\": \"Pin preview on the side\",\n    \"editor/note-control/display-modification-records\":\n      \"Display modification records\",\n    \"editor/note-control/note-visibility\": \"Note visibility\",\n    \"editor/note-control/author-visibility\": \"Author visibility\",\n    \"editor/note-control/shareable-link\": \"Shareable link\",\n    \"editor/note-control/copy-to-clipboard\": \"Copy to clipboard\",\n    \"editor/note-control/link-to-preview\": \"Link to preview\",\n    \"editor/note-control/link-to-editor\": \"Link to editor\",\n    \"editor/note-control/attach-to-note\": \"Attach to note\",\n    \"editor/note-control/source-added\": \"URL added\",\n    \"editor/note-control/source-deleted\": \"URL deleted\",\n    \"editor/note-control/invalid-note-source\": \"Invalid URL\",\n    \"editor/note-control/add-note-source\": \"Add related URLs\",\n    \"editor/note-control/note-source-hint\":\n      \"Notes on the same URL will be grouped together\",\n    \"editor/note-control/enter-note-source\": \"Enter URL\",\n\n    // AvatarPanel\n    \"avatar-panel/this-note-is-private\": \"This note is private\",\n    \"avatar-panel/this-note-is-public\": \"This note is visible to public\",\n    \"avatar-panel/this-note-is-friends-only\":\n      \"This note is only visible to friends\",\n    \"avatar-panel/you-are-anonymous\": \"You are anonymous\",\n\n    // FileExporter\n    \"file-exporter/name\": \"File exporter\",\n    \"file-exporter/orientation\": \"Orientation\",\n    \"file-exporter/portrait\": \"portrait\",\n    \"file-exporter/landscape\": \"landscape\",\n    \"file-exporter/paper-size\": \"Paper size\",\n    \"file-exporter/unit\": \"Unit\",\n    \"file-exporter/margin-top\": \"Margin top\",\n    \"file-exporter/margin-bottom\": \"Margin bottom\",\n    \"file-exporter/margin-left\": \"Margin left\",\n    \"file-exporter/margin-right\": \"Margin right\",\n\n    // Utils\n    \"utils/uploading-image\": \"Uploading image...\",\n    \"utils/upload-image-failure\": \"Failed to upload image\",\n\n    // Notification\n    // * CommentPostingNotification\n    \"notification/replies-to-you-in\": \"Replies to you in\",\n    \"notification/'s-note\": \"'s note \",\n    // * NoteReactionNotification\n    \"notification/added\": \"Added\",\n    \"notification/to-your-note\": \"to your note\",\n    \"notification/add-you-as\": \"Added you as\",\n    \"notification/of-note\": \"of note\",\n    // * NoteTagSuggestion\n    \"notification/add-tag-failure\": \"Failed to add tag\",\n    \"notification/suggested-to-add-tag\": \"Suggested to add tag\",\n    // * UserFollowingNotification\n    \"notification/started-following-you\": \"Started following you\",\n    // * BookmarkNotification\n    \"notification/bookmarked-your-note\": \"Bookmarked your note\",\n\n    // GitHubOAuthCallback\n    \"github-oauth/wait\": \"Please wait ...\",\n    \"github-oauth/link-with-github-account-failure\":\n      \"Failed to link with GitHub account\",\n    \"github-oauth/sign-in-with-github-account-failure\":\n      \"Failed to sign in with GitHub account\",\n    \"github-oauth/first-time-sign-in\":\n      \"It seems to be the first time you sign in with GitHub account\",\n    \"github-oauth/first-time-sign-in-small\":\n      \"Please finish the registeration below\",\n\n    // Widgets\n    \"widget/autoplay\": \"autoplay\",\n    \"widget/controls\": \"controls\",\n    \"widget/loop\": \"loop\",\n    \"widget/muted\": \"muted\",\n    \"widget/crossnote.image/thanks_sm_ms\":\n      \"Thanks sm.ms for offering free image hosting service.\",\n    \"widget/crossnote.audio/audio_element_fail\":\n      \"Your browser does not support the audio element.\",\n    \"widget/crossnote.audio/source-url-placeholder\":\n      \"Enter audio source URL here, then press 'Enter' to insert.\",\n    \"widget/crossnote.video/video_element_fail\":\n      \"Your browser does not support the video element\",\n    \"widget/crossnote.bilibili/error_message\":\n      \"Error: Only supported https://www.bilibili.com/video/av79126732 like URL\",\n    \"widget/crossnote.youtube/error_message\":\n      \"Error: Only supported https://www.youtube.com/watch?v=MmB9b5njVbA like URL\",\n    \"widget/crossnote.auth/welcome\": \"Welcome to crossnote\",\n    \"widget/crossnote.auth/doesnt-have-account\":\n      \"Doesn't have an account? Let's create one 😉!\",\n    \"widget/crossnote.auth/forgot_password\": \"Forgot your password 😣?\",\n    \"widget/crossnote.auth/failed_to_send_code\":\n      \"Failed to send verification code\",\n    \"widget/crossnote.auth/verification_code_sent\":\n      \"Verification code has been sent to \",\n    \"widget/crossnote.auth/failed_to_reset_password\":\n      \"Failed to reset password\",\n    \"widget/crossnote.auth/password_reset\": \"Your password has been reset\",\n    \"widget/crossnote.auth/password-mismatch\": \"Passwords mismatch\",\n    \"widget/crossnote.auth/hello\": \"Hello, \",\n    \"widget/crossnote.auth/enter-the-verification-code\":\n      \"Enter the verification code\",\n    \"widget/crossnote.auth/get-code\": \"Get code\",\n    \"widget/crossnote.auth/sign-in-with-github-account\":\n      \"Sign in with GitHub account\",\n    \"widget/crossnote.auth/already-have-an-account\": \"Already have an account?\",\n    \"widget/crossnote.auth/reset-password\": \"Reset password\",\n    \"widget/crossnote.auth/Or\": \"Or\",\n    \"widget/crossnote.bilibili/Bilibili\": \"Bilibili\",\n    \"widget/crossnote.bilibili/bilibili-video-url\": \"Bilibili video URL\",\n    \"widget/crossnote.bilibili/url-placeholder\":\n      \"Enter the Bilibili video URL here, then press 'Enter' to insert.\",\n    \"widget/crossnote.image/image-helper\": \"Image helper\",\n    \"widget/crossnote.image/image-url-placeholder\":\n      \"Enter image URL here, then press 'Enter' to insert.\",\n    \"widget/crossnote.image/click-here-to-browse-image-file\":\n      \"Click here to browse image file\",\n    \"widget/crossnote.neteasemusic/song-id-placeholder\":\n      \"Enter Netease Music song number ID.\",\n    \"widget/crossnote.video/video-url-placeholder\":\n      \"Enter video source URL here, then press 'Enter' to insert.\",\n    \"widget/crossnote.video/poster-url\": \"Poster URL (optional)\",\n    \"widget/crossnote.video/poster-url-placeholder\": \"Enter poster URL here.\",\n    \"widget/crossnote.youtube/youtube-video-url\": \"Youtube video URL\",\n    \"widget/crossnote.youtube/youtube-video-url-placeholder\":\n      \"Enter the Youtube video URL here, then press 'Enter' to insert.\",\n    \"widget/crossnote.ocr/ocr\": \"OCR - Optical character recognition\",\n    \"widget/crossnote.ocr/local-image\": \"Local image\",\n    \"widget/crossnote.ocr/recognize-text-in-languages\":\n      \"Recognize text in languages\",\n    \"widget/crossnote.ocr/start-ocr\": \"Start OCR\",\n    \"widget/crossnote.ocr/extra-settings\": \"Extra settings\",\n    \"widget/crossnote.ocr/grayscale\": \"Grayscale\",\n    \"widget/crossnote.kanban/add-column\": \"Add new column\",\n\n    // Tesseract\n    \"tesseract/loading tesseract core\": \"loading tesseract core\",\n    \"tesseract/initializing tesseract\": \"initializing tesseract\",\n    \"tesseract/initialized tesseract\": \"initialized tesseract\",\n    \"tesseract/loading language traineddata\": \"loading language traineddata\",\n    \"tesseract/loaded language traineddata\": \"loaded language traineddata\",\n    \"tesseract/initializing api\": \"initializing api\",\n    \"tesseract/initialized api\": \"initialized api\",\n    \"tesseract/recognizing text\": \"recognizing text\"\n  }\n};\n","import { useState, useEffect, useCallback } from \"react\";\nimport { createContainer } from \"unstated-next\";\nimport * as path from \"path\";\nimport Noty from \"noty\";\nimport useInterval from \"@use-it/interval\";\nimport { randomID, OneDay } from \"../utilities/utils\";\nimport { useTranslation } from \"react-i18next\";\nimport Crossnote, {\n  Notebook,\n  Note,\n  Directory,\n  NoteConfig,\n  PushNotebookArgs,\n  PullNotebookArgs,\n  TagNode\n} from \"../lib/crossnote\";\nimport { getHeaderFromMarkdown } from \"../utilities/note\";\n\nexport enum SelectedSectionType {\n  Notes = \"Notes\",\n  Today = \"Today\",\n  Todo = \"Todo\",\n  Tagged = \"Tagged\",\n  Untagged = \"Untagged\",\n  Directory = \"Directory\",\n  Tag = \"Tag\",\n  Conflicted = \"Conflicted\",\n  Encrypted = \"Encrypted\",\n  Wiki = \"Wiki\"\n}\n\nexport interface SelectedSection {\n  type: SelectedSectionType;\n  path?: string;\n}\n\nexport enum OrderBy {\n  CreatedAt = \"CreatedAt\",\n  ModifiedAt = \"ModifiedAt\",\n  Title = \"Title\"\n}\n\nexport enum OrderDirection {\n  ASC = \"ASC\",\n  DESC = \"DESC\"\n}\n\ninterface InitialState {\n  crossnote: Crossnote;\n}\n\nfunction useCrossnoteContainer(initialState: InitialState) {\n  const { t } = useTranslation();\n  const crossnote = initialState.crossnote;\n  const [notebooks, setNotebooks] = useState<Notebook[]>([]);\n  const [selectedNotebook, setSelectedNotebook] = useState<Notebook>(null);\n  const [notebookNotes, setNotebookNotes] = useState<Note[]>([]);\n  const [notebookDirectories, setNotebookDirectories] = useState<Directory>({\n    name: \".\",\n    path: \".\",\n    children: []\n  });\n  const [notebookTagNode, setNotebookTagNode] = useState<TagNode>({\n    name: \".\",\n    path: \".\",\n    children: []\n  });\n  const [notes, setNotes] = useState<Note[]>([]);\n  const [selectedNote, setSelectedNote] = useState<Note>(null);\n  const [includeSubdirectories, setIncludeSubdirectories] = useState<boolean>(\n    true\n  );\n  const [selectedSection, setSelectedSection] = useState<SelectedSection>({\n    type: SelectedSectionType.Notes\n  }); // $notes | $todau | $todo | real directory\n  const [isAddingNotebook, setIsAddingNotebook] = useState<boolean>(false);\n  const [isPushingNotebook, setIsPushingNotebook] = useState<boolean>(false);\n  const [isPullingNotebook, setIsPullingNotebook] = useState<boolean>(false);\n  const [displayMobileEditor, setDisplayMobileEditor] = useState<boolean>(\n    false\n  ); // For mobile device without any initial data, set to `true` will create empty white page.\n  const [needsToRefreshNotes, setNeedsToRefreshNotes] = useState<boolean>(\n    false\n  );\n  const [wikiTOCElement, setWikiTOCElement] = useState<HTMLElement>(null);\n  const [isLoadingNotebook, setIsLoadingNotebook] = useState<boolean>(false);\n  const [hasSummaryMD, setHasSummaryMD] = useState<boolean>(false);\n  const [orderBy, setOrderBy] = useState<OrderBy>(OrderBy.ModifiedAt);\n  const [orderDirection, setOrderDirection] = useState<OrderDirection>(\n    OrderDirection.DESC\n  );\n\n  const updateNoteMarkdown = useCallback(\n    (\n      note: Note,\n      markdown: string,\n      password?: string,\n      callback?: (status: string) => void\n    ) => {\n      crossnote\n        .writeNote(\n          note.notebook,\n          note.filePath,\n          markdown,\n          note.config,\n          password\n        )\n        .then(noteConfig => {\n          note.config = noteConfig;\n          note.markdown = markdown;\n          if (callback) {\n            crossnote.getStatus(note).then(status => {\n              callback(status);\n            });\n          }\n          setNeedsToRefreshNotes(true);\n        });\n    },\n    [crossnote]\n  );\n\n  const deleteNote = useCallback(\n    async (note: Note) => {\n      await crossnote.deleteNote(selectedNotebook, note.filePath);\n      setNotebookNotes(notes => {\n        const newNotes = notes.filter(n => n.filePath !== note.filePath);\n        if (newNotes.length !== notes.length) {\n          setSelectedNote(null);\n        }\n\n        crossnote\n          .getNotebookDirectoriesFromNotes(newNotes)\n          .then(directories => {\n            setNotebookDirectories(directories);\n          });\n\n        crossnote\n          .hasSummaryMD(selectedNotebook)\n          .then(exists => setHasSummaryMD(exists));\n\n        setNotebookTagNode(crossnote.getNotebookTagNodeFromNotes(newNotes));\n        return newNotes;\n      });\n      setDisplayMobileEditor(false);\n    },\n    [crossnote, selectedNotebook]\n  );\n\n  const changeNoteFilePath = useCallback(\n    (note: Note, newFilePath: string) => {\n      (async () => {\n        try {\n          await crossnote.changeNoteFilePath(\n            selectedNotebook,\n            note,\n            newFilePath\n          );\n          const newNotes = notebookNotes.map(n => {\n            if (n.filePath === note.filePath) {\n              n.filePath = newFilePath;\n              n.config.modifiedAt = new Date();\n              return n;\n            } else {\n              return n;\n            }\n          });\n          setNotebookNotes(newNotes);\n          setNotebookDirectories(\n            await crossnote.getNotebookDirectoriesFromNotes(newNotes)\n          );\n          setHasSummaryMD(await crossnote.hasSummaryMD(selectedNotebook));\n          setNotebookTagNode(crossnote.getNotebookTagNodeFromNotes(newNotes));\n        } catch (error) {\n          new Noty({\n            type: \"error\",\n            text: \"Failed to change file path\",\n            layout: \"topRight\",\n            theme: \"relax\",\n            timeout: 5000\n          }).show();\n        }\n      })();\n    },\n    [selectedNotebook, crossnote, notebookNotes]\n  );\n\n  const createNewNote = useCallback(\n    (fileName: string = \"\") => {\n      (async () => {\n        if (!fileName) {\n          fileName = randomID();\n        }\n        if (!fileName.endsWith(\".md\")) {\n          fileName = fileName + \".md\";\n        }\n        let filePath;\n        let tags: string[] = [];\n        if (\n          selectedSection.type === SelectedSectionType.Notes ||\n          selectedSection.type === SelectedSectionType.Today ||\n          selectedSection.type === SelectedSectionType.Todo ||\n          selectedSection.type === SelectedSectionType.Tagged ||\n          selectedSection.type === SelectedSectionType.Untagged\n        ) {\n          filePath = fileName;\n        } else if (selectedSection.type === SelectedSectionType.Tag) {\n          filePath = fileName;\n          tags = [selectedSection.path];\n        } else {\n          filePath = path.relative(\n            selectedNotebook.dir,\n            path.resolve(selectedNotebook.dir, selectedSection.path, fileName)\n          );\n        }\n\n        const noteConfig: NoteConfig = {\n          id: \"\",\n          tags: tags,\n          modifiedAt: new Date(),\n          createdAt: new Date()\n        };\n        await crossnote.writeNote(selectedNotebook, filePath, \"\", noteConfig);\n        const note: Note = {\n          notebook: selectedNotebook,\n          filePath: filePath,\n          markdown: \"\",\n          config: noteConfig\n        };\n        setNotebookNotes(notes => [note, ...notes]);\n        setSelectedNote(note);\n        setDisplayMobileEditor(true);\n      })();\n    },\n    [selectedNotebook, crossnote, selectedSection]\n  );\n\n  const addNotebook = useCallback(\n    async (\n      name: string,\n      gitURL: string,\n      gitBranch: string,\n      gitUsername: string,\n      gitPassword: string,\n      gitRememberCredentials: boolean,\n      gitCorsProxy: string\n    ) => {\n      setIsAddingNotebook(true);\n      try {\n        const notebook = await crossnote.addNotebook({\n          name,\n          gitURL,\n          branch: gitBranch,\n          username: gitUsername,\n          password: gitPassword,\n          corsProxy: gitCorsProxy,\n          rememberCredentials: gitRememberCredentials\n        });\n        setNotebooks(notebooks => [notebook, ...notebooks]);\n        setIsAddingNotebook(false);\n      } catch (error) {\n        setIsAddingNotebook(false);\n        throw error;\n      }\n    },\n    [crossnote]\n  );\n\n  const updateNotebook = useCallback(\n    async (notebook: Notebook) => {\n      if (!crossnote) {\n        return;\n      }\n      try {\n        await crossnote.updateNotebook(notebook);\n        setNotebooks(notebooks => [...notebooks]);\n      } catch (error) {}\n    },\n    [crossnote]\n  );\n\n  const deleteNotebook = useCallback(\n    async (notebook: Notebook) => {\n      if (!crossnote) {\n        return;\n      }\n      try {\n        await crossnote.deleteNotebook(notebook._id);\n      } catch (error) {}\n      let selectedNotebook: Notebook = null;\n      setNotebooks(notebooks =>\n        notebooks.filter(n => {\n          if (!selectedNotebook && n._id !== notebook._id) {\n            selectedNotebook = n;\n          }\n          return n._id !== notebook._id;\n        })\n      );\n      _setSelectedNotebook(selectedNotebook);\n    },\n    [crossnote]\n  );\n\n  const pushNotebook = useCallback(\n    async (args: PushNotebookArgs) => {\n      if (!crossnote) {\n        return;\n      }\n      setIsPushingNotebook(true);\n      try {\n        await crossnote.pushNotebook(args);\n        setIsPushingNotebook(false);\n      } catch (error) {\n        setIsPushingNotebook(false);\n        throw error;\n      }\n    },\n    [crossnote]\n  );\n\n  const pullNotebook = useCallback(\n    async (args: PullNotebookArgs) => {\n      if (!crossnote) {\n        return;\n      }\n      setIsPullingNotebook(true);\n      try {\n        // NOTE: Code here might have bug\n        await crossnote.pullNotebook(args);\n        setIsPullingNotebook(false);\n        const notes = await crossnote.listNotes({\n          notebook: args.notebook,\n          dir: \"./\",\n          includeSubdirectories: true\n        });\n        setNotebookNotes(notes);\n        setNotebookDirectories(\n          await crossnote.getNotebookDirectoriesFromNotes(notes)\n        );\n        setHasSummaryMD(await crossnote.hasSummaryMD(args.notebook));\n        setNotebookTagNode(crossnote.getNotebookTagNodeFromNotes(notes));\n\n        const newNote = notes.find(n => n.filePath === selectedNote.filePath);\n        if (!newNote) {\n          setSelectedNote(notes[0]); // TODO: pull might remove currently selectedNote\n        } else {\n          setSelectedNote(newNote);\n        }\n      } catch (error) {\n        setIsPullingNotebook(false);\n        throw error;\n      }\n    },\n    [crossnote, selectedNote]\n  );\n\n  const checkoutNote = useCallback(\n    async (note: Note) => {\n      if (!crossnote) {\n        return;\n      }\n      const newNote = await crossnote.checkoutNote(note);\n      if (newNote) {\n        setNotebookNotes(notes =>\n          notes.map(n => {\n            if (n.filePath === newNote.filePath) {\n              return newNote;\n            } else {\n              return n;\n            }\n          })\n        );\n        setNotes(notes =>\n          notes.map(n => {\n            if (n.filePath === newNote.filePath) {\n              return newNote;\n            } else {\n              return n;\n            }\n          })\n        );\n        setSelectedNote(newNote);\n      } else {\n        // The note is deleted after checkout\n        setNotebookNotes(notes => {\n          const newNotes = notes.filter(n => n.filePath !== note.filePath);\n          crossnote\n            .getNotebookDirectoriesFromNotes(newNotes)\n            .then(directories => {\n              setNotebookDirectories(directories);\n            });\n          crossnote\n            .hasSummaryMD(selectedNotebook)\n            .then(exists => setHasSummaryMD(exists));\n          setNotebookTagNode(crossnote.getNotebookTagNodeFromNotes(newNotes));\n          return newNotes;\n        });\n        setNotes(notes => {\n          const newNotes = notes.filter(n => n.filePath !== note.filePath);\n          setSelectedNote(newNotes[0]);\n          return newNotes;\n        });\n      }\n    },\n    [crossnote, selectedNotebook]\n  );\n\n  const updateNotebookTagNode = useCallback(() => {\n    if (!crossnote) return;\n    setNotebookTagNode(crossnote.getNotebookTagNodeFromNotes(notebookNotes));\n  }, [notebookNotes, crossnote]);\n\n  const getNote = useCallback(\n    async (notebook: Notebook, filePath: string) => {\n      if (!crossnote) {\n        return;\n      }\n      return await crossnote.getNote(notebook, filePath);\n    },\n    [crossnote]\n  );\n\n  const openNoteAtPath = useCallback(\n    (filePath: string) => {\n      if (!crossnote) return;\n      const note = notebookNotes.find(n => n.filePath === filePath);\n      if (note) {\n        setSelectedNote(note);\n      }\n    },\n    [crossnote, notebookNotes]\n  );\n\n  useEffect(() => {\n    if (!crossnote) {\n      return;\n    }\n\n    (async () => {\n      const notebooks = await crossnote.listNotebooks();\n      let notebook: Notebook = null;\n      if (notebooks.length) {\n        setNotebooks(notebooks);\n        const selectedNotebookID = localStorage.getItem(\"selectedNotebookID\");\n        notebook = notebooks.find(n => n._id === selectedNotebookID);\n        if (!notebook) {\n          notebook = notebooks[0];\n        }\n        _setSelectedNotebook(notebook); // TODO: <= default selected\n      } else {\n        /*\n        notebook = await crossnote.cloneNotebook({\n          corsProxy: \"https://cors.isomorphic-git.org\",\n          gitURL: \"https://github.com/0xGG/crossnote-doc.git\"\n        });\n        */\n        notebook = await crossnote.addNotebook({\n          name: \"Unamed\",\n          corsProxy: \"https://cors.isomorphic-git.org\",\n          gitURL: \"\"\n        });\n        setNotebooks([notebook]);\n        _setSelectedNotebook(notebook);\n      }\n    })();\n  }, [crossnote]);\n\n  useEffect(() => {\n    if (!crossnote) {\n      return;\n    }\n    (async () => {\n      setIsLoadingNotebook(true);\n      setNotebookNotes([]);\n      setNotebookDirectories({\n        name: \".\",\n        path: \".\",\n        children: []\n      });\n      setHasSummaryMD(false);\n      setNotebookTagNode({\n        name: \".\",\n        path: \".\",\n        children: []\n      });\n\n      const notes = await crossnote.listNotes({\n        notebook: selectedNotebook,\n        dir: \"./\",\n        includeSubdirectories: true\n      });\n      setNotebookNotes(notes);\n      setNotebookDirectories(\n        await crossnote.getNotebookDirectoriesFromNotes(notes)\n      );\n      setHasSummaryMD(await crossnote.hasSummaryMD(selectedNotebook));\n      setNotebookTagNode(crossnote.getNotebookTagNodeFromNotes(notes));\n      setSelectedNote(null);\n      setIsLoadingNotebook(false);\n    })();\n  }, [crossnote, selectedNotebook]);\n\n  useEffect(() => {\n    if (crossnote && selectedNotebook) {\n      setSelectedSection({ type: SelectedSectionType.Notes });\n    }\n  }, [crossnote, selectedNotebook]);\n\n  useEffect(() => {\n    if (crossnote && selectedNotebook && notebookNotes) {\n      if (\n        notebookNotes.length &&\n        notebookNotes[0].notebook._id !== selectedNotebook._id\n      ) {\n        return;\n      }\n\n      let notes: Note[] = [];\n      if (selectedSection.type === SelectedSectionType.Notes) {\n        notes = [...notebookNotes];\n      } else if (selectedSection.type === SelectedSectionType.Todo) {\n        notes = notebookNotes.filter(note =>\n          note.markdown.match(/(\\*|-|\\d+\\.)\\s\\[(\\s+|x|X)\\]\\s/gm)\n        );\n      } else if (selectedSection.type === SelectedSectionType.Today) {\n        notes = notebookNotes.filter(\n          note => Date.now() - note.config.modifiedAt.getTime() <= OneDay\n        );\n      } else if (selectedSection.type === SelectedSectionType.Tagged) {\n        notes = notebookNotes.filter(note => note.config.tags.length > 0);\n      } else if (selectedSection.type === SelectedSectionType.Untagged) {\n        notes = notebookNotes.filter(note => note.config.tags.length === 0);\n      } else if (selectedSection.type === SelectedSectionType.Tag) {\n        notes = notebookNotes.filter(note => {\n          const tags = note.config.tags;\n          return tags.find(\n            tag =>\n              (tag.toLocaleLowerCase() + \"/\").indexOf(\n                selectedSection.path + \"/\"\n              ) === 0\n          );\n        });\n      } else if (selectedSection.type === SelectedSectionType.Conflicted) {\n        notes = notebookNotes.filter(note => {\n          return crossnote.markdownHasConflicts(note.markdown);\n        });\n      } else if (selectedSection.type === SelectedSectionType.Encrypted) {\n        notes = notebookNotes.filter(note => {\n          return note.config.encryption;\n        });\n      } else if (selectedSection.type === SelectedSectionType.Wiki) {\n        // Do nothing here\n      } else {\n        // SelectedSectionType.Directory\n        if (includeSubdirectories) {\n          notes = notebookNotes.filter(\n            note => note.filePath.indexOf(selectedSection.path + \"/\") === 0\n          );\n        } else {\n          notes = notebookNotes.filter(\n            note => path.dirname(note.filePath) === selectedSection.path\n          );\n        }\n      }\n\n      if (orderBy === OrderBy.ModifiedAt) {\n        if (orderDirection === OrderDirection.DESC) {\n          notes.sort(\n            (a, b) =>\n              b.config.modifiedAt.getTime() - a.config.modifiedAt.getTime()\n          );\n        } else {\n          notes.sort(\n            (a, b) =>\n              a.config.modifiedAt.getTime() - b.config.modifiedAt.getTime()\n          );\n        }\n      } else if (orderBy === OrderBy.CreatedAt) {\n        if (orderDirection === OrderDirection.DESC) {\n          notes.sort(\n            (a, b) =>\n              b.config.createdAt.getTime() - a.config.createdAt.getTime()\n          );\n        } else {\n          notes.sort(\n            (a, b) =>\n              a.config.createdAt.getTime() - b.config.createdAt.getTime()\n          );\n        }\n      } else if (orderBy === OrderBy.Title) {\n        if (orderDirection === OrderDirection.DESC) {\n          notes.sort((a, b) =>\n            (\n              (b.config.encryption && b.config.encryption.title) ||\n              getHeaderFromMarkdown(b.markdown)\n            ).localeCompare(\n              (a.config.encryption && a.config.encryption.title) ||\n                getHeaderFromMarkdown(a.markdown)\n            )\n          );\n        } else {\n          notes.sort((a, b) =>\n            (\n              (a.config.encryption && a.config.encryption.title) ||\n              getHeaderFromMarkdown(a.markdown)\n            ).localeCompare(\n              (b.config.encryption && b.config.encryption.title) ||\n                getHeaderFromMarkdown(b.markdown)\n            )\n          );\n        }\n      }\n\n      setNotes(notes);\n      if (!selectedNote) {\n        setSelectedNote(notes[0]);\n      }\n    }\n  }, [\n    selectedSection,\n    crossnote,\n    selectedNotebook,\n    includeSubdirectories,\n    selectedNote,\n    notebookNotes,\n    orderBy,\n    orderDirection\n  ]);\n\n  useInterval(() => {\n    if (needsToRefreshNotes) {\n      setNeedsToRefreshNotes(false);\n      setNotes(notes => [...notes]);\n    }\n  }, 4000);\n\n  const _setSelectedNotebook = useCallback(\n    (notebook: Notebook) => {\n      localStorage.setItem(\"selectedNotebookID\", notebook._id);\n      setSelectedNotebook(notebook);\n    },\n    [setSelectedNotebook]\n  );\n\n  return {\n    crossnote,\n    notebooks,\n    selectedNotebook,\n    setSelectedNotebook: _setSelectedNotebook,\n    notes,\n    selectedNote,\n    setSelectedNote,\n    updateNoteMarkdown,\n    createNewNote,\n    selectedSection,\n    setSelectedSection,\n    includeSubdirectories,\n    setIncludeSubdirectories,\n    deleteNote,\n    changeNoteFilePath,\n    notebookDirectories,\n    notebookTagNode,\n    addNotebook,\n    isAddingNotebook,\n    isPushingNotebook,\n    isPullingNotebook,\n    updateNotebook,\n    deleteNotebook,\n    pushNotebook,\n    pullNotebook,\n    checkoutNote,\n    displayMobileEditor,\n    setDisplayMobileEditor,\n    updateNotebookTagNode,\n    getNote,\n    isLoadingNotebook,\n    openNoteAtPath,\n    orderBy,\n    setOrderBy,\n    orderDirection,\n    setOrderDirection,\n    hasSummaryMD,\n    wikiTOCElement,\n    setWikiTOCElement\n  };\n}\n\nexport const CrossnoteContainer = createContainer(useCrossnoteContainer);\n","import React, { useState, useEffect, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  TextField,\n  Typography,\n  Box\n} from \"@material-ui/core\";\nimport { CrossnoteContainer } from \"../containers/crossnote\";\nimport { Notebook } from \"../lib/crossnote\";\nimport Noty from \"noty\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface Props {\n  open: boolean;\n  onClose: () => void;\n  notebook: Notebook;\n}\n\nexport default function PushNotebookDialog(props: Props) {\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n  const notebook = props.notebook;\n  const [authorName, setAuthorName] = useState<string>(\n    localStorage.getItem(\"authorName\") || \"anonymous\"\n  );\n  const [authorEmail, setAuthorEmail] = useState<string>(\n    localStorage.getItem(\"authorEmail\") || \"anonymous@crossnote.app\"\n  );\n  const [gitUsername, setGitUsername] = useState<string>(notebook.gitUsername);\n  const [gitPassword, setGitPassword] = useState<string>(notebook.gitPassword);\n  const [commitMessage, setCommitMessage] = useState<string>(\n    \"doc: Updated docs\"\n  );\n  const { t } = useTranslation();\n\n  const pushNotebook = useCallback(() => {\n    crossnoteContainer\n      .pushNotebook({\n        notebook,\n        authorName,\n        authorEmail,\n        username: gitUsername,\n        password: gitPassword,\n        message: commitMessage,\n        onAuthFailure: () => {\n          new Noty({\n            type: \"error\",\n            text: \"Authentication failed\",\n            layout: \"topRight\",\n            theme: \"relax\",\n            timeout: 5000\n          }).show();\n        }\n      })\n      .then(() => {\n        props.onClose();\n        new Noty({\n          type: \"success\",\n          text: \"Notebook pushed\",\n          layout: \"topRight\",\n          theme: \"relax\",\n          timeout: 2000\n        }).show();\n      })\n      .catch((error: Error) => {\n        props.onClose();\n        new Noty({\n          type: \"error\",\n          text: error.message.match(/^error\\//)\n            ? t(error.message)\n            : \"Failed to push notebook\",\n          layout: \"topRight\",\n          theme: \"relax\",\n          timeout: 2000\n        }).show();\n      });\n  }, [\n    authorEmail,\n    authorName,\n    gitUsername,\n    gitPassword,\n    notebook,\n    commitMessage,\n    props\n  ]);\n\n  useEffect(() => {\n    localStorage.setItem(\"authorName\", authorName);\n  }, [authorName]);\n\n  useEffect(() => {\n    localStorage.setItem(\"authorEmail\", authorEmail);\n  }, [authorEmail]);\n\n  useEffect(() => {\n    setGitUsername(notebook.gitUsername);\n  }, [notebook.gitUsername, props.open]);\n\n  useEffect(() => {\n    setGitPassword(notebook.gitPassword);\n  }, [notebook.gitPassword, props.open]);\n\n  return (\n    <Dialog\n      open={props.open}\n      onClose={() => {\n        if (!crossnoteContainer.isPushingNotebook) {\n          props.onClose();\n        }\n      }}\n    >\n      <DialogTitle>\n        {`Push notebook ${notebook.name} to git repository`}\n        <Box>\n          <Typography variant={\"caption\"}>\n            {notebook.gitURL + \":\" + notebook.gitBranch}\n          </Typography>\n        </Box>\n      </DialogTitle>\n      <DialogContent>\n        <TextField\n          label={\"Author name\"}\n          fullWidth={true}\n          value={authorName}\n          onChange={event => setAuthorName(event.target.value)}\n        ></TextField>\n        <TextField\n          label={\"Author email\"}\n          fullWidth={true}\n          value={authorEmail}\n          onChange={event => setAuthorEmail(event.target.value)}\n        ></TextField>\n        <TextField\n          label={\"Commit message\"}\n          fullWidth={true}\n          value={commitMessage}\n          onChange={event => setCommitMessage(event.target.value)}\n        ></TextField>\n        <TextField\n          label={\"username\"}\n          placeholder={\"username\"}\n          fullWidth={true}\n          value={gitUsername}\n          onChange={event => setGitUsername(event.target.value)}\n        ></TextField>\n        <TextField\n          label={\"password\"}\n          placeholder={\"password\"}\n          type={\"password\"}\n          fullWidth={true}\n          value={gitPassword}\n          onChange={event => setGitPassword(event.target.value)}\n        ></TextField>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant={\"contained\"}\n          color={\"primary\"}\n          disabled={crossnoteContainer.isPushingNotebook}\n          onClick={pushNotebook}\n        >\n          {crossnoteContainer.isPushingNotebook ? \"Pushing...\" : \"Push\"}\n        </Button>\n        <Button onClick={props.onClose}>{\"Cancel\"}</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import React, { useState, useEffect, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  Box,\n  TextField\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { Editor as CodeMirrorEditor, TextMarker } from \"codemirror\";\n\ninterface Props {\n  open: boolean;\n  onClose: () => void;\n  editor: CodeMirrorEditor;\n  marker: TextMarker;\n  imageElement: HTMLImageElement;\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    imageWrapper: {\n      textAlign: \"center\"\n    },\n    imagePreview: {\n      maxWidth: \"100%\",\n      maxHeight: \"400px\"\n    }\n  })\n);\n\nexport default function EditImageDialog(props: Props) {\n  const classes = useStyles(props);\n  const editor = props.editor;\n  const marker = props.marker;\n  const imageElement = props.imageElement;\n  const [imageSrc, setImageSrc] = useState<string>(\"\");\n  const [imageAlt, setImageAlt] = useState<string>(\"\");\n  const [imageTitle, setImageTitle] = useState<string>(\"\");\n\n  const deleteImage = useCallback(() => {\n    if (!imageElement || !editor || !marker) {\n      return;\n    }\n    const pos = marker.find();\n    editor.replaceRange(\"\", pos.from, pos.to);\n    props.onClose();\n  }, [imageElement, editor, marker, props]);\n\n  const updateImage = useCallback(() => {\n    if (!imageElement || !editor || !marker) {\n      return;\n    }\n    const pos = marker.find();\n    if (!pos) return;\n    if (imageTitle.trim().length) {\n      editor.replaceRange(\n        `![${imageAlt.trim()}](${imageSrc.trim()} ${JSON.stringify(\n          imageTitle\n        )})`,\n        pos.from,\n        pos.to\n      );\n    } else {\n      editor.replaceRange(\n        `![${imageAlt.trim()}](${imageSrc.trim()})`,\n        pos.from,\n        pos.to\n      );\n    }\n    props.onClose();\n  }, [imageElement, editor, marker, props, imageAlt, imageSrc, imageTitle]);\n\n  useEffect(() => {\n    if (imageElement && marker && editor) {\n      setImageSrc(imageElement.src || \"\");\n      setImageTitle(imageElement.title || \"\");\n      setImageAlt(imageElement.alt || \"\");\n    }\n  }, [imageElement, marker, editor]);\n\n  if (!editor || !marker || !imageElement) {\n    return null;\n  }\n\n  return (\n    <Dialog open={props.open} onClose={props.onClose}>\n      <DialogTitle>Edit image</DialogTitle>\n      <DialogContent style={{ width: \"400px\", maxWidth: \"100%\" }}>\n        <Box className={clsx(classes.imageWrapper)}>\n          <img\n            className={clsx(classes.imagePreview)}\n            src={imageSrc}\n            alt={imageAlt}\n            title={imageTitle}\n          ></img>{\" \"}\n        </Box>\n        <TextField\n          autoFocus={true}\n          value={imageSrc}\n          helperText={\"image URL\"}\n          fullWidth={true}\n          onChange={event => setImageSrc(event.target.value)}\n        ></TextField>\n        <TextField\n          autoFocus={true}\n          value={imageTitle}\n          helperText={\"image title\"}\n          fullWidth={true}\n          onChange={event => setImageTitle(event.target.value)}\n        ></TextField>\n        <TextField\n          autoFocus={true}\n          value={imageAlt}\n          helperText={\"image alt text\"}\n          fullWidth={true}\n          onChange={event => setImageAlt(event.target.value)}\n        ></TextField>\n      </DialogContent>\n      <DialogActions>\n        <Button variant={\"contained\"} color={\"primary\"} onClick={updateImage}>\n          Update\n        </Button>\n        <Button variant={\"contained\"} color={\"secondary\"} onClick={deleteImage}>\n          Delete\n        </Button>\n        <Button onClick={props.onClose}>Cancel</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import React, { useState, useCallback, useEffect } from \"react\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { Note } from \"../lib/crossnote\";\nimport { CrossnoteContainer } from \"../containers/crossnote\";\nimport { useTranslation } from \"react-i18next\";\nimport * as CryptoJS from \"crypto-js\";\nimport * as path from \"path\";\nimport {\n  Box,\n  Typography,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogContentText,\n  DialogActions,\n  Button,\n  Tooltip,\n  TextField,\n  ButtonGroup,\n  IconButton,\n  Popover,\n  List,\n  ListItem,\n  Hidden\n} from \"@material-ui/core\";\nimport {\n  Editor as CodeMirrorEditor,\n  EditorChangeLinkedList,\n  TextMarker\n} from \"codemirror\";\nimport {\n  RenameBox,\n  Delete,\n  FilePresentationBox,\n  Pencil,\n  CodeTags,\n  CloudUploadOutline,\n  CloudDownloadOutline,\n  Restore,\n  Fullscreen,\n  FullscreenExit,\n  ChevronLeft,\n  Close,\n  Pin,\n  PinOutline,\n  LockOpenOutline,\n  Lock,\n  LockOpen,\n  TagOutline,\n  Printer\n} from \"mdi-material-ui\";\nimport { renderPreview } from \"vickymd/preview\";\nimport PushNotebookDialog from \"./PushNotebookDialog\";\nimport EditImageDialog from \"./EditImageDialog\";\nimport Noty from \"noty\";\nimport { formatDistance } from \"date-fns\";\nimport { getHeaderFromMarkdown } from \"../utilities/note\";\nimport { printPreview } from \"../utilities/preview\";\n\nconst VickyMD = require(\"vickymd\");\nconst is = require(\"is_js\");\n\nconst previewZIndex = 99;\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    editorPanel: {\n      width: \"100%\",\n      height: \"100%\",\n      display: \"flex\",\n      flexDirection: \"column\"\n    },\n    topPanel: {\n      position: \"relative\",\n      padding: theme.spacing(0.5, 1), // theme.spacing(0.5, 1),\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"space-between\",\n      borderBottom: \"1px solid #eee\",\n      overflow: \"auto\"\n    },\n    bottomPanel: {\n      position: \"relative\",\n      padding: theme.spacing(0.5, 1),\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"space-between\",\n      borderTop: \"1px solid #eee\"\n      // color: theme.palette.primary.contrastText,\n      // backgroundColor: theme.palette.primary.main\n    },\n    controlBtn: {\n      padding: theme.spacing(0.5, 0),\n      color: theme.palette.text.secondary\n    },\n    controlBtnSelected: {\n      color: theme.palette.primary.main\n    },\n    controlBtnSelectedSecondary: {\n      color: theme.palette.secondary.main\n    },\n    row: {\n      display: \"flex\",\n      flexDirection: \"row\",\n      alignItems: \"center\"\n    },\n    cursorPositionInfo: {\n      // position: \"absolute\",\n      // right: \"16px\",\n      // bottom: \"16px\",\n      zIndex: 150\n    },\n    editorWrapper: {\n      //     display: \"contents\",\n      flex: 1,\n      overflow: \"auto\",\n      \"& .CodeMirror-gutters\": {\n        display: \"none\"\n      },\n      \"& .CodeMirror-code\": {\n        width: \"100%\"\n      },\n      \"& .CodeMirror\": {\n        height: \"100%\",\n        padding: theme.spacing(0, 2),\n        [theme.breakpoints.down(\"sm\")]: {\n          padding: theme.spacing(0)\n        }\n      },\n      \"& .CodeMirror-vscrollbar\": {\n        display: \"none !important\"\n      },\n      [theme.breakpoints.down(\"sm\")]: {\n        padding: theme.spacing(1)\n      }\n    },\n    fullScreen: {\n      position: \"fixed\",\n      width: \"100%\",\n      height: \"100%\",\n      left: \"0\",\n      top: \"0\",\n      zIndex: 2000,\n      overflow: \"auto\",\n      padding: \"0\"\n    },\n    editor: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    preview: {\n      position: \"relative\",\n      left: \"0\",\n      top: \"0\",\n      width: \"100%\",\n      height: \"100%\",\n      border: \"none\",\n      overflow: \"auto !important\",\n      padding: theme.spacing(2),\n      zIndex: previewZIndex,\n      [theme.breakpoints.down(\"sm\")]: {\n        padding: theme.spacing(1)\n      }\n      // gridArea: \"2 / 2 / 3 / 3\"\n    },\n    backBtn: {\n      marginRight: \"8px\",\n      [theme.breakpoints.up(\"sm\")]: {\n        display: \"none\"\n      }\n    },\n    menuItemOverride: {\n      cursor: \"default\",\n      padding: `0 0 0 ${theme.spacing(2)}px`,\n      \"&:hover\": {\n        backgroundColor: \"inherit\"\n      }\n    },\n    menuItemTextField: {\n      paddingRight: theme.spacing(2)\n    }\n  })\n);\n\nexport enum EditorMode {\n  VickyMD = \"VickyMD\",\n  SourceCode = \"SourceCode\",\n  Preview = \"Preview\"\n}\ninterface CursorPosition {\n  ch: number;\n  line: number;\n}\ninterface TimerText {\n  text: string;\n  line: number;\n  date: Date;\n}\ninterface Props {\n  note: Note;\n}\nexport default function Editor(props: Props) {\n  const note = props.note;\n  const classes = useStyles(props);\n  const [textAreaElement, setTextAreaElement] = useState<HTMLTextAreaElement>(\n    null\n  );\n  const [editor, setEditor] = useState<CodeMirrorEditor>(null);\n  const [cursorPosition, setCursorPosition] = useState<CursorPosition>({\n    line: 0,\n    ch: 0\n  });\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState<boolean>(false);\n  const [filePathDialogOpen, setFilePathDialogOpen] = useState<boolean>(false);\n  const [pushDialogOpen, setPushDialogOpen] = useState<boolean>(false);\n  const [newFilePath, setNewFilePath] = useState<string>(\n    (note && note.filePath) || \"\"\n  );\n  const [editorMode, setEditorMode] = useState<EditorMode>(EditorMode.VickyMD);\n  const [previewElement, setPreviewElement] = useState<HTMLElement>(null);\n  const [gitStatus, setGitStatus] = useState<string>(\"\");\n  const [fullScreenMode, setFullScreenMode] = useState<boolean>(false);\n  const [tagsMenuAnchorEl, setTagsMenuAnchorEl] = useState<HTMLElement>(null);\n  const [tagName, setTagName] = useState<string>(\"\");\n  const [tagNames, setTagNames] = useState<string[]>([]);\n  const [toggleEncryptionDialogOpen, setToggleEncryptionDialogOpen] = useState<\n    boolean\n  >(false);\n  const [toggleEncryptionPassword, setToggleEncryptionPassword] = useState<\n    string\n  >(\"\");\n  const [decryptionDialogOpen, setDecryptionDialogOpen] = useState<boolean>(\n    false\n  );\n  const [decryptionPassword, setDecryptionPassword] = useState<string>(\"\");\n  const [isDecrypted, setIsDecrypted] = useState<boolean>(false);\n  const [needsToPrint, setNeedsToPrint] = useState<boolean>(false);\n  const [editImageElement, setEditImageElement] = useState<HTMLImageElement>(\n    null\n  );\n  const [editImageTextMarker, setEditImageTextMarker] = useState<TextMarker>(\n    null\n  );\n  const [editImageDialogOpen, setEditImageDialogOpen] = useState<boolean>(\n    false\n  );\n\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n\n  const { t } = useTranslation();\n\n  const closeFilePathDialog = useCallback(() => {\n    if (!note) return;\n    setFilePathDialogOpen(false);\n    setNewFilePath(note.filePath);\n  }, [note]);\n\n  const closeEncryptionDialog = useCallback(() => {\n    setToggleEncryptionPassword(\"\");\n    setToggleEncryptionDialogOpen(false);\n  }, []);\n\n  const closeDecryptionDialog = useCallback(() => {\n    setDecryptionPassword(\"\");\n    setDecryptionDialogOpen(false);\n  }, []);\n\n  const changeFilePath = useCallback(\n    (newFilePath: string) => {\n      if (!note) return;\n      (async () => {\n        newFilePath = newFilePath.replace(/^\\/+/, \"\");\n        if (!newFilePath.endsWith(\".md\")) {\n          newFilePath = newFilePath + \".md\";\n        }\n        if (note.filePath !== newFilePath) {\n          await crossnoteContainer.changeNoteFilePath(note, newFilePath);\n        }\n        setNewFilePath(newFilePath);\n        setFilePathDialogOpen(false);\n      })();\n    },\n    [note, closeFilePathDialog]\n  );\n\n  const pullNotebook = useCallback(() => {\n    new Noty({\n      type: \"info\",\n      text: \"Pulling notebook...\",\n      layout: \"topRight\",\n      theme: \"relax\",\n      timeout: 2000\n    }).show();\n    if (!note) return;\n    crossnoteContainer\n      .pullNotebook({\n        notebook: note.notebook,\n        onAuthFailure: () => {\n          new Noty({\n            type: \"error\",\n            text: \"Authentication failed\",\n            layout: \"topRight\",\n            theme: \"relax\",\n            timeout: 5000\n          }).show();\n        }\n      })\n      .then(() => {\n        new Noty({\n          type: \"success\",\n          text: \"Notebook pulled\",\n          layout: \"topRight\",\n          theme: \"relax\",\n          timeout: 2000\n        }).show();\n      })\n      .catch(error => {\n        console.log(error);\n        new Noty({\n          type: \"error\",\n          text: \"Failed to pull notebook\",\n          layout: \"topRight\",\n          theme: \"relax\",\n          timeout: 2000\n        }).show();\n      });\n  }, [note]);\n\n  const checkoutNote = useCallback(() => {\n    if (!note) return;\n    crossnoteContainer.checkoutNote(note);\n  }, [note]);\n\n  const addTag = useCallback(() => {\n    let tag = tagName.trim() || \"\";\n    if (!note || !tag.length || !editor || !isDecrypted) {\n      return;\n    }\n    tag = tag\n      .replace(/\\s+/g, \" \")\n      .split(\"/\")\n      .map(t => t.trim())\n      .filter(x => x.length > 0)\n      .join(\"/\");\n    setTagNames(tagNames => {\n      const newTagNames =\n        tagNames.indexOf(tag) >= 0 ? [...tagNames] : [tag, ...tagNames];\n      note.config.tags = newTagNames.sort((x, y) => x.localeCompare(y));\n      crossnoteContainer.updateNoteMarkdown(\n        note,\n        editor.getValue(),\n        note.config.encryption ? decryptionPassword : \"\",\n        status => {\n          setGitStatus(status);\n        }\n      );\n      crossnoteContainer.updateNotebookTagNode();\n      return newTagNames;\n    });\n    setTagName(\"\");\n  }, [tagName, note, editor, decryptionPassword, isDecrypted]);\n\n  const deleteTag = useCallback(\n    (tagName: string) => {\n      if (note && editor && isDecrypted) {\n        setTagNames(tagNames => {\n          const newTagNames = tagNames.filter(t => t !== tagName);\n          note.config.tags = newTagNames.sort((x, y) => x.localeCompare(y));\n          crossnoteContainer.updateNoteMarkdown(\n            note,\n            editor.getValue(),\n            note.config.encryption ? decryptionPassword : \"\",\n            status => {\n              setGitStatus(status);\n            }\n          );\n          crossnoteContainer.updateNotebookTagNode();\n          return newTagNames;\n        });\n      }\n    },\n    [note, editor, decryptionPassword, isDecrypted]\n  );\n\n  const toggleEncryption = useCallback(() => {\n    if (note && editor) {\n      const markdown = editor.getValue();\n      if (note.config.encryption) {\n        // Disable encryption\n        // Check if the password is correct\n        crossnoteContainer\n          .getNote(note.notebook, note.filePath)\n          .then(n => {\n            try {\n              const bytes = CryptoJS.AES.decrypt(\n                n.markdown.trim(),\n                toggleEncryptionPassword\n              );\n              const json = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));\n              // Disable encryption\n              note.config.encryption = null;\n              delete note.config.encryption;\n              crossnoteContainer.updateNoteMarkdown(\n                note,\n                json.markdown,\n                \"\",\n                status => {\n                  setGitStatus(status);\n                  setDecryptionPassword(\"\");\n                  setIsDecrypted(true);\n                  closeEncryptionDialog();\n                  editor.setValue(json.markdown);\n                  editor.setOption(\"readOnly\", false);\n                }\n              );\n            } catch (error) {\n              new Noty({\n                type: \"error\",\n                text: \"Failed to disable encryption\",\n                layout: \"topRight\",\n                theme: \"relax\",\n                timeout: 5000\n              }).show();\n            }\n          })\n          .catch(error => {\n            new Noty({\n              type: \"error\",\n              text: \"Failed to disable encryption\",\n              layout: \"topRight\",\n              theme: \"relax\",\n              timeout: 5000\n            }).show();\n          });\n      } else {\n        // Enable encryption\n        note.config.encryption = {\n          title: getHeaderFromMarkdown(markdown)\n        };\n        crossnoteContainer.updateNoteMarkdown(\n          note,\n          editor.getValue(),\n          toggleEncryptionPassword,\n          status => {\n            setDecryptionPassword(toggleEncryptionPassword);\n            setIsDecrypted(true);\n            setGitStatus(status);\n            closeEncryptionDialog();\n          }\n        );\n      }\n    }\n  }, [note, editor, closeEncryptionDialog, toggleEncryptionPassword]);\n\n  const decryptNote = useCallback(() => {\n    if (note && editor) {\n      crossnoteContainer\n        .getNote(note.notebook, note.filePath)\n        .then(n => {\n          // Decrypt\n          try {\n            const bytes = CryptoJS.AES.decrypt(\n              n.markdown.trim(),\n              decryptionPassword\n            );\n            const json = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));\n            editor.setOption(\"readOnly\", false);\n            editor.setValue(json.markdown);\n            setIsDecrypted(true);\n            setDecryptionDialogOpen(false); // Don't clear decryptionPassword\n          } catch (error) {\n            new Noty({\n              type: \"error\",\n              text: \"Decryption failed\",\n              layout: \"topRight\",\n              theme: \"relax\",\n              timeout: 5000\n            }).show();\n            setIsDecrypted(false);\n          }\n        })\n        .catch(error => {\n          setIsDecrypted(false);\n          console.log(error);\n        });\n    }\n  }, [note, editor, decryptionPassword, closeDecryptionDialog]);\n\n  const togglePin = useCallback(() => {\n    if (note && editor && isDecrypted) {\n      note.config.pinned = !note.config.pinned;\n      if (!note.config.pinned) {\n        delete note.config.pinned;\n      }\n      crossnoteContainer.updateNoteMarkdown(\n        note,\n        editor.getValue(),\n        note.config.encryption ? decryptionPassword : \"\",\n        status => {\n          setGitStatus(status);\n        }\n      );\n    }\n  }, [note, editor, decryptionPassword, isDecrypted]);\n\n  const openURL = useCallback(\n    (url: string = \"\") => {\n      if (!note || !editor || !url) {\n        return;\n      }\n      if (url.match(/https?:\\/\\//)) {\n        window.open(url, \"_blank\");\n      } else if (url.startsWith(\"/\")) {\n        let filePath = path.relative(\n          note.notebook.dir,\n          path.resolve(note.notebook.dir, url.replace(/^\\//, \"\"))\n        );\n        crossnoteContainer.openNoteAtPath(filePath);\n      } else {\n        let filePath = path.relative(\n          note.notebook.dir,\n          path.resolve(\n            path.dirname(path.resolve(note.notebook.dir, note.filePath)),\n            url\n          )\n        );\n        crossnoteContainer.openNoteAtPath(filePath);\n      }\n    },\n    [note, editor]\n  );\n\n  useEffect(() => {\n    if (!note) {\n      return () => {\n        setEditor(null);\n        setTextAreaElement(null);\n        setPreviewElement(null);\n      };\n    }\n  }, [note]);\n\n  useEffect(() => {\n    if (note) {\n      setNewFilePath(note.filePath);\n    }\n  }, [note]);\n\n  useEffect(() => {\n    if (note) {\n      crossnoteContainer.crossnote.getStatus(note).then(status => {\n        setGitStatus(status);\n      });\n    }\n  }, [note, crossnoteContainer.crossnote]);\n\n  // Decryption\n  useEffect(() => {\n    if (!editor || !note) return;\n    if (note.config.encryption) {\n      setIsDecrypted(false);\n      setDecryptionPassword(\"\");\n      editor.setOption(\"readOnly\", true);\n      editor.setValue(\"🔐 encrypted\");\n      setDecryptionDialogOpen(true);\n    } else {\n      setIsDecrypted(true);\n      setDecryptionPassword(\"\");\n      editor.setOption(\"readOnly\", false);\n      editor.setValue(note.markdown);\n    }\n  }, [editor, note]);\n\n  useEffect(() => {\n    if (textAreaElement && !editor && note) {\n      // console.log(\"textarea element mounted\");\n      const editor: CodeMirrorEditor = VickyMD.fromTextArea(textAreaElement, {\n        mode: {\n          name: \"hypermd\",\n          hashtag: true\n        },\n        inputStyle: \"textarea\"\n      });\n      editor.setOption(\"lineNumbers\", false);\n      editor.setOption(\"foldGutter\", false);\n      editor.setValue(note.markdown || \"\");\n      editor.on(\"cursorActivity\", instance => {\n        const cursor = instance.getCursor();\n        if (cursor) {\n          setCursorPosition({\n            line: cursor.line,\n            ch: cursor.ch\n          });\n        }\n      });\n      setEditor(editor);\n    }\n  }, [textAreaElement, note, editor]);\n\n  useEffect(() => {\n    if (editor && note) {\n      setTagNames(note.config.tags || []);\n      const changesHandler = () => {\n        if (editor.getOption(\"readOnly\") || !isDecrypted) {\n          // This line is necessary for decryption...\n          return;\n        }\n        const markdown = editor.getValue();\n\n        if (!note.config.encryption && markdown === note.markdown) {\n          return;\n        }\n        crossnoteContainer.updateNoteMarkdown(\n          note,\n          markdown,\n          note.config.encryption ? decryptionPassword : \"\",\n          status => {\n            setGitStatus(status);\n            setTagNames(note.config.tags || []); // After resolve conflicts\n          }\n        );\n      };\n      editor.on(\"changes\", changesHandler);\n\n      const keyupHandler = () => {\n        if (!isDecrypted && note.config.encryption) {\n          setDecryptionDialogOpen(true);\n        }\n      };\n      editor.on(\"keyup\", keyupHandler);\n\n      const linkIconClickedHandler = (args: any) => {\n        const url = args.element.getAttribute(\"data-url\");\n        openURL(url || \"\");\n      };\n      editor.on(\"linkIconClicked\", linkIconClickedHandler);\n\n      const imageClickedHandler = (args: any) => {\n        const marker: TextMarker = args.marker;\n        const imageElement: HTMLImageElement = args.element;\n        imageElement.setAttribute(\n          \"data-marker-position\",\n          JSON.stringify(marker.find())\n        );\n        setEditImageElement(imageElement);\n        setEditImageTextMarker(marker);\n        setEditImageDialogOpen(true);\n      };\n      editor.on(\"imageClicked\", imageClickedHandler);\n\n      return () => {\n        editor.off(\"changes\", changesHandler);\n        editor.off(\"keyup\", keyupHandler);\n        editor.off(\"linkIconClicked\", linkIconClickedHandler);\n        editor.off(\"imageClicked\", imageClickedHandler);\n      };\n    }\n  }, [editor, note, decryptionPassword, isDecrypted]);\n\n  useEffect(() => {\n    if (!editor || !note) return;\n    if (editorMode === EditorMode.VickyMD) {\n      VickyMD.switchToHyperMD(editor);\n      editor.getWrapperElement().style.display = \"block\";\n      editor.refresh();\n    } else if (editorMode === EditorMode.SourceCode) {\n      VickyMD.switchToNormal(editor);\n      editor.getWrapperElement().style.display = \"block\";\n      editor.refresh();\n    } else {\n      editor.getWrapperElement().style.display = \"none\";\n    }\n  }, [editorMode, editor, note, isDecrypted]);\n\n  // Render Preview\n  useEffect(() => {\n    if (editorMode === EditorMode.Preview && editor && note && previewElement) {\n      if (isDecrypted) {\n        const handleLinksClickEvent = (preview: HTMLElement) => {\n          // Handle link click event\n          const links = preview.getElementsByTagName(\"A\");\n          for (let i = 0; i < links.length; i++) {\n            const link = links[i] as HTMLAnchorElement;\n            link.onclick = event => {\n              event.preventDefault();\n              openURL(link.getAttribute(\"href\"));\n            };\n          }\n        };\n        renderPreview(previewElement, editor.getValue());\n        if (\n          previewElement.childElementCount &&\n          previewElement.children[0].tagName.toUpperCase() === \"IFRAME\"\n        ) {\n          // presentation\n          previewElement.style.maxWidth = \"100%\";\n          previewElement.style.height = \"100%\";\n          previewElement.style.overflow = \"hidden !important\";\n          handleLinksClickEvent(\n            (previewElement.children[0] as HTMLIFrameElement).contentDocument\n              .body as HTMLElement\n          );\n        } else {\n          // normal\n          // previewElement.style.maxWidth = `${EditorPreviewMaxWidth}px`;\n          previewElement.style.height = \"100%\";\n          previewElement.style.overflow = \"hidden !important\";\n          handleLinksClickEvent(previewElement);\n        }\n      } else {\n        previewElement.innerHTML = \"🔐 encrypted\";\n      }\n    }\n  }, [editorMode, editor, previewElement, note, isDecrypted]);\n\n  // Command\n  useEffect(() => {\n    if (!editor || !note) return;\n    const onChangeHandler = (\n      instance: CodeMirrorEditor,\n      changeObject: EditorChangeLinkedList\n    ) => {\n      // Check commands\n      if (changeObject.text.length === 1 && changeObject.text[0] === \"/\") {\n        editor.showHint({\n          closeOnUnfocus: false,\n          completeSingle: false,\n          hint: () => {\n            const cursor = editor.getCursor();\n            const token = editor.getTokenAt(cursor);\n            const start = token.string.lastIndexOf(\"/\");\n            const line = cursor.line;\n            const end: number = cursor.ch;\n            const currentWord: string = token.string.slice(start + 1, end);\n\n            const commands = [\n              {\n                text: \"# \",\n                displayText: `/h1 - ${t(\"editor/toolbar/insert-header-1\")}`\n              },\n              {\n                text: \"## \",\n                displayText: `/h2 - ${t(\"editor/toolbar/insert-header-2\")}`\n              },\n              {\n                text: \"### \",\n                displayText: `/h3 - ${t(\"editor/toolbar/insert-header-3\")}`\n              },\n              {\n                text: \"#### \",\n                displayText: `/h4 - ${t(\"editor/toolbar/insert-header-4\")}`\n              },\n              {\n                text: \"##### \",\n                displayText: `/h5 - ${t(\"editor/toolbar/insert-header-5\")}`\n              },\n              {\n                text: \"###### \",\n                displayText: `/h6 - ${t(\"editor/toolbar/insert-header-6\")}`\n              },\n              {\n                text: \"> \",\n                displayText: `/blockquote - ${t(\n                  \"editor/toolbar/insert-blockquote\"\n                )}`\n              },\n              {\n                text: \"* \",\n                displayText: `/ul - ${t(\n                  \"editor/toolbar/insert-unordered-list\"\n                )}`\n              },\n              {\n                text: \"1. \",\n                displayText: `/ol - ${t(\"editor/toolbar/insert-ordered-list\")}`\n              },\n              {\n                text: \"`@crossnote.image`\\n\",\n                displayText: `/image - ${t(\"editor/toolbar/insert-image\")}`\n              },\n              {\n                text: `|   |   |\n|---|---|\n|   |   |\n`,\n                displayText: `/table - ${t(\"editor/toolbar/insert-table\")}`\n              },\n              {\n                text:\n                  \"`@timer \" +\n                  JSON.stringify({ date: new Date().toString() })\n                    .replace(/^{/, \"\")\n                    .replace(/}$/, \"\") +\n                  \"`\\n\",\n                displayText: `/timer - ${t(\"editor/toolbar/insert-clock\")}`\n              },\n              {\n                text: \"\",\n                displayText: `/emoji - ${t(\"editor/toolbar/insert-emoji\")}`\n              },\n              {\n                text: \"`@crossnote.audio`  \\n\",\n                displayText: `/audio - ${t(\"editor/toolbar/audio-url\")}`\n              },\n              {\n                text: \"`@crossnote.netease_music`  \\n\",\n                displayText: `/netease - ${t(\"editor/toolbar/netease-music\")}`\n              },\n              {\n                text: \"`@crossnote.video`  \\n\",\n                displayText: `/video - ${t(\"editor/toolbar/video-url\")}`\n              },\n              {\n                text: \"`@crossnote.youtube`  \\n\",\n                displayText: `/youtube - ${t(\"editor/toolbar/youtube\")}`\n              },\n              {\n                text: \"`@crossnote.bilibili`  \\n\",\n                displayText: `/bilibili - ${t(\"editor/toolbar/bilibili\")}`\n              },\n              {\n                text: \"<!-- slide -->  \\n\",\n                displayText: `/slide - ${t(\"editor/toolbar/insert-slide\")}`\n              },\n              {\n                text: \"`@crossnote.ocr`  \\n\",\n                displayText: `/ocr - ${t(\"editor/toolbar/insert-ocr\")}`\n              },\n              {\n                text: '`@crossnote.kanban \"v\":2,\"board\":{\"columns\":[]}`  \\n',\n                displayText: `/kanban - ${t(\n                  \"editor/toolbar/insert-kanban\"\n                )} (beta)`\n              },\n              {\n                text: \"`@crossnote.abc`  \\n\",\n                displayText: `/abc - ${t(\"editor/toolbar/insert-abc-notation\")}`\n              }\n            ];\n            const filtered = commands.filter(\n              item =>\n                item.displayText\n                  .toLocaleLowerCase()\n                  .indexOf(currentWord.toLowerCase()) >= 0\n            );\n            return {\n              list: filtered.length ? filtered : commands,\n              from: { line, ch: start },\n              to: { line, ch: end }\n            };\n          }\n        });\n      }\n\n      // Timer\n      if (\n        changeObject.text.length > 0 &&\n        changeObject.text[0].startsWith(\"`@timer \") &&\n        changeObject.removed.length > 0 &&\n        changeObject.removed[0].startsWith(\"/\")\n      ) {\n        // Calcuate date time\n        const lines = editor.getValue().split(\"\\n\");\n        const timerTexts: TimerText[] = [];\n        for (let i = 0; i < lines.length; i++) {\n          const match = lines[i].match(/^`@timer\\s.+`/);\n          if (match) {\n            const text = match[0];\n            const dataMatch = text.match(/^`@timer\\s+(.+)`/);\n            if (!dataMatch || !dataMatch.length) {\n              continue;\n            }\n            const dataStr = dataMatch[1];\n            try {\n              const data = JSON.parse(`{${dataStr}}`);\n              const datetime = data[\"date\"];\n              if (datetime) {\n                timerTexts.push({\n                  text: text,\n                  line: i,\n                  date: new Date(datetime)\n                });\n              }\n            } catch (error) {\n              continue;\n            }\n          }\n        }\n        for (let i = 1; i < timerTexts.length; i++) {\n          const currentTimerText = timerTexts[i];\n          const previousTimerText = timerTexts[i - 1];\n          const duration = formatDistance(\n            currentTimerText.date,\n            previousTimerText.date,\n            { includeSeconds: true }\n          );\n          const newText = `\\`@timer ${JSON.stringify({\n            date: currentTimerText.date.toString(),\n            duration\n          })\n            .replace(/^{/, \"\")\n            .replace(/}$/, \"\")}\\``;\n          editor.replaceRange(\n            newText,\n            { line: currentTimerText.line, ch: 0 },\n            { line: currentTimerText.line, ch: currentTimerText.text.length }\n          );\n        }\n      }\n    };\n    editor.on(\"change\", onChangeHandler);\n\n    const onCursorActivityHandler = (instance: CodeMirrorEditor) => {\n      // console.log(\"cursorActivity\", editor.getCursor());\n      // console.log(\"selection: \", editor.getSelection());\n      return;\n    };\n    editor.on(\"cursorActivity\", onCursorActivityHandler);\n\n    return () => {\n      editor.off(\"change\", onChangeHandler);\n      editor.off(\"cursorActivity\", onCursorActivityHandler);\n    };\n  }, [editor, note /*t*/]);\n\n  // Print preview\n  useEffect(() => {\n    if (!note || !editor || !needsToPrint) {\n      return;\n    }\n    if (editorMode === EditorMode.Preview && previewElement) {\n      const printDone = () => {\n        setNeedsToPrint(false);\n        previewElement.style.zIndex = `${previewZIndex}`;\n      };\n      printPreview(previewElement)\n        .then(() => {\n          printDone();\n        })\n        .catch(() => {\n          printDone();\n        });\n    } else {\n      setEditorMode(EditorMode.Preview);\n    }\n  }, [needsToPrint, editorMode, note, editor, previewElement]);\n\n  // Wiki TOC Render\n  useEffect(() => {\n    if (\n      note &&\n      editor &&\n      note.filePath === \"SUMMARY.md\" &&\n      crossnoteContainer.wikiTOCElement\n    ) {\n      const handleLinksClickEvent = (preview: HTMLElement) => {\n        // Handle link click event\n        const links = preview.getElementsByTagName(\"A\");\n        for (let i = 0; i < links.length; i++) {\n          const link = links[i] as HTMLAnchorElement;\n          link.onclick = event => {\n            event.preventDefault();\n            openURL(link.getAttribute(\"href\"));\n          };\n        }\n      };\n      const onChangesHandler = () => {\n        renderPreview(crossnoteContainer.wikiTOCElement, editor.getValue());\n        handleLinksClickEvent(crossnoteContainer.wikiTOCElement);\n      };\n      editor.on(\"changes\", onChangesHandler);\n      renderPreview(crossnoteContainer.wikiTOCElement, editor.getValue());\n      handleLinksClickEvent(crossnoteContainer.wikiTOCElement);\n      return () => {\n        editor.off(\"changes\", onChangesHandler);\n      };\n    }\n  }, [note, editor, crossnoteContainer.wikiTOCElement]);\n\n  if (!note) {\n    return (\n      <Box className={clsx(classes.editorPanel, \"editor-panel\")}>\n        <Hidden smUp>\n          <Box className={clsx(classes.topPanel)}>\n            <Box className={clsx(classes.row)}>\n              <ButtonGroup className={clsx(classes.backBtn)}>\n                <Button\n                  className={clsx(classes.controlBtn)}\n                  onClick={() => {\n                    crossnoteContainer.setDisplayMobileEditor(false);\n                  }}\n                >\n                  <ChevronLeft></ChevronLeft>\n                </Button>\n              </ButtonGroup>\n            </Box>\n          </Box>\n        </Hidden>\n        <Button\n          style={{\n            margin: \"0 auto\",\n            top: \"50%\",\n            position: \"relative\"\n          }}\n          onClick={() => crossnoteContainer.createNewNote()}\n          disabled={crossnoteContainer.isLoadingNotebook}\n          variant={\"outlined\"}\n        >\n          <Typography>{\"📝 Create a note\"}</Typography>\n        </Button>\n      </Box>\n    );\n  }\n\n  return (\n    <Box className={clsx(classes.editorPanel, \"editor-panel\")}>\n      <Box className={clsx(classes.topPanel)}>\n        <Box className={clsx(classes.row)}>\n          <ButtonGroup className={clsx(classes.backBtn)}>\n            <Button\n              className={clsx(classes.controlBtn)}\n              onClick={() => {\n                crossnoteContainer.setDisplayMobileEditor(false);\n              }}\n            >\n              <ChevronLeft></ChevronLeft>\n            </Button>\n          </ButtonGroup>\n          <ButtonGroup\n            variant={\"outlined\"}\n            color=\"default\"\n            aria-label=\"editor mode\"\n          >\n            <Tooltip title={t(\"general/vickymd\")}>\n              <Button\n                className={clsx(\n                  classes.controlBtn,\n                  editorMode === EditorMode.VickyMD &&\n                    classes.controlBtnSelected\n                )}\n                color={\n                  editorMode === EditorMode.VickyMD ? \"primary\" : \"default\"\n                }\n                onClick={() => setEditorMode(EditorMode.VickyMD)}\n              >\n                <Pencil></Pencil>\n              </Button>\n            </Tooltip>\n            <Tooltip title={t(\"editor/note-control/source-code\")}>\n              <Button\n                className={clsx(\n                  classes.controlBtn,\n                  editorMode === EditorMode.SourceCode &&\n                    classes.controlBtnSelected\n                )}\n                color={\n                  editorMode === EditorMode.SourceCode ? \"primary\" : \"default\"\n                }\n                onClick={() => setEditorMode(EditorMode.SourceCode)}\n              >\n                <CodeTags></CodeTags>\n              </Button>\n            </Tooltip>\n            <Tooltip title={t(\"editor/note-control/preview\")}>\n              <Button\n                className={clsx(\n                  classes.controlBtn,\n                  editorMode === EditorMode.Preview &&\n                    classes.controlBtnSelected\n                )}\n                color={\n                  editorMode === EditorMode.Preview ? \"primary\" : \"default\"\n                }\n                onClick={() => setEditorMode(EditorMode.Preview)}\n              >\n                <FilePresentationBox></FilePresentationBox>\n              </Button>\n            </Tooltip>\n          </ButtonGroup>\n          <ButtonGroup style={{ marginLeft: \"8px\" }}>\n            {isDecrypted && (\n              <Tooltip title={\"Tags\"}>\n                <Button\n                  className={clsx(classes.controlBtn)}\n                  onClick={event => setTagsMenuAnchorEl(event.currentTarget)}\n                >\n                  <TagOutline></TagOutline>\n                </Button>\n              </Tooltip>\n            )}\n            {isDecrypted && (\n              <Tooltip title={\"Pin\"}>\n                <Button\n                  className={clsx(\n                    classes.controlBtn,\n                    note.config.pinned && classes.controlBtnSelectedSecondary\n                  )}\n                  onClick={togglePin}\n                >\n                  {note.config.pinned ? <Pin></Pin> : <PinOutline></PinOutline>}\n                </Button>\n              </Tooltip>\n            )}\n            <Tooltip title={\"Encryption\"}>\n              <Button\n                className={clsx(\n                  classes.controlBtn,\n                  note.config.encryption && classes.controlBtnSelectedSecondary\n                )}\n                onClick={() => setToggleEncryptionDialogOpen(true)}\n              >\n                {note.config.encryption ? (\n                  <Lock></Lock>\n                ) : (\n                  <LockOpenOutline></LockOpenOutline>\n                )}\n              </Button>\n            </Tooltip>\n          </ButtonGroup>\n          <ButtonGroup style={{ marginLeft: \"8px\" }}>\n            <Tooltip title={\"Change file path\"}>\n              <Button\n                className={clsx(classes.controlBtn)}\n                onClick={() => setFilePathDialogOpen(true)}\n              >\n                <RenameBox></RenameBox>\n              </Button>\n            </Tooltip>\n            <Tooltip title={\"Restore (checkout)\"}>\n              <Button\n                className={clsx(classes.controlBtn)}\n                onClick={checkoutNote}\n              >\n                <Restore></Restore>\n              </Button>\n            </Tooltip>\n            <Tooltip title={\"Delete file\"}>\n              <Button\n                className={clsx(classes.controlBtn)}\n                onClick={() => setDeleteDialogOpen(true)}\n              >\n                <Delete></Delete>\n              </Button>\n            </Tooltip>\n            {is.desktop() && (\n              <Tooltip title={\"Print\"}>\n                <Button\n                  className={clsx(classes.controlBtn)}\n                  onClick={() => setNeedsToPrint(true)}\n                >\n                  <Printer></Printer>\n                </Button>\n              </Tooltip>\n            )}\n          </ButtonGroup>\n          <ButtonGroup style={{ marginLeft: \"8px\" }}>\n            <Tooltip title={\"Fullscreen\"}>\n              <Button\n                className={clsx(classes.controlBtn)}\n                onClick={() => setFullScreenMode(true)}\n              >\n                <Fullscreen></Fullscreen>\n              </Button>\n            </Tooltip>\n          </ButtonGroup>\n          {note.notebook.gitURL && ( // If no git url set, then don't allow push/pull\n            <ButtonGroup style={{ marginLeft: \"8px\" }}>\n              <Tooltip title={\"Upload (Push)\"}>\n                <Button\n                  className={clsx(classes.controlBtn)}\n                  onClick={() => setPushDialogOpen(true)}\n                  disabled={\n                    crossnoteContainer.isPullingNotebook ||\n                    crossnoteContainer.isPushingNotebook\n                  }\n                >\n                  <CloudUploadOutline></CloudUploadOutline>\n                </Button>\n              </Tooltip>\n              <Tooltip title={\"Download (Pull)\"}>\n                <Button\n                  className={clsx(classes.controlBtn)}\n                  onClick={pullNotebook}\n                  disabled={\n                    crossnoteContainer.isPullingNotebook ||\n                    crossnoteContainer.isPushingNotebook\n                  }\n                >\n                  <CloudDownloadOutline></CloudDownloadOutline>\n                </Button>\n              </Tooltip>\n            </ButtonGroup>\n          )}\n          <Popover\n            open={Boolean(tagsMenuAnchorEl)}\n            anchorEl={tagsMenuAnchorEl}\n            keepMounted\n            onClose={() => setTagsMenuAnchorEl(null)}\n          >\n            <List>\n              <ListItem\n                className={clsx(\n                  classes.menuItemOverride,\n                  classes.menuItemTextField\n                )}\n              >\n                <TextField\n                  placeholder={\"Add tag...\"}\n                  autoFocus={true}\n                  value={tagName}\n                  onChange={event => {\n                    event.stopPropagation();\n                    setTagName(event.target.value);\n                  }}\n                  onKeyUp={event => {\n                    if (event.which === 13) {\n                      addTag();\n                    }\n                  }}\n                ></TextField>\n              </ListItem>\n              {tagNames.length > 0 ? (\n                tagNames.map(tagName => {\n                  return (\n                    <ListItem\n                      key={tagName}\n                      className={clsx(classes.menuItemOverride)}\n                    >\n                      <Box\n                        style={{\n                          display: \"flex\",\n                          flexDirection: \"row\",\n                          alignItems: \"center\",\n                          justifyContent: \"space-between\",\n                          width: \"100%\"\n                        }}\n                      >\n                        <Typography>{tagName}</Typography>\n                        <IconButton onClick={() => deleteTag(tagName)}>\n                          <Close></Close>\n                        </IconButton>\n                      </Box>\n                    </ListItem>\n                  );\n                })\n              ) : (\n                <ListItem className={clsx(classes.menuItemOverride)}>\n                  <Typography style={{ margin: \"8px 0\" }}>\n                    {\"No tags\"}\n                  </Typography>\n                </ListItem>\n              )}\n            </List>\n          </Popover>\n        </Box>\n      </Box>\n      <Box\n        className={clsx(\n          classes.editorWrapper,\n          fullScreenMode ? classes.fullScreen : null\n        )}\n      >\n        <textarea\n          className={clsx(classes.editor, \"editor-textarea\")}\n          placeholder={t(\"editor/placeholder\")}\n          ref={(element: HTMLTextAreaElement) => {\n            setTextAreaElement(element);\n          }}\n        ></textarea>\n        {editorMode === EditorMode.Preview &&\n        /*!editorContainer.pinPreviewOnTheSide &&*/\n        editor ? (\n          <div\n            className={clsx(classes.preview, \"preview\")}\n            id=\"preview\"\n            ref={(element: HTMLElement) => {\n              setPreviewElement(element);\n            }}\n          ></div>\n        ) : null}\n        {fullScreenMode && (\n          <IconButton\n            style={{\n              position: \"fixed\",\n              right: \"0\",\n              top: \"0\",\n              zIndex: 2001\n            }}\n            onClick={() => setFullScreenMode(false)}\n          >\n            <FullscreenExit></FullscreenExit>\n          </IconButton>\n        )}\n      </Box>\n      <Box className={clsx(classes.bottomPanel, \"editor-bottom-panel\")}>\n        <Box className={clsx(classes.row)}>\n          <Typography\n            variant={\"caption\"}\n            style={{ cursor: \"pointer\" }}\n            onClick={() => {\n              setFilePathDialogOpen(true);\n            }}\n          >\n            {note.filePath}\n          </Typography>\n          <Typography variant={\"caption\"} style={{ marginLeft: \"4px\" }}>\n            {\"- \" + gitStatus}\n          </Typography>\n        </Box>\n        <Box className={clsx(classes.cursorPositionInfo)}>\n          <Typography variant={\"caption\"}>\n            {`Ln ${cursorPosition.line + 1}, Col ${cursorPosition.ch}`}\n          </Typography>\n        </Box>\n      </Box>\n      <Dialog\n        open={deleteDialogOpen}\n        onClose={() => setDeleteDialogOpen(false)}\n      >\n        <DialogTitle>Are you sure to delete this file?</DialogTitle>\n        <DialogContent>\n          <DialogContentText>Can't be undone</DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            style={{ color: \"red\" }}\n            onClick={() => {\n              crossnoteContainer.deleteNote(note);\n              setDeleteDialogOpen(false);\n            }}\n          >\n            Delete\n          </Button>\n          <Button onClick={() => setDeleteDialogOpen(false)}>Cancel</Button>\n        </DialogActions>\n      </Dialog>\n      <Dialog open={filePathDialogOpen} onClose={closeFilePathDialog}>\n        <DialogTitle>Change file path</DialogTitle>\n        <DialogContent>\n          <TextField\n            value={newFilePath}\n            autoFocus={true}\n            onChange={event => setNewFilePath(event.target.value)}\n            onKeyUp={event => {\n              if (event.which === 13) {\n                changeFilePath(newFilePath);\n              }\n            }}\n          ></TextField>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => changeFilePath(newFilePath)}>Save</Button>\n          <Button onClick={closeFilePathDialog}>Cancel</Button>\n        </DialogActions>\n      </Dialog>\n      <Dialog open={toggleEncryptionDialogOpen} onClose={closeEncryptionDialog}>\n        <DialogTitle>\n          {note.config.encryption\n            ? \"Disable the encryption\"\n            : \"Encrypt this note with password\"}\n        </DialogTitle>\n        <DialogContent>\n          <TextField\n            value={toggleEncryptionPassword}\n            autoFocus={true}\n            onChange={event => setToggleEncryptionPassword(event.target.value)}\n            onKeyUp={event => {\n              if (event.which === 13) {\n                toggleEncryption();\n              }\n            }}\n            placeholder={\"password\"}\n            type={\"password\"}\n          ></TextField>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            variant={\"contained\"}\n            color={\"primary\"}\n            onClick={toggleEncryption}\n          >\n            {note.config.encryption ? <Lock></Lock> : <LockOpen></LockOpen>}\n            {note.config.encryption ? \"Disable encryption\" : \"Encrypt\"}\n          </Button>\n          <Button onClick={closeEncryptionDialog}>Cancel</Button>\n        </DialogActions>\n      </Dialog>\n      <Dialog open={decryptionDialogOpen} onClose={closeDecryptionDialog}>\n        <DialogTitle>{\"Decrypt this note\"}</DialogTitle>\n        <DialogContent>\n          <TextField\n            value={decryptionPassword}\n            autoFocus={true}\n            onChange={event => setDecryptionPassword(event.target.value)}\n            placeholder={\"password\"}\n            type={\"password\"}\n            onKeyUp={event => {\n              if (event.which === 13) {\n                decryptNote();\n              }\n            }}\n          ></TextField>\n        </DialogContent>\n        <DialogActions>\n          <Button variant={\"contained\"} color={\"primary\"} onClick={decryptNote}>\n            {\"Decrypt\"}\n          </Button>\n          <Button onClick={closeDecryptionDialog}>Cancel</Button>\n        </DialogActions>\n      </Dialog>\n      <PushNotebookDialog\n        open={pushDialogOpen}\n        onClose={() => setPushDialogOpen(false)}\n        notebook={note.notebook}\n      ></PushNotebookDialog>\n      <EditImageDialog\n        open={editImageDialogOpen}\n        onClose={() => setEditImageDialogOpen(false)}\n        editor={editor}\n        imageElement={editImageElement}\n        marker={editImageTextMarker}\n      ></EditImageDialog>\n    </Box>\n  );\n}\n","import { printPreview as VickyMDPrintPreview } from \"vickymd/preview\";\n\nexport function handleTagClickInPreview(previewElement: HTMLElement) {\n  const tagElements = previewElement.querySelectorAll(\"a.tag\");\n  for (let i = 0; i < tagElements.length; i++) {\n    const tag = tagElements[i];\n    if (tag.hasAttribute(\"data-topic\")) {\n      const tagName = tag.getAttribute(\"data-topic\");\n      if (tagName.trim().length) {\n        tag.addEventListener(\"click\", () => {\n          window.open(\n            `${window.location.origin}/tag/${tagName.trim()}`,\n            \"_blank\"\n          );\n        });\n      }\n    }\n  }\n}\n\nexport function printPreview(\n  previewElement: HTMLElement,\n  bannerElement?: HTMLElement,\n  timeout = 2000\n) {\n  return VickyMDPrintPreview(\n    previewElement,\n    bannerElement,\n    [\"#main-panel\", \"#editor-main-panel\", \"#editor-card\"],\n    `\n  #notes-panel,\n  .editor-bottom-panel,\n  .drawer,\n  .CodeMirror,\n  .editor-textarea,\n  .control-panel-wrapper {\n    display: none;\n  }\n  #editor-card {\n    width: 100%;\n    height: 100%;\n    box-shadow: none;\n  }\n  .editor-panel, #main-panel {\n    background-color: #fff;\n    box-shadow: none;\n    border: none;\n  }\n`,\n    timeout\n  );\n}\n","import React, { useState, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  TextField,\n  Box,\n  Typography,\n  DialogActions,\n  Button,\n  Link,\n  FormControlLabel,\n  Checkbox,\n  ExpansionPanel,\n  ExpansionPanelDetails,\n  ExpansionPanelSummary\n} from \"@material-ui/core\";\nimport { ChevronDown } from \"mdi-material-ui\";\nimport { CrossnoteContainer } from \"../containers/crossnote\";\nimport Noty from \"noty\";\n\ninterface Props {\n  open: boolean;\n  onClose: () => void;\n  canCancel: boolean;\n}\n\nexport default function AddNotebookDialog(props: Props) {\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n  const [notebookName, setNotebookName] = useState<string>(\"\");\n  const [expanded, setExpanded] = useState<boolean>(false);\n  const [gitURL, setGitURL] = useState<string>(\"\");\n  const [gitBranch, setGitBranch] = useState<string>(\"\");\n  const [gitUsername, setGitUsername] = useState<string>(\"\");\n  const [gitPassword, setGitPassword] = useState<string>(\"\");\n  const [gitCorsProxy, setGitCorsProxy] = useState<string>(\n    \"https://cors.isomorphic-git.org\"\n  );\n  const [rememberCredentialsChecked, setRememberCredentialsChecked] = useState<\n    boolean\n  >(false);\n\n  const addNotebook = useCallback(async () => {\n    try {\n      new Noty({\n        type: \"info\",\n        text: \"Getting notebook...\",\n        layout: \"topRight\",\n        theme: \"relax\",\n        timeout: 2000\n      }).show();\n      await crossnoteContainer.addNotebook(\n        notebookName,\n        gitURL,\n        gitBranch,\n        gitUsername,\n        gitPassword,\n        rememberCredentialsChecked,\n        gitCorsProxy\n      );\n      props.onClose();\n    } catch (error) {\n      new Noty({\n        type: \"error\",\n        text: \"Failed to get notebook...\",\n        layout: \"topRight\",\n        theme: \"relax\",\n        timeout: 2000\n      }).show();\n      props.onClose();\n    }\n  }, [\n    props,\n    notebookName,\n    gitURL,\n    gitBranch,\n    gitUsername,\n    gitPassword,\n    rememberCredentialsChecked,\n    gitCorsProxy\n  ]);\n\n  return (\n    <Dialog\n      open={props.open}\n      onClose={() => {\n        if (!crossnoteContainer.isAddingNotebook) {\n          props.onClose();\n        }\n      }}\n    >\n      <DialogTitle>Add a notebook</DialogTitle>\n      <DialogContent>\n        <TextField\n          label={\"Notebook name\"}\n          value={notebookName}\n          fullWidth={true}\n          onChange={event => {\n            setNotebookName(event.target.value);\n          }}\n          style={{ marginBottom: \"16px\" }}\n        ></TextField>\n        <ExpansionPanel\n          elevation={2}\n          expanded={expanded}\n          onChange={() => setExpanded(!expanded)}\n        >\n          <ExpansionPanelSummary expandIcon={<ChevronDown></ChevronDown>}>\n            <Typography>{\"Git repository (optional)\"}</Typography>\n          </ExpansionPanelSummary>\n          <ExpansionPanelDetails>\n            <Box>\n              <TextField\n                label={\"url\"}\n                placeholder={\"https://abc/def.git\"}\n                fullWidth={true}\n                value={gitURL}\n                onChange={event => setGitURL(event.target.value)}\n              ></TextField>\n              <TextField\n                label={\"branch\"}\n                placeholder={\"master\"}\n                fullWidth={true}\n                value={gitBranch}\n                onChange={event => setGitBranch(event.target.value)}\n              ></TextField>\n              <TextField\n                label={\"username (optional)\"}\n                placeholder={\"username (optional)\"}\n                fullWidth={true}\n                value={gitUsername}\n                onChange={event => setGitUsername(event.target.value)}\n              ></TextField>\n              <TextField\n                label={\"password (optional)\"}\n                placeholder={\"password (optional)\"}\n                type={\"password\"}\n                fullWidth={true}\n                value={gitPassword}\n                onChange={event => setGitPassword(event.target.value)}\n              ></TextField>\n              <FormControlLabel\n                control={\n                  <Checkbox\n                    checked={rememberCredentialsChecked}\n                    onChange={() =>\n                      setRememberCredentialsChecked(!rememberCredentialsChecked)\n                    }\n                    value={rememberCredentialsChecked}\n                  />\n                }\n                label={\n                  <Typography>\n                    {\"Remember credentials\" +\n                      \" \" +\n                      (rememberCredentialsChecked ? \"(stored locally)\" : \"\")}\n                  </Typography>\n                }\n              />\n              <TextField\n                label={\"cors proxy\"}\n                placeholder={\"https://cors.isomorphic-git.org\"}\n                fullWidth={true}\n                value={gitCorsProxy}\n                onChange={event => setGitCorsProxy(event.target.value)}\n              ></TextField>\n              <Link\n                href={\n                  \"https://github.com/isomorphic-git/isomorphic-git#cors-support\"\n                }\n                target={\"_blank\"}\n              >\n                Why we need cors proxy?\n              </Link>\n            </Box>\n          </ExpansionPanelDetails>\n        </ExpansionPanel>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant={\"contained\"}\n          color={\"primary\"}\n          onClick={addNotebook}\n          disabled={crossnoteContainer.isAddingNotebook}\n        >\n          {crossnoteContainer.isAddingNotebook ? \"Adding...\" : \"Add\"}\n        </Button>\n        {props.canCancel && <Button onClick={props.onClose}>{\"Cancel\"}</Button>}\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import { TreeView, TreeItem } from \"@material-ui/lab\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { IconButton, Box, Typography } from \"@material-ui/core\";\nimport { ChevronRight, ChevronDown } from \"mdi-material-ui\";\nimport {\n  CrossnoteContainer,\n  SelectedSectionType\n} from \"../containers/crossnote\";\nimport { useTranslation } from \"react-i18next\";\nimport { Directory, Notebook, TagNode } from \"../lib/crossnote\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    treeItemRoot: {\n      paddingLeft: \"4px\",\n      // color: theme.palette.text.secondary,\n      \"&:focus > $treeItemContent\": {\n        color: \"#1a73e8\",\n        backgroundColor: \"#e8f0fe\" //theme.palette.primary.main\n        // backgroundColor: `var(--tree-view-bg-color, ${theme.palette.grey[400]})`,\n        // color: \"var(--tree-view-color)\"\n      },\n      \"&:focus > $treeItemLabelIcon\": {\n        color: \"#1a73e8\"\n      }\n    },\n    treeItemContent: {\n      cursor: \"default\",\n      color: theme.palette.text.primary,\n      // paddingLeft: theme.spacing(1),\n      // paddingRight: theme.spacing(1),\n      userSelect: \"none\",\n      fontWeight: theme.typography.fontWeightMedium,\n      \"$treeItemExpanded > &\": {\n        fontWeight: theme.typography.fontWeightRegular\n      }\n    },\n    treeItemGroup: {\n      marginLeft: 0,\n      \"& $treeItemContent\": {\n        // paddingLeft: theme.spacing(2)\n      }\n    },\n    treeItemExpanded: {},\n    treeItemLabel: {\n      fontWeight: \"inherit\",\n      color: \"inherit\"\n    },\n    treeItemLabelRoot: {\n      display: \"flex\",\n      alignItems: \"center\",\n      padding: theme.spacing(1, 0)\n    },\n    treeItemLabelIcon: {\n      color: \"rgba(0, 0, 0, 0.54)\"\n    },\n    treeItemLabelText: {\n      paddingLeft: \"12px\",\n      flexGrow: 1\n    }\n  })\n);\n\ninterface Props {\n  notebook: Notebook;\n}\nexport default function NotebookTreeView(props: Props) {\n  const classes = useStyles();\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n\n  const [expanded, setExpanded] = useState<string[]>([]);\n  const handleChange = useCallback(\n    (event: React.ChangeEvent<{}>, nodes: string[]) => {\n      event.stopPropagation();\n      const element = event.target as HTMLElement;\n      if (\n        element &&\n        element.tagName &&\n        element.tagName.toUpperCase().match(/^(SVG|PATH|BUTTON)$/)\n      ) {\n        crossnoteContainer.setSelectedNotebook(props.notebook);\n        setExpanded(nodes);\n      }\n    },\n    [props.notebook]\n  );\n\n  const constructDirectoryTreeItems: (directory: Directory) => any = (\n    directory: Directory\n  ) => {\n    if (directory.name === \".\") {\n      if (directory.children.length === 0) {\n        return null;\n      }\n      return (\n        <>{directory.children.map(dir => constructDirectoryTreeItems(dir))}</>\n      );\n    } else {\n      return (\n        <TreeItem\n          nodeId={directory.name}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          endIcon={<div style={{ width: 24 }}></div>}\n          key={directory.name}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Directory,\n                  path: directory.path\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"folder\">\n                {\"📁\"}\n              </span>\n              <Typography\n                color={\"inherit\"}\n                variant={\"body1\"}\n                className={clsx(classes.treeItemLabelText)}\n              >\n                {directory.name}\n              </Typography>\n            </Box>\n          }\n        >\n          {directory.children.map(dir => constructDirectoryTreeItems(dir))}\n        </TreeItem>\n      );\n    }\n  };\n\n  const constructTagNodeTreeItems: (tagNode: TagNode) => any = (\n    tagNode: TagNode\n  ) => {\n    if (tagNode.name === \".\") {\n      if (tagNode.children.length === 0) {\n        return null;\n      }\n      return (\n        <>{tagNode.children.map(node => constructTagNodeTreeItems(node))}</>\n      );\n    } else {\n      return (\n        <TreeItem\n          nodeId={tagNode.path}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          endIcon={<div style={{ width: 24 }}></div>}\n          key={tagNode.path}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Tag,\n                  path: tagNode.path\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"folder\">\n                {\"🏷️\"}\n              </span>\n              <Typography\n                color={\"inherit\"}\n                variant={\"body1\"}\n                className={clsx(classes.treeItemLabelText)}\n              >\n                {tagNode.name}\n              </Typography>\n            </Box>\n          }\n        >\n          {tagNode.children.map(dir => constructTagNodeTreeItems(dir))}\n        </TreeItem>\n      );\n    }\n  };\n\n  useEffect(() => {\n    if (crossnoteContainer.selectedNotebook !== props.notebook) {\n      setExpanded([]);\n    }\n  }, [crossnoteContainer.selectedNotebook, props.notebook]);\n\n  return (\n    <TreeView\n      defaultExpandIcon={\n        <IconButton\n          disableFocusRipple={true}\n          disableRipple={true}\n          size={\"medium\"}\n        >\n          <ChevronRight></ChevronRight>\n        </IconButton>\n      }\n      defaultCollapseIcon={\n        <IconButton\n          disableFocusRipple={true}\n          disableRipple={true}\n          size={\"medium\"}\n        >\n          <ChevronDown></ChevronDown>\n        </IconButton>\n      }\n      defaultEndIcon={<div style={{ width: 24 }} />}\n      expanded={expanded}\n      onNodeToggle={handleChange}\n      style={{ width: \"100%\" }}\n    >\n      <TreeItem\n        nodeId={\"notes\"}\n        classes={{\n          root: classes.treeItemRoot,\n          content: classes.treeItemContent,\n          expanded: classes.treeItemExpanded,\n          group: classes.treeItemGroup,\n          label: classes.treeItemLabel\n        }}\n        label={\n          <Box\n            onClick={() => {\n              crossnoteContainer.setSelectedNotebook(props.notebook);\n              crossnoteContainer.setSelectedSection({\n                type: SelectedSectionType.Notes\n              });\n            }}\n            className={clsx(classes.treeItemLabelRoot)}\n          >\n            {/*\n            <span role=\"img\" aria-label=\"notes\">\n              📒\n          </span>*/}\n            <Typography\n              color={\"inherit\"}\n              variant={\"body1\"}\n              className={clsx(classes.treeItemLabelText)}\n            >\n              {props.notebook.name}\n            </Typography>\n          </Box>\n        }\n      >\n        <TreeItem\n          nodeId={\"today-notes\"}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Today\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"today-notes\">\n                🗓\n              </span>\n              <Typography className={clsx(classes.treeItemLabelText)}>\n                {\"today\"}\n              </Typography>\n            </Box>\n          }\n        ></TreeItem>\n        <TreeItem\n          nodeId={\"todo-notes\"}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Todo\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"todo-notes\">\n                ☑️\n              </span>\n              <Typography className={clsx(classes.treeItemLabelText)}>\n                {\"todo\"}\n              </Typography>\n            </Box>\n          }\n        ></TreeItem>\n        <TreeItem\n          nodeId={\"directories\"}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Notes\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"directories\">\n                🗂\n              </span>\n              <Typography className={clsx(classes.treeItemLabelText)}>\n                {\"notes\"}\n              </Typography>\n            </Box>\n          }\n        >\n          {constructDirectoryTreeItems(crossnoteContainer.notebookDirectories)}\n        </TreeItem>\n        {crossnoteContainer.hasSummaryMD ? (\n          <TreeItem\n            nodeId={\"wiki\"}\n            classes={{\n              root: classes.treeItemRoot,\n              content: classes.treeItemContent,\n              expanded: classes.treeItemExpanded,\n              group: classes.treeItemGroup,\n              label: classes.treeItemLabel\n            }}\n            label={\n              <Box\n                onClick={() => {\n                  crossnoteContainer.setSelectedSection({\n                    type: SelectedSectionType.Wiki\n                  });\n                }}\n                className={clsx(classes.treeItemLabelRoot)}\n              >\n                <span role=\"img\" aria-label=\"wiki\">\n                  📖\n                </span>\n                <Typography className={clsx(classes.treeItemLabelText)}>\n                  {\"wiki\"}\n                </Typography>\n              </Box>\n            }\n          ></TreeItem>\n        ) : (\n          <TreeItem nodeId={\"wiki\"}></TreeItem>\n        )}\n        <TreeItem\n          nodeId={\"tagged-notes\"}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Tagged\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"tagged-notes\">\n                🏷️\n              </span>\n              <Typography className={clsx(classes.treeItemLabelText)}>\n                {\"tagged\"}\n              </Typography>\n            </Box>\n          }\n        >\n          {constructTagNodeTreeItems(crossnoteContainer.notebookTagNode)}\n        </TreeItem>\n        <TreeItem\n          nodeId={\"untagged-notes\"}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Untagged\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"untagged-notes\">\n                🈚\n              </span>\n              <Typography className={clsx(classes.treeItemLabelText)}>\n                {\"untagged\"}\n              </Typography>\n            </Box>\n          }\n        ></TreeItem>\n        <TreeItem\n          nodeId={\"encrypted-notes\"}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Encrypted\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"encrypted-notes\">\n                🔐\n              </span>\n              <Typography className={clsx(classes.treeItemLabelText)}>\n                {\"encrypted\"}\n              </Typography>\n            </Box>\n          }\n        ></TreeItem>\n        <TreeItem\n          nodeId={\"conflicted-notes\"}\n          classes={{\n            root: classes.treeItemRoot,\n            content: classes.treeItemContent,\n            expanded: classes.treeItemExpanded,\n            group: classes.treeItemGroup,\n            label: classes.treeItemLabel\n          }}\n          label={\n            <Box\n              onClick={() => {\n                crossnoteContainer.setSelectedSection({\n                  type: SelectedSectionType.Conflicted\n                });\n              }}\n              className={clsx(classes.treeItemLabelRoot)}\n            >\n              <span role=\"img\" aria-label=\"conflicted-notes\">\n                ⚠️\n              </span>\n              <Typography className={clsx(classes.treeItemLabelText)}>\n                {\"conflicted\"}\n              </Typography>\n            </Box>\n          }\n        ></TreeItem>\n      </TreeItem>\n    </TreeView>\n  );\n}\n","import React, { useState, useEffect, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  TextField,\n  Box,\n  Typography,\n  DialogActions,\n  Button,\n  Link,\n  FormControlLabel,\n  Checkbox,\n  ExpansionPanel,\n  ExpansionPanelDetails,\n  ExpansionPanelSummary\n} from \"@material-ui/core\";\nimport { ChevronDown } from \"mdi-material-ui\";\nimport { CrossnoteContainer } from \"../containers/crossnote\";\nimport { Notebook } from \"../lib/crossnote\";\n\ninterface Props {\n  open: boolean;\n  onClose: () => void;\n  notebook: Notebook;\n}\n\nconst MaxClickDeleteCount = 3;\nexport default function ConfigureNotebookDialog(props: Props) {\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n  const [notebookName, setNotebookName] = useState<string>(\"\");\n  const [expanded, setExpanded] = useState<boolean>(false);\n  const [gitURL, setGitURL] = useState<string>(\"\");\n  const [gitBranch, setGitBranch] = useState<string>(\"\");\n  const [gitUsername, setGitUsername] = useState<string>(\"\");\n  const [gitPassword, setGitPassword] = useState<string>(\"\");\n  const [gitCorsProxy, setGitCorsProxy] = useState<string>(\n    \"https://cors.isomorphic-git.org\"\n  );\n  const [clickDeleteCount, setClickDeleteCount] = useState<number>(\n    MaxClickDeleteCount\n  );\n\n  useEffect(() => {\n    const notebook = props.notebook;\n    if (!notebook) {\n      return;\n    }\n    setNotebookName(notebook.name);\n    setGitURL(notebook.gitURL);\n    setGitBranch(notebook.gitBranch || \"master\");\n    setGitUsername(notebook.gitUsername);\n    setGitPassword(notebook.gitPassword);\n    setGitCorsProxy(notebook.gitCorsProxy);\n  }, [props.notebook]);\n\n  const updateNotebook = useCallback(async () => {\n    const notebook = props.notebook;\n    if (!notebook) {\n      props.onClose();\n      return;\n    }\n    notebook.name = notebookName.trim();\n    notebook.gitURL = gitURL.trim();\n    notebook.gitBranch = gitBranch.trim();\n    notebook.gitUsername = gitUsername.trim();\n    notebook.gitPassword = gitPassword;\n    notebook.gitCorsProxy = gitCorsProxy.trim();\n    try {\n      await crossnoteContainer.updateNotebook(notebook);\n    } catch (error) {}\n    props.onClose();\n  }, [\n    props,\n    props.notebook,\n    notebookName,\n    gitURL,\n    gitBranch,\n    gitUsername,\n    gitPassword,\n    gitCorsProxy\n  ]);\n\n  const deleteNotebook = useCallback(async () => {\n    const notebook = props.notebook;\n    try {\n      await crossnoteContainer.deleteNotebook(notebook);\n    } catch (error) {}\n    props.onClose();\n  }, [props.notebook]);\n\n  useEffect(() => {\n    setClickDeleteCount(MaxClickDeleteCount);\n  }, [props.notebook]);\n\n  return (\n    <Dialog\n      open={props.open}\n      onClose={!clickDeleteCount ? null : props.onClose}\n    >\n      <DialogTitle>Configure a notebook</DialogTitle>\n      <DialogContent>\n        <TextField\n          label={\"Notebook name\"}\n          value={notebookName}\n          fullWidth={true}\n          onChange={event => {\n            setNotebookName(event.target.value);\n          }}\n          style={{ marginBottom: \"16px\" }}\n        ></TextField>\n        <ExpansionPanel\n          elevation={2}\n          expanded={expanded}\n          onChange={() => setExpanded(!expanded)}\n        >\n          <ExpansionPanelSummary expandIcon={<ChevronDown></ChevronDown>}>\n            <Typography>{\"Git repository (optional)\"}</Typography>\n          </ExpansionPanelSummary>\n          <ExpansionPanelDetails>\n            <Box>\n              <TextField\n                label={\"url\"}\n                placeholder={\"https://abc/def.git\"}\n                disabled={true}\n                fullWidth={true}\n                value={gitURL}\n                onChange={event => setGitURL(event.target.value)}\n              ></TextField>\n              <TextField\n                label={\"branch\"}\n                placeholder={\"master\"}\n                disabled={true}\n                fullWidth={true}\n                value={gitBranch}\n                onChange={event => setGitBranch(event.target.value)}\n              ></TextField>\n              <TextField\n                label={\"username (optional)\"}\n                placeholder={\"username (optional)\"}\n                fullWidth={true}\n                value={gitUsername}\n                onChange={event => setGitUsername(event.target.value)}\n              ></TextField>\n              <TextField\n                label={\"password (optional)\"}\n                placeholder={\"password (optional)\"}\n                type={\"password\"}\n                fullWidth={true}\n                value={gitPassword}\n                onChange={event => setGitPassword(event.target.value)}\n              ></TextField>\n              <TextField\n                label={\"cors proxy\"}\n                placeholder={\"https://cors.isomorphic-git.org\"}\n                fullWidth={true}\n                value={gitCorsProxy}\n                onChange={event => setGitCorsProxy(event.target.value)}\n              ></TextField>\n              <Link\n                href={\n                  \"https://github.com/isomorphic-git/isomorphic-git#cors-support\"\n                }\n                target={\"_blank\"}\n              >\n                Why we need cors proxy?\n              </Link>\n            </Box>\n          </ExpansionPanelDetails>\n        </ExpansionPanel>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant={\"contained\"}\n          color={\"secondary\"}\n          disabled={!clickDeleteCount}\n          onClick={() => {\n            if (clickDeleteCount === 1) {\n              deleteNotebook();\n              setClickDeleteCount(clickDeleteCount - 1);\n            } else {\n              setClickDeleteCount(clickDeleteCount - 1);\n            }\n          }}\n        >\n          {\"Delete\" +\n            (clickDeleteCount < MaxClickDeleteCount\n              ? ` ${clickDeleteCount}`\n              : \"\")}\n        </Button>\n        <Button\n          variant={\"contained\"}\n          color={\"primary\"}\n          onClick={updateNotebook}\n          disabled={!clickDeleteCount}\n        >\n          {\"Save\"}\n        </Button>\n        <Button onClick={props.onClose} disabled={!clickDeleteCount}>\n          {\"Cancel\"}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { CrossnoteContainer } from \"../containers/crossnote\";\nimport { Box, Typography, ButtonBase, Tooltip } from \"@material-ui/core\";\nimport { Note } from \"../lib/crossnote\";\nimport {\n  getHeaderFromMarkdown,\n  generateSummaryFromMarkdown,\n  Summary\n} from \"../utilities/note\";\nimport { formatDistanceStrict } from \"date-fns/esm\";\nimport { useTranslation } from \"react-i18next\";\nimport { Pin } from \"mdi-material-ui\";\nimport { formatRelative } from \"date-fns\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    noteCard: {\n      width: \"100%\",\n      display: \"flex\",\n      flexDirection: \"row\",\n      alignItems: \"flex-start\",\n      padding: theme.spacing(2, 0.5, 0),\n      textAlign: \"left\",\n      cursor: \"default\"\n    },\n    selected: {\n      borderLeft: `4px solid ${theme.palette.primary.main}`\n    },\n    unselected: {\n      borderLeft: `4px solid rgba(0, 0, 0, 0)`\n    },\n    leftPanel: {\n      width: \"48px\",\n      paddingLeft: theme.spacing(0.5)\n    },\n    duration: {\n      color: theme.palette.text.secondary\n    },\n    rightPanel: {\n      width: \"calc(100% - 48px)\",\n      borderBottom: \"1px solid #ededed\"\n    },\n    header: {\n      marginBottom: theme.spacing(1),\n      wordBreak: \"break-all\"\n    },\n    summary: {\n      color: theme.palette.text.secondary,\n      marginBottom: theme.spacing(1),\n      paddingRight: theme.spacing(2),\n      display: \"-webkit-box\",\n      lineHeight: \"1.3rem !important\",\n      textOverflow: \"ellipsis !important\",\n      overflow: \"hidden !important\",\n      maxWidth: \"100%\",\n      maxHeight: \"2.6rem\", // lineHeight x -website-line-clamp\n      \"-webkit-line-clamp\": 2,\n      \"-webkit-box-orient\": \"vertical\",\n      wordBreak: \"break-all\"\n    },\n    filePath: {},\n    images: {\n      display: \"flex\",\n      width: \"100%\",\n      overflow: \"hidden\",\n      position: \"relative\",\n      marginBottom: theme.spacing(1)\n    },\n    imagesWrapper: {\n      display: \"flex\",\n      alignItems: \"center\",\n      flexDirection: \"row\"\n    },\n    image: {\n      width: \"128px\",\n      height: \"80px\",\n      marginRight: theme.spacing(1),\n      position: \"relative\",\n      backgroundSize: \"cover\",\n      backgroundPosition: \"center\",\n      display: \"block\",\n      borderRadius: \"6px\"\n    },\n    pin: {\n      color: theme.palette.secondary.main,\n      marginTop: theme.spacing(1)\n    }\n  })\n);\n\ninterface Props {\n  note: Note;\n}\n\nexport default function NoteCard(props: Props) {\n  const classes = useStyles(props);\n  const note = props.note;\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n  const [header, setHeader] = useState<string>(\"\");\n  const [summary, setSummary] = useState<Summary>(null);\n  const [images, setImages] = useState<string[]>([]);\n  const [gitStatus, setGitStatus] = useState<string>(\"\");\n  const { t } = useTranslation();\n  const duration = formatDistanceStrict(note.config.modifiedAt, Date.now())\n    .replace(/\\sseconds?/, \"s\")\n    .replace(/\\sminutes?/, \"m\")\n    .replace(/\\shours?/, \"h\")\n    .replace(/\\sdays?/, \"d\")\n    .replace(/\\sweeks?/, \"w\")\n    .replace(/\\smonths?/, \"mo\")\n    .replace(/\\syears?/, \"y\");\n\n  useEffect(() => {\n    setHeader(\n      (note.config.encryption && note.config.encryption.title) ||\n        getHeaderFromMarkdown(note.markdown)\n    );\n    generateSummaryFromMarkdown(\n      note.config.encryption\n        ? \"🔐 encrypted\"\n        : note.markdown.trim() || t(\"general/this-note-is-empty\")\n    )\n      .then(summary => {\n        setSummary(summary);\n\n        // render images\n        const images = summary.images\n          .filter(image => image.startsWith(\"https://\"))\n          .slice(0, 3); // TODO: Support local image\n        setImages(images);\n      })\n      .catch(error => {});\n  }, [note.markdown, note.config.encryption, t]);\n\n  useEffect(() => {\n    crossnoteContainer.crossnote.getStatus(note).then(status => {\n      setGitStatus(status);\n    });\n  }, [\n    note.markdown,\n    note.config.modifiedAt,\n    note,\n    crossnoteContainer.crossnote\n  ]);\n\n  return (\n    <ButtonBase\n      className={clsx(\n        classes.noteCard,\n        crossnoteContainer.selectedNote &&\n          crossnoteContainer.selectedNote.filePath === note.filePath\n          ? classes.selected\n          : classes.unselected\n      )}\n      onClick={() => {\n        crossnoteContainer.setSelectedNote(note);\n        crossnoteContainer.setDisplayMobileEditor(true);\n      }}\n    >\n      <Box className={clsx(classes.leftPanel)}>\n        <Tooltip\n          title={\n            <>\n              <p>\n                {t(\"general/created-at\") +\n                  \" \" +\n                  formatRelative(\n                    new Date(note.config.createdAt),\n                    new Date() /*{\n                    locale: languageCodeToDateFNSLocale(\n                      crossnoteContainer.viewer.language\n                    )\n                  }*/\n                  )}\n              </p>\n              <p>\n                {t(\"general/modified-at\") +\n                  \" \" +\n                  formatRelative(\n                    new Date(note.config.modifiedAt),\n                    new Date() /*{\n                      locale: languageCodeToDateFNSLocale(\n                        crossnoteContainer.viewer.language\n                      )\n                    }*/\n                  )}\n              </p>\n            </>\n          }\n          arrow\n        >\n          <Typography className={clsx(classes.duration)}>{duration}</Typography>\n        </Tooltip>\n\n        {note.config.pinned && <Pin className={clsx(classes.pin)}></Pin>}\n      </Box>\n      <Box className={clsx(classes.rightPanel)}>\n        {header && (\n          <Typography\n            style={{ fontWeight: \"bold\" }}\n            variant={\"body1\"}\n            className={clsx(classes.header)}\n          >\n            {header}\n          </Typography>\n        )}\n        {summary && summary.summary.trim().length > 0 && (\n          <Typography className={clsx(classes.summary)}>\n            {summary && summary.summary}\n          </Typography>\n        )}\n        {images.length > 0 && (\n          <Box className={clsx(classes.images)}>\n            <Box className={clsx(classes.imagesWrapper)}>\n              {images.map(image => (\n                <div\n                  key={image}\n                  className={clsx(classes.image)}\n                  style={{\n                    backgroundImage: `url(${image})`\n                  }}\n                ></div>\n              ))}\n            </Box>\n          </Box>\n        )}\n        <Typography variant={\"caption\"} className={clsx(classes.filePath)}>\n          {note.filePath + \" - \" + gitStatus}\n        </Typography>\n      </Box>\n    </ButtonBase>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { CrossnoteContainer } from \"../containers/crossnote\";\nimport { Box } from \"@material-ui/core\";\nimport NoteCard from \"./NoteCard\";\nimport { useTranslation } from \"react-i18next\";\nimport { Note } from \"../lib/crossnote\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    notesList: {\n      position: \"relative\",\n      flex: \"1\",\n      overflowY: \"auto\",\n      paddingBottom: theme.spacing(12)\n    }\n  })\n);\n\ninterface Props {\n  searchValue: string;\n}\n\nexport default function Notes(props: Props) {\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n  const [notes, setNotes] = useState<Note[]>([]);\n  const [notesListElement, setNotesListElement] = useState<HTMLElement>(null);\n  const searchValue = props.searchValue;\n\n  useEffect(() => {\n    const pinned: Note[] = [];\n    const unpinned: Note[] = [];\n    crossnoteContainer.notes.forEach(note => {\n      if (searchValue.trim().length) {\n        const regexp = new RegExp(\n          \"(\" +\n            searchValue\n              .trim()\n              .split(/\\s+/g)\n              // .map(s => \"\\\\\" + s.split(\"\").join(\"\\\\\"))\n              .join(\"|\") +\n            \")\",\n          \"i\"\n        );\n\n        if (note.markdown.match(regexp) || note.filePath.match(regexp)) {\n          if (note.config.pinned) {\n            pinned.push(note);\n          } else {\n            unpinned.push(note);\n          }\n        }\n      } else {\n        if (note.config.pinned) {\n          pinned.push(note);\n        } else {\n          unpinned.push(note);\n        }\n      }\n    });\n\n    setNotes([...pinned, ...unpinned]);\n  }, [crossnoteContainer.notes, searchValue]);\n\n  useEffect(() => {\n    if (notesListElement) {\n      const keyDownHandler = (event: KeyboardEvent) => {\n        const selectedNote = crossnoteContainer.selectedNote;\n        const notes = crossnoteContainer.notes || [];\n        if (!selectedNote) return;\n        if (event.which === 40) {\n          // Up\n          const currentIndex = notes.findIndex(\n            n => n.filePath === selectedNote.filePath\n          );\n          if (currentIndex >= 0 && currentIndex < notes.length - 1) {\n            crossnoteContainer.setSelectedNote(notes[currentIndex + 1]);\n          }\n        } else if (event.which === 38) {\n          // Down\n          const currentIndex = notes.findIndex(\n            n => n.filePath === selectedNote.filePath\n          );\n          if (currentIndex > 0 && currentIndex < notes.length) {\n            crossnoteContainer.setSelectedNote(notes[currentIndex - 1]);\n          }\n        }\n      };\n      notesListElement.addEventListener(\"keydown\", keyDownHandler);\n      return () => {\n        notesListElement.removeEventListener(\"keydown\", keyDownHandler);\n      };\n    }\n  }, [notesListElement, crossnoteContainer.notes]);\n\n  return (\n    <div\n      className={clsx(classes.notesList)}\n      ref={(element: HTMLElement) => {\n        setNotesListElement(element);\n      }}\n    >\n      {(notes || []).map(note => {\n        return (\n          <NoteCard key={\"note-card-\" + note.filePath} note={note}></NoteCard>\n        );\n      })}\n    </div>\n  );\n}\n","import React, { useState } from \"react\";\nimport {\n  fade,\n  createStyles,\n  makeStyles,\n  Theme\n} from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport {\n  CrossnoteContainer,\n  SelectedSectionType,\n  OrderBy,\n  OrderDirection\n} from \"../containers/crossnote\";\nimport {\n  Box,\n  InputBase,\n  Card,\n  IconButton,\n  Typography,\n  Hidden,\n  CircularProgress,\n  Popover,\n  List,\n  ListItem,\n  ListItemText,\n  ListItemIcon,\n  Divider\n} from \"@material-ui/core\";\nimport {\n  Magnify,\n  FileEditOutline,\n  Settings,\n  Menu as MenuIcon,\n  SortVariant,\n  SortDescending,\n  SortAscending\n} from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\nimport ConfigureNotebookDialog from \"./ConfigureNotebookDialog\";\nimport Notes from \"./Notes\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    notesPanel: {\n      position: \"relative\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      height: \"100%\"\n    },\n    topPanel: {\n      padding: theme.spacing(1)\n    },\n    row: {\n      display: \"flex\",\n      alignItems: \"center\"\n    },\n    sectionName: {\n      marginLeft: theme.spacing(1)\n    },\n    search: {\n      position: \"relative\",\n      borderRadius: theme.shape.borderRadius,\n      backgroundColor: fade(theme.palette.common.white, 0.15),\n      \"&:hover\": {\n        backgroundColor: fade(theme.palette.common.white, 0.25)\n      },\n      marginRight: 0, // theme.spacing(2),\n      marginLeft: 0,\n      width: \"100%\",\n      [theme.breakpoints.up(\"sm\")]: {\n        // marginLeft: theme.spacing(3),\n        // width: \"auto\"\n      }\n    },\n    searchIcon: {\n      width: theme.spacing(7),\n      color: \"rgba(0, 0, 0, 0.54)\",\n      height: \"100%\",\n      position: \"absolute\",\n      pointerEvents: \"none\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\"\n    },\n    inputRoot: {\n      color: \"inherit\",\n      border: \"1px solid #bbb\",\n      borderRadius: \"4px\"\n    },\n    inputInput: {\n      padding: theme.spacing(1, 1, 1, 7),\n      transition: theme.transitions.create(\"width\"),\n      width: \"100%\",\n      [theme.breakpoints.up(\"md\")]: {\n        // width: 200\n      }\n    },\n    notesList: {\n      position: \"relative\",\n      flex: \"1\",\n      overflowY: \"auto\",\n      paddingBottom: theme.spacing(12)\n    },\n    loading: {\n      position: \"absolute\",\n      top: \"30%\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\"\n    },\n    sortSelected: {\n      color: theme.palette.primary.main,\n      \"& svg\": {\n        color: theme.palette.primary.main\n      }\n    }\n  })\n);\n\ninterface Props {\n  toggleDrawer: () => void;\n}\n\nexport default function NotesPanel(props: Props) {\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [sortMenuAnchorEl, setSortMenuAnchorEl] = useState<HTMLElement>(null);\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n\n  // Search\n  const [searchValue, setSearchValue] = useState<string>(\"\");\n\n  const [\n    notebookConfigurationDialogOpen,\n    setNotebookConfigurationDialogOpen\n  ] = useState<boolean>(false);\n\n  return (\n    <Box className={clsx(classes.notesPanel)}>\n      <Card className={clsx(classes.topPanel)}>\n        <Box className={clsx(classes.row)}>\n          <Hidden smUp implementation=\"css\">\n            <IconButton onClick={props.toggleDrawer}>\n              <MenuIcon></MenuIcon>\n            </IconButton>\n          </Hidden>\n          <div className={classes.search}>\n            <div className={classes.searchIcon}>\n              <Magnify />\n            </div>\n            <InputBase\n              placeholder={t(\"search/placeholder\")}\n              classes={{\n                root: classes.inputRoot,\n                input: classes.inputInput\n              }}\n              value={searchValue}\n              inputProps={{ \"aria-label\": \"search\" }}\n              onChange={event => setSearchValue(event.target.value)}\n            />\n          </div>\n          <IconButton\n            onClick={() => {\n              crossnoteContainer.createNewNote();\n            }}\n          >\n            <FileEditOutline></FileEditOutline>\n          </IconButton>\n        </Box>\n        <Box\n          className={clsx(classes.row)}\n          style={{ justifyContent: \"space-between\" }}\n        >\n          {crossnoteContainer.selectedSection.type ===\n          SelectedSectionType.Notes ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"notes\">\n                📒\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {crossnoteContainer.selectedNotebook &&\n                  crossnoteContainer.selectedNotebook.name}\n              </Typography>\n            </Box>\n          ) : crossnoteContainer.selectedSection.type ===\n            SelectedSectionType.Today ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"today-notes\">\n                🗓\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {\" today\"}\n              </Typography>\n            </Box>\n          ) : crossnoteContainer.selectedSection.type ===\n            SelectedSectionType.Todo ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"todo-notes\">\n                ☑️\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {\" todo\"}\n              </Typography>\n            </Box>\n          ) : crossnoteContainer.selectedSection.type ===\n            SelectedSectionType.Tagged ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"tagged-notes\">\n                🏷️\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {\" tagged\"}\n              </Typography>\n            </Box>\n          ) : crossnoteContainer.selectedSection.type ===\n            SelectedSectionType.Untagged ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"untagged-notes\">\n                🈚\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {\" untagged\"}\n              </Typography>\n            </Box>\n          ) : crossnoteContainer.selectedSection.type ===\n            SelectedSectionType.Tag ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"tag\">\n                🏷️\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {crossnoteContainer.selectedSection.path}\n              </Typography>\n            </Box>\n          ) : crossnoteContainer.selectedSection.type ===\n            SelectedSectionType.Encrypted ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"encrypted-notes\">\n                🔐\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {\" encrypted\"}\n              </Typography>\n            </Box>\n          ) : crossnoteContainer.selectedSection.type ===\n            SelectedSectionType.Conflicted ? (\n            <Box className={clsx(classes.row)}>\n              <span role=\"img\" aria-label=\"conflicted-notes\">\n                ⚠️\n              </span>\n              <Typography className={clsx(classes.sectionName)}>\n                {\" conflicted\"}\n              </Typography>\n            </Box>\n          ) : (\n            crossnoteContainer.selectedSection.type ===\n              SelectedSectionType.Directory && (\n              <Box className={clsx(classes.row)}>\n                <span role=\"img\" aria-label=\"folder\">\n                  {\"📁\"}\n                </span>\n                <Typography className={clsx(classes.sectionName)}>\n                  {crossnoteContainer.selectedSection.path}\n                </Typography>\n              </Box>\n            )\n          )}\n\n          <Box>\n            {crossnoteContainer.selectedSection.type ===\n              SelectedSectionType.Notes && (\n              <IconButton\n                onClick={() => setNotebookConfigurationDialogOpen(true)}\n              >\n                <Settings></Settings>\n              </IconButton>\n            )}\n            <IconButton\n              onClick={event => setSortMenuAnchorEl(event.currentTarget)}\n            >\n              <SortVariant></SortVariant>\n            </IconButton>\n            <Popover\n              anchorEl={sortMenuAnchorEl}\n              keepMounted\n              open={Boolean(sortMenuAnchorEl)}\n              onClose={() => setSortMenuAnchorEl(null)}\n            >\n              <List>\n                <ListItem\n                  button\n                  onClick={() =>\n                    crossnoteContainer.setOrderBy(OrderBy.ModifiedAt)\n                  }\n                  className={clsx(\n                    crossnoteContainer.orderBy === OrderBy.ModifiedAt &&\n                      classes.sortSelected\n                  )}\n                >\n                  <ListItemText primary={\"Date modified\"}></ListItemText>\n                </ListItem>\n                <ListItem\n                  button\n                  onClick={() =>\n                    crossnoteContainer.setOrderBy(OrderBy.CreatedAt)\n                  }\n                  className={clsx(\n                    crossnoteContainer.orderBy === OrderBy.CreatedAt &&\n                      classes.sortSelected\n                  )}\n                >\n                  <ListItemText primary={\"Date created\"}></ListItemText>\n                </ListItem>\n                <ListItem\n                  button\n                  onClick={() => crossnoteContainer.setOrderBy(OrderBy.Title)}\n                  className={clsx(\n                    crossnoteContainer.orderBy === OrderBy.Title &&\n                      classes.sortSelected\n                  )}\n                >\n                  <ListItemText primary={\"Title\"}></ListItemText>\n                </ListItem>\n                <Divider></Divider>\n                <ListItem\n                  button\n                  onClick={() =>\n                    crossnoteContainer.setOrderDirection(OrderDirection.DESC)\n                  }\n                  className={clsx(\n                    crossnoteContainer.orderDirection === OrderDirection.DESC &&\n                      classes.sortSelected\n                  )}\n                >\n                  <ListItemText primary={\"Desc\"}></ListItemText>\n                  <ListItemIcon>\n                    <SortDescending></SortDescending>\n                  </ListItemIcon>\n                </ListItem>\n                <ListItem\n                  button\n                  onClick={() =>\n                    crossnoteContainer.setOrderDirection(OrderDirection.ASC)\n                  }\n                  className={clsx(\n                    crossnoteContainer.orderDirection === OrderDirection.ASC &&\n                      classes.sortSelected\n                  )}\n                >\n                  <ListItemText primary={\"Asc\"}></ListItemText>\n                  <ListItemIcon>\n                    <SortAscending></SortAscending>\n                  </ListItemIcon>\n                </ListItem>\n              </List>\n            </Popover>\n          </Box>\n        </Box>\n      </Card>\n\n      <ConfigureNotebookDialog\n        open={notebookConfigurationDialogOpen}\n        onClose={() => setNotebookConfigurationDialogOpen(false)}\n        notebook={crossnoteContainer.selectedNotebook}\n      ></ConfigureNotebookDialog>\n\n      {crossnoteContainer.isLoadingNotebook && (\n        <CircularProgress className={clsx(classes.loading)}></CircularProgress>\n      )}\n\n      <Notes searchValue={searchValue}></Notes>\n    </Box>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport {\n  fade,\n  createStyles,\n  makeStyles,\n  Theme\n} from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport {\n  CrossnoteContainer,\n  SelectedSectionType,\n  OrderBy,\n  OrderDirection\n} from \"../containers/crossnote\";\nimport {\n  Box,\n  InputBase,\n  Card,\n  IconButton,\n  Typography,\n  Hidden,\n  CircularProgress,\n  Popover,\n  List,\n  ListItem,\n  ListItemText,\n  ListItemIcon,\n  Divider\n} from \"@material-ui/core\";\nimport {\n  Magnify,\n  FileEditOutline,\n  Settings,\n  Menu as MenuIcon,\n  SortVariant,\n  SortDescending,\n  SortAscending\n} from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\n\nconst previewZIndex = 99;\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    wikiPanel: {\n      position: \"relative\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      height: \"100%\"\n    },\n    topPanel: {\n      padding: theme.spacing(1)\n    },\n    row: {\n      display: \"flex\",\n      alignItems: \"center\"\n    },\n    sectionName: {\n      marginLeft: theme.spacing(1)\n    },\n    toc: {\n      position: \"relative\",\n      flex: \"1\",\n      overflowY: \"auto\",\n      paddingBottom: theme.spacing(12)\n    },\n    preview: {\n      position: \"relative\",\n      left: \"0\",\n      top: \"0\",\n      margin: \"4px\",\n      width: \"calc(100% - 8px)\",\n      height: \"100%\",\n      border: \"none\",\n      overflow: \"auto !important\",\n      padding: theme.spacing(2),\n      zIndex: previewZIndex,\n      [theme.breakpoints.down(\"sm\")]: {\n        padding: theme.spacing(1)\n      }\n      // gridArea: \"2 / 2 / 3 / 3\"\n    }\n  })\n);\n\ninterface Props {\n  toggleDrawer: () => void;\n}\n\nexport default function WikiPanel(props: Props) {\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n\n  useEffect(() => {\n    return () => {\n      crossnoteContainer.setWikiTOCElement(null);\n    };\n  }, []);\n\n  return (\n    <Box className={clsx(classes.wikiPanel)}>\n      <Card className={clsx(classes.topPanel)}>\n        <Box className={clsx(classes.row)}>\n          <Hidden smUp implementation=\"css\">\n            <IconButton onClick={props.toggleDrawer}>\n              <MenuIcon></MenuIcon>\n            </IconButton>\n          </Hidden>\n          <Box className={clsx(classes.row)}>\n            <span role=\"img\" aria-label=\"wiki\">\n              📖\n            </span>\n            <Typography className={clsx(classes.sectionName)}>\n              {\"wiki\"}\n            </Typography>\n          </Box>\n          {/*<IconButton\n            onClick={() => {\n              crossnoteContainer.createNewNote();\n            }}\n          >\n            <FileEditOutline></FileEditOutline>\n          </IconButton>*/}\n        </Box>\n      </Card>\n      <div\n        className={clsx(classes.toc, classes.preview, \"preview\")}\n        ref={(element: HTMLElement) => {\n          crossnoteContainer.setWikiTOCElement(element);\n        }}\n      ></div>\n    </Box>\n  );\n}\n","import {\n  Box,\n  CssBaseline,\n  Drawer,\n  Hidden,\n  List,\n  ListItem,\n  IconButton,\n  Paper,\n  Typography\n} from \"@material-ui/core\";\nimport {\n  fade,\n  createStyles,\n  makeStyles,\n  Theme\n} from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport React, { useState, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { PlusCircle } from \"mdi-material-ui\";\nimport {\n  CrossnoteContainer,\n  SelectedSectionType\n} from \"../containers/crossnote\";\nimport Editor from \"../components/Editor\";\nimport AddNotebookDialog from \"../components/AddNotebookDialog\";\nimport NotebookTreeView from \"../components/NotebookTreeView\";\nimport NotesPanel from \"../components/NotesPanel\";\nimport WikiPanel from \"../components/WikiPanel\";\n\nconst drawerWidth = 200;\nconst notesPanelWidth = 350;\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    page: {\n      display: \"flex\",\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: \"#2196F1\"\n    },\n    appBar: {\n      zIndex: theme.zIndex.drawer + 1,\n      boxShadow: \"none\"\n    },\n    toolBar: {\n      display: \"flex\",\n      flexDirection: \"row\",\n      justifyContent: \"space-between\"\n    },\n    search: {\n      position: \"relative\",\n      borderRadius: theme.shape.borderRadius,\n      backgroundColor: fade(theme.palette.common.white, 0.15),\n      \"&:hover\": {\n        backgroundColor: fade(theme.palette.common.white, 0.25)\n      },\n      marginRight: theme.spacing(2),\n      marginLeft: 0,\n      width: \"100%\",\n      [theme.breakpoints.up(\"sm\")]: {\n        marginLeft: theme.spacing(3),\n        width: \"auto\"\n      }\n    },\n    searchIcon: {\n      width: theme.spacing(7),\n      height: \"100%\",\n      position: \"absolute\",\n      pointerEvents: \"none\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\"\n    },\n    inputRoot: {\n      color: \"inherit\"\n    },\n    inputInput: {\n      padding: theme.spacing(1, 1, 1, 7),\n      transition: theme.transitions.create(\"width\"),\n      width: \"100%\",\n      [theme.breakpoints.up(\"md\")]: {\n        width: 200\n      }\n    },\n    displayNone: {\n      display: \"none\"\n    },\n    drawer: {\n      [theme.breakpoints.up(\"sm\")]: {\n        width: drawerWidth,\n        flexShrink: 0\n      }\n    },\n    drawerPaper: {\n      width: drawerWidth\n      // backgroundColor: \"#2196f1\",\n      // color: \"#fff\"\n    },\n    selectedSection: {\n      backgroundColor: \"#ccc\"\n    },\n    left: {\n      display: \"flex\",\n      flexDirection: \"row\",\n      alignItems: \"center\"\n    },\n    menuButton: {\n      marginRight: theme.spacing(2)\n      /*\n      [theme.breakpoints.up(\"sm\")]: {\n        display: \"none\"\n      }\n      */\n    },\n    mainPanel: {\n      position: \"relative\",\n      display: \"flex\",\n      flexDirection: \"row\",\n      flexGrow: 1,\n      overflow: \"auto\",\n      backgroundColor: \"#eee\"\n    },\n    notesPanel: {\n      width: `${notesPanelWidth}px`,\n      maxWidth: \"100%\",\n      height: \"100%\",\n      [theme.breakpoints.down(\"xs\")]: {\n        width: \"100%\"\n      }\n    },\n    editorPanel: {\n      // flex: \"1\" // Flex has overflow issue\n      width: `calc(100% - ${notesPanelWidth}px)`,\n      position: \"absolute\",\n      left: `calc(${notesPanelWidth}px)`,\n      height: \"100%\",\n      [theme.breakpoints.down(\"md\")]: {\n        width: `calc(100% - ${notesPanelWidth}px)`,\n        left: `${notesPanelWidth}px`\n      },\n      [theme.breakpoints.down(\"xs\")]: {\n        display: \"none\",\n        top: \"0\",\n        left: \"0\",\n        width: \"100%\",\n        height: \"100%\"\n      }\n    },\n    toolBarSpace: theme.mixins.toolbar\n  })\n);\n\ninterface Props {}\n\nexport function Home(props: Props) {\n  const classes = useStyles(props);\n  const crossnoteContainer = CrossnoteContainer.useContainer();\n\n  const [addNotebookDialogOpen, setAddNotebookDialogOpen] = useState<boolean>(\n    false\n  );\n  const [drawerOpen, setDrawerOpen] = useState<boolean>(false);\n\n  const toggleDrawer = useCallback(() => {\n    setDrawerOpen(!drawerOpen);\n  }, [drawerOpen]);\n\n  const drawer = (\n    <div>\n      <List disablePadding={true}>\n        <ListItem disableGutters={true}>\n          <Box\n            style={{\n              width: \"100%\",\n              display: \"flex\",\n              flexDirection: \"row\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              padding: \"0 8px\"\n            }}\n          >\n            <Typography variant={\"body1\"} style={{ fontWeight: \"bold\" }}>\n              {\"Notebooks\"}\n            </Typography>\n            <IconButton onClick={() => setAddNotebookDialogOpen(true)}>\n              <PlusCircle></PlusCircle>\n            </IconButton>\n          </Box>\n        </ListItem>\n        {crossnoteContainer.notebooks.map(notebook => {\n          return (\n            <ListItem\n              disableGutters={true}\n              style={{ padding: \"0\" }}\n              key={notebook._id}\n            >\n              <NotebookTreeView notebook={notebook}></NotebookTreeView>\n            </ListItem>\n          );\n        })}\n      </List>\n    </div>\n  );\n\n  const notesPanel =\n    crossnoteContainer.selectedSection.type !== SelectedSectionType.Wiki ? (\n      <Paper className={clsx(classes.notesPanel)} id={\"notes-panel\"}>\n        <NotesPanel toggleDrawer={toggleDrawer}></NotesPanel>\n      </Paper>\n    ) : (\n      <Paper className={clsx(classes.notesPanel)} id={\"notes-panel\"}>\n        <WikiPanel toggleDrawer={toggleDrawer}></WikiPanel>\n      </Paper>\n    );\n\n  return (\n    <Box className={clsx(classes.page)}>\n      <CssBaseline></CssBaseline>\n      <nav className={clsx(classes.drawer, \"drawer\")}>\n        {/* The implementation can be swapped with js to avoid SEO duplication of links. */}\n        <Hidden smUp implementation=\"css\">\n          <Drawer\n            variant=\"temporary\"\n            open={drawerOpen}\n            onClose={toggleDrawer}\n            classes={{\n              paper: classes.drawerPaper\n            }}\n            ModalProps={{\n              keepMounted: true // Better open performance on mobile.\n            }}\n          >\n            {drawer}\n          </Drawer>\n        </Hidden>\n        <Hidden xsDown implementation=\"css\">\n          <Drawer\n            classes={{\n              paper: classes.drawerPaper\n            }}\n            variant=\"permanent\"\n            open\n          >\n            {drawer}\n          </Drawer>\n        </Hidden>\n      </nav>\n      <Box className={clsx(classes.mainPanel)} id=\"main-panel\">\n        {notesPanel}\n        <Paper\n          className={clsx(classes.editorPanel, \"editor-panel\")}\n          style={{\n            display: crossnoteContainer.displayMobileEditor && \"block\"\n          }}\n        >\n          <Editor note={crossnoteContainer.selectedNote}></Editor>\n        </Paper>\n      </Box>\n      <AddNotebookDialog\n        open={addNotebookDialogOpen}\n        onClose={() => setAddNotebookDialogOpen(false)}\n        canCancel={true}\n      ></AddNotebookDialog>\n    </Box>\n  );\n}\n","/**\n * Upload image to sm.ms\n * @param filePath\n */\nexport async function smmsUploadImages(files: File[] = []): Promise<string[]> {\n  const promises = [];\n  for (let i = 0; i < files.length; i++) {\n    const file = files[i];\n    if (!file.type.match(\"image.*\")) {\n      continue;\n    }\n    promises.push(\n      new Promise<string>((resolve, reject) => {\n        const headers = {\n          // \"Content-Type\": \"multipart/form-data\" // <= Adding this will cause problem.\n        };\n        const data = new FormData();\n        data.append(\"smfile\", file);\n        data.append(\"format\", \"json\");\n        fetch(\"https://sm.ms/api/v2/upload\", {\n          method: \"POST\",\n          mode: \"cors\",\n          headers,\n          referrer: \"\",\n          body: data\n        })\n          .then(response => response.json())\n          .then(json => {\n            if (json[\"success\"]) {\n              return resolve(json[\"data\"][\"url\"]);\n            } else if (\n              json[\"code\"] === \"image_repeated\" ||\n              (json[\"code\"] === \"exception\" &&\n                json[\"message\"].match(/this image exists at:/))\n            ) {\n              return resolve(json[\"message\"].match(/https:\\/\\/.+$/)[0]);\n            } else {\n              return reject(json[\"message\"]);\n            }\n          })\n          .catch(error => {\n            return reject(\"Failed to connect to sm.ms host\");\n          });\n      })\n    );\n  }\n  return await Promise.all(promises);\n}\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  Input,\n  Tooltip,\n  Switch,\n  FormControlLabel\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { TrashCan } from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\nimport { smmsUploadImages } from \"../../utilities/image_uploader\";\nimport Noty from \"noty\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    actionButtons: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    },\n    section: {\n      marginTop: theme.spacing(2)\n    },\n    dropArea: {\n      textAlign: \"center\",\n      padding: \"24px\",\n      border: \"4px dotted #c7c7c7\",\n      backgroundColor: \"#f1f1f1\",\n      cursor: \"pointer\",\n      \"&:hover\": {\n        backgroundColor: \"#eee\"\n      }\n    },\n    disabled: {\n      cursor: \"not-allowed\"\n    }\n  })\n);\n\nfunction ImageWidget(props: WidgetArgs) {\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [url, setURL] = useState<string>(\"\");\n  const [imageUploaderElement, setImageUploaderElement] = useState<\n    HTMLInputElement\n  >(null);\n  const [uploadingImages, setUploadingImages] = useState<boolean>(false);\n\n  function clickDropArea(e: any) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!imageUploaderElement || uploadingImages) return;\n    imageUploaderElement.onchange = function(event) {\n      const target = event.target as any;\n      const files = target.files || [];\n      new Noty({\n        type: \"info\",\n        text: t(\"utils/uploading-image\"),\n        layout: \"topRight\",\n        theme: \"relax\",\n        timeout: 2000\n      }).show();\n      setUploadingImages(true);\n      smmsUploadImages(files)\n        .then(urls => {\n          let markdown = ``;\n          urls.forEach(url => {\n            markdown = markdown + `![](${url})  \\n`;\n          });\n          props.replaceSelf(markdown);\n        })\n        .catch((error: any) => {\n          // console.log(error);\n          setUploadingImages(false);\n          new Noty({\n            type: \"error\",\n            text: t(\"utils/upload-image-failure\"),\n            layout: \"topRight\",\n            theme: \"relax\",\n            timeout: 2000\n          }).show();\n        });\n    };\n    imageUploaderElement.click();\n  }\n\n  if (props.isPreview) {\n    return <span></span>;\n  }\n\n  return (\n    <Card elevation={2} className={clsx(classes.card)}>\n      <Typography variant={\"h5\"}>\n        {t(\"widget/crossnote.image/image-helper\")}\n      </Typography>\n      <Box className={clsx(classes.actionButtons)}>\n        <Tooltip title={t(\"general/Delete\")}>\n          <IconButton onClick={() => props.removeSelf()}>\n            <TrashCan></TrashCan>\n          </IconButton>\n        </Tooltip>\n      </Box>\n      {!uploadingImages && (\n        <Box className={clsx(classes.section)}>\n          <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n            {\"URL\"}\n          </Typography>\n          <Input\n            margin={\"dense\"}\n            placeholder={t(\"widget/crossnote.image/image-url-placeholder\")}\n            value={url}\n            onChange={event => {\n              setURL(event.target.value);\n            }}\n            onKeyDown={event => {\n              if (event.which === 13) {\n                props.replaceSelf(`![](${url})\\n`);\n              }\n            }}\n            fullWidth={true}\n          ></Input>\n        </Box>\n      )}\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"general/Upload\")}\n        </Typography>\n        <Box\n          className={clsx(\n            classes.dropArea,\n            uploadingImages ? classes.disabled : null\n          )}\n          onClick={clickDropArea}\n        >\n          <Typography>\n            {uploadingImages\n              ? t(\"utils/uploading-image\")\n              : t(\"widget/crossnote.image/click-here-to-browse-image-file\")}\n          </Typography>\n        </Box>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"caption\"}>\n          {t(\"widget/crossnote.image/thanks_sm_ms\")}\n        </Typography>\n      </Box>\n      <input\n        type=\"file\"\n        multiple\n        style={{ display: \"none\" }}\n        ref={(element: HTMLInputElement) => {\n          setImageUploaderElement(element);\n        }}\n      ></input>\n    </Card>\n  );\n}\n\nexport const ImageWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<ImageWidget {...args}></ImageWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  Input,\n  Tooltip,\n  Switch,\n  FormControlLabel\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { TrashCan } from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    actionButtons: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    },\n    section: {\n      marginTop: theme.spacing(2)\n    },\n    dropArea: {\n      textAlign: \"center\",\n      padding: \"24px\",\n      border: \"4px dotted #c7c7c7\",\n      backgroundColor: \"#f1f1f1\",\n      cursor: \"pointer\",\n      \"&:hover\": {\n        backgroundColor: \"#eee\"\n      }\n    },\n    disabled: {\n      cursor: \"not-allowed\"\n    }\n  })\n);\n\nfunction AudioWidget(props: WidgetArgs) {\n  const attributes = props.attributes;\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [source, setSource] = useState<string>(attributes[\"source\"] || \"\");\n  const [autoplay, setAutoplay] = useState<boolean>(\n    attributes[\"autoplay\"] || false\n  );\n  const [controls, setControls] = useState<boolean>(\n    attributes[\"controls\"] || true\n  );\n  const [loop, setLoop] = useState<boolean>(attributes[\"loop\"] || false);\n  const [muted, setMuted] = useState<boolean>(attributes[\"muted\"] || false);\n\n  if (attributes[\"src\"]) {\n    return (\n      <span style={{ cursor: \"default\" }}>\n        <audio\n          autoPlay={attributes[\"autoplay\"] || attributes[\"autoPlay\"]}\n          controls={attributes[\"controls\"]}\n          loop={attributes[\"loop\"]}\n          muted={attributes[\"muted\"]}\n          style={attributes[\"style\"]}\n        >\n          {t(\"widget/crossnote.audio/audio_element_fail\")}\n          <source src={attributes[\"src\"]} type={attributes[\"type\"]}></source>\n        </audio>\n        {!props.isPreview && !attributes[\"controls\"] && \"🎵\"}\n      </span>\n    );\n  }\n\n  if (props.isPreview) {\n    return <span></span>;\n  }\n\n  return (\n    <Card elevation={2} className={clsx(classes.card)}>\n      <Typography variant={\"h5\"}>{t(\"general/Audio\")}</Typography>\n      <Box className={clsx(classes.actionButtons)}>\n        <Tooltip title={t(\"general/Delete\")}>\n          <IconButton onClick={() => props.removeSelf()}>\n            <TrashCan></TrashCan>\n          </IconButton>\n        </Tooltip>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"general/source-url\")}\n        </Typography>\n        <Input\n          margin={\"dense\"}\n          placeholder={t(\"widget/crossnote.audio/source-url-placeholder\")}\n          value={source}\n          onChange={event => {\n            setSource(event.target.value);\n          }}\n          onKeyDown={event => {\n            if (event.which === 13) {\n              if (source) {\n                const attrs = {\n                  autoplay,\n                  controls,\n                  loop,\n                  muted,\n                  src: source\n                };\n                props.replaceSelf(\n                  `\\`@crossnote.audio ${JSON.stringify(attrs)\n                    .replace(/^{/, \"\")\n                    .replace(/}$/, \"\")}\\``\n                );\n              }\n            }\n          }}\n          fullWidth={true}\n        ></Input>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <FormControlLabel\n          label={t(\"widget/autoplay\")}\n          control={\n            <Switch\n              checked={autoplay}\n              onChange={() => setAutoplay(!autoplay)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n        <FormControlLabel\n          label={t(\"widget/controls\")}\n          control={\n            <Switch\n              checked={controls}\n              onChange={() => setControls(!controls)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n        <FormControlLabel\n          label={t(\"widget/loop\")}\n          control={\n            <Switch\n              checked={loop}\n              onChange={() => setLoop(!loop)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n        <FormControlLabel\n          label={t(\"widget/muted\")}\n          control={\n            <Switch\n              checked={muted}\n              onChange={() => setMuted(!muted)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n      </Box>\n    </Card>\n  );\n}\n\nexport const AudioWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<AudioWidget {...args}></AudioWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  Input,\n  Tooltip,\n  Switch,\n  FormControlLabel\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { TrashCan } from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    actionButtons: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    },\n    section: {\n      marginTop: theme.spacing(2)\n    },\n    dropArea: {\n      textAlign: \"center\",\n      padding: \"24px\",\n      border: \"4px dotted #c7c7c7\",\n      backgroundColor: \"#f1f1f1\",\n      cursor: \"pointer\",\n      \"&:hover\": {\n        backgroundColor: \"#eee\"\n      }\n    },\n    disabled: {\n      cursor: \"not-allowed\"\n    }\n  })\n);\n\nfunction NeteaseMusicWidget(props: WidgetArgs) {\n  const attributes = props.attributes;\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [id, setID] = useState<string>(attributes[\"id\"] || \"\");\n  const [autoplay, setAutoplay] = useState<boolean>(\n    attributes[\"autoplay\"] || false\n  );\n\n  if (attributes[\"id\"]) {\n    return (\n      <iframe\n        title={\"netease_music_\" + attributes[\"id\"]}\n        style={{\n          maxWidth: \"100%\",\n          width: \"333px\",\n          height: \"86px\",\n          border: \"none\"\n        }}\n        src={`https://music.163.com/outchain/player?type=2&id=${\n          attributes[\"id\"]\n        }&auto=${attributes[\"autoplay\"] ? \"1\" : \"0\"}&height=66`}\n      ></iframe>\n    );\n  }\n\n  if (props.isPreview) {\n    return <span></span>;\n  }\n\n  return (\n    <Card elevation={2} className={clsx(classes.card)}>\n      <Typography variant={\"h5\"}>{t(\"general/Audio\")}</Typography>\n      <Box className={clsx(classes.actionButtons)}>\n        <Tooltip title={t(\"general/Delete\")}>\n          <IconButton onClick={() => props.removeSelf()}>\n            <TrashCan></TrashCan>\n          </IconButton>\n        </Tooltip>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"general/ID\")}\n        </Typography>\n        <Input\n          margin={\"dense\"}\n          placeholder={t(\"widget/crossnote.neteasemusic/song-id-placeholder\")}\n          value={id}\n          onChange={event => {\n            setID(event.target.value);\n          }}\n          onKeyDown={event => {\n            if (event.which === 13) {\n              if (id) {\n                const attrs = {\n                  autoplay,\n                  id\n                };\n                props.replaceSelf(\n                  `\\`@crossnote.netease_music ${JSON.stringify(attrs)\n                    .replace(/^{/, \"\")\n                    .replace(/}$/, \"\")}\\``\n                );\n              }\n            }\n          }}\n          fullWidth={true}\n        ></Input>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <FormControlLabel\n          label={t(\"widget/autoplay\")}\n          control={\n            <Switch\n              checked={autoplay}\n              onChange={() => setAutoplay(!autoplay)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n      </Box>\n    </Card>\n  );\n}\n\nexport const NeteaseMusicWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<NeteaseMusicWidget {...args}></NeteaseMusicWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  Input,\n  Tooltip,\n  Switch,\n  FormControlLabel\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { TrashCan } from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    actionButtons: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    },\n    section: {\n      marginTop: theme.spacing(2)\n    },\n    videoWrapper: {\n      cursor: \"default\",\n      position: \"relative\",\n      width: \"100%\",\n      height: \"0\",\n      paddingTop: \"56.25%\"\n    },\n    video: {\n      position: \"absolute\",\n      left: \"0\",\n      top: \"0\",\n      width: \"100%\",\n      height: \"100%\"\n    }\n  })\n);\n\nfunction VideoWidget(props: WidgetArgs) {\n  const attributes = props.attributes;\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [source, setSource] = useState<string>(attributes[\"source\"] || \"\");\n  const [autoplay, setAutoplay] = useState<boolean>(\n    attributes[\"autoplay\"] || false\n  );\n  const [controls, setControls] = useState<boolean>(\n    attributes[\"controls\"] || true\n  );\n  const [loop, setLoop] = useState<boolean>(attributes[\"loop\"] || false);\n  const [muted, setMuted] = useState<boolean>(attributes[\"muted\"] || false);\n  const [poster, setPoster] = useState<string>(attributes[\"poster\"] || \"\");\n\n  if (attributes[\"src\"]) {\n    return (\n      <span style={{ cursor: \"default\" }}>\n        <Box className={clsx(classes.videoWrapper)}>\n          <video\n            className={clsx(classes.video)}\n            autoPlay={attributes[\"autoplay\"] || attributes[\"autoPlay\"]}\n            controls={attributes[\"controls\"]}\n            loop={attributes[\"loop\"]}\n            muted={attributes[\"muted\"]}\n            style={attributes[\"style\"]}\n            poster={attributes[\"poster\"]}\n          >\n            {t(\"widget/crossnote.video/video_element_fail\")}\n            <source src={attributes[\"src\"]} type={attributes[\"type\"]}></source>\n          </video>\n        </Box>\n      </span>\n    );\n  }\n\n  if (props.isPreview) {\n    return <span></span>;\n  }\n\n  return (\n    <Card elevation={2} className={clsx(classes.card)}>\n      <Typography variant={\"h5\"}>{t(\"general/Video\")}</Typography>\n      <Box className={clsx(classes.actionButtons)}>\n        <Tooltip title={t(\"general/Delete\")}>\n          <IconButton onClick={() => props.removeSelf()}>\n            <TrashCan></TrashCan>\n          </IconButton>\n        </Tooltip>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"general/source-url\")}\n        </Typography>\n        <Input\n          margin={\"dense\"}\n          placeholder={t(\"widget/crossnote.video/video-url-placeholder\")}\n          value={source}\n          onChange={event => {\n            setSource(event.target.value);\n          }}\n          onKeyDown={event => {\n            if (event.which === 13) {\n              if (source) {\n                const attrs = {\n                  autoplay,\n                  controls,\n                  loop,\n                  muted,\n                  src: source,\n                  poster\n                };\n                props.replaceSelf(\n                  `\\`@crossnote.video ${JSON.stringify(attrs)\n                    .replace(/^{/, \"\")\n                    .replace(/}$/, \"\")}\\``\n                );\n              }\n            }\n          }}\n          fullWidth={true}\n        ></Input>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"widget/crossnote.video/poster-url\")}\n        </Typography>\n        <Input\n          margin={\"dense\"}\n          placeholder={t(\"widget/crossnote.video/poster-url-placeholder\")}\n          value={poster}\n          onChange={event => {\n            setPoster(event.target.value);\n          }}\n          fullWidth={true}\n        ></Input>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <FormControlLabel\n          label={t(\"widget/autoplay\")}\n          control={\n            <Switch\n              checked={autoplay}\n              onChange={() => setAutoplay(!autoplay)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n        <FormControlLabel\n          label={t(\"widget/controls\")}\n          control={\n            <Switch\n              checked={controls}\n              onChange={() => setControls(!controls)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n        <FormControlLabel\n          label={t(\"widget/loop\")}\n          control={\n            <Switch\n              checked={loop}\n              onChange={() => setLoop(!loop)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n        <FormControlLabel\n          label={t(\"widget/muted\")}\n          control={\n            <Switch\n              checked={muted}\n              onChange={() => setMuted(!muted)}\n              color={\"primary\"}\n            ></Switch>\n          }\n        ></FormControlLabel>\n      </Box>\n    </Card>\n  );\n}\n\nexport const VideoWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<VideoWidget {...args}></VideoWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  Input,\n  Tooltip\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { TrashCan } from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    actionButtons: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    },\n    section: {\n      marginTop: theme.spacing(2)\n    },\n    videoWrapper: {\n      cursor: \"default\",\n      position: \"relative\",\n      width: \"100%\",\n      height: \"0\",\n      paddingTop: \"56.25%\"\n    },\n    video: {\n      backgroundColor: \"#ddd\",\n      border: \"none\",\n      position: \"absolute\",\n      left: \"0\",\n      top: \"0\",\n      width: \"100%\",\n      height: \"100%\"\n    },\n    errorMessage: {\n      color: \"#f44336\",\n      marginTop: theme.spacing(2)\n    }\n  })\n);\n\nfunction BilibiliWidget(props: WidgetArgs) {\n  const attributes = props.attributes;\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [url, setURL] = useState<string>(\"\");\n  const [error, setError] = useState<string>(\"\");\n\n  if (attributes[\"aid\"]) {\n    return (\n      <span style={{ cursor: \"default\" }}>\n        <Box className={clsx(classes.videoWrapper)}>\n          <iframe\n            title={\"bilibili_\" + attributes[\"id\"]}\n            className={clsx(classes.video)}\n            src={`https://player.bilibili.com/player.html?aid=${attributes[\"aid\"]}`}\n            scrolling={\"no\"}\n            frameBorder={\"no\"}\n            allowFullScreen={true}\n          ></iframe>\n        </Box>\n      </span>\n    );\n  }\n\n  if (props.isPreview) {\n    return <span></span>;\n  }\n\n  return (\n    <Card elevation={2} className={clsx(classes.card)}>\n      <Typography variant={\"h5\"}>\n        {t(\"widget/crossnote.bilibili/Bilibili\")}\n      </Typography>\n      <Box className={clsx(classes.actionButtons)}>\n        <Tooltip title={t(\"general/Delete\")}>\n          <IconButton onClick={() => props.removeSelf()}>\n            <TrashCan></TrashCan>\n          </IconButton>\n        </Tooltip>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"widget/crossnote.bilibili/bilibili-video-url\")}\n        </Typography>\n        <Input\n          margin={\"dense\"}\n          placeholder={t(\"widget/crossnote.bilibili/url-placeholder\")}\n          value={url}\n          onChange={event => {\n            setURL(event.target.value);\n            setError(\"\");\n          }}\n          onKeyDown={event => {\n            if (event.which === 13) {\n              if (url && url.match(/bilibili\\.com\\/video\\/av(\\d+)/)) {\n                const aid = url.match(/bilibili\\.com\\/video\\/av(\\d+)/)[1];\n                const attrs = {\n                  aid\n                };\n                props.replaceSelf(\n                  `\\`@crossnote.bilibili ${JSON.stringify(attrs)\n                    .replace(/^{/, \"\")\n                    .replace(/}$/, \"\")}\\``\n                );\n              } else {\n                setError(t(\"widget/crossnote.bilibili/error_message\"));\n              }\n            }\n          }}\n          fullWidth={true}\n        ></Input>\n        <Typography className={clsx(classes.errorMessage)}>{error}</Typography>\n      </Box>\n    </Card>\n  );\n}\n\nexport const BilibiliWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<BilibiliWidget {...args}></BilibiliWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  Input,\n  Tooltip\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { TrashCan } from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    actionButtons: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    },\n    section: {\n      marginTop: theme.spacing(2)\n    },\n    videoWrapper: {\n      cursor: \"default\",\n      position: \"relative\",\n      width: \"100%\",\n      height: \"0\",\n      paddingTop: \"56.25%\"\n    },\n    video: {\n      backgroundColor: \"#ddd\",\n      border: \"none\",\n      position: \"absolute\",\n      left: \"0\",\n      top: \"0\",\n      width: \"100%\",\n      height: \"100%\"\n    },\n    errorMessage: {\n      color: \"#f44336\",\n      marginTop: theme.spacing(2)\n    }\n  })\n);\n\nfunction YoutubeWidget(props: WidgetArgs) {\n  const attributes = props.attributes;\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [url, setURL] = useState<string>(\"\");\n  const [error, setError] = useState<string>(\"\");\n\n  if (attributes[\"videoID\"]) {\n    return (\n      <span style={{ cursor: \"default\" }}>\n        <Box className={clsx(classes.videoWrapper)}>\n          <iframe\n            title={\"youtube_\" + attributes[\"videoID\"]}\n            className={clsx(classes.video)}\n            src={`https://www.youtube.com/embed/${attributes[\"videoID\"]}`}\n            scrolling={\"no\"}\n            frameBorder={\"no\"}\n            allowFullScreen={true}\n          ></iframe>\n        </Box>\n      </span>\n    );\n  }\n\n  if (props.isPreview) {\n    return <span></span>;\n  }\n\n  return (\n    <Card elevation={2} className={clsx(classes.card)}>\n      <Typography variant={\"h5\"}>{t(\"Youtube\")}</Typography>\n      <Box className={clsx(classes.actionButtons)}>\n        <Tooltip title={t(\"general/Delete\")}>\n          <IconButton onClick={() => props.removeSelf()}>\n            <TrashCan></TrashCan>\n          </IconButton>\n        </Tooltip>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"Youtube video URL\")}\n        </Typography>\n        <Input\n          margin={\"dense\"}\n          placeholder={t(\n            \"widget/crossnote.youtube/youtube-video-url-placeholder\"\n          )}\n          value={url}\n          onChange={event => {\n            setURL(event.target.value);\n            setError(\"\");\n          }}\n          onKeyDown={event => {\n            if (event.which === 13) {\n              if (url && url.match(/youtube\\.com\\/watch\\?v=(.+?)$/)) {\n                const videoID = url.match(/youtube\\.com\\/watch\\?v=(.+?)$/)[1];\n                const attrs = {\n                  videoID\n                };\n                props.replaceSelf(\n                  `\\`@crossnote.youtube ${JSON.stringify(attrs)\n                    .replace(/^{/, \"\")\n                    .replace(/}$/, \"\")}\\``\n                );\n              } else {\n                setError(t(\"widget/crossnote.youtube/error_message\"));\n              }\n            }\n          }}\n          fullWidth={true}\n        ></Input>\n        <Typography className={clsx(classes.errorMessage)}>{error}</Typography>\n      </Box>\n    </Card>\n  );\n}\n\nexport const YoutubeWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<YoutubeWidget {...args}></YoutubeWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState, useEffect } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  Input,\n  Tooltip,\n  Switch,\n  FormControlLabel,\n  ListItem,\n  ListItemText,\n  List,\n  ListItemSecondaryAction,\n  FormGroup,\n  Checkbox,\n  ButtonGroup,\n  Button\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport { TrashCan } from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\nimport { createWorker } from \"tesseract.js\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    actionButtons: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    },\n    section: {\n      marginTop: theme.spacing(2)\n    },\n    dropArea: {\n      textAlign: \"center\",\n      padding: \"24px\",\n      border: \"4px dotted #c7c7c7\",\n      backgroundColor: \"#f1f1f1\",\n      cursor: \"pointer\",\n      \"&:hover\": {\n        backgroundColor: \"#eee\"\n      }\n    },\n    canvasWrapper: {\n      marginTop: theme.spacing(2)\n      // height: 0,\n      // paddingTop: \"56.25%\" // 16:9\n    },\n    canvas: {\n      maxWidth: \"100%\"\n    },\n    disabled: {\n      cursor: \"not-allowed\"\n    }\n  })\n);\n\ninterface OCRProgress {\n  status: string;\n  progress: number;\n  workerId?: string;\n}\n\nfunction getInitialLanguages() {\n  try {\n    return JSON.parse(\n      localStorage.getItem(\"widget/crossnote.ocr/languages\") || '[\"eng\"]'\n    );\n  } catch (error) {\n    return [\"eng\"];\n  }\n}\n\nfunction OCRWidget(props: WidgetArgs) {\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [canvas, setCanvas] = useState<HTMLCanvasElement>(null);\n  // https://github.com/tesseract-ocr/tesseract/wiki/Data-Files#data-files-for-version-400-november-29-2016\n  const [link, setLink] = useState<string>(\"\");\n  const [imageDataURL, setImageDataURL] = useState<string>(\"\");\n  const [ocrDataURL, setOCRDataURL] = useState<string>(\"\");\n  const [imageDropAreaElement, setImageDropAreaElement] = useState<\n    HTMLInputElement\n  >(null);\n  const [isProcessing, setIsProcessing] = useState<boolean>(false);\n  const [ocrProgresses, setOCRProgresses] = useState<OCRProgress[]>([]);\n  const [selectedLanguages, setSelectedLanguages] = useState<string[]>(\n    getInitialLanguages()\n  );\n  const [grayscaleChecked, setGrayscaleChecked] = useState<boolean>(\n    !!localStorage.getItem(\"widget/crossnote.ocr/grayscale\") || true\n  );\n\n  useEffect(() => {\n    if (canvas && imageDataURL) {\n      const imageObject = new Image();\n      const context = canvas.getContext(\"2d\");\n      imageObject.onload = function() {\n        canvas.width = imageObject.width;\n        canvas.height = imageObject.height;\n        context.clearRect(0, 0, canvas.width, canvas.height);\n        if (grayscaleChecked) {\n          context.fillStyle = \"#FFF\";\n          context.fillRect(0, 0, canvas.width, canvas.height);\n          context.globalCompositeOperation = \"luminosity\";\n        }\n        context.drawImage(imageObject, 0, 0);\n        setOCRDataURL(canvas.toDataURL());\n      };\n      imageObject.onerror = error => {\n        throw error;\n      };\n      imageObject.setAttribute(\"crossOrigin\", \"anonymous\");\n      imageObject.src = imageDataURL;\n    }\n  }, [canvas, imageDataURL, grayscaleChecked]);\n\n  function clickDropArea(e: any) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!imageDropAreaElement || isProcessing) return;\n    imageDropAreaElement.onchange = function(event) {\n      const target = event.target as any;\n      const files = target.files || [];\n      if (files.length) {\n        try {\n          const file = files[0] as File;\n          const reader = new FileReader();\n          reader.readAsDataURL(file);\n          reader.onload = () => {\n            setImageDataURL(reader.result as string);\n          };\n          reader.onerror = error => {\n            throw error;\n          };\n        } catch (error) {}\n      }\n    };\n    imageDropAreaElement.click();\n  }\n\n  function startOCRFromLink() {\n    try {\n      setImageDataURL(link);\n    } catch (error) {}\n  }\n\n  function ocr(input: File | string | HTMLCanvasElement) {\n    const worker = createWorker({\n      logger: (m: OCRProgress) => {\n        setOCRProgresses(ocrProgresses => {\n          if (\n            ocrProgresses.length &&\n            ocrProgresses[ocrProgresses.length - 1].status === m.status\n          ) {\n            return [...ocrProgresses.slice(0, ocrProgresses.length - 1), m];\n          } else {\n            return [...ocrProgresses, m];\n          }\n        });\n      }\n    });\n\n    (async () => {\n      setIsProcessing(true);\n      let languagesArr = selectedLanguages;\n      if (languagesArr.length === 0) {\n        languagesArr = [\"eng\"];\n      }\n\n      await worker.load();\n      await worker.loadLanguage(languagesArr.join(\"+\"));\n      await worker.initialize(languagesArr.join(\"+\"));\n      const {\n        data: { text }\n      } = await worker.recognize(input);\n      props.replaceSelf(\"\\n\" + text);\n      await worker.terminate();\n      setIsProcessing(false);\n    })();\n  }\n\n  function toggleLanguage(lang: string) {\n    setSelectedLanguages(selectedLanguages => {\n      const offset = selectedLanguages.indexOf(lang);\n      if (offset >= 0) {\n        selectedLanguages.splice(offset, 1);\n        selectedLanguages = [...selectedLanguages];\n      } else {\n        selectedLanguages = [...selectedLanguages, lang];\n      }\n      localStorage.setItem(\n        \"widget/crossnote.ocr/languages\",\n        JSON.stringify(selectedLanguages)\n      );\n      return selectedLanguages;\n    });\n  }\n\n  if (props.isPreview) {\n    return <span></span>;\n  }\n\n  if (isProcessing) {\n    return (\n      <Card elevation={2} className={clsx(classes.card)}>\n        <Typography variant={\"h5\"}>{t(\"general/Processing\")}</Typography>\n        {/*<Typography variant={\"body1\"}>{t(\"general/please-wait\")}</Typography>*/}\n        <List>\n          {ocrProgresses.length > 0 && (\n            <ListItem>\n              <ListItemText>\n                {t(\n                  \"tesseract/\" + ocrProgresses[ocrProgresses.length - 1].status\n                )}\n              </ListItemText>\n              <ListItemSecondaryAction>\n                {Math.floor(\n                  ocrProgresses[ocrProgresses.length - 1].progress * 100\n                ).toString() + \"%\"}\n              </ListItemSecondaryAction>\n            </ListItem>\n          )}\n        </List>\n      </Card>\n    );\n  }\n\n  if (imageDataURL) {\n    return (\n      <Card elevation={2} className={clsx(classes.card)}>\n        <Box className={clsx(classes.section)}>\n          <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n            {t(\"widget/crossnote.ocr/recognize-text-in-languages\")}\n          </Typography>\n          <FormGroup>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={selectedLanguages.indexOf(\"eng\") >= 0}\n                  onChange={() => toggleLanguage(\"eng\")}\n                  value=\"eng\"\n                />\n              }\n              label=\"English\"\n            />\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={selectedLanguages.indexOf(\"chi_sim\") >= 0}\n                  onChange={() => toggleLanguage(\"chi_sim\")}\n                  value=\"chi_sim\"\n                />\n              }\n              label=\"简体中文\"\n            />\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={selectedLanguages.indexOf(\"chi_tra\") >= 0}\n                  onChange={() => toggleLanguage(\"chi_tra\")}\n                  value=\"chi_tra\"\n                />\n              }\n              label=\"繁體中文\"\n            />\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={selectedLanguages.indexOf(\"jpn\") >= 0}\n                  onChange={() => toggleLanguage(\"jpn\")}\n                  value=\"jpn\"\n                />\n              }\n              label=\"日本語\"\n            />\n          </FormGroup>\n        </Box>\n        <Box className={clsx(classes.section)}>\n          <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n            {t(\"widget/crossnote.ocr/extra-settings\")}\n          </Typography>\n          <FormControlLabel\n            control={\n              <Switch\n                checked={grayscaleChecked}\n                onChange={() => {\n                  if (grayscaleChecked) {\n                    localStorage.removeItem(\"widget/crossnote.ocr/grayscale\");\n                  } else {\n                    localStorage.setItem(\n                      \"widget/crossnote.ocr/grayscale\",\n                      \"true\"\n                    );\n                  }\n                  setGrayscaleChecked(!grayscaleChecked);\n                }}\n                color={\"primary\"}\n              ></Switch>\n            }\n            label={t(\"widget/crossnote.ocr/grayscale\")}\n          ></FormControlLabel>\n        </Box>\n        <Box className={clsx(classes.canvasWrapper)}>\n          <canvas\n            className={clsx(classes.canvas)}\n            ref={element => setCanvas(element)}\n          ></canvas>\n        </Box>\n        <ButtonGroup>\n          <Button\n            onClick={() => {\n              setImageDataURL(\"\");\n              setOCRDataURL(\"\");\n            }}\n          >\n            {t(\"general/go-back\")}\n          </Button>\n          <Button\n            color={\"primary\"}\n            onClick={() => ocr(ocrDataURL)}\n            disabled={!ocrDataURL}\n          >\n            {t(\"widget/crossnote.ocr/start-ocr\")}\n          </Button>\n        </ButtonGroup>\n      </Card>\n    );\n  }\n\n  return (\n    <Card elevation={2} className={clsx(classes.card)}>\n      <Typography variant={\"h5\"}>{t(\"widget/crossnote.ocr/ocr\")}</Typography>\n      <Box className={clsx(classes.actionButtons)}>\n        <Tooltip title={t(\"general/Delete\")}>\n          <IconButton onClick={() => props.removeSelf()}>\n            <TrashCan></TrashCan>\n          </IconButton>\n        </Tooltip>\n      </Box>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"general/Link\")}\n        </Typography>\n        <Input\n          margin={\"dense\"}\n          placeholder={t(\"widget/crossnote.image/image-url-placeholder\")}\n          value={link}\n          onChange={event => {\n            setLink(event.target.value);\n          }}\n          onKeyDown={event => {\n            if (event.which === 13) {\n              startOCRFromLink();\n            }\n          }}\n          fullWidth={true}\n        ></Input>\n      </Box>\n      <Typography\n        variant={\"subtitle1\"}\n        style={{ marginTop: \"16px\", textAlign: \"center\" }}\n      >\n        {t(\"widget/crossnote.auth/Or\")}\n      </Typography>\n      <Box className={clsx(classes.section)}>\n        <Typography variant={\"subtitle1\"} style={{ marginBottom: \"8px\" }}>\n          {t(\"widget/crossnote.ocr/local-image\")}\n        </Typography>\n        <Box\n          className={clsx(\n            classes.dropArea,\n            isProcessing ? classes.disabled : null\n          )}\n          onClick={clickDropArea}\n        >\n          <Typography>\n            {isProcessing\n              ? t(\"utils/uploading-image\")\n              : t(\"widget/crossnote.image/click-here-to-browse-image-file\")}\n          </Typography>\n        </Box>\n      </Box>\n      <input\n        type=\"file\"\n        // multiple\n        style={{ display: \"none\" }}\n        ref={(element: HTMLInputElement) => {\n          setImageDropAreaElement(element);\n        }}\n      ></input>\n    </Card>\n  );\n}\n\nexport const OCRWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<OCRWidget {...args}></OCRWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState, useEffect } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {\n  Card,\n  Typography,\n  IconButton,\n  Box,\n  CardContent,\n  TextField,\n  Button,\n  Dialog,\n  DialogContent,\n  DialogActions\n} from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport clsx from \"clsx\";\nimport {\n  CardPlus,\n  Close,\n  ContentSave,\n  Cancel,\n  Plus,\n  TrashCan,\n  Pencil\n} from \"mdi-material-ui\";\nimport { useTranslation } from \"react-i18next\";\n\n// @ts-ignore\nimport Board from \"@lourenci/react-kanban\";\nimport { Editor as CodeMirrorEditor } from \"codemirror\";\nimport { renderPreview } from \"vickymd/preview\";\nconst VickyMD = require(\"vickymd\");\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    columnHeader: {\n      width: \"256px\",\n      maxWidth: \"100%\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"space-between\"\n    },\n    kanbanCard: {\n      width: \"256px\",\n      maxWidth: \"100%\",\n      position: \"relative\",\n      [theme.breakpoints.down(\"sm\")]: {\n        marginTop: \"4px\",\n        marginBottom: \"4px\"\n      }\n    },\n    editorWrapper: {\n      // height: \"160px\",\n      // border: \"2px solid #96c3e6\",\n      \"& .CodeMirror-gutters\": {\n        display: \"none\"\n      }\n    },\n    textarea: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    preview: {\n      padding: theme.spacing(2)\n    }\n  })\n);\n\ninterface KanbanCard {\n  id: number;\n  title: string;\n  description: string;\n}\n\ninterface kanbanColumn {\n  id: number;\n  title: string;\n  wip: boolean;\n  cards: KanbanCard[];\n}\n\ninterface KanbanBoard {\n  columns: kanbanColumn[];\n}\n\ninterface KanbanColumnHeaderProps {\n  column: kanbanColumn;\n  board: KanbanBoard;\n  refreshBoard: (board: Board) => void;\n  isPreview: boolean;\n}\n\nfunction KanbanColumnHeaderDisplay(props: KanbanColumnHeaderProps) {\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const column = props.column;\n  const board = props.board;\n  const isPreview = props.isPreview;\n  const refreshBoard = props.refreshBoard;\n  const [clickedTitle, setClickedTitle] = useState<boolean>(false);\n  const [titleValue, setTitleValue] = useState<string>(column.title);\n\n  useEffect(() => {\n    if (!clickedTitle && titleValue !== column.title) {\n      column.title = titleValue || t(\"general/Untitled\");\n      setTitleValue(column.title);\n      refreshBoard(board);\n    }\n  }, [clickedTitle, board, column.title, titleValue, t, refreshBoard]);\n\n  return (\n    <Box className={clsx(classes.columnHeader)}>\n      <Box>\n        {clickedTitle ? (\n          <TextField\n            value={titleValue}\n            onChange={event => {\n              setTitleValue(event.target.value);\n            }}\n            onBlur={() => {\n              setClickedTitle(false);\n            }}\n            onKeyUp={event => {\n              if (event.which === 13) {\n                setClickedTitle(false);\n              }\n            }}\n          ></TextField>\n        ) : (\n          <Typography\n            variant={\"body1\"}\n            style={{ cursor: \"text\" }}\n            onClick={() => {\n              if (!isPreview) {\n                setClickedTitle(true);\n              }\n            }}\n          >\n            {titleValue}\n          </Typography>\n        )}\n      </Box>\n      {!isPreview && (\n        <Box>\n          <IconButton\n            onClick={() => {\n              const card: KanbanCard = {\n                id: Date.now(),\n                title: \"\", //\"Card \" + column.cards.length,\n                description: t(\"general/empty\")\n              };\n              if (column) {\n                column.cards.push(card);\n              }\n              props.refreshBoard(board);\n            }}\n          >\n            <CardPlus></CardPlus>\n          </IconButton>\n          <IconButton\n            onClick={() => {\n              board.columns = board.columns.filter(l => column.id !== l.id);\n              props.refreshBoard(board);\n            }}\n          >\n            <Close></Close>\n          </IconButton>\n        </Box>\n      )}\n    </Box>\n  );\n}\n\ninterface KanbanCardProps {\n  card: KanbanCard;\n  board: KanbanBoard;\n  refreshBoard: (board: Board) => void;\n  isPreview: boolean;\n}\nfunction KanbanCardDisplay(props: KanbanCardProps) {\n  const classes = useStyles(props);\n  const board = props.board;\n  const card = props.card;\n  const isPreview = props.isPreview;\n  const [textAreaElement, setTextAreaElement] = useState<HTMLTextAreaElement>(\n    null\n  );\n  const [previewElement, setPreviewElement] = React.useState<HTMLElement>(null);\n\n  const [editor, setEditor] = useState<CodeMirrorEditor>(null);\n  const [description, setDescription] = useState<string>(card.description);\n  const [editorDialogOpen, setEditDialogOpen] = useState<boolean>(false);\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    setDescription(card.description);\n  }, [card.description]);\n\n  useEffect(() => {\n    if (textAreaElement) {\n      const editor: CodeMirrorEditor = VickyMD.fromTextArea(textAreaElement, {\n        mode: {\n          name: \"hypermd\",\n          hashtag: true\n        },\n        inputStyle: \"textarea\"\n        // autofocus: false\n      });\n      editor.setValue(card.description);\n      editor.setOption(\"lineNumbers\", false);\n      editor.setOption(\"foldGutter\", false);\n      editor.setOption(\"autofocus\", false);\n      if (isPreview) {\n        editor.setOption(\"readOnly\", \"nocursor\");\n      }\n      editor.on(\"changes\", () => {\n        setDescription(editor.getValue());\n      });\n      editor.focus();\n      /*\n      // Cause save not working\n      editor.on(\"blur\", () => {\n        setClickedPreview(false);\n        setEditor(null);\n      });\n      */\n      // editor.display.input.blur();\n      setEditor(editor);\n    }\n  }, [textAreaElement]);\n\n  useEffect(() => {\n    if (previewElement) {\n      renderPreview(previewElement, card.description);\n    }\n  }, [previewElement]);\n\n  return (\n    <Card className={clsx(classes.kanbanCard)}>\n      <div\n        className={clsx(\"preview\", classes.preview)}\n        ref={(element: HTMLElement) => {\n          setPreviewElement(element);\n        }}\n      ></div>\n      {!isPreview && (\n        <Box style={{ position: \"absolute\", top: \"0\", right: \"0\", zIndex: 99 }}>\n          <IconButton onClick={() => setEditDialogOpen(true)}>\n            <Pencil></Pencil>\n          </IconButton>\n          <IconButton\n            onClick={() => {\n              board.columns.forEach(column => {\n                column.cards = column.cards.filter(c => c.id !== card.id);\n              });\n              props.refreshBoard(board);\n            }}\n          >\n            <Close></Close>\n          </IconButton>\n        </Box>\n      )}\n      <Dialog open={editorDialogOpen} onClose={() => setEditDialogOpen(false)}>\n        <DialogContent>\n          <Box\n            className={clsx(classes.editorWrapper)}\n            style={{ minWidth: \"300px\", maxWidth: \"100%\" }}\n          >\n            <textarea\n              className={classes.textarea}\n              ref={(element: HTMLTextAreaElement) => {\n                setTextAreaElement(element);\n              }}\n            ></textarea>\n          </Box>\n        </DialogContent>\n        <DialogActions>\n          <IconButton\n            onClick={() => {\n              card.description = description;\n              props.refreshBoard(props.board);\n              setEditDialogOpen(false);\n            }}\n          >\n            <ContentSave></ContentSave>\n          </IconButton>\n          <IconButton\n            onClick={() => {\n              if (editor) {\n                editor.setValue(card.description);\n              }\n              setDescription(card.description);\n              setEditDialogOpen(false);\n            }}\n          >\n            <Cancel></Cancel>\n          </IconButton>\n        </DialogActions>\n      </Dialog>\n    </Card>\n  );\n}\n\nfunction KanbanWidget(props: WidgetArgs) {\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [board, setBoard] = useState<KanbanBoard>(\n    props.attributes[\"board\"] || {\n      columns: []\n    }\n  );\n\n  if (\"lanes\" in (board as any)) {\n    board.columns = (board as any).lanes;\n  }\n\n  const refreshBoard = (board: KanbanBoard) => {\n    const newBoard = Object.assign({}, board);\n    props.setAttributes({ board: newBoard });\n    setBoard(newBoard as KanbanBoard);\n  };\n\n  return (\n    <div>\n      <Board\n        renderColumnHeader={(column: kanbanColumn) => (\n          <KanbanColumnHeaderDisplay\n            column={column}\n            board={board}\n            refreshBoard={refreshBoard}\n            isPreview={props.isPreview}\n          ></KanbanColumnHeaderDisplay>\n        )}\n        renderCard={(card: KanbanCard, { dragging }: { dragging: boolean }) => {\n          return (\n            <KanbanCardDisplay\n              card={card}\n              board={board}\n              refreshBoard={refreshBoard}\n              isPreview={props.isPreview}\n            ></KanbanCardDisplay>\n          );\n        }}\n        allowAddColumn={!props.isPreview}\n        allowAddCard={!props.isPreview}\n        renderColumnAdder={(): any => {\n          return (\n            <Box style={{ marginLeft: \"16px\", marginTop: \"16px\" }}>\n              <Button\n                color={\"primary\"}\n                variant={\"outlined\"}\n                onClick={() => {\n                  board.columns.push({\n                    id: Date.now(),\n                    title: t(\"general/untitled\"),\n                    cards: [],\n                    wip: false\n                  });\n                  refreshBoard(board);\n                }}\n              >\n                <Plus></Plus>\n                {t(\"widget/crossnote.kanban/add-column\")}\n              </Button>\n              <Button color={\"primary\"} onClick={() => props.removeSelf()}>\n                <TrashCan></TrashCan>\n              </Button>\n            </Box>\n          );\n          // return <ColumnAdder addColumn={addColumn} />;\n        }}\n        onNewColumnConfirm={(newColumn: any) => {\n          board.columns.push({ id: Date.now(), ...newColumn });\n          refreshBoard(board);\n        }}\n        disableCardDrag={props.isPreview}\n        disableColumnDrag={props.isPreview}\n        onCardDragEnd={(\n          card: KanbanCard,\n          source: { fromPosition: number; fromColumnId: number },\n          destination: { toPosition: number; toColumnId: number }\n        ) => {\n          const { fromPosition, fromColumnId } = source;\n          let { toPosition, toColumnId } = destination;\n          const fromColumn = board.columns.filter(\n            l => l.id === fromColumnId\n          )[0];\n          const toColumn = board.columns.filter(l => l.id === toColumnId)[0];\n          fromColumn.cards.splice(fromPosition, 1);\n          toColumn.cards = [\n            ...toColumn.cards.slice(0, toPosition),\n            card,\n            ...toColumn.cards.slice(toPosition, toColumn.cards.length)\n          ];\n\n          refreshBoard(board);\n        }}\n        onColumnDragEnd={(\n          b: KanbanBoard,\n          source: { fromPosition: number },\n          destination: { toPosition: number }\n        ) => {\n          const fromPosition: number = source.fromPosition;\n          const toPosition: number = destination.toPosition;\n          const fromColumn = board.columns[fromPosition];\n          const toColumn = board.columns[toPosition];\n          board.columns[toPosition] = fromColumn;\n          board.columns[fromPosition] = toColumn;\n          refreshBoard(board);\n        }}\n      >\n        {board}\n      </Board>\n    </div>\n  );\n}\n\nexport const KanbanWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<KanbanWidget {...args}></KanbanWidget>, el);\n  return el;\n};\n","import { WidgetCreator, WidgetArgs } from \"vickymd/widget\";\nimport React, { useState, useEffect } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport clsx from \"clsx\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport { Box, IconButton, Card } from \"@material-ui/core\";\nimport { useTranslation } from \"react-i18next\";\nimport { generateUUID } from \"../../utilities/utils\";\n\n// @ts-ignore\nimport abcjs from \"abcjs\";\nimport \"abcjs/abcjs-audio.css\";\nimport { ContentSave } from \"mdi-material-ui\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    card: {\n      padding: theme.spacing(2),\n      position: \"relative\"\n    },\n    editorWrapper: {\n      position: \"relative\",\n      padding: \"2px\"\n    },\n    editor: {\n      width: \"100%\",\n      height: \"128px\",\n      resize: \"none\",\n      border: \"none\"\n    },\n    canvas: {\n      overflow: \"auto !important\",\n      height: \"100% !important\"\n    },\n    saveBtn: {\n      position: \"absolute\",\n      top: \"0\",\n      right: \"0\"\n    }\n  })\n);\n\nfunction ABCWidget(props: WidgetArgs) {\n  const attributes = props.attributes;\n  const classes = useStyles(props);\n  const { t } = useTranslation();\n  const [abcEditorID] = useState<string>(\"abc-editor-\" + generateUUID());\n  const [abcWarningsID] = useState<string>(\"abc-warnings-\" + generateUUID());\n  const [abcCanvasID] = useState<string>(\"abc-canvas-\" + generateUUID());\n  const [abcAudioID] = useState<string>(\"abc-audio-\" + generateUUID());\n  const [editorElement, setEditorElement] = useState<HTMLElement>(null);\n  const [warningsElement, setWarningsElement] = useState<HTMLElement>(null);\n  const [canvasElement, setCanvasElement] = useState<HTMLElement>(null);\n  const [audioControlElement, setAudioControlElement] = useState<HTMLElement>(\n    null\n  );\n  const [hideEditor, setHideEditor] = useState<boolean>(props.isPreview);\n\n  const [abc, setABC] = useState<string>(\n    attributes[\"abc\"] ||\n      `X: 1\nT: Cooley's\nM: 4/4\nL: 1/8\nK: Emin\n|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|`\n  );\n\n  useEffect(() => {\n    if (\n      editorElement &&\n      warningsElement &&\n      canvasElement &&\n      audioControlElement\n    ) {\n      setTimeout(() => {\n        const editor = new abcjs.Editor(editorElement.id, {\n          canvas_id: canvasElement.id,\n          warnings_id: warningsElement.id,\n          generate_warnings: true,\n          synth: {\n            el: `#${audioControlElement.id}`,\n            options: {\n              displayLoop: true,\n              displayRestart: true,\n              displayPlay: true,\n              displayProgress: true,\n              displayWarp: true\n            }\n          },\n          abcjsParams: {\n            generateDownload: true\n          }\n        });\n\n        // Test synth\n      }, 1000);\n    }\n  }, [editorElement, warningsElement, canvasElement, audioControlElement]);\n\n  return (\n    <Box>\n      {/*<Typography variant={\"h5\"}>{t(\"widget/crossnote.abc/title\")}</Typography>*/}\n      <Card\n        elevation={2}\n        className={clsx(classes.editorWrapper)}\n        style={{\n          display: hideEditor ? \"none\" : \"block\"\n        }}\n      >\n        <textarea\n          className={clsx(classes.editor)}\n          id={abcEditorID}\n          ref={(element: HTMLElement) => {\n            setEditorElement(element);\n          }}\n          value={abc}\n          onChange={event => {\n            setABC(event.target.value);\n          }}\n          readOnly={props.isPreview}\n        ></textarea>\n        {!props.isPreview && attributes[\"abc\"] !== abc && (\n          <IconButton\n            className={clsx(classes.saveBtn)}\n            onClick={() => {\n              props.setAttributes(Object.assign(props.attributes, { abc }));\n            }}\n          >\n            <ContentSave></ContentSave>\n          </IconButton>\n        )}\n      </Card>\n      <div\n        id={abcWarningsID}\n        ref={(element: HTMLElement) => {\n          setWarningsElement(element);\n        }}\n      ></div>\n      <div\n        id={abcCanvasID}\n        className={clsx(classes.canvas)}\n        ref={(element: HTMLElement) => {\n          setCanvasElement(element);\n        }}\n      ></div>\n      <div\n        id={abcAudioID}\n        ref={(element: HTMLElement) => {\n          setAudioControlElement(element);\n        }}\n      ></div>\n    </Box>\n  );\n}\n\nexport const ABCWidgetCreator: WidgetCreator = args => {\n  const el = document.createElement(\"span\");\n  ReactDOM.render(<ABCWidget {...args}></ABCWidget>, el);\n  return el;\n};\n","// Import VickyMD related modules\n// VickyMD\nimport \"codemirror\";\n// Load these modes if you want highlighting ...\nimport \"codemirror/lib/codemirror.css\";\nimport \"codemirror/addon/hint/show-hint.css\";\nimport \"codemirror/mode/htmlmixed/htmlmixed\"; // for embedded HTML\nimport \"codemirror/mode/markdown/markdown\";\nimport \"codemirror/mode/stex/stex\"; // for Math TeX Formular\nimport \"codemirror/mode/yaml/yaml\"; // for Front Matters\nimport \"codemirror/mode/javascript/javascript\"; // eg. javascript\nimport \"codemirror/mode/python/python\";\nimport \"codemirror/addon/display/placeholder\";\nimport \"codemirror/addon/hint/show-hint\";\n\n// Essential\nimport \"vickymd\"; // ESSENTIAL\n// Widgets\n// Load PowerPacks if you want to utilize 3rd-party libs\nimport \"vickymd/powerpack/fold-math-with-katex\";\nimport \"vickymd/powerpack/fold-code-with-mermaid\";\nimport \"vickymd/powerpack/fold-code-with-plantuml\";\nimport \"vickymd/powerpack/fold-code-with-echarts\";\nimport \"vickymd/powerpack/fold-code-with-wavedrom\";\nimport \"vickymd/powerpack/hover-with-marked\";\nimport { registerWidgetCreator } from \"vickymd/widget\";\nimport { ImageWidgetCreator } from \"./widgets/Image\";\nimport { AudioWidgetCreator } from \"./widgets/Audio\";\nimport { NeteaseMusicWidgetCreator } from \"./widgets/NeteaseMusic\";\nimport { VideoWidgetCreator } from \"./widgets/Video\";\nimport { BilibiliWidgetCreator } from \"./widgets/Bilibili\";\nimport { YoutubeWidgetCreator } from \"./widgets/Youtube\";\nimport { OCRWidgetCreator } from \"./widgets/OCR\";\nimport { KanbanWidgetCreator } from \"./widgets/Kanban\";\nimport { ABCWidgetCreator } from \"./widgets/ABC\";\n\n// Set necessary window scope variables\nwindow[\"CodeMirror\"] = require(\"codemirror\");\n\n// Register widget creators\nregisterWidgetCreator(\"crossnote.image\", ImageWidgetCreator);\nregisterWidgetCreator(\"crossnote.audio\", AudioWidgetCreator);\nregisterWidgetCreator(\"crossnote.netease_music\", NeteaseMusicWidgetCreator);\nregisterWidgetCreator(\"crossnote.video\", VideoWidgetCreator);\nregisterWidgetCreator(\"crossnote.bilibili\", BilibiliWidgetCreator);\nregisterWidgetCreator(\"crossnote.youtube\", YoutubeWidgetCreator);\nregisterWidgetCreator(\"crossnote.ocr\", OCRWidgetCreator);\nregisterWidgetCreator(\"crossnote.kanban\", KanbanWidgetCreator);\nregisterWidgetCreator(\"crossnote.abc\", ABCWidgetCreator);\n","import React, { useEffect } from \"react\";\nimport \"./App.css\";\nimport { Home } from \"./pages/Home\";\nimport { createMuiTheme } from \"@material-ui/core\";\nimport { orange, blue } from \"@material-ui/core/colors\";\nimport { ThemeProvider } from \"@material-ui/styles\";\n\nimport \"./editor\";\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: blue,\n    secondary: orange\n  }\n});\n\nconst App: React.FC = () => {\n  useEffect(() => {\n    const handler = (event: any) => {\n      event.preventDefault();\n      event.prompt();\n      event.userChoice.then((choiceResult: any) => {\n        console.log(choiceResult);\n      });\n    };\n    window.addEventListener(\"beforeinstallprompt\", handler);\n    return () => {\n      window.removeEventListener(\"beforeinstallprompt\", handler);\n    };\n  }, []);\n  return (\n    <ThemeProvider theme={theme}>\n      <div className=\"App\">\n        <Home></Home>\n      </div>\n    </ThemeProvider>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n//import \"typeface-noto-sans\";\n//import \"typeface-noto-sans-sc\";\n//import \"typeface-noto-serif-sc\";\n//import \"typeface-noto-sans-hk\";\nimport \"typeface-roboto\";\nimport \"noty/lib/noty.css\";\nimport \"noty/lib/themes/relax.css\";\n// @ts-ignore\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\n\nimport \"./i18n/i18n\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport Crossnote from \"./lib/crossnote\";\nimport { CrossnoteContainer } from \"./containers/crossnote\";\n\nconst fs = new LightningFS(\"fs\");\n(window as any)[\"fs\"] = fs;\n\ntry {\n  const crossnote = new Crossnote({\n    fs: fs\n  });\n  (window as any)[\"crossnote\"] = crossnote;\n\n  ReactDOM.render(\n    <CrossnoteContainer.Provider\n      initialState={{\n        crossnote: crossnote\n      }}\n    >\n      <App />\n    </CrossnoteContainer.Provider>,\n    document.getElementById(\"root\")\n  );\n} catch (error) {\n  console.log(error);\n}\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\nserviceWorker.register();\n","import { PeerJSOption } from \"peerjs\";\n\nexport function waitForTimeout(timeout: number) {\n  return new Promise((resolve, reject) => {\n    return setTimeout(() => {\n      return resolve();\n    }, timeout);\n  });\n}\n\nexport const UUIDNil = \"00000000-0000-0000-0000-000000000000\";\n\nexport const OneDay = 1000 * 60 * 60 * 24;\n\nexport function getGraphQLEndpoint() {\n  if (process.env.NODE_ENV === \"production\") {\n    return `https://crossnote.app/api/graphql`;\n  } else {\n    return `http://${window.location.hostname}:9999/graphql`;\n  }\n}\n\nexport function getPeerJSEndpoint(): PeerJSOption {\n  if (process.env.NODE_ENV === \"production\") {\n    return {\n      host: `crossnote.app`,\n      path: \"/peer\",\n      secure: true\n      // config: { iceServers: [{ url: \"stun:stun.l.google.com:19302\" }] }\n    };\n  } else {\n    return {\n      host: window.location.hostname,\n      port: 9000,\n      path: \"/peer\",\n      secure: false\n      // config: { iceServers: [{ url: \"stun:stun.l.google.com:19302\" }] }\n    };\n  }\n}\n\nexport function getGitHubOAuthClientID() {\n  if (process.env.NODE_ENV === \"production\") {\n    return \"3dd81bb2c212b7749761\";\n  } else {\n    return \"c7477b9aa512785936e0\";\n  }\n}\n\nexport function getGitHubOAuthCallbackURL() {\n  if (process.env.NODE_ENV === \"production\") {\n    return \"https://crossnote.app/github_oauth_callback\";\n  } else {\n    return `http://${window.location.host}/github_oauth_callback`;\n  }\n}\n\nexport function startGitHubOAuth() {\n  window.open(\n    `https://github.com/login/oauth/authorize?client_id=${getGitHubOAuthClientID()}&redirect_uri=${encodeURIComponent(\n      getGitHubOAuthCallbackURL()\n    )}`,\n    \"_self\"\n  );\n}\n\nexport const graphqlFetchContext = {\n  fetchOptions: {\n    headers: {\n      Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n    }\n  }\n};\nexport function formatDate(dateString: string) {\n  if (!dateString) return \"\";\n  const date = new Date(dateString);\n  const diff = Date.now() - date.getTime();\n  const passedTime = Math.abs(diff);\n\n  if (passedTime <= 1000 * 60 * 60 * 24) {\n    // within 24h\n    if (passedTime <= 1000 * 60 * 60) {\n      // within 1 hour\n      return (\n        (diff < 0 ? \"future \" : \"\") + Math.ceil(passedTime / (1000 * 60)) + \"m\"\n      );\n    } else {\n      return (\n        (diff < 0 ? \"future \" : \"\") +\n        Math.floor(passedTime / (1000 * 60 * 60)) +\n        \"h\"\n      );\n    }\n  } else {\n    const monthNamesShort = [\n      \"Jan\",\n      \"Feb\",\n      \"Mar\",\n      \"Apr\",\n      \"May\",\n      \"Jun\",\n      \"Jul\",\n      \"Aug\",\n      \"Sep\",\n      \"Oct\",\n      \"Nov\",\n      \"Dec\"\n    ];\n    return (\n      monthNamesShort[date.getMonth()] +\n      \" \" +\n      date.getDate() +\n      \" \" +\n      date.getFullYear()\n    );\n  }\n}\n\n// https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript\nexport function copyToClipboard(text: string) {\n  if (\"clipboardData\" in window && (window as any).clipboardData.setData) {\n    // Internet Explorer-specific code path to prevent textarea being shown while dialog is visible.\n    return (window as any).setData(\"Text\", text);\n  } else if (\n    document.queryCommandSupported &&\n    document.queryCommandSupported(\"copy\")\n  ) {\n    var textarea = document.createElement(\"textarea\");\n    textarea.textContent = text;\n    textarea.style.position = \"fixed\"; // Prevent scrolling to bottom of page in Microsoft Edge.\n    document.body.appendChild(textarea);\n    textarea.select();\n    try {\n      return document.execCommand(\"copy\"); // Security exception may be thrown by some browsers.\n    } catch (ex) {\n      console.warn(\"Copy to clipboard failed.\", ex);\n      return false;\n    } finally {\n      document.body.removeChild(textarea);\n    }\n  }\n}\n\nexport function generateUUID() {\n  // Public Domain/MIT\n  var d = new Date().getTime(); //Timestamp\n  var d2 = (performance && performance.now && performance.now() * 1000) || 0; //Time in microseconds since page-load or 0 if unsupported\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16; //random number between 0 and 16\n    if (d > 0) {\n      //Use timestamp until depleted\n      r = (d + r) % 16 | 0;\n      d = Math.floor(d / 16);\n    } else {\n      //Use microseconds since page-load if supported\n      r = (d2 + r) % 16 | 0;\n      d2 = Math.floor(d2 / 16);\n    }\n    return (c === \"x\" ? r : (r & 0x3) | 0x8).toString(16);\n  });\n}\n\nexport class RandomColorGenerator {\n  private cache: { [key: string]: string } = {};\n  private hashCode(s: string): number {\n    let n = s.split(\"\").reduce(function(a, b) {\n      a = (a << 5) - a + b.charCodeAt(0);\n      return a & a;\n    }, 0);\n    n = Math.abs(n);\n    const x = \"0.\" + n.toString();\n    return parseFloat(x);\n  }\n  public generateColor(key: string): string {\n    if (key in this.cache) {\n      return this.cache[key];\n    } else {\n      const color =\n        \"#\" +\n        (((1 << 24) * /* Math.random() */ this.hashCode(key)) | 0).toString(16);\n      this.cache[key] = color;\n      return color;\n    }\n  }\n}\n\nexport const randomColorGenerator = new RandomColorGenerator();\n\nexport function randomID() {\n  return Math.random()\n    .toString(36)\n    .substr(2, 9);\n}\n","import { UUIDNil } from \"./utils\";\n\nexport interface Summary {\n  title: string;\n  summary: string;\n  images: string[]; // If has `title`, then images[0] is cover.\n  tags: string[]; // TODO: support tags\n  html: string; // original html\n}\n\n/*\nexport async function getTopicsAndMentionsFromHTML(\n  html: string,\n  ribbit: Ribbit\n): Promise<{\n  topics: string[];\n  mentions: { name: string; address: string }[];\n}> {\n  const div = document.createElement(\"div\");\n  const topics = [];\n  const mentions = [];\n  div.innerHTML = html;\n\n  const tagElems = div.getElementsByClassName(\"tag\");\n  for (let i = 0; i < tagElems.length; i++) {\n    const tagElem = tagElems[i] as HTMLAnchorElement;\n    if (tagElem.classList.contains(\"tag-mention\")) {\n      const mention = tagElem.getAttribute(\"data-mention\");\n      const userInfo = await ribbit.getUserInfoFromUsername(mention);\n      mentions.push({\n        name: userInfo.username,\n        address: userInfo.address\n      });\n    } else if (tagElem.classList.contains(\"tag-topic\")) {\n      const topic = tagElem.getAttribute(\"data-topic\");\n      topics.push(topic);\n    }\n  }\n  div.remove();\n\n  return {\n    topics: Array.from(new Set(topics)),\n    mentions\n  };\n}\n*/\n\nexport function getHeaderFromMarkdown(markdown: string): string {\n  const titleMatch = markdown.match(/^#\\s.+$/gim);\n  if (titleMatch && titleMatch.length) {\n    return titleMatch[0].replace(/^#/, \"\").trim();\n  }\n  return \"\";\n}\n\nexport function getMentionsFromMarkdown(markdown: string): string[] {\n  return (markdown.match(/@(?:[a-zA-Z\\d]+-)*[a-zA-Z\\d]+/g) || [])\n    .map(username => username.replace(/^@/, \"\").toLocaleLowerCase())\n    .filter(\n      (username, index, self) =>\n        index === self.findIndex(username2 => username === username2)\n    );\n}\n\nexport async function generateSummaryFromMarkdown(\n  markdown: string\n): Promise<Summary> {\n  let title = \"\",\n    summary = \"\",\n    images: string[] = [];\n  markdown = markdown.replace(/^---([\\w\\W]+?\\n---)/, \"\").trim(); // Remove front matter\n  let contentString = markdown;\n\n  const titleMatch = markdown.match(/^#\\s.+$/gim);\n  if (titleMatch && titleMatch.length) {\n    title = titleMatch[0].replace(/^#/, \"\").trim();\n    const aheadString = markdown\n      .slice(0, markdown.indexOf(titleMatch[0]))\n      .trim();\n    contentString = markdown.slice(\n      markdown.indexOf(titleMatch[0]) + titleMatch[0].length,\n      markdown.length\n    );\n    const coverMatch = aheadString.match(/^!\\[.*?\\]\\(.+?\\)/gim);\n    if (coverMatch && coverMatch.length) {\n      images.push(coverMatch[0].match(/\\(([^)\"]+?)\\)/)[1].trim());\n    }\n  }\n\n  const coverImagesMatch = markdown.match(/^!\\[.*?\\]\\(.+?\\)/gim);\n  if (coverImagesMatch && coverImagesMatch.length) {\n    coverImagesMatch.forEach(mdImage => {\n      images.push(mdImage.match(/\\(([^)\"]+?)\\)/)[1].trim());\n    });\n    images = images.filter(\n      (image, index, self) => index === self.findIndex(m => m === image)\n    );\n  }\n\n  summary = contentString\n    .split(\"\\n\")\n    .filter(\n      x =>\n        x.trim().length > 0 &&\n        !x.match(/!\\[.*?\\]\\(.+?\\)/) && // Remove image\n        !x.match(/`@.+?`/) // Remove widget\n    )\n    .map(x => x.replace(/#+\\s(.+)\\s*$/, \"**$1**\").trim()) // Replace headers to bold\n    .slice(0, 10)\n    .join(\"  \\n\");\n\n  return {\n    title,\n    summary,\n    images,\n    tags: [],\n    html: \"\"\n  };\n}\n\nexport const EmptyPageInfo = {\n  hasPreviousPage: false,\n  hasNextPage: false,\n  startCursor: UUIDNil,\n  endCursor: UUIDNil\n};\n"],"sourceRoot":""}