/*! For license information please see main.7f283afd.chunk.js.LICENSE.txt */
(this.webpackJsonpnotehub=this.webpackJsonpnotehub||[]).push([[0],{116:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return l}));var n=a(1),r=a.n(n),o=a(2),i=a(51);function c(e){var t=e.match(/^#\s.+$/gim);return t&&t.length?t[0].replace(/^#/,"").trim():""}function l(e){return s.apply(this,arguments)}function s(){return(s=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,l,s,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="","",o=[],t=t.replace(/^---.+?\n---/,""),i=t,(c=t.match(/^#\s.+$/gim))&&c.length&&(a=c[0].replace(/^#/,"").trim(),l=t.slice(0,t.indexOf(c[0])).trim(),i=t.slice(t.indexOf(c[0])+c[0].length,t.length),(s=l.match(/^!\[.*?\]\(.+?\)/gim))&&s.length&&o.push(s[0].match(/\(([^)"]+?)\)/)[1].trim())),(u=t.match(/^!\[.*?\]\(.+?\)/gim))&&u.length&&(u.forEach((function(e){o.push(e.match(/\(([^)"]+?)\)/)[1].trim())})),o=o.filter((function(e,t,a){return t===a.findIndex((function(t){return t===e}))}))),n=i.split("\n").filter((function(e){return e.trim().length>0&&!e.match(/!\[.*?\]\(.+?\)/)&&!e.match(/`@.+?`/)})).map((function(e){return e.replace(/#+\s(.+)\s*$/,"**$1**").trim()})).slice(0,10).join("  \n"),e.abrupt("return",{title:a,summary:n,images:o,tags:[],html:""});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}i.b,i.b},309:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return w}));var n=a(1),r=a.n(n),o=a(2),i=a(9),c=a(15),l=a(31),s=a(149),u=a(21),d=a(183),m=a(314),p=a(143),b=a.n(p),f=a(51),g=a(116),h=a(120),v=a.n(h),w=function(){function t(e){Object(i.a)(this,t),this.fs=void 0,this.readFile=void 0,this.writeFile=void 0,this.readdir=void 0,this.unlink=void 0,this.stats=void 0,this.mkdir=void 0,this.exists=void 0,this.rename=void 0,this.rmdir=void 0,this.notebookDB=void 0,this.fs=e.fs,this.setUpFSMethods(),d.a.plugin(m.a),this.notebookDB=new d.a("notebooks"),this.notebookDB.createIndex({index:{fields:["gitURL"]}})}return Object(c.a)(t,[{key:"setUpFSMethods",value:function(){var e=this;this.readFile=function(t){return new Promise((function(a,n){e.fs.readFile(t,{encoding:"utf8"},(function(e,t){return e?n(e):a(t.toString())}))}))},this.writeFile=function(t,a){return new Promise((function(n,r){e.fs.writeFile(t,a,{encoding:"utf8"},(function(e){return e?r(e):n()}))}))},this.readdir=function(t){return new Promise((function(a,n){e.fs.readdir(t,(function(e,t){return e?n(e):a(t)}))}))},this.unlink=function(t){return new Promise((function(a,n){e.fs.unlink(t,(function(e){return e?n(e):a()}))}))},this.stats=function(t){return new Promise((function(a,n){e.fs.stat(t,(function(e,t){return e?n(e):a(t)}))}))},this.mkdir=function(t){return new Promise((function(a,n){e.fs.mkdir(t,"0777",(function(e){return e?n(e):a()}))}))},this.exists=function(t){return new Promise((function(a,n){e.fs.stat(t,(function(e,t){return a(!e)}))}))},this.rename=function(t,a){return new Promise((function(n,r){e.fs.rename(t,a,(function(e){return e?r(e):n()}))}))};var t=function(t){return new Promise((function(a,n){e.fs.rmdir(t,(function(e){return e?n(e):a()}))}))};this.rmdir=function(){var a=Object(o.a)(r.a.mark((function a(n){var o,i,c,l;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.readdir(n);case 2:o=a.sent,i=0;case 4:if(!(i<o.length)){a.next=20;break}return c=o[i],l=u.resolve(n,c),a.next=9,e.stats(l);case 9:if(!a.sent.isDirectory()){a.next=15;break}return a.next=13,e.rmdir(l);case 13:a.next=17;break;case 15:return a.next=17,e.unlink(l);case 17:i++,a.next=4;break;case 20:return a.next=22,t(n);case 22:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}},{key:"addNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,s,u,d,m,p,b,g,h,v,w,E,O;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,n=void 0===a?"":a,o=t.corsProxy,i=t.gitURL,c=t.branch,s=void 0===c?"master":c,u=t.username,d=void 0===u?"":u,m=t.password,p=void 0===m?"":m,b=t.depth,g=void 0===b?3:b,h=t.rememberCredentials,v=void 0!==h&&h,!i){e.next=7;break}return e.next=4,this.cloneNotebook({name:n,corsProxy:o,gitURL:i,branch:s,username:d,password:p,depth:g,rememberCredentials:v});case 4:return e.abrupt("return",e.sent);case 7:return w=Object(f.d)(),E="/notebooks/".concat(w),O={_id:w,dir:E,name:n.trim()||"Unnamed",gitURL:i.trim(),gitBranch:s.trim()||"master",gitCorsProxy:o.trim(),gitUsername:v?d.trim():"",gitPassword:v?p:""},e.next=12,this.exists("/notebooks");case 12:if(e.sent){e.next=15;break}return e.next=15,this.mkdir("/notebooks");case 15:return e.next=17,this.exists(E);case 17:if(e.sent){e.next=20;break}return e.next=20,this.mkdir(E);case 20:return e.next=22,l.e({fs:this.fs,dir:E});case 22:return e.prev=22,e.next=25,this.notebookDB.put(O);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e.catch(22),e.next=31,this.rmdir(E);case 31:return e.abrupt("return",O);case 32:case"end":return e.stop()}}),e,this,[[22,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cloneNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,u,d,m,p,b,g,h,v,w,E,O,k;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,n=void 0===a?"":a,o=t.corsProxy,i=t.gitURL,c=t.branch,u=void 0===c?"master":c,d=t.username,m=void 0===d?"":d,p=t.password,b=void 0===p?"":p,g=t.depth,h=void 0===g?10:g,v=t.rememberCredentials,w=void 0!==v&&v,i.match(/^https?:\/\//)){e.next=3;break}throw new Error("error/invalid-git-url-prefix");case 3:return E=Object(f.d)(),O="/notebooks/".concat(E),e.next=7,l.c({fs:this.fs,http:s.a,dir:O,corsProxy:o,url:i,ref:u.trim()||"master",depth:h,singleBranch:!0,onAuth:function(e,t){return{username:m,password:b}}});case 7:return k={_id:E,dir:O,name:n||this.getDefaultNotebookNameFromGitURL(i),gitURL:i,gitBranch:u.trim()||"master",gitCorsProxy:o,gitUsername:w?m:"",gitPassword:w?b:""},e.prev=8,e.next=11,this.notebookDB.put(k);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(8),e.next=17,this.rmdir(O);case 17:return e.abrupt("return",k);case 18:case"end":return e.stop()}}),e,this,[[8,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"exportNotebookToJSON",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"importNotebookFromJSON",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.get(t);case 2:return a=e.sent,e.next=5,this.rmdir(a.dir);case 5:return e.next=7,this.notebookDB.remove(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.put(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeNoteFilePath",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a,n){var o,i,c,s,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=n.replace(/^\/+/,"")).endsWith(".md")||(n+=".md"),e.prev=2,e.next=5,l.k({fs:this.fs,dir:t.dir,filepath:a.filePath});case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:o=u.dirname(u.resolve(t.dir,n)),i=o.split("/").slice(1),c=0;case 12:if(!(c<i.length)){e.next=23;break}for(s=["/"],d=0;d<=c;d++)s.push(i[d]);return e.next=17,this.exists(s.join("/"));case 17:if(e.sent){e.next=20;break}return e.next=20,this.mkdir(s.join("/"));case 20:c++,e.next=12;break;case 23:return e.next=25,this.exists(u.resolve(t.dir,n));case 25:if(!e.sent){e.next=28;break}throw new Error("target file already exists");case 28:return e.next=30,this.rename(u.resolve(t.dir,a.filePath),u.resolve(t.dir,n));case 30:return e.next=32,l.a({fs:this.fs,dir:t.dir,filepath:n});case 32:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"pushNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,i,c,d,m,p,b,f,g,h,v,w,E,O,k,j,x=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.notebook,n=t.authorName,i=void 0===n?"crossnote":n,c=t.authorEmail,d=void 0===c?"anonymous@crossnote.com":c,m=t.username,p=t.password,b=t.message,f=void 0===b?"doc: Updated docs":b,g=t.onProgress,h=t.onMessage,v=t.onAuthFailure,w=t.onAuthSuccess,e.next=3,this.listFiles(a);case 3:if(e.sent.length){e.next=6;break}return e.abrupt("return",{ok:!0,error:null,refs:{}});case 6:return e.next=8,this.pullNotebook({notebook:a,onProgress:g,onAuthFailure:v,onAuthSuccess:w,onMessage:h});case 8:if(!(e.sent.numConflicts>0)){e.next=11;break}throw new Error("error/please-resolve-conflicts");case 11:return e.next=13,l.g({fs:this.fs,dir:a.dir,ref:"origin/".concat(a.gitBranch||"master"),depth:5});case 13:return E=e.sent,O=E&&E[0]&&E[0].oid||"",e.next=17,l.d({fs:this.fs,dir:a.dir,author:{name:i,email:d},message:f});case 17:return e.sent,k=function(){var e=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.gitBranch||"master",e.next=3,x.writeFile(u.resolve(a.dir,".git/refs/heads/".concat(t)),O);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=21,l.i({fs:this.fs,http:s.a,onAuth:function(e,t){return{username:m,password:p}},onProgress:function(e){g&&g(e)},onMessage:function(e){h&&h(e)},onAuthFailure:function(e,t){v&&v(e),k()},onAuthSuccess:function(e,t){w&&w(e)},url:a.gitURL,dir:a.dir,ref:a.gitBranch,corsProxy:a.gitCorsProxy});case 21:return(j=e.sent).error&&k(),j.ok,e.abrupt("return",j);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"pullNotebook",value:function(){var t=Object(o.a)(r.a.mark((function t(a){var n,o,i,c,d,m,p,f,g,h,v,w,E,O,k,j,x,y,N,C,S,I,P,T,D,A,L,B,R,F,U,W,M,_,G,V,H;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.notebook,o=a.onProgress,i=a.onAuthFailure,c=a.onAuthSuccess,d=a.onMessage,t.next=3,l.f({fs:this.fs,dir:n.dir});case 3:m=t.sent,p={},f=0;case 6:if(!(f<m.length)){t.next=19;break}return t.next=9,l.l({fs:this.fs,dir:n.dir,filepath:m[f]});case 9:if(!(g=t.sent).match(/^\*?(modified|added)/)){t.next=16;break}return t.t0=g,t.next=14,this.readFile(u.resolve(n.dir,m[f]));case 14:t.t1=t.sent,p[m[f]]={status:t.t0,markdown:t.t1};case 16:f++,t.next=6;break;case 19:return t.next=21,l.g({fs:this.fs,dir:n.dir,ref:"origin/".concat(n.gitBranch||"master"),depth:5});case 21:return h=t.sent,v=(h&&h[0]&&h[0]).oid,t.next=25,l.h({fs:this.fs,http:s.a,dir:n.dir,singleBranch:!0,corsProxy:n.gitCorsProxy,ref:n.gitBranch||"master",author:{name:"anonymous",email:"anonymous@crossnote.app"},onAuth:function(e,t){return{username:n.gitUsername,password:n.gitPassword}},onProgress:o,onAuthFailure:i,onAuthSuccess:c,onMessage:d});case 25:return t.next=27,l.g({fs:this.fs,dir:n.dir,ref:"origin/".concat(n.gitBranch||"master"),depth:5});case 27:if(h=t.sent,w=(h&&h[0]&&h[0]).oid,E=0,v!==w){t.next=44;break}t.t2=r.a.keys(p);case 32:if((t.t3=t.t2()).done){t.next=42;break}return O=t.t3.value,k=p[O].markdown,t.next=37,this.writeFile(u.resolve(n.dir,O),k);case 37:return t.next=39,l.a({fs:this.fs,dir:n.dir,filepath:O});case 39:this.markdownHasConflicts(k)&&(E+=1),t.next=32;break;case 42:t.next=101;break;case 44:j=/^.*(\r?\n|$)/gm,x=7,y="ours",N="theirs",t.t4=r.a.keys(p);case 49:if((t.t5=t.t4()).done){t.next=101;break}return C=t.t5.value,S=p[C].markdown,t.next=54,this.exists(u.resolve(n.dir,C));case 54:if(!t.sent){t.next=94;break}return t.next=57,this.readFile(u.resolve(n.dir,C));case 57:return I=t.sent,t.next=60,l.j({fs:this.fs,dir:n.dir,oid:v,filepath:C});case 60:for(P=t.sent,T=e.from(P.blob).toString("utf8"),D=S.match(j),A=T.match(j),L=I.match(j),B=b()(D,A,L),R="",F=!1,U=!0,W=!1,M=void 0,t.prev=71,_=B[Symbol.iterator]();!(U=(G=_.next()).done);U=!0)(V=G.value).ok&&(R+=V.ok.join("")),V.conflict&&(F=!0,R+="\\<".concat("<".repeat(x-1)," ").concat(y,"\n"),R+=V.conflict.a.join(""),R+="\\=".concat("=".repeat(x-1),"\n"),R+=V.conflict.b.join(""),R+="\\>".concat(">".repeat(x-1)," ").concat(N,"\n"));t.next=79;break;case 75:t.prev=75,t.t6=t.catch(71),W=!0,M=t.t6;case 79:t.prev=79,t.prev=80,U||null==_.return||_.return();case 82:if(t.prev=82,!W){t.next=85;break}throw M;case 85:return t.finish(82);case 86:return t.finish(79);case 87:return F&&(E+=1),t.next=90,this.writeFile(u.resolve(n.dir,C),R);case 90:return t.next=92,l.a({fs:this.fs,dir:n.dir,filepath:C});case 92:t.next=99;break;case 94:return H=p[C].markdown,t.next=97,this.writeFile(u.resolve(n.dir,C),H);case 97:return t.next=99,l.a({fs:this.fs,dir:n.dir,filepath:C});case 99:t.next=49;break;case 101:return t.abrupt("return",{numConflicts:E});case 102:case"end":return t.stop()}}),t,this,[[71,75,79,87],[80,,82,86]])})));return function(e){return t.apply(this,arguments)}}()},{key:"markdownHasConflicts",value:function(e){var t=e.match(/^\\<+\s/gm),a=e.match(/^\\=+\s/gm),n=e.match(/^\\>+\s/gm);return t&&t.length>0&&a&&a.length>0&&n&&n.length>0}},{key:"checkoutNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.b({fs:this.fs,dir:t.notebook.dir,filepaths:[t.filePath],force:!0});case 3:return e.next=5,this.exists(u.resolve(t.notebook.dir,t.filePath));case 5:if(!e.sent){e.next=8;break}return e.next=8,l.a({fs:this.fs,dir:t.notebook.dir,filepath:t.filePath});case 8:return e.next=10,this.getNote(t.notebook,t.filePath);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"listNotebooks",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t,a,n,o,i,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.find({selector:{gitURL:{$gt:null}}});case 2:t=e.sent.docs,a=0;case 4:if(!(a<t.length)){e.next=18;break}if(!((n=t[a]).gitURL.trim().length<=0)){e.next=8;break}return e.abrupt("continue",15);case 8:return o=n.gitBranch||"master",e.next=11,l.g({fs:this.fs,dir:n.dir,ref:"origin/".concat(o),depth:5});case 11:return i=e.sent,c=i&&i[0]&&i[0].oid||"",e.next=15,this.writeFile(u.resolve(n.dir,".git/refs/heads/".concat(o)),c);case 15:a++,e.next=4;break;case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"listFiles",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.f({fs:this.fs,dir:t.dir});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a,n){var o,i,c,l,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=u.resolve(t.dir,a),n){e.next=11;break}return e.prev=2,e.next=5,this.stats(o);case 5:n=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",null);case 11:if(!n.isFile()||!a.endsWith(".md")){e.next=21;break}return e.next=14,this.readFile(o);case 14:i=e.sent,c={createdAt:new Date(n.ctimeMs),modifiedAt:new Date(n.mtimeMs),tags:[]};try{l=v.a(i),c=Object.assign(c,l.data.note||{}),i=l.content}catch(r){i="Please fix front-matter\n\n"+i}return s={notebook:t,filePath:u.relative(t.dir,o),title:Object(g.b)(i),markdown:i,config:c},e.abrupt("return",s);case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"listNotes",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,l,s,d,m,p,b,f;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.notebook,n=t.dir,o=void 0===n?"./":n,i=t.includeSubdirectories,c=void 0!==i&&i,l=[],s=[],e.prev=3,e.next=6,this.readdir(u.resolve(a.dir,o));case 6:s=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),s=[];case 12:d=0;case 13:if(!(d<s.length)){e.next=32;break}return m=s[d],p=u.resolve(a.dir,o,m),e.next=18,this.stats(p);case 18:return b=e.sent,e.next=21,this.getNote(a,u.relative(a.dir,p),b);case 21:if((f=e.sent)&&l.push(f),!b.isDirectory()||".git"===m||!c){e.next=29;break}return e.t1=l,e.next=27,this.listNotes({notebook:a,dir:u.relative(a.dir,p),includeSubdirectories:c});case 27:e.t2=e.sent,l=e.t1.concat.call(e.t1,e.t2);case 29:d++,e.next=13;break;case 32:return e.abrupt("return",l);case 33:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"writeNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a,n,o){var i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.modifiedAt=new Date;try{(i=v.a(n)).data.note&&i.data.note instanceof Object&&(o=Object.assign({},o,i.data.note)),n=v.a.stringify(n,Object.assign(i.data||{},{note:o}))}catch(r){n=v.a.stringify(n,{note:o})}return e.next=4,this.writeFile(u.resolve(t.dir,a),n);case 4:return e.next=6,l.a({fs:this.fs,dir:t.dir,filepath:a});case 6:return e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"deleteNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists(u.resolve(t.dir,a));case 2:if(!e.sent){e.next=7;break}return e.next=5,l.k({fs:this.fs,dir:t.dir,filepath:a});case 5:return e.next=7,this.unlink(u.resolve(t.dir,a));case 7:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getNotebookDirectoriesFromNotes",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a={name:".",path:".",children:[]},n=new Set([]),o=0;o<t.length;o++)n.add(u.dirname(t[o].filePath));return n.forEach((function(e){for(var t=e.split("/"),n=a,r=function(e){if("."===t[e])return"break";var a=n.children.filter((function(a){return a.name===t[e]}))[0];if(a)n=a;else{for(var r=[],o=0;o<=e;o++)r.push(t[o]);a={name:t[e],path:r.join("/"),children:[]},n.children.push(a),n=a}},o=0;o<t.length;o++){if("break"===r(o))break}})),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNotebookTagNodeFromNotes",value:function(e){for(var t={name:".",path:".",children:[]},a=0;a<e.length;a++){(e[a].config.tags||[]).forEach((function(e){var a=t;e.split("/").forEach((function(e,t){e=e.toLocaleLowerCase().replace(/\s+/g," ");var n=a.children.findIndex((function(t){return t.name===e}));if(n>=0)a=a.children[n];else{var r={name:e,path:"."===a.name?e:a.path+"/"+e,children:[]};a.children.push(r),a.children.sort((function(e,t){return e.name.localeCompare(t.name)})),a=r}}))}))}return t}},{key:"getDefaultNotebookNameFromGitURL",value:function(e){var t=e.lastIndexOf("/");return e.slice(t+1).replace(/\.git/,"")}},{key:"getStatus",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.l({fs:this.fs,dir:t.notebook.dir,filepath:t.filePath});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}()}).call(this,a(112).Buffer)},51:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return c})),a.d(t,"d",(function(){return l}));var n=a(9),r=a(15);var o="00000000-0000-0000-0000-000000000000",i=864e5;"Bearer ".concat(localStorage.getItem("token"));function c(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===a?n:3&n|8).toString(16)}))}new(function(){function e(){Object(n.a)(this,e),this.cache={}}return Object(r.a)(e,[{key:"hashCode",value:function(e){var t=e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0),a="0."+(t=Math.abs(t)).toString();return parseFloat(a)}},{key:"generateColor",value:function(e){if(e in this.cache)return this.cache[e];var t="#"+((1<<24)*this.hashCode(e)|0).toString(16);return this.cache[e]=t,t}}]),e}());function l(){return Math.random().toString(36).substr(2,9)}},5305:function(e,t,a){e.exports=a(5565)},5343:function(e,t,a){},5344:function(e,t,a){},5513:function(e,t){},5565:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(12),i=a.n(o),c=(a(5310),a(5311),a(5312),a(297)),l=a.n(c),s=a(188),u=a(18);a(5627),a(144),a(5629),a(5628);s.a.use(u.a).init({interpolation:{escapeValue:!1},keySeparator:!1,lng:localStorage.getItem("language")||"en-US",fallbackLng:"en-US",resources:{"en-US":{translation:{"title/Crossnote":"Crossnote","search/placeholder":"Search Notes","account/Anonymous":"Anonymous","account/anonymous":"anonymous","general/go-back":"Go back","general/sending":"Sending","general/send":"Send","general/cancel":"Cancel","general/backed-up-at":"Backed up at","general/created-at":"Created at","general/modified-at":"Modified at","general/interacted-at":"Interacted at","general/date-created":"Date created","general/date-modified":"Date modified","general/date-interacted":"Date interacted","general/saved-at":"Saved at","general/loading":"Loading ...","general/loading-notifications":"Loading notifications ...","general/failed-to-set":"Failed to set","general/update":"Update","general/updated":"Updated","general/updating":"Updating","general/close":"Close","general/Note":"Note","general/notes":"notes","general/Settings":"Settings","general/Collaborators":"Collaborators","general/collaborators":"collaborators","general/Backups":"Backups","general/backups":"backups","general/Discussion":"Discussion","general/discussion":"discussion","general/Notifications":"Notifications","general/Username":"Username","general/Email":"Email","general/Password":"Password","general/confirm-password":"Confirm password","general/Continue":"Continue","general/enter-username":"Enter username","general/vickymd":"VickyMD","general/tags":"Tags","general/add-a-tag":"Add a tag","general/private":"Private","general/public":"Public","general/friends-only":"Friends only","general/anonymous":"Anonymous","general/onymous":"Onymous","general/Tag":"Tag","general/no-tags":"No tags","general/Untitled":"Untitled","general/untitled":"untitled","general/Unknown":"Unknown","general/unknown":"unknown","general/Agree":"Agree","general/Disagree":"Disagree","general/Print":"Print",Editor:"Editor",EDITOR:"EDITOR",Viewer:"Viewer",VIEWER:"VIEWER",Admin:"Admin",ADMIN:"ADMIN",ARCHIVED:"ARCHIVED","ATTACHED NOTES":"ATTACHED NOTES",DELETED:"DELETED",PINNED:"PINNED",OTHERS:"OTHERS","PUBLIC NOTES":"PUBLIC NOTES","FOLLOWINGS' NOTES":"FOLLOWINGS' NOTES","SHARED WITH ME":"SHARED WITH ME",BOOKMARKS:"BOOKMARKS","MY TAGS":"MY TAGS","general/enter-fullscreen-mode":"Enter fullscreen mode","general/enter-presentation-mode":"Enter presentation mode","general/math-preview":"Math Preview","general/this-note-is-empty":"This note is empty","general/no-notes-found":"No notes found","general/no-notifications-found":"No notifications found","general/clear-all":"Clear all","general/Save":"Save","general/Delete":"Delete","general/Follow":"Follow","general/Following":"Following","general/Unfollow":"Unfollow","general/my-notes":"My notes","general/public-notes":"Public notes","general/followings-notes":"Followings' notes","general/shared-with-me":"Shared with me","general/Bookmarks":"Bookmarks","general/Archive":"Archive","general/Trash":"Trash","general/new-note":"New note","general/profile-updated":"Profile updated","general/ID":"ID","general/Audio":"Audio","general/Video":"Video","general/source-url":"Source URL","general/sign-in":"Sign in","general/sign-up":"Sign up","general/Link":"Link","general/Upload":"Upload","general/clicks":"clicks","general/Processing":"Processing...","general/please-wait":"please wait...","general/Languages":"Languages","general/track":"Track","general/Publish":"Publish","general/empty":"empty","note/unarchive-note":"Unarchive note","note/archive-note":"Archive note","note/delete-forever":"Delete forever","note/delete-note":"Delete note","note/restore-note":"Restore note","note/report-note":"Report note","note/open-in-crossnote-website":"Open in Crossnote website","note-tags/send-suggestion-failure":"Failed to send suggestion","note-tags/suggestion-sent":"Suggestion sent","note-tags/suggest-a-tag-to-this-note":"Suggest a tag to this note","user-tags/follow-a-tag":"Follow a tag","chat-message/reply-to-this-user":"Reply to this user","chat-message/add-reaction-to-this-message":"Add reaction to this message","chat-message/edit-this-message":"Edit this message","chat-message/modified-message":"modified message","chat-panel/post-message-failure":"Failed to post message","chat-panel/unsubscribe-info":"Unsubscribing from this chat group will stop you from receiving notifications unless someone mentions you","chat-panel/subscribe-info":"Subscribing to this chat group will let you receive notifications whenever someone posts a message","notifications/refresh":"Refresh to see new notifications","settings/about-this-project":"About this project \ud83e\udd14","settings/uploading-cover-image":"Uploading cover image","settings/upload-image-failure":"Failed to upload image","settings/Cover":"Cover","settings/enter-cover-image-url":"Enter cover image URL","settings/upload-image":"Upload image","settings/Avatar":"Avatar","settings/enter-avatar-image-url":"Enter avatar image URL","settings/Name":"Name","settings/enter-name":"Enter your Name (this is not your username)","settings/editor-cursor-color":"Editor cursor color","settings/hello":"Hello, ","settings/world":"world!","settings/linked-with-github-account":"Linked with GitHub account","settings/link-with-github-account":"Link with GitHub account","settings/log-out":"Log out","preview/attach-a-note":"Attach a note","preview/crossnote-untitled":"Crossnote - Untitled","preview/edit-this-note":"Edit this note","profile-card/followings":"followings","profile-card/followers":"followers","profile-card/Followings":"Followings","profile-card/Followers":"Followers","profile-card/notes":"notes","profile-card/follow-user-failure":"Failed to follow user","profile-card/followed-user":"Followed user","profile-card/unfollow-user-failure":"Failed to unfollow user","profile-card/unfollowed-user":"Unfollowed user","tag-card/pin-to-my-notes-page":"Pin to my notes page","interaction-panel/show-attached-notes":"Show attached notes","interaction-panel/add-comment":"Add comment","interaction-panel/add-reaction":"Add reaction","editor/loading-your-note":"Loading your note...","editor/sync-failure":"Failed to sync... Please refresh your page","editor/saving":"Saving...","editor/save-failure":"Failed to save","editor/saved":"Saved","editor/update-note-failure":"Failed to update note","editor/placeholder":"#  Hi \ud83d\ude00 Type '/' for commands","editor/note-control/allow-readers-to-suggest-note-tags":"Allow readers to suggest note tags","editor/note-control/allow-readers-to-attach-notes-under-this-note":"Allow readers to attach notes under this note","editor/note-control/inherit-parent-note-collaborators-list":"Inherit parent note collaborators list","editor/note-control/note-visibility-hint":"All collaborators will be able to see this note","editor/note-control/allow-readers-to-attach-notes-unchecked":"Applies to you and collaborators that can edit and admin","editor/note-control/allow-readers-to-attach-notes-checked":"Applies to anyone that can view this note","editor/note-control/enter-parent-note-id":"Enter parent note ID","editor/note-control/attach-note-failure":"Failed to attach note","editor/note-control/unattach-note-failure":"Failed to unattach note","editor/collaborator-hint":" - note will be visible to them","editor/shareable-link-hint":"people with the link can view/edit this note with no need of login","editor/backups-control/create-backup":"Create backup","editor/backups-control/delete-this-backup":"Delete this backup","editor/backups-control/create-backup-failure":"Failed to create backup","editor/backups-control/backup-created":"Backup created","editor/backups-control/delete-backup-failure":"Failed to delete backup","editor/backups-control/backup-deleted":"Backup deleted","editor/backups-control/cloud-version":"Cloud version","editor/backups-control/backup-name":"Backup name","editor/collaborators-control/set-collaborator-role-failure":"Failed to set collaborator role","editor/collaborators-control/add-collaborator-failure":"Failed to add collaborator","editor/collaborators-control/collaborator-removed":"Collaborator removed","editor/collaborators-control/collaborator-added":"Collaborator added","editor/collaborators-control/can-view":"Can view","editor/collaborators-control/can-edit":"Can edit","editor/collaborators-control/can-administrate":"Can administrate","editor/toolbar/insert-image":"Insert image","editor/toolbar/upload-local-images":"Upload local images","editor/toolbar/capture-webpage":"Capture the whole webpage","editor/toolbar/insert-clock":"Insert clock","editor/toolbar/insert-emoji":"Insert emoji","editor/toolbar/insert-media":"Insert media","editor/toolbar/audio-url":"Audio URL","editor/toolbar/netease-music":"Netease Music","editor/toolbar/video-url":"Video URL","editor/toolbar/youtube":"Youtube","editor/toolbar/bilibili":"Bilibili","editor/toolbar/insert-slide":"Insert slide","editor/toolbar/insert-ocr":"Insert OCR","editor/toolbar/insert-kanban":"Insert Kanban","editor/toolbar/insert-abc-notation":"Insert ABC notation","editor/toolbar/insert-header-1":"Insert header 1","editor/toolbar/insert-header-2":"Insert header 2","editor/toolbar/insert-header-3":"Insert header 3","editor/toolbar/insert-header-4":"Insert header 4","editor/toolbar/insert-header-5":"Insert header 5","editor/toolbar/insert-header-6":"Insert header 6","editor/toolbar/bold":"Bold","editor/toolbar/italic":"Italic","editor/toolbar/strikethrough":"Strikethrough","editor/toolbar/insert-inline-code":"Insert inline code","editor/toolbar/insert-blockquote":"Insert blockquote","editor/toolbar/insert-unordered-list":"Insert unordered list","editor/toolbar/insert-ordered-list":"Insert ordered list","editor/toolbar/insert-link":"Insert link","editor/toolbar/insert-table":"Insert table","editor/note-control/tag-added":"Tag added","editor/note-control/tag-deleted":"Tag deleted","editor/note-control/set-note-visibility-failure":"Failed to set note visibility","editor/note-control/note-visibility-updated":"Note visibility updated","editor/note-control/set-author-visibility-failure":"Failed to set author visibility","editor/note-control/author-visibility-updated":"Author visibility updated","editor/note-control/editor-mode":"Editor mode","editor/note-control/source-code":"Source code","editor/note-control/preview":"Preview","editor/note-control/pin-preview":"Pin preview on the side","editor/note-control/display-modification-records":"Display modification records","editor/note-control/note-visibility":"Note visibility","editor/note-control/author-visibility":"Author visibility","editor/note-control/shareable-link":"Shareable link","editor/note-control/copy-to-clipboard":"Copy to clipboard","editor/note-control/link-to-preview":"Link to preview","editor/note-control/link-to-editor":"Link to editor","editor/note-control/attach-to-note":"Attach to note","editor/note-control/source-added":"URL added","editor/note-control/source-deleted":"URL deleted","editor/note-control/invalid-note-source":"Invalid URL","editor/note-control/add-note-source":"Add related URLs","editor/note-control/note-source-hint":"Notes on the same URL will be grouped together","editor/note-control/enter-note-source":"Enter URL","avatar-panel/this-note-is-private":"This note is private","avatar-panel/this-note-is-public":"This note is visible to public","avatar-panel/this-note-is-friends-only":"This note is only visible to friends","avatar-panel/you-are-anonymous":"You are anonymous","file-exporter/name":"File exporter","file-exporter/orientation":"Orientation","file-exporter/portrait":"portrait","file-exporter/landscape":"landscape","file-exporter/paper-size":"Paper size","file-exporter/unit":"Unit","file-exporter/margin-top":"Margin top","file-exporter/margin-bottom":"Margin bottom","file-exporter/margin-left":"Margin left","file-exporter/margin-right":"Margin right","utils/uploading-image":"Uploading image...","utils/upload-image-failure":"Failed to upload image","notification/replies-to-you-in":"Replies to you in","notification/'s-note":"'s note ","notification/added":"Added","notification/to-your-note":"to your note","notification/add-you-as":"Added you as","notification/of-note":"of note","notification/add-tag-failure":"Failed to add tag","notification/suggested-to-add-tag":"Suggested to add tag","notification/started-following-you":"Started following you","notification/bookmarked-your-note":"Bookmarked your note","github-oauth/wait":"Please wait ...","github-oauth/link-with-github-account-failure":"Failed to link with GitHub account","github-oauth/sign-in-with-github-account-failure":"Failed to sign in with GitHub account","github-oauth/first-time-sign-in":"It seems to be the first time you sign in with GitHub account","github-oauth/first-time-sign-in-small":"Please finish the registeration below","widget/autoplay":"autoplay","widget/controls":"controls","widget/loop":"loop","widget/muted":"muted","widget/crossnote.image/thanks_sm_ms":"Thanks sm.ms for offering free image hosting service.","widget/crossnote.audio/audio_element_fail":"Your browser does not support the audio element.","widget/crossnote.audio/source-url-placeholder":"Enter audio source URL here, then press 'Enter' to insert.","widget/crossnote.video/video_element_fail":"Your browser does not support the video element","widget/crossnote.bilibili/error_message":"Error: Only supported https://www.bilibili.com/video/av79126732 like URL","widget/crossnote.youtube/error_message":"Error: Only supported https://www.youtube.com/watch?v=MmB9b5njVbA like URL","widget/crossnote.auth/welcome":"Welcome to crossnote","widget/crossnote.auth/doesnt-have-account":"Doesn't have an account? Let's create one \ud83d\ude09!","widget/crossnote.auth/forgot_password":"Forgot your password \ud83d\ude23?","widget/crossnote.auth/failed_to_send_code":"Failed to send verification code","widget/crossnote.auth/verification_code_sent":"Verification code has been sent to ","widget/crossnote.auth/failed_to_reset_password":"Failed to reset password","widget/crossnote.auth/password_reset":"Your password has been reset","widget/crossnote.auth/password-mismatch":"Passwords mismatch","widget/crossnote.auth/hello":"Hello, ","widget/crossnote.auth/enter-the-verification-code":"Enter the verification code","widget/crossnote.auth/get-code":"Get code","widget/crossnote.auth/sign-in-with-github-account":"Sign in with GitHub account","widget/crossnote.auth/already-have-an-account":"Already have an account?","widget/crossnote.auth/reset-password":"Reset password","widget/crossnote.auth/Or":"Or","widget/crossnote.bilibili/Bilibili":"Bilibili","widget/crossnote.bilibili/bilibili-video-url":"Bilibili video URL","widget/crossnote.bilibili/url-placeholder":"Enter the Bilibili video URL here, then press 'Enter' to insert.","widget/crossnote.image/image-helper":"Image helper","widget/crossnote.image/set-as-cover-image-in-note-card":"Set as cover image in note card","widget/crossnote.image/image-url-placeholder":"Enter image URL here, then press 'Enter' to insert.","widget/crossnote.image/click-here-to-browse-image-file":"Click here to browse image file","widget/crossnote.neteasemusic/song-id-placeholder":"Enter Netease Music song number ID.","widget/crossnote.video/video-url-placeholder":"Enter video source URL here, then press 'Enter' to insert.","widget/crossnote.video/poster-url":"Poster URL (optional)","widget/crossnote.video/poster-url-placeholder":"Enter poster URL here.","widget/crossnote.youtube/youtube-video-url":"Youtube video URL","widget/crossnote.youtube/youtube-video-url-placeholder":"Enter the Youtube video URL here, then press 'Enter' to insert.","widget/crossnote.ocr/ocr":"OCR - Optical character recognition","widget/crossnote.ocr/local-image":"Local image","widget/crossnote.ocr/recognize-text-in-languages":"Recognize text in languages","widget/crossnote.ocr/start-ocr":"Start OCR","widget/crossnote.ocr/extra-settings":"Extra settings","widget/crossnote.ocr/grayscale":"Grayscale","widget/crossnote.kanban/add-column":"Add new column","tesseract/loading tesseract core":"loading tesseract core","tesseract/initializing tesseract":"initializing tesseract","tesseract/initialized tesseract":"initialized tesseract","tesseract/loading language traineddata":"loading language traineddata","tesseract/loaded language traineddata":"loaded language traineddata","tesseract/initializing api":"initializing api","tesseract/initialized api":"initialized api","tesseract/recognizing text":"recognizing text"}}}});s.a;a(5343),a(5344);var d,m=a(5),p=a(28),b=a(5607),f=a(5614),g=a(5625),h=a(72),v=a(319),w=a(189),E=a(5619),O=a(5630),k=a(5633),j=a(5597),x=a(5635),y=a(20),N=a(4),C=a(11),S=a(1),I=a.n(S),P=a(2),T=a(16),D=a(301),A=a(21),L=a(40),B=a.n(L),R=a(51);!function(e){e.Notes="Notes",e.Today="Today",e.Todo="Todo",e.Tagged="Tagged",e.Untagged="Untagged",e.Directory="Directory",e.Tag="Tag",e.Conflicted="Conflicted"}(d||(d={}));var F=Object(D.a)((function(e){Object(u.b)().t;var t=e.crossnote,a=Object(n.useState)([]),r=Object(m.a)(a,2),o=r[0],i=r[1],c=Object(n.useState)(null),l=Object(m.a)(c,2),s=l[0],p=l[1],b=Object(n.useState)([]),f=Object(m.a)(b,2),g=f[0],h=f[1],v=Object(n.useState)({name:".",path:".",children:[]}),w=Object(m.a)(v,2),E=w[0],O=w[1],k=Object(n.useState)({name:".",path:".",children:[]}),j=Object(m.a)(k,2),x=j[0],y=j[1],N=Object(n.useState)([]),C=Object(m.a)(N,2),S=C[0],D=C[1],L=Object(n.useState)(null),F=Object(m.a)(L,2),U=F[0],W=F[1],M=Object(n.useState)(!0),_=Object(m.a)(M,2),G=_[0],V=_[1],H=Object(n.useState)({type:d.Notes}),z=Object(m.a)(H,2),$=z[0],K=z[1],J=Object(n.useState)(!1),Y=Object(m.a)(J,2),q=Y[0],X=Y[1],Q=Object(n.useState)(!1),Z=Object(m.a)(Q,2),ee=Z[0],te=Z[1],ae=Object(n.useState)(!1),ne=Object(m.a)(ae,2),re=ne[0],oe=ne[1],ie=Object(n.useState)(!1),ce=Object(m.a)(ie,2),le=ce[0],se=ce[1],ue=Object(n.useCallback)((function(e,a,n){t.writeNote(e.notebook,e.filePath,a,e.config).then((function(r){e.config=r,n&&t.getStatus(e).then((function(e){n(e)})),D((function(t){var n=t.findIndex((function(t){return t.filePath===e.filePath}));return n>=0&&(t[n].markdown=a),Object(T.a)(t)}))}))}),[t]),de=Object(n.useCallback)((function(e){t.deleteNote(s,e.filePath),h((function(a){var n=a.filter((function(t){return t.filePath!==e.filePath}));return n.length!==a.length&&W(n[0]),t.getNotebookDirectoriesFromNotes(n).then((function(e){O(e)})),y(t.getNotebookTagNodeFromNotes(n)),n})),se(!1)}),[t,s]),me=Object(n.useCallback)((function(e,a){Object(P.a)(I.a.mark((function n(){var r;return I.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.changeNoteFilePath(s,e,a);case 3:return r=g.map((function(t){return t.filePath===e.filePath?(t.filePath=a,t.config.modifiedAt=new Date,t):t})),h(r),n.t0=O,n.next=8,t.getNotebookDirectoriesFromNotes(r);case 8:n.t1=n.sent,(0,n.t0)(n.t1),y(t.getNotebookTagNodeFromNotes(r)),n.next=16;break;case 13:n.prev=13,n.t2=n.catch(0),new B.a({type:"error",text:"Failed to change file path",layout:"topRight",theme:"relax",timeout:5e3}).show();case 16:case"end":return n.stop()}}),n,null,[[0,13]])})))()}),[s,t,g]),pe=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(P.a)(I.a.mark((function a(){var n,r,o,i;return I.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e||(e=Object(R.d)()),e.endsWith(".md")||(e+=".md"),r=[],$.type===d.Notes||$.type===d.Today||$.type===d.Todo||$.type===d.Tagged||$.type===d.Untagged?n=e:$.type===d.Tag?(n=e,r=[$.path]):n=A.relative(s.dir,A.resolve(s.dir,$.path,e)),o={id:"",tags:r,modifiedAt:new Date,createdAt:new Date},a.next=7,t.writeNote(s,n,"",o);case 7:i={notebook:s,filePath:n,title:"",markdown:"",config:o},h((function(e){return[i].concat(Object(T.a)(e))})),W(i),se(!0);case 11:case"end":return a.stop()}}),a)})))()}),[s,t,$]),be=Object(n.useCallback)(function(){var e=Object(P.a)(I.a.mark((function e(a,n,r,o,c,l,s){var u;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X(!0),e.prev=1,e.next=4,t.addNotebook({name:a,gitURL:n,branch:r,username:o,password:c,corsProxy:s,rememberCredentials:l});case 4:u=e.sent,i((function(e){return[u].concat(Object(T.a)(e))})),X(!1),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),X(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,a,n,r,o,i,c){return e.apply(this,arguments)}}(),[t]),fe=Object(n.useCallback)(function(){var e=Object(P.a)(I.a.mark((function e(a){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.updateNotebook(a);case 5:i((function(e){return Object(T.a)(e)})),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[t]),ge=Object(n.useCallback)(function(){var e=Object(P.a)(I.a.mark((function e(a){var n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.deleteNotebook(a._id);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:n=null,i((function(e){return e.filter((function(e){return n||e._id===a._id||(n=e),e._id!==a._id}))})),p(n);case 12:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),[t]),he=Object(n.useCallback)(function(){var e=Object(P.a)(I.a.mark((function e(a){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return te(!0),e.prev=3,e.next=6,t.pushNotebook(a);case 6:te(!1),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),te(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),[t]),ve=Object(n.useCallback)(function(){var e=Object(P.a)(I.a.mark((function e(a){var n,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return oe(!0),e.prev=3,e.next=6,t.pullNotebook(a);case 6:return oe(!1),e.next=9,t.listNotes({notebook:a.notebook,dir:"./",includeSubdirectories:!0});case 9:return n=e.sent.sort((function(e,t){return t.config.modifiedAt.getTime()-e.config.modifiedAt.getTime()})),h(n),e.t0=O,e.next=14,t.getNotebookDirectoriesFromNotes(n);case 14:e.t1=e.sent,(0,e.t0)(e.t1),y(t.getNotebookTagNodeFromNotes(n)),r=n.find((function(e){return e.filePath===U.filePath})),W(r||n[0]),e.next=25;break;case 21:throw e.prev=21,e.t2=e.catch(3),oe(!1),e.t2;case 25:case"end":return e.stop()}}),e,null,[[3,21]])})));return function(t){return e.apply(this,arguments)}}(),[t,U]),we=Object(n.useCallback)(function(){var e=Object(P.a)(I.a.mark((function e(a){var n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.checkoutNote(a);case 4:(n=e.sent)?(h((function(e){return e.map((function(e){return e.filePath===n.filePath?n:e}))})),D((function(e){return e.map((function(e){return e.filePath===n.filePath?n:e}))})),W(n)):(h((function(e){var n=e.filter((function(e){return e.filePath!==a.filePath}));return t.getNotebookDirectoriesFromNotes(n).then((function(e){O(e)})),y(t.getNotebookTagNodeFromNotes(n)),n})),D((function(e){var t=e.filter((function(e){return e.filePath!==a.filePath}));return W(t[0]),t})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[t]),Ee=Object(n.useCallback)((function(){t&&y(t.getNotebookTagNodeFromNotes(g))}),[g,t]);Object(n.useEffect)((function(){t&&Object(P.a)(I.a.mark((function e(){var a,n,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.listNotebooks();case 2:if(a=e.sent,n=null,!a.length){e.next=12;break}i(a),r=localStorage.getItem("selectedNotebookID"),(n=a.find((function(e){return e._id===r})))||(n=a[0]),p(n),e.next=17;break;case 12:return e.next=14,t.addNotebook({name:"Unamed",corsProxy:"https://cors.isomorphic-git.org",gitURL:""});case 14:n=e.sent,i([n]),p(n);case 17:case"end":return e.stop()}}),e)})))()}),[t]),Object(n.useEffect)((function(){t&&Object(P.a)(I.a.mark((function e(){var a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.listNotes({notebook:s,dir:"./",includeSubdirectories:!0});case 2:return a=e.sent.sort((function(e,t){return t.config.modifiedAt.getTime()-e.config.modifiedAt.getTime()})),h(a),e.t0=O,e.next=7,t.getNotebookDirectoriesFromNotes(a);case 7:e.t1=e.sent,(0,e.t0)(e.t1),y(t.getNotebookTagNodeFromNotes(a)),W(a[0]);case 11:case"end":return e.stop()}}),e)})))()}),[t,s]),Object(n.useEffect)((function(){t&&s&&K({type:d.Notes})}),[t,s]),Object(n.useEffect)((function(){if(t&&s&&g){if(g.length&&g[0].notebook._id!==s._id)return;var e=[];e=$.type===d.Notes?Object(T.a)(g):$.type===d.Todo?g.filter((function(e){return e.markdown.match(/(\*|-|\d+\.)\s\[(\s+|x|X)\]\s/gm)})):$.type===d.Today?g.filter((function(e){return Date.now()-e.config.modifiedAt.getTime()<=R.a})):$.type===d.Tagged?g.filter((function(e){return e.config.tags.length>0})):$.type===d.Untagged?g.filter((function(e){return 0===e.config.tags.length})):$.type===d.Tag?g.filter((function(e){return e.config.tags.find((function(e){return 0===(e.toLocaleLowerCase()+"/").indexOf($.path+"/")}))})):$.type===d.Conflicted?g.filter((function(e){return t.markdownHasConflicts(e.markdown)})):G?g.filter((function(e){return 0===e.filePath.indexOf($.path+"/")})):g.filter((function(e){return A.dirname(e.filePath)===$.path})),D(e),U||W(e[0])}}),[$,t,s,G,U,g]);var Oe=Object(n.useCallback)((function(e){localStorage.setItem("selectedNotebookID",e._id),p(e)}),[p]);return{crossnote:t,notebooks:o,selectedNotebook:s,setSelectedNotebook:Oe,notes:S,selectedNote:U,setSelectedNote:W,updateNoteMarkdown:ue,createNewNote:pe,selectedSection:$,setSelectedSection:K,includeSubdirectories:G,setIncludeSubdirectories:V,deleteNote:de,changeNoteFilePath:me,notebookDirectories:E,notebookTagNode:x,addNotebook:be,isAddingNotebook:q,isPushingNotebook:ee,isPullingNotebook:re,updateNotebook:fe,deleteNotebook:ge,pushNotebook:he,pullNotebook:ve,checkoutNote:we,displayMobileEditor:le,setDisplayMobileEditor:se,updateNotebookTagNode:Ee}})),U=a(5612),W=a(5572),M=a(152),_=a(116),G=a(5599),V=Object(j.a)((function(e){return Object(x.a)({noteCard:{width:"100%",display:"flex",flexDirection:"row",alignItems:"flex-start",padding:e.spacing(2,.5,0),textAlign:"left",cursor:"default"},selected:{borderLeft:"4px solid ".concat(e.palette.primary.main)},unselected:{borderLeft:"4px solid rgba(0, 0, 0, 0)"},leftPanel:{width:"48px",paddingLeft:e.spacing(.5)},duration:{color:e.palette.text.secondary},rightPanel:{width:"calc(100% - 48px)",borderBottom:"1px solid #ededed"},header:{marginBottom:e.spacing(1),wordBreak:"break-all"},summary:{color:e.palette.text.secondary,marginBottom:e.spacing(1),paddingRight:e.spacing(2),display:"-webkit-box",lineHeight:"1.3rem !important",textOverflow:"ellipsis !important",overflow:"hidden !important",maxWidth:"100%",maxHeight:"2.6rem","-webkit-line-clamp":2,"-webkit-box-orient":"vertical",wordBreak:"break-all"},filePath:{},images:{display:"flex",width:"100%",overflow:"hidden",position:"relative",marginBottom:e.spacing(1)},imagesWrapper:{display:"flex",alignItems:"center",flexDirection:"row"},image:{width:"128px",height:"80px",marginRight:e.spacing(1),position:"relative",backgroundSize:"cover",backgroundPosition:"center",display:"block",borderRadius:"6px"}})}));function H(e){var t=V(e),a=e.note,o=F.useContainer(),i=Object(n.useState)(""),c=Object(m.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(null),p=Object(m.a)(d,2),b=p[0],f=p[1],v=Object(n.useState)([]),w=Object(m.a)(v,2),E=w[0],O=w[1],k=Object(n.useState)(""),j=Object(m.a)(k,2),x=j[0],y=j[1],C=Object(u.b)().t,S=Object(G.a)(a.config.modifiedAt,Date.now()).replace(/\sseconds?/,"s").replace(/\sminutes?/,"m").replace(/\shours?/,"h").replace(/\sdays?/,"d").replace(/\sweeks?/,"w").replace(/\smonths?/,"mo").replace(/\syears?/,"y");return Object(n.useEffect)((function(){s(Object(_.b)(a.markdown)),Object(_.a)(a.markdown.trim()||C("general/this-note-is-empty")).then((function(e){f(e);var t=e.images.filter((function(e){return e.startsWith("https://")})).slice(0,3);O(t)})).catch((function(e){}))}),[a.markdown,C]),Object(n.useEffect)((function(){o.crossnote.getStatus(a).then((function(e){y(e)}))}),[a.markdown,a.config.modifiedAt,a,o.crossnote]),r.a.createElement(M.a,{className:Object(N.a)(t.noteCard,o.selectedNote&&o.selectedNote.filePath===a.filePath?t.selected:t.unselected),onClick:function(){o.setSelectedNote(a),o.setDisplayMobileEditor(!0)}},r.a.createElement(g.a,{className:Object(N.a)(t.leftPanel)},r.a.createElement(h.a,{className:Object(N.a)(t.duration)},S)),r.a.createElement(g.a,{className:Object(N.a)(t.rightPanel)},l&&r.a.createElement(h.a,{style:{fontWeight:"bold"},variant:"body1",className:Object(N.a)(t.header)},l),b&&b.summary.trim().length>0&&r.a.createElement(h.a,{className:Object(N.a)(t.summary)},b&&b.summary),E.length&&r.a.createElement(g.a,{className:Object(N.a)(t.images)},r.a.createElement(g.a,{className:Object(N.a)(t.imagesWrapper)},E.map((function(e){return r.a.createElement("div",{key:e,className:Object(N.a)(t.image),style:{backgroundImage:"url(".concat(e,")")}})})))),r.a.createElement(h.a,{variant:"caption",className:Object(N.a)(t.filePath)},a.filePath+" - "+x)))}var z=a(5601),$=a(5603),K=a(5604),J=a(5626),Y=a(5636),q=a(5608),X=a(5609),Q=a(5610),Z=a(5611),ee=a(5570);function te(e){var t=F.useContainer(),a=Object(n.useState)(""),o=Object(m.a)(a,2),i=o[0],c=o[1],l=Object(n.useState)(!1),s=Object(m.a)(l,2),u=s[0],d=s[1],p=Object(n.useState)(""),b=Object(m.a)(p,2),f=b[0],v=b[1],w=Object(n.useState)(""),E=Object(m.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(""),x=Object(m.a)(j,2),y=x[0],N=x[1],S=Object(n.useState)(""),T=Object(m.a)(S,2),D=T[0],A=T[1],L=Object(n.useState)("https://cors.isomorphic-git.org"),B=Object(m.a)(L,2),R=B[0],U=B[1],W=Object(n.useState)(3),M=Object(m.a)(W,2),_=M[0],G=M[1];Object(n.useEffect)((function(){var t=e.notebook;t&&(c(t.name),v(t.gitURL),k(t.gitBranch||"master"),N(t.gitUsername),A(t.gitPassword),U(t.gitCorsProxy))}),[e.notebook]);var V=Object(n.useCallback)(Object(P.a)(I.a.mark((function a(){var n;return I.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.notebook){a.next=4;break}return e.onClose(),a.abrupt("return");case 4:return n.name=i.trim(),n.gitURL=f.trim(),n.gitBranch=O.trim(),n.gitUsername=y.trim(),n.gitPassword=D,n.gitCorsProxy=R.trim(),a.prev=10,a.next=13,t.updateNotebook(n);case 13:a.next=17;break;case 15:a.prev=15,a.t0=a.catch(10);case 17:e.onClose();case 18:case"end":return a.stop()}}),a,null,[[10,15]])}))),[e,e.notebook,i,f,O,y,D,R]),H=Object(n.useCallback)(Object(P.a)(I.a.mark((function a(){var n;return I.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.notebook,a.prev=1,a.next=4,t.deleteNotebook(n);case 4:a.next=8;break;case 6:a.prev=6,a.t0=a.catch(1);case 8:e.onClose();case 9:case"end":return a.stop()}}),a,null,[[1,6]])}))),[e.notebook]);return Object(n.useEffect)((function(){G(3)}),[e.notebook]),r.a.createElement(z.a,{open:e.open,onClose:e.onClose},r.a.createElement($.a,null,"Configure a notebook"),r.a.createElement(K.a,null,r.a.createElement(J.a,{label:"Notebook name",value:i,fullWidth:!0,onChange:function(e){c(e.target.value)},style:{marginBottom:"16px"}}),r.a.createElement(Y.a,{elevation:2,expanded:u,onChange:function(){return d(!u)}},r.a.createElement(q.a,{expandIcon:r.a.createElement(C.c,null)},r.a.createElement(h.a,null,"Git repository (optional)")),r.a.createElement(X.a,null,r.a.createElement(g.a,null,r.a.createElement(J.a,{label:"url",placeholder:"https://abc/def.git",disabled:!0,fullWidth:!0,value:f,onChange:function(e){return v(e.target.value)}}),r.a.createElement(J.a,{label:"branch",placeholder:"master",disabled:!0,fullWidth:!0,value:O,onChange:function(e){return k(e.target.value)}}),r.a.createElement(J.a,{label:"username (optional)",placeholder:"username (optional)",fullWidth:!0,value:y,onChange:function(e){return N(e.target.value)}}),r.a.createElement(J.a,{label:"password (optional)",placeholder:"password (optional)",type:"password",fullWidth:!0,value:D,onChange:function(e){return A(e.target.value)}}),r.a.createElement(J.a,{label:"cors proxy",placeholder:"https://cors.isomorphic-git.org",fullWidth:!0,value:R,onChange:function(e){return U(e.target.value)}}),r.a.createElement(Q.a,{href:"https://github.com/isomorphic-git/isomorphic-git#cors-support",target:"_blank"},"Why we need cors proxy?"))))),r.a.createElement(Z.a,null,r.a.createElement(ee.a,{variant:"contained",color:"secondary",disabled:!_,onClick:function(){1===_?(H(),G(_-1)):G(_-1)}},"Delete"+(_<3?" ".concat(_):"")),r.a.createElement(ee.a,{variant:"contained",color:"primary",onClick:V},"Save"),r.a.createElement(ee.a,{onClick:e.onClose},"Cancel")))}var ae=Object(j.a)((function(e){return Object(x.a)({notes:{display:"flex",flexDirection:"column",height:"100%"},topPanel:{padding:e.spacing(1)},row:{display:"flex",alignItems:"center"},sectionName:{marginLeft:e.spacing(1)},search:Object(p.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(y.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(y.b)(e.palette.common.white,.25)},marginRight:0,marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{}),searchIcon:{width:e.spacing(7),color:"rgba(0, 0, 0, 0.54)",height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",border:"1px solid #bbb",borderRadius:"4px"},inputInput:Object(p.a)({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{}),notesList:{flex:"1",overflowY:"auto",paddingBottom:e.spacing(12)}})}));function ne(e){var t=ae(e),a=Object(u.b)().t,o=F.useContainer(),i=Object(n.useState)(""),c=Object(m.a)(i,2),l=c[0],s=c[1],p=Object(n.useState)(!1),b=Object(m.a)(p,2),f=b[0],w=b[1];return r.a.createElement(g.a,{className:Object(N.a)(t.notes)},r.a.createElement(U.a,{className:Object(N.a)(t.topPanel)},r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement(O.a,{smUp:!0,implementation:"css"},r.a.createElement(v.a,{onClick:e.toggleDrawer},r.a.createElement(C.q,null))),r.a.createElement("div",{className:t.search},r.a.createElement("div",{className:t.searchIcon},r.a.createElement(C.p,null)),r.a.createElement(W.a,{placeholder:a("search/placeholder"),classes:{root:t.inputRoot,input:t.inputInput},value:l,inputProps:{"aria-label":"search"},onChange:function(e){return s(e.target.value)}})),r.a.createElement(v.a,{onClick:function(){o.createNewNote()}},r.a.createElement(C.l,null))),r.a.createElement(g.a,{className:Object(N.a)(t.row),style:{justifyContent:"space-between"}},o.selectedSection.type===d.Notes?r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"notes"},"\ud83d\udcd2"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)},o.selectedNotebook&&o.selectedNotebook.name)):o.selectedSection.type===d.Today?r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"today-notes"},"\ud83d\uddd3"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)}," today")):o.selectedSection.type===d.Todo?r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"todo-notes"},"\u2611\ufe0f"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)}," todo")):o.selectedSection.type===d.Tagged?r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"tagged-notes"},"\ud83c\udff7\ufe0f"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)}," tagged")):o.selectedSection.type===d.Untagged?r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"untagged-notes"},"\ud83c\ude1a"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)}," untagged")):o.selectedSection.type===d.Tag?r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"tag"},"\ud83c\udff7\ufe0f"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)},o.selectedSection.path)):o.selectedSection.type===d.Conflicted?r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"conflicted-notes"},"\u26a0\ufe0f"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)}," conflicted")):o.selectedSection.type===d.Directory&&r.a.createElement(g.a,{className:Object(N.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83d\udcc1"),r.a.createElement(h.a,{className:Object(N.a)(t.sectionName)},o.selectedSection.path)),o.selectedSection.type===d.Notes&&r.a.createElement(v.a,{onClick:function(){return w(!0)}},r.a.createElement(C.w,null)))),r.a.createElement(te,{open:f,onClose:function(){return w(!1)},notebook:o.selectedNotebook}),r.a.createElement(g.a,{className:Object(N.a)(t.notesList)},o.notes.map((function(e){if(!l.trim().length)return r.a.createElement(H,{key:"note-card-"+e.filePath,note:e});var t=new RegExp("("+l.trim().split(/\s+/g).join("|")+")","i");return e.title.match(t)||e.markdown.match(t)||e.filePath.match(t)?r.a.createElement(H,{key:"note-card-"+e.filePath,note:e}):void 0}))))}var re=a(5613),oe=a(5634),ie=a(5606),ce=a(5615),le=a(115);function se(e){var t=F.useContainer(),a=e.notebook,o=Object(n.useState)(localStorage.getItem("authorName")||"anonymous"),i=Object(m.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(localStorage.getItem("authorEmail")||"anonymous@crossnote.app"),d=Object(m.a)(s,2),p=d[0],b=d[1],f=Object(n.useState)(a.gitUsername),v=Object(m.a)(f,2),w=v[0],E=v[1],O=Object(n.useState)(a.gitPassword),k=Object(m.a)(O,2),j=k[0],x=k[1],y=Object(n.useState)("doc: Updated docs"),N=Object(m.a)(y,2),C=N[0],S=N[1],I=Object(u.b)().t,P=Object(n.useCallback)((function(){t.pushNotebook({notebook:a,authorName:c,authorEmail:p,username:w,password:j,message:C,onAuthFailure:function(){new B.a({type:"error",text:"Authentication failed",layout:"topRight",theme:"relax",timeout:5e3}).show()}}).then((function(){e.onClose(),new B.a({type:"success",text:"Notebook pushed",layout:"topRight",theme:"relax",timeout:2e3}).show()})).catch((function(t){e.onClose(),new B.a({type:"error",text:t.message.match(/^error\//)?I(t.message):"Failed to push notebook",layout:"topRight",theme:"relax",timeout:2e3}).show()}))}),[p,c,w,j,a,C,e]);return Object(n.useEffect)((function(){localStorage.setItem("authorName",c)}),[c]),Object(n.useEffect)((function(){localStorage.setItem("authorEmail",p)}),[p]),Object(n.useEffect)((function(){E(a.gitUsername)}),[a.gitUsername,e.open]),Object(n.useEffect)((function(){x(a.gitPassword)}),[a.gitPassword,e.open]),r.a.createElement(z.a,{open:e.open,onClose:function(){t.isPushingNotebook||e.onClose()}},r.a.createElement($.a,null,"Push notebook ".concat(a.name," to git repository"),r.a.createElement(g.a,null,r.a.createElement(h.a,{variant:"caption"},a.gitURL+":"+a.gitBranch))),r.a.createElement(K.a,null,r.a.createElement(J.a,{label:"Author name",fullWidth:!0,value:c,onChange:function(e){return l(e.target.value)}}),r.a.createElement(J.a,{label:"Author email",fullWidth:!0,value:p,onChange:function(e){return b(e.target.value)}}),r.a.createElement(J.a,{label:"Commit message",fullWidth:!0,value:C,onChange:function(e){return S(e.target.value)}}),r.a.createElement(J.a,{label:"username",placeholder:"username",fullWidth:!0,value:w,onChange:function(e){return E(e.target.value)}}),r.a.createElement(J.a,{label:"password",placeholder:"password",type:"password",fullWidth:!0,value:j,onChange:function(e){return x(e.target.value)}})),r.a.createElement(Z.a,null,r.a.createElement(ee.a,{variant:"contained",color:"primary",disabled:t.isPushingNotebook,onClick:P},t.isPushingNotebook?"Pushing...":"Push"),r.a.createElement(ee.a,{onClick:e.onClose},"Cancel")))}var ue,de=a(5632),me=a(166),pe=Object(j.a)((function(e){return Object(x.a)({editorPanel:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},topPanel:{position:"relative",padding:e.spacing(.5,1),display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #eee",overflow:"auto"},bottomPanel:{position:"relative",padding:e.spacing(.5,1),display:"flex",alignItems:"center",justifyContent:"space-between",borderTop:"1px solid #eee"},controlBtn:{padding:e.spacing(.5,0),color:e.palette.text.secondary},controlBtnSelected:{color:e.palette.primary.main},row:{display:"flex",flexDirection:"row",alignItems:"center"},cursorPositionInfo:{zIndex:150},editorWrapper:Object(p.a)({flex:1,overflow:"auto","& .CodeMirror-gutters":{display:"none"},"& .CodeMirror-code":{width:"100%"},"& .CodeMirror":Object(p.a)({height:"100%",padding:e.spacing(0,2)},e.breakpoints.down("sm"),{padding:e.spacing(0)}),"& .CodeMirror-vscrollbar":{display:"none !important"}},e.breakpoints.down("sm"),{padding:e.spacing(1)}),fullScreen:{position:"fixed",width:"100%",height:"100%",left:"0",top:"0",zIndex:2e3,overflow:"auto"},editor:{width:"100%",height:"100%"},preview:Object(p.a)({position:"relative",left:"0",top:"0",width:"100%",height:"100%",border:"none",overflow:"auto !important",padding:e.spacing(2),zIndex:99},e.breakpoints.down("sm"),{padding:e.spacing(1)}),backBtn:Object(p.a)({marginRight:"8px"},e.breakpoints.up("sm"),{display:"none"}),menuItemOverride:{cursor:"default",padding:"0 0 0 ".concat(e.spacing(2),"px"),"&:hover":{backgroundColor:"inherit"}},menuItemTextField:{paddingRight:e.spacing(2)}})}));function be(e){var t=e.note,a=pe(e),o=Object(n.useState)(null),i=Object(m.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(null),d=Object(m.a)(s,2),p=d[0],w=d[1],E=Object(n.useState)({line:0,ch:0}),O=Object(m.a)(E,2),k=O[0],j=O[1],x=Object(n.useState)(!1),y=Object(m.a)(x,2),S=y[0],D=y[1],A=Object(n.useState)(!1),L=Object(m.a)(A,2),R=L[0],U=L[1],W=Object(n.useState)(!1),M=Object(m.a)(W,2),_=M[0],G=M[1],V=Object(n.useState)(t.filePath),H=Object(m.a)(V,2),Y=H[0],q=H[1],X=Object(n.useState)(ue.VickyMD),Q=Object(m.a)(X,2),te=Q[0],ae=Q[1],ne=Object(n.useState)(null),be=Object(m.a)(ne,2),fe=be[0],ge=be[1],he=Object(n.useState)(""),ve=Object(m.a)(he,2),we=ve[0],Ee=ve[1],Oe=Object(n.useState)(!1),ke=Object(m.a)(Oe,2),je=ke[0],xe=ke[1],ye=Object(n.useState)(null),Ne=Object(m.a)(ye,2),Ce=Ne[0],Se=Ne[1],Ie=Object(n.useState)(""),Pe=Object(m.a)(Ie,2),Te=Pe[0],De=Pe[1],Ae=Object(n.useState)([]),Le=Object(m.a)(Ae,2),Be=Le[0],Re=Le[1],Fe=F.useContainer(),Ue=Object(u.b)().t,We=Object(n.useCallback)((function(){U(!1),q(t.filePath)}),[t]),Me=Object(n.useCallback)((function(e){Object(P.a)(I.a.mark((function a(){return I.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if((e=e.replace(/^\/+/,"")).endsWith(".md")||(e+=".md"),t.filePath===e){a.next=5;break}return a.next=5,Fe.changeNoteFilePath(t,e);case 5:q(e),U(!1);case 7:case"end":return a.stop()}}),a)})))()}),[t,We]),_e=Object(n.useCallback)((function(){new B.a({type:"info",text:"Pulling notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),Fe.pullNotebook({notebook:t.notebook,onAuthFailure:function(){new B.a({type:"error",text:"Authentication failed",layout:"topRight",theme:"relax",timeout:5e3}).show()}}).then((function(){new B.a({type:"success",text:"Notebook pulled",layout:"topRight",theme:"relax",timeout:2e3}).show()})).catch((function(e){console.log(e),new B.a({type:"error",text:"Failed to pull notebook",layout:"topRight",theme:"relax",timeout:2e3}).show()}))}),[t]),Ge=Object(n.useCallback)((function(){Fe.checkoutNote(t)}),[t]),Ve=Object(n.useCallback)((function(){var e=Te.trim()||"";t&&e.length&&p&&(e=e.replace(/\s+/g," ").split("/").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).join("/"),Re((function(a){var n=a.indexOf(e)>=0?Object(T.a)(a):[e].concat(Object(T.a)(a));return t.config.tags=n.sort((function(e,t){return e.localeCompare(t)})),Fe.updateNoteMarkdown(t,p.getValue(),(function(e){Ee(e)})),Fe.updateNotebookTagNode(),n})),De(""))}),[Te,t,p]),He=Object(n.useCallback)((function(e){Re((function(a){var n=a.filter((function(t){return t!==e}));return t.config.tags=n.sort((function(e,t){return e.localeCompare(t)})),Fe.updateNoteMarkdown(t,p.getValue(),(function(e){Ee(e)})),Fe.updateNotebookTagNode(),n}))}),[t,p]);return Object(n.useEffect)((function(){q(t.filePath)}),[t.filePath]),Object(n.useEffect)((function(){Fe.crossnote.getStatus(t).then((function(e){Ee(e)}))}),[t,Fe.crossnote]),Object(n.useEffect)((function(){Fe.displayMobileEditor&&p&&p.setValue(t.markdown||"")}),[Fe.displayMobileEditor,p,t]),Object(n.useEffect)((function(){if(c&&!p){var e=me.fromTextArea(c,{mode:{name:"hypermd",hashtag:!0},inputStyle:"textarea"});e.setOption("lineNumbers",!1),e.setOption("foldGutter",!1),e.setValue(t.markdown||""),e.on("cursorActivity",(function(e){var t=e.getCursor();t&&j({line:t.line,ch:t.ch})})),w(e)}}),[c,t,p]),Object(n.useEffect)((function(){if(p&&t){Re(t.config.tags),p.setValue(t.markdown);var e=function(){var e=p.getValue();Fe.updateNoteMarkdown(t,e,(function(e){Ee(e),Re(t.config.tags)}))};return p.on("changes",e),function(){p.off("changes",e)}}}),[p,t]),Object(n.useEffect)((function(){p&&(te===ue.VickyMD?(me.switchToHyperMD(p),p.getWrapperElement().style.display="block"):te===ue.SourceCode?(me.switchToNormal(p),p.getWrapperElement().style.display="block"):p.getWrapperElement().style.display="none")}),[te,p,t]),Object(n.useEffect)((function(){te===ue.Preview&&p&&fe&&(Object(le.renderPreview)(fe,p.getValue()),fe.childElementCount&&"IFRAME"===fe.children[0].tagName.toUpperCase()?(fe.style.maxWidth="100%",fe.style.height="100%",fe.style.overflow="hidden !important"):(fe.style.height="auto",fe.style.overflow="hidden !important"))}),[te,p,fe,t]),Object(n.useEffect)((function(){if(p){var e=function(e,t){if(1===t.text.length&&"/"===t.text[0]&&p.showHint({closeOnUnfocus:!1,completeSingle:!1,hint:function(){var e=p.getCursor(),t=p.getTokenAt(e),a=t.string.lastIndexOf("/"),n=e.line,r=e.ch,o=t.string.slice(a+1,r),i=[{text:"# ",displayText:"/h1 - ".concat(Ue("editor/toolbar/insert-header-1"))},{text:"## ",displayText:"/h2 - ".concat(Ue("editor/toolbar/insert-header-2"))},{text:"### ",displayText:"/h3 - ".concat(Ue("editor/toolbar/insert-header-3"))},{text:"#### ",displayText:"/h4 - ".concat(Ue("editor/toolbar/insert-header-4"))},{text:"##### ",displayText:"/h5 - ".concat(Ue("editor/toolbar/insert-header-5"))},{text:"###### ",displayText:"/h6 - ".concat(Ue("editor/toolbar/insert-header-6"))},{text:"> ",displayText:"/blockquote - ".concat(Ue("editor/toolbar/insert-blockquote"))},{text:"* ",displayText:"/ul - ".concat(Ue("editor/toolbar/insert-unordered-list"))},{text:"1. ",displayText:"/ol - ".concat(Ue("editor/toolbar/insert-ordered-list"))},{text:"`@crossnote.image`\n",displayText:"/image - ".concat(Ue("editor/toolbar/insert-image"))},{text:"|   |   |\n|---|---|\n|   |   |\n",displayText:"/table - ".concat(Ue("editor/toolbar/insert-table"))},{text:"`@timer "+JSON.stringify({date:(new Date).toString()}).replace(/^{/,"").replace(/}$/,"")+"`\n",displayText:"/timer - ".concat(Ue("editor/toolbar/insert-clock"))},{text:"",displayText:"/emoji - ".concat(Ue("editor/toolbar/insert-emoji"))},{text:"`@crossnote.audio`  \n",displayText:"/audio - ".concat(Ue("editor/toolbar/audio-url"))},{text:"`@crossnote.netease_music`  \n",displayText:"/netease - ".concat(Ue("editor/toolbar/netease-music"))},{text:"`@crossnote.video`  \n",displayText:"/video - ".concat(Ue("editor/toolbar/video-url"))},{text:"`@crossnote.youtube`  \n",displayText:"/youtube - ".concat(Ue("editor/toolbar/youtube"))},{text:"`@crossnote.bilibili`  \n",displayText:"/bilibili - ".concat(Ue("editor/toolbar/bilibili"))},{text:"\x3c!-- slide --\x3e  \n",displayText:"/slide - ".concat(Ue("editor/toolbar/insert-slide"))},{text:"`@crossnote.ocr`  \n",displayText:"/ocr - ".concat(Ue("editor/toolbar/insert-ocr"))},{text:'`@crossnote.kanban "v":2,"board":{"columns":[]}`  \n',displayText:"/kanban - ".concat(Ue("editor/toolbar/insert-kanban")," (beta)")},{text:"`@crossnote.abc`  \n",displayText:"/abc - ".concat(Ue("editor/toolbar/insert-abc-notation"))}],c=i.filter((function(e){return e.displayText.toLocaleLowerCase().indexOf(o.toLowerCase())>=0}));return{list:c.length?c:i,from:{line:n,ch:a},to:{line:n,ch:r}}}}),t.text.length>0&&t.text[0].startsWith("`@timer ")&&t.removed.length>0&&t.removed[0].startsWith("/")){for(var a=p.getValue().split("\n"),n=[],r=0;r<a.length;r++){var o=a[r].match(/^`@timer\s.+`/);if(o){var i=o[0],c=i.match(/^`@timer\s+(.+)`/);if(!c||!c.length)continue;var l=c[1];try{var s=JSON.parse("{".concat(l,"}")).date;s&&n.push({text:i,line:r,date:new Date(s)})}catch(g){continue}}}for(var u=1;u<n.length;u++){var d=n[u],m=n[u-1],b=Object(de.a)(d.date,m.date,{includeSeconds:!0}),f="`@timer ".concat(JSON.stringify({date:d.date.toString(),duration:b}).replace(/^{/,"").replace(/}$/,""),"`");p.replaceRange(f,{line:d.line,ch:0},{line:d.line,ch:d.text.length})}}};p.on("change",e);var t=function(e){};return p.on("cursorActivity",t),function(){p.off("change",e),p.off("cursorActivity",t)}}}),[p,t]),r.a.createElement(g.a,{className:Object(N.a)(a.editorPanel)},r.a.createElement(g.a,{className:Object(N.a)(a.topPanel)},r.a.createElement(g.a,{className:Object(N.a)(a.row)},r.a.createElement(re.a,{className:Object(N.a)(a.backBtn)},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:function(){Fe.setDisplayMobileEditor(!1)}},r.a.createElement(C.d,null))),r.a.createElement(re.a,{variant:"outlined",color:"default","aria-label":"editor mode"},r.a.createElement(oe.a,{title:Ue("general/vickymd")},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn,te===ue.VickyMD&&a.controlBtnSelected),color:te===ue.VickyMD?"primary":"default",onClick:function(){return ae(ue.VickyMD)}},r.a.createElement(C.r,null))),r.a.createElement(oe.a,{title:Ue("editor/note-control/source-code")},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn,te===ue.SourceCode&&a.controlBtnSelected),color:te===ue.SourceCode?"primary":"default",onClick:function(){return ae(ue.SourceCode)}},r.a.createElement(C.i,null))),r.a.createElement(oe.a,{title:Ue("editor/note-control/preview")},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn,te===ue.Preview&&a.controlBtnSelected),color:te===ue.Preview?"primary":"default",onClick:function(){return ae(ue.Preview)}},r.a.createElement(C.m,null)))),r.a.createElement(re.a,{style:{marginLeft:"8px"}},r.a.createElement(oe.a,{title:"Tags"},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:function(e){return Se(e.currentTarget)}},r.a.createElement(C.x,null)))),r.a.createElement(re.a,{style:{marginLeft:"8px"}},r.a.createElement(oe.a,{title:"Fullscreen"},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:function(){return xe(!0)}},r.a.createElement(C.n,null)))),r.a.createElement(re.a,{style:{marginLeft:"8px"}},r.a.createElement(oe.a,{title:"Change file path"},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:function(){return U(!0)}},r.a.createElement(C.u,null))),r.a.createElement(oe.a,{title:"Restore (checkout)"},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:Ge},r.a.createElement(C.v,null))),r.a.createElement(oe.a,{title:"Delete file"},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:function(){return D(!0)}},r.a.createElement(C.k,null)))),t.notebook.gitURL&&r.a.createElement(re.a,{style:{marginLeft:"8px"}},r.a.createElement(oe.a,{title:"Upload (Push)"},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:function(){return G(!0)}},r.a.createElement(C.h,null))),r.a.createElement(oe.a,{title:"Download (Pull)"},r.a.createElement(ee.a,{className:Object(N.a)(a.controlBtn),onClick:_e,disabled:Fe.isPullingNotebook},r.a.createElement(C.g,null)))),r.a.createElement(ie.a,{open:Boolean(Ce),anchorEl:Ce,keepMounted:!0,onClose:function(){return Se(null)}},r.a.createElement(b.a,null,r.a.createElement(f.a,{className:Object(N.a)(a.menuItemOverride,a.menuItemTextField)},r.a.createElement(J.a,{placeholder:"Add tag...",autoFocus:!0,value:Te,onChange:function(e){e.stopPropagation(),De(e.target.value)},onKeyUp:function(e){13===e.which&&Ve()}})),Be.length>0?Be.map((function(e){return r.a.createElement(f.a,{key:e,className:Object(N.a)(a.menuItemOverride)},r.a.createElement(g.a,{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%"}},r.a.createElement(h.a,null,e),r.a.createElement(v.a,{onClick:function(){return He(e)}},r.a.createElement(C.f,null))))})):r.a.createElement(f.a,{className:Object(N.a)(a.menuItemOverride)},r.a.createElement(h.a,{style:{margin:"8px 0"}},"No tags")))))),r.a.createElement(g.a,{className:Object(N.a)(a.editorWrapper,je?a.fullScreen:null)},r.a.createElement("textarea",{className:Object(N.a)(a.editor,"editor-textarea"),placeholder:Ue("editor/placeholder"),ref:function(e){l(e)}}),te===ue.Preview&&p?r.a.createElement("div",{className:Object(N.a)(a.preview,"preview"),id:"preview",ref:function(e){ge(e)}}):null,je&&r.a.createElement(v.a,{style:{position:"fixed",right:"0",top:"0",zIndex:2001},onClick:function(){return xe(!1)}},r.a.createElement(C.o,null))),r.a.createElement(g.a,{className:Object(N.a)(a.bottomPanel)},r.a.createElement(g.a,{className:Object(N.a)(a.row)},r.a.createElement(h.a,{variant:"caption",style:{cursor:"pointer"},onClick:function(){U(!0)}},t.filePath),r.a.createElement(h.a,{variant:"caption",style:{marginLeft:"4px"}},"- "+we)),r.a.createElement(g.a,{className:Object(N.a)(a.cursorPositionInfo)},r.a.createElement(h.a,{variant:"caption"},"Ln ".concat(k.line+1,", Col ").concat(k.ch)))),r.a.createElement(z.a,{open:S,onClose:function(){return D(!1)}},r.a.createElement($.a,null,"Are you sure to delete this file?"),r.a.createElement(K.a,null,r.a.createElement(ce.a,null,"Can't be undone")),r.a.createElement(Z.a,null,r.a.createElement(ee.a,{style:{color:"red"},onClick:function(){Fe.deleteNote(t),D(!1)}},"Delete"),r.a.createElement(ee.a,{onClick:function(){return D(!1)}},"Cancel"))),r.a.createElement(z.a,{open:R,onClose:We},r.a.createElement($.a,null,"Change file path"),r.a.createElement(K.a,null,r.a.createElement(J.a,{value:Y,autoFocus:!0,onChange:function(e){return q(e.target.value)},onKeyUp:function(e){13===e.which&&Me(Y)}})),r.a.createElement(Z.a,null,r.a.createElement(ee.a,{onClick:function(){return Me(Y)}},"Save"),r.a.createElement(ee.a,{onClick:We},"Cancel"))),r.a.createElement(se,{open:_,onClose:function(){return G(!1)},notebook:t.notebook}))}!function(e){e.VickyMD="VickyMD",e.SourceCode="SourceCode",e.Preview="Preview"}(ue||(ue={}));var fe=a(5616),ge=a(5631);function he(e){var t=F.useContainer(),a=Object(n.useState)(""),o=Object(m.a)(a,2),i=o[0],c=o[1],l=Object(n.useState)(!1),s=Object(m.a)(l,2),u=s[0],d=s[1],p=Object(n.useState)(""),b=Object(m.a)(p,2),f=b[0],v=b[1],w=Object(n.useState)(""),E=Object(m.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(""),x=Object(m.a)(j,2),y=x[0],N=x[1],S=Object(n.useState)(""),T=Object(m.a)(S,2),D=T[0],A=T[1],L=Object(n.useState)("https://cors.isomorphic-git.org"),R=Object(m.a)(L,2),U=R[0],W=R[1],M=Object(n.useState)(!1),_=Object(m.a)(M,2),G=_[0],V=_[1],H=Object(n.useCallback)(Object(P.a)(I.a.mark((function a(){return I.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,new B.a({type:"info",text:"Getting notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),a.next=4,t.addNotebook(i,f,O,y,D,G,U);case 4:e.onClose(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),new B.a({type:"error",text:"Failed to get notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),e.onClose();case 11:case"end":return a.stop()}}),a,null,[[0,7]])}))),[e,i,f,O,y,D,G,U]);return r.a.createElement(z.a,{open:e.open,onClose:function(){t.isAddingNotebook||e.onClose()}},r.a.createElement($.a,null,"Add a notebook"),r.a.createElement(K.a,null,r.a.createElement(J.a,{label:"Notebook name",value:i,fullWidth:!0,onChange:function(e){c(e.target.value)},style:{marginBottom:"16px"}}),r.a.createElement(Y.a,{elevation:2,expanded:u,onChange:function(){return d(!u)}},r.a.createElement(q.a,{expandIcon:r.a.createElement(C.c,null)},r.a.createElement(h.a,null,"Git repository (optional)")),r.a.createElement(X.a,null,r.a.createElement(g.a,null,r.a.createElement(J.a,{label:"url",placeholder:"https://abc/def.git",fullWidth:!0,value:f,onChange:function(e){return v(e.target.value)}}),r.a.createElement(J.a,{label:"branch",placeholder:"master",fullWidth:!0,value:O,onChange:function(e){return k(e.target.value)}}),r.a.createElement(J.a,{label:"username (optional)",placeholder:"username (optional)",fullWidth:!0,value:y,onChange:function(e){return N(e.target.value)}}),r.a.createElement(J.a,{label:"password (optional)",placeholder:"password (optional)",type:"password",fullWidth:!0,value:D,onChange:function(e){return A(e.target.value)}}),r.a.createElement(fe.a,{control:r.a.createElement(ge.a,{checked:G,onChange:function(){return V(!G)},value:G}),label:r.a.createElement(h.a,null,"Remember credentials "+(G?"(stored locally)":""))}),r.a.createElement(J.a,{label:"cors proxy",placeholder:"https://cors.isomorphic-git.org",fullWidth:!0,value:U,onChange:function(e){return W(e.target.value)}}),r.a.createElement(Q.a,{href:"https://github.com/isomorphic-git/isomorphic-git#cors-support",target:"_blank"},"Why we need cors proxy?"))))),r.a.createElement(Z.a,null,r.a.createElement(ee.a,{variant:"contained",color:"primary",onClick:H,disabled:t.isAddingNotebook},t.isAddingNotebook?"Adding...":"Add"),e.canCancel&&r.a.createElement(ee.a,{onClick:e.onClose},"Cancel")))}var ve=a(5617),we=a(5618),Ee=Object(j.a)((function(e){return Object(x.a)({treeItemRoot:{paddingLeft:"4px","&:focus > $treeItemContent":{color:"#1a73e8",backgroundColor:"#e8f0fe"},"&:focus > $treeItemLabelIcon":{color:"#1a73e8"}},treeItemContent:{cursor:"default",color:e.palette.text.primary,userSelect:"none",fontWeight:e.typography.fontWeightMedium,"$treeItemExpanded > &":{fontWeight:e.typography.fontWeightRegular}},treeItemGroup:{marginLeft:0,"& $treeItemContent":{}},treeItemExpanded:{},treeItemLabel:{fontWeight:"inherit",color:"inherit"},treeItemLabelRoot:{display:"flex",alignItems:"center",padding:e.spacing(1,0)},treeItemLabelIcon:{color:"rgba(0, 0, 0, 0.54)"},treeItemLabelText:{paddingLeft:"12px",flexGrow:1}})}));function Oe(e){var t=Ee(),a=F.useContainer(),o=Object(n.useState)([]),i=Object(m.a)(o,2),c=i[0],l=i[1],s=Object(n.useCallback)((function(t,n){t.stopPropagation();var r=t.target;r&&r.tagName&&r.tagName.toUpperCase().match(/^(SVG|PATH|BUTTON)$/)&&(a.setSelectedNotebook(e.notebook),l(n))}),[e.notebook]);return Object(n.useEffect)((function(){a.selectedNotebook!==e.notebook&&l([])}),[a.selectedNotebook,e.notebook]),r.a.createElement(we.a,{defaultExpandIcon:r.a.createElement(v.a,{disableFocusRipple:!0,disableRipple:!0,size:"medium"},r.a.createElement(C.e,null)),defaultCollapseIcon:r.a.createElement(v.a,{disableFocusRipple:!0,disableRipple:!0,size:"medium"},r.a.createElement(C.c,null)),defaultEndIcon:r.a.createElement("div",{style:{width:24}}),expanded:c,onNodeToggle:s,style:{width:"100%"}},r.a.createElement(ve.a,{nodeId:"notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(g.a,{onClick:function(){a.setSelectedNotebook(e.notebook),a.setSelectedSection({type:d.Notes})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement(h.a,{color:"inherit",variant:"body1",className:Object(N.a)(t.treeItemLabelText)},e.notebook.name))},r.a.createElement(ve.a,{nodeId:"today-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Today})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"today-notes"},"\ud83d\uddd3"),r.a.createElement(h.a,{className:Object(N.a)(t.treeItemLabelText)},"today"))}),r.a.createElement(ve.a,{nodeId:"todo-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Todo})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"todo-notes"},"\u2611\ufe0f"),r.a.createElement(h.a,{className:Object(N.a)(t.treeItemLabelText)},"todo"))}),r.a.createElement(ve.a,{nodeId:"directories",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Notes})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"directories"},"\ud83d\uddc2"),r.a.createElement(h.a,{className:Object(N.a)(t.treeItemLabelText)},"notes"))},function e(n){return"."===n.name?0===n.children.length?null:r.a.createElement(r.a.Fragment,null,n.children.map((function(t){return e(t)}))):r.a.createElement(ve.a,{nodeId:n.name,classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},endIcon:r.a.createElement("div",{style:{width:24}}),key:n.name,label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Directory,path:n.path})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83d\udcc1"),r.a.createElement(h.a,{color:"inherit",variant:"body1",className:Object(N.a)(t.treeItemLabelText)},n.name))},n.children.map((function(t){return e(t)})))}(a.notebookDirectories)),r.a.createElement(ve.a,{nodeId:"tagged-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Tagged})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"tagged-notes"},"\ud83c\udff7\ufe0f"),r.a.createElement(h.a,{className:Object(N.a)(t.treeItemLabelText)},"tagged"))},function e(n){return"."===n.name?0===n.children.length?null:r.a.createElement(r.a.Fragment,null,n.children.map((function(t){return e(t)}))):r.a.createElement(ve.a,{nodeId:n.path,classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},endIcon:r.a.createElement("div",{style:{width:24}}),key:n.path,label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Tag,path:n.path})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83c\udff7\ufe0f"),r.a.createElement(h.a,{color:"inherit",variant:"body1",className:Object(N.a)(t.treeItemLabelText)},n.name))},n.children.map((function(t){return e(t)})))}(a.notebookTagNode)),r.a.createElement(ve.a,{nodeId:"untagged-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Untagged})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"untagged-notes"},"\ud83c\ude1a"),r.a.createElement(h.a,{className:Object(N.a)(t.treeItemLabelText)},"untagged"))}),r.a.createElement(ve.a,{nodeId:"conflicted-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(g.a,{onClick:function(){a.setSelectedSection({type:d.Conflicted})},className:Object(N.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"conflicted-notes"},"\u26a0\ufe0f"),r.a.createElement(h.a,{className:Object(N.a)(t.treeItemLabelText)},"conflicted"))})))}var ke=Object(j.a)((function(e){var t;return Object(x.a)({page:{display:"flex",width:"100%",height:"100%",backgroundColor:"#2196F1"},appBar:{zIndex:e.zIndex.drawer+1,boxShadow:"none"},toolBar:{display:"flex",flexDirection:"row",justifyContent:"space-between"},search:Object(p.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(y.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(y.b)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:Object(p.a)({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:200}),displayNone:{display:"none"},drawer:Object(p.a)({},e.breakpoints.up("sm"),{width:200,flexShrink:0}),drawerPaper:{width:200},selectedSection:{backgroundColor:"#ccc"},left:{display:"flex",flexDirection:"row",alignItems:"center"},menuButton:{marginRight:e.spacing(2)},mainPanel:{position:"relative",display:"flex",flexDirection:"row",flexGrow:1,overflow:"auto",backgroundColor:"#eee"},notesPanel:Object(p.a)({width:"".concat(350,"px"),maxWidth:"100%",height:"100%"},e.breakpoints.down("xs"),{width:"100%"}),editorPanel:(t={width:"calc(100% - ".concat(350,"px)"),position:"absolute",left:"calc(".concat(350,"px)"),height:"100%"},Object(p.a)(t,e.breakpoints.down("md"),{width:"calc(100% - ".concat(350,"px)"),left:"".concat(350,"px")}),Object(p.a)(t,e.breakpoints.down("xs"),{display:"none",top:"0",left:"0",width:"100%",height:"100%"}),t),toolBarSpace:e.mixins.toolbar})}));function je(e){var t=ke(e),a=F.useContainer(),o=Object(n.useState)(!1),i=Object(m.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(!1),u=Object(m.a)(s,2),d=u[0],p=u[1],j=Object(n.useCallback)((function(){p(!d)}),[d]),x=r.a.createElement("div",null,r.a.createElement(b.a,{disablePadding:!0},r.a.createElement(f.a,{disableGutters:!0},r.a.createElement(g.a,{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:"0 8px"}},r.a.createElement(h.a,{variant:"body1",style:{fontWeight:"bold"}},"Notebooks"),r.a.createElement(v.a,{onClick:function(){return l(!0)}},r.a.createElement(C.t,null)))),a.notebooks.map((function(e){return r.a.createElement(f.a,{disableGutters:!0,style:{padding:"0"},key:e._id},r.a.createElement(Oe,{notebook:e}))})))),y=r.a.createElement(w.a,{className:Object(N.a)(t.notesPanel)},r.a.createElement(ne,{toggleDrawer:j}));return r.a.createElement(g.a,{className:Object(N.a)(t.page)},r.a.createElement(E.a,null),r.a.createElement("nav",{className:t.drawer},r.a.createElement(O.a,{smUp:!0,implementation:"css"},r.a.createElement(k.a,{variant:"temporary",open:d,onClose:j,classes:{paper:t.drawerPaper},ModalProps:{keepMounted:!0}},x)),r.a.createElement(O.a,{xsDown:!0,implementation:"css"},r.a.createElement(k.a,{classes:{paper:t.drawerPaper},variant:"permanent",open:!0},x))),r.a.createElement(g.a,{className:Object(N.a)(t.mainPanel),id:"main-panel"},y,r.a.createElement(w.a,{className:Object(N.a)(t.editorPanel),style:{display:a.displayMobileEditor&&a.selectedNote&&"block"}},a.selectedNote&&r.a.createElement(be,{note:a.selectedNote}))),r.a.createElement(he,{open:c,onClose:function(){return l(!1)},canCancel:!0}))}var xe=a(313),ye=a(148),Ne=a(147),Ce=a(5624),Se=(a(13),a(250),a(5442),a(5443),a(259),a(5445),a(5446),a(266),a(5447),a(5448),a(5449),a(166),a(5450),a(164),a(160),a(162),a(165),a(5452),a(55)),Ie=a(5620),Pe=a(5605);function Te(){return(Te=Object(P.a)(I.a.mark((function e(){var t,a,n,r,o=arguments;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:[],a=[],n=function(e){var n=t[e];if(!n.type.match("image.*"))return"continue";a.push(new Promise((function(e,t){var a=new FormData;a.append("smfile",n),a.append("format","json"),fetch("https://sm.ms/api/v2/upload",{method:"POST",mode:"cors",headers:{},referrer:"",body:a}).then((function(e){return e.json()})).then((function(a){return a.success?e(a.data.url):"image_repeated"===a.code||"exception"===a.code&&a.message.match(/this image exists at:/)?e(a.message.match(/https:\/\/.+$/)[0]):t(a.message)})).catch((function(e){return t("Failed to connect to sm.ms host")}))})))},r=0;case 4:if(!(r<t.length)){e.next=11;break}if("continue"!==n(r)){e.next=8;break}return e.abrupt("continue",8);case 8:r++,e.next=4;break;case 11:return e.next=13,Promise.all(a);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var De=Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function Ae(e){var t=De(e),a=Object(u.b)().t,o=Object(n.useState)(""),i=Object(m.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(!1),d=Object(m.a)(s,2),p=d[0],b=d[1],f=Object(n.useState)(null),w=Object(m.a)(f,2),E=w[0],O=w[1],k=Object(n.useState)(!1),j=Object(m.a)(k,2),x=j[0],y=j[1];return e.isPreview?r.a.createElement("span",null):r.a.createElement(U.a,{elevation:2,className:Object(N.a)(t.card)},r.a.createElement(h.a,{variant:"h5"},a("widget/crossnote.image/image-helper")),r.a.createElement(g.a,{className:Object(N.a)(t.actionButtons)},r.a.createElement(oe.a,{title:a("general/Delete")},r.a.createElement(v.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),!x&&r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(fe.a,{label:a("widget/crossnote.image/set-as-cover-image-in-note-card"),control:r.a.createElement(Ie.a,{checked:p,onChange:function(){return b(!p)},color:"primary"})})),!x&&r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Link")),r.a.createElement(Pe.a,{margin:"dense",placeholder:a("widget/crossnote.image/image-url-placeholder"),value:c,onChange:function(e){l(e.target.value)},onKeyDown:function(t){13===t.which&&e.replaceSelf("![".concat(p?"cover":"","](").concat(c,")\n"))},fullWidth:!0})),r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Upload")),r.a.createElement(g.a,{className:Object(N.a)(t.dropArea,x?t.disabled:null),onClick:function(t){t.preventDefault(),t.stopPropagation(),E&&!x&&(E.onchange=function(t){var n=t.target.files||[];new B.a({type:"info",text:a("utils/uploading-image"),layout:"topRight",theme:"relax",timeout:2e3}).show(),y(!0),function(){return Te.apply(this,arguments)}(n).then((function(t){var a="";t.forEach((function(e){a+="![".concat(p?"cover":"","](").concat(e,")  \n")})),e.replaceSelf(a)})).catch((function(e){y(!1),new B.a({type:"error",text:a("utils/upload-image-failure"),layout:"topRight",theme:"relax",timeout:2e3}).show()}))},E.click())}},r.a.createElement(h.a,null,a(x?"utils/uploading-image":"widget/crossnote.image/click-here-to-browse-image-file")))),r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(h.a,{variant:"caption"},a("widget/crossnote.image/thanks_sm_ms"))),r.a.createElement("input",{type:"file",multiple:!0,style:{display:"none"},ref:function(e){O(e)}}))}var Le=Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function Be(e){var t=e.attributes,a=Le(e),o=Object(u.b)().t,i=Object(n.useState)(t.source||""),c=Object(m.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(t.autoplay||!1),p=Object(m.a)(d,2),b=p[0],f=p[1],w=Object(n.useState)(t.controls||!0),E=Object(m.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(t.loop||!1),x=Object(m.a)(j,2),y=x[0],S=x[1],I=Object(n.useState)(t.muted||!1),P=Object(m.a)(I,2),T=P[0],D=P[1];return t.src?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement("audio",{autoPlay:t.autoplay||t.autoPlay,controls:t.controls,loop:t.loop,muted:t.muted,style:t.style},o("widget/crossnote.audio/audio_element_fail"),r.a.createElement("source",{src:t.src,type:t.type})),!e.isPreview&&!t.controls&&"\ud83c\udfb5"):e.isPreview?r.a.createElement("span",null):r.a.createElement(U.a,{elevation:2,className:Object(N.a)(a.card)},r.a.createElement(h.a,{variant:"h5"},o("general/Audio")),r.a.createElement(g.a,{className:Object(N.a)(a.actionButtons)},r.a.createElement(oe.a,{title:o("general/Delete")},r.a.createElement(v.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/source-url")),r.a.createElement(Pe.a,{margin:"dense",placeholder:o("widget/crossnote.audio/source-url-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:b,controls:O,loop:y,muted:T,src:l};e.replaceSelf("`@crossnote.audio ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(fe.a,{label:o("widget/autoplay"),control:r.a.createElement(Ie.a,{checked:b,onChange:function(){return f(!b)},color:"primary"})}),r.a.createElement(fe.a,{label:o("widget/controls"),control:r.a.createElement(Ie.a,{checked:O,onChange:function(){return k(!O)},color:"primary"})}),r.a.createElement(fe.a,{label:o("widget/loop"),control:r.a.createElement(Ie.a,{checked:y,onChange:function(){return S(!y)},color:"primary"})}),r.a.createElement(fe.a,{label:o("widget/muted"),control:r.a.createElement(Ie.a,{checked:T,onChange:function(){return D(!T)},color:"primary"})})))}var Re=Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function Fe(e){var t=e.attributes,a=Re(e),o=Object(u.b)().t,i=Object(n.useState)(t.id||""),c=Object(m.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(t.autoplay||!1),p=Object(m.a)(d,2),b=p[0],f=p[1];return t.id?r.a.createElement("iframe",{title:"netease_music_"+t.id,style:{maxWidth:"100%",width:"333px",height:"86px",border:"none"},src:"https://music.163.com/outchain/player?type=2&id=".concat(t.id,"&auto=").concat(t.autoplay?"1":"0","&height=66")}):e.isPreview?r.a.createElement("span",null):r.a.createElement(U.a,{elevation:2,className:Object(N.a)(a.card)},r.a.createElement(h.a,{variant:"h5"},o("general/Audio")),r.a.createElement(g.a,{className:Object(N.a)(a.actionButtons)},r.a.createElement(oe.a,{title:o("general/Delete")},r.a.createElement(v.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/ID")),r.a.createElement(Pe.a,{margin:"dense",placeholder:o("widget/crossnote.neteasemusic/song-id-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:b,id:l};e.replaceSelf("`@crossnote.netease_music ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(fe.a,{label:o("widget/autoplay"),control:r.a.createElement(Ie.a,{checked:b,onChange:function(){return f(!b)},color:"primary"})})))}var Ue=Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%"}})}));function We(e){var t=e.attributes,a=Ue(e),o=Object(u.b)().t,i=Object(n.useState)(t.source||""),c=Object(m.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(t.autoplay||!1),p=Object(m.a)(d,2),b=p[0],f=p[1],w=Object(n.useState)(t.controls||!0),E=Object(m.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(t.loop||!1),x=Object(m.a)(j,2),y=x[0],S=x[1],I=Object(n.useState)(t.muted||!1),P=Object(m.a)(I,2),T=P[0],D=P[1],A=Object(n.useState)(t.poster||""),L=Object(m.a)(A,2),B=L[0],R=L[1];return t.src?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(g.a,{className:Object(N.a)(a.videoWrapper)},r.a.createElement("video",{className:Object(N.a)(a.video),autoPlay:t.autoplay||t.autoPlay,controls:t.controls,loop:t.loop,muted:t.muted,style:t.style,poster:t.poster},o("widget/crossnote.video/video_element_fail"),r.a.createElement("source",{src:t.src,type:t.type})))):e.isPreview?r.a.createElement("span",null):r.a.createElement(U.a,{elevation:2,className:Object(N.a)(a.card)},r.a.createElement(h.a,{variant:"h5"},o("general/Video")),r.a.createElement(g.a,{className:Object(N.a)(a.actionButtons)},r.a.createElement(oe.a,{title:o("general/Delete")},r.a.createElement(v.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/source-url")),r.a.createElement(Pe.a,{margin:"dense",placeholder:o("widget/crossnote.video/video-url-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:b,controls:O,loop:y,muted:T,src:l,poster:B};e.replaceSelf("`@crossnote.video ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("widget/crossnote.video/poster-url")),r.a.createElement(Pe.a,{margin:"dense",placeholder:o("widget/crossnote.video/poster-url-placeholder"),value:B,onChange:function(e){R(e.target.value)},fullWidth:!0})),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(fe.a,{label:o("widget/autoplay"),control:r.a.createElement(Ie.a,{checked:b,onChange:function(){return f(!b)},color:"primary"})}),r.a.createElement(fe.a,{label:o("widget/controls"),control:r.a.createElement(Ie.a,{checked:O,onChange:function(){return k(!O)},color:"primary"})}),r.a.createElement(fe.a,{label:o("widget/loop"),control:r.a.createElement(Ie.a,{checked:y,onChange:function(){return S(!y)},color:"primary"})}),r.a.createElement(fe.a,{label:o("widget/muted"),control:r.a.createElement(Ie.a,{checked:T,onChange:function(){return D(!T)},color:"primary"})})))}var Me=Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{backgroundColor:"#ddd",border:"none",position:"absolute",left:"0",top:"0",width:"100%",height:"100%"},errorMessage:{color:"#f44336",marginTop:e.spacing(2)}})}));function _e(e){var t=e.attributes,a=Me(e),o=Object(u.b)().t,i=Object(n.useState)(""),c=Object(m.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(""),p=Object(m.a)(d,2),b=p[0],f=p[1];return t.aid?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(g.a,{className:Object(N.a)(a.videoWrapper)},r.a.createElement("iframe",{title:"bilibili_"+t.id,className:Object(N.a)(a.video),src:"https://player.bilibili.com/player.html?aid=".concat(t.aid),scrolling:"no",frameBorder:"no",allowFullScreen:!0}))):e.isPreview?r.a.createElement("span",null):r.a.createElement(U.a,{elevation:2,className:Object(N.a)(a.card)},r.a.createElement(h.a,{variant:"h5"},o("widget/crossnote.bilibili/Bilibili")),r.a.createElement(g.a,{className:Object(N.a)(a.actionButtons)},r.a.createElement(oe.a,{title:o("general/Delete")},r.a.createElement(v.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("widget/crossnote.bilibili/bilibili-video-url")),r.a.createElement(Pe.a,{margin:"dense",placeholder:o("widget/crossnote.bilibili/url-placeholder"),value:l,onChange:function(e){s(e.target.value),f("")},onKeyDown:function(t){if(13===t.which)if(l&&l.match(/bilibili\.com\/video\/av(\d+)/)){var a={aid:l.match(/bilibili\.com\/video\/av(\d+)/)[1]};e.replaceSelf("`@crossnote.bilibili ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}else f(o("widget/crossnote.bilibili/error_message"))},fullWidth:!0}),r.a.createElement(h.a,{className:Object(N.a)(a.errorMessage)},b)))}var Ge=Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{backgroundColor:"#ddd",border:"none",position:"absolute",left:"0",top:"0",width:"100%",height:"100%"},errorMessage:{color:"#f44336",marginTop:e.spacing(2)}})}));function Ve(e){var t=e.attributes,a=Ge(e),o=Object(u.b)().t,i=Object(n.useState)(""),c=Object(m.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(""),p=Object(m.a)(d,2),b=p[0],f=p[1];return t.videoID?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(g.a,{className:Object(N.a)(a.videoWrapper)},r.a.createElement("iframe",{title:"youtube_"+t.videoID,className:Object(N.a)(a.video),src:"https://www.youtube.com/embed/".concat(t.videoID),scrolling:"no",frameBorder:"no",allowFullScreen:!0}))):e.isPreview?r.a.createElement("span",null):r.a.createElement(U.a,{elevation:2,className:Object(N.a)(a.card)},r.a.createElement(h.a,{variant:"h5"},o("Youtube")),r.a.createElement(g.a,{className:Object(N.a)(a.actionButtons)},r.a.createElement(oe.a,{title:o("general/Delete")},r.a.createElement(v.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(g.a,{className:Object(N.a)(a.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("Youtube video URL")),r.a.createElement(Pe.a,{margin:"dense",placeholder:o("widget/crossnote.youtube/youtube-video-url-placeholder"),value:l,onChange:function(e){s(e.target.value),f("")},onKeyDown:function(t){if(13===t.which)if(l&&l.match(/youtube\.com\/watch\?v=(.+?)$/)){var a={videoID:l.match(/youtube\.com\/watch\?v=(.+?)$/)[1]};e.replaceSelf("`@crossnote.youtube ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}else f(o("widget/crossnote.youtube/error_message"))},fullWidth:!0}),r.a.createElement(h.a,{className:Object(N.a)(a.errorMessage)},b)))}var He=a(5621),ze=a(5622),$e=a(5623),Ke=a(303),Je=Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},canvasWrapper:{marginTop:e.spacing(2)},canvas:{maxWidth:"100%"},disabled:{cursor:"not-allowed"}})}));function Ye(e){var t=Je(e),a=Object(u.b)().t,o=Object(n.useState)(null),i=Object(m.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(""),d=Object(m.a)(s,2),p=d[0],w=d[1],E=Object(n.useState)(""),O=Object(m.a)(E,2),k=O[0],j=O[1],x=Object(n.useState)(""),y=Object(m.a)(x,2),S=y[0],D=y[1],A=Object(n.useState)(null),L=Object(m.a)(A,2),B=L[0],R=L[1],F=Object(n.useState)(!1),W=Object(m.a)(F,2),M=W[0],_=W[1],G=Object(n.useState)([]),V=Object(m.a)(G,2),H=V[0],z=V[1],$=Object(n.useState)(function(){try{return JSON.parse(localStorage.getItem("widget/crossnote.ocr/languages")||'["eng"]')}catch(e){return["eng"]}}()),K=Object(m.a)($,2),J=K[0],Y=K[1],q=Object(n.useState)(!!localStorage.getItem("widget/crossnote.ocr/grayscale")||!0),X=Object(m.a)(q,2),Q=X[0],Z=X[1];function te(e){Y((function(t){var a=t.indexOf(e);return a>=0?(t.splice(a,1),t=Object(T.a)(t)):t=[].concat(Object(T.a)(t),[e]),localStorage.setItem("widget/crossnote.ocr/languages",JSON.stringify(t)),t}))}return Object(n.useEffect)((function(){if(c&&k){var e=new Image,t=c.getContext("2d");e.onload=function(){c.width=e.width,c.height=e.height,t.clearRect(0,0,c.width,c.height),Q&&(t.fillStyle="#FFF",t.fillRect(0,0,c.width,c.height),t.globalCompositeOperation="luminosity"),t.drawImage(e,0,0),D(c.toDataURL())},e.onerror=function(e){throw e},e.setAttribute("crossOrigin","anonymous"),e.src=k}}),[c,k,Q]),e.isPreview?r.a.createElement("span",null):M?r.a.createElement(U.a,{elevation:2,className:Object(N.a)(t.card)},r.a.createElement(h.a,{variant:"h5"},a("general/Processing")),r.a.createElement(b.a,null,H.length>0&&r.a.createElement(f.a,null,r.a.createElement(He.a,null,a("tesseract/"+H[H.length-1].status)),r.a.createElement(ze.a,null,Math.floor(100*H[H.length-1].progress).toString()+"%")))):k?r.a.createElement(U.a,{elevation:2,className:Object(N.a)(t.card)},r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/recognize-text-in-languages")),r.a.createElement($e.a,null,r.a.createElement(fe.a,{control:r.a.createElement(ge.a,{checked:J.indexOf("eng")>=0,onChange:function(){return te("eng")},value:"eng"}),label:"English"}),r.a.createElement(fe.a,{control:r.a.createElement(ge.a,{checked:J.indexOf("chi_sim")>=0,onChange:function(){return te("chi_sim")},value:"chi_sim"}),label:"\u7b80\u4f53\u4e2d\u6587"}),r.a.createElement(fe.a,{control:r.a.createElement(ge.a,{checked:J.indexOf("chi_tra")>=0,onChange:function(){return te("chi_tra")},value:"chi_tra"}),label:"\u7e41\u9ad4\u4e2d\u6587"}),r.a.createElement(fe.a,{control:r.a.createElement(ge.a,{checked:J.indexOf("jpn")>=0,onChange:function(){return te("jpn")},value:"jpn"}),label:"\u65e5\u672c\u8a9e"}))),r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/extra-settings")),r.a.createElement(fe.a,{control:r.a.createElement(Ie.a,{checked:Q,onChange:function(){Q?localStorage.removeItem("widget/crossnote.ocr/grayscale"):localStorage.setItem("widget/crossnote.ocr/grayscale","true"),Z(!Q)},color:"primary"}),label:a("widget/crossnote.ocr/grayscale")})),r.a.createElement(g.a,{className:Object(N.a)(t.canvasWrapper)},r.a.createElement("canvas",{className:Object(N.a)(t.canvas),ref:function(e){return l(e)}})),r.a.createElement(re.a,null,r.a.createElement(ee.a,{onClick:function(){j(""),D("")}},a("general/go-back")),r.a.createElement(ee.a,{color:"primary",onClick:function(){return function(t){var a=Object(Ke.createWorker)({logger:function(e){z((function(t){return t.length&&t[t.length-1].status===e.status?[].concat(Object(T.a)(t.slice(0,t.length-1)),[e]):[].concat(Object(T.a)(t),[e])}))}});Object(P.a)(I.a.mark((function n(){var r,o,i;return I.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return _(!0),0===(r=J).length&&(r=["eng"]),n.next=5,a.load();case 5:return n.next=7,a.loadLanguage(r.join("+"));case 7:return n.next=9,a.initialize(r.join("+"));case 9:return n.next=11,a.recognize(t);case 11:return o=n.sent,i=o.data.text,e.replaceSelf("\n"+i),n.next=16,a.terminate();case 16:_(!1);case 17:case"end":return n.stop()}}),n)})))()}(S)},disabled:!S},a("widget/crossnote.ocr/start-ocr")))):r.a.createElement(U.a,{elevation:2,className:Object(N.a)(t.card)},r.a.createElement(h.a,{variant:"h5"},a("widget/crossnote.ocr/ocr")),r.a.createElement(g.a,{className:Object(N.a)(t.actionButtons)},r.a.createElement(oe.a,{title:a("general/Delete")},r.a.createElement(v.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Link")),r.a.createElement(Pe.a,{margin:"dense",placeholder:a("widget/crossnote.image/image-url-placeholder"),value:p,onChange:function(e){w(e.target.value)},onKeyDown:function(e){13===e.which&&function(){try{j(p)}catch(e){}}()},fullWidth:!0})),r.a.createElement(h.a,{variant:"subtitle1",style:{marginTop:"16px",textAlign:"center"}},a("widget/crossnote.auth/Or")),r.a.createElement(g.a,{className:Object(N.a)(t.section)},r.a.createElement(h.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/local-image")),r.a.createElement(g.a,{className:Object(N.a)(t.dropArea,M?t.disabled:null),onClick:function(e){e.preventDefault(),e.stopPropagation(),B&&!M&&(B.onchange=function(e){var t=e.target.files||[];if(t.length)try{var a=t[0],n=new FileReader;n.readAsDataURL(a),n.onload=function(){j(n.result)},n.onerror=function(e){throw e}}catch(r){}},B.click())}},r.a.createElement(h.a,null,a(M?"utils/uploading-image":"widget/crossnote.image/click-here-to-browse-image-file")))),r.a.createElement("input",{type:"file",style:{display:"none"},ref:function(e){R(e)}}))}var qe=a(117),Xe=a(304),Qe=a.n(Xe),Ze=a(166),et=Object(j.a)((function(e){return Object(x.a)({columnHeader:{width:"256px",maxWidth:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},kanbanCard:Object(p.a)({width:"256px",maxWidth:"100%",position:"relative"},e.breakpoints.down("sm"),{marginTop:"4px",marginBottom:"4px"}),editorWrapper:{"& .CodeMirror-gutters":{display:"none"}},textarea:{width:"100%",height:"100%"},preview:{padding:e.spacing(2)}})}));function tt(e){var t=et(e),a=Object(u.b)().t,o=e.column,i=e.board,c=e.isPreview,l=e.refreshBoard,s=Object(n.useState)(!1),d=Object(m.a)(s,2),p=d[0],b=d[1],f=Object(n.useState)(o.title),w=Object(m.a)(f,2),E=w[0],O=w[1];return Object(n.useEffect)((function(){p||E===o.title||(o.title=E||a("general/Untitled"),O(o.title),l(i))}),[p,i,o.title,E,a,l]),r.a.createElement(g.a,{className:Object(N.a)(t.columnHeader)},r.a.createElement(g.a,null,p?r.a.createElement(J.a,{value:E,onChange:function(e){O(e.target.value)},onBlur:function(){b(!1)},onKeyUp:function(e){13===e.which&&b(!1)}}):r.a.createElement(h.a,{variant:"body1",style:{cursor:"text"},onClick:function(){c||b(!0)}},E)),!c&&r.a.createElement(g.a,null,r.a.createElement(v.a,{onClick:function(){var t={id:Date.now(),title:"",description:a("general/empty")};o&&o.cards.push(t),e.refreshBoard(i)}},r.a.createElement(C.b,null)),r.a.createElement(v.a,{onClick:function(){i.columns=i.columns.filter((function(e){return o.id!==e.id})),e.refreshBoard(i)}},r.a.createElement(C.f,null))))}function at(e){var t=et(e),a=e.board,o=e.card,i=e.isPreview,c=Object(n.useState)(null),l=Object(m.a)(c,2),s=l[0],d=l[1],p=r.a.useState(null),b=Object(m.a)(p,2),f=b[0],h=b[1],w=Object(n.useState)(null),E=Object(m.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(o.description),x=Object(m.a)(j,2),y=x[0],S=x[1],I=Object(n.useState)(!1),P=Object(m.a)(I,2),T=P[0],D=P[1];Object(u.b)().t;return Object(n.useEffect)((function(){S(o.description)}),[o.description]),Object(n.useEffect)((function(){if(s){var e=Ze.fromTextArea(s,{mode:{name:"hypermd",hashtag:!0},inputStyle:"textarea"});e.setValue(o.description),e.setOption("lineNumbers",!1),e.setOption("foldGutter",!1),e.setOption("autofocus",!1),i&&e.setOption("readOnly","nocursor"),e.on("changes",(function(){S(e.getValue())})),e.focus(),k(e)}}),[s]),Object(n.useEffect)((function(){f&&Object(le.renderPreview)(f,o.description)}),[f]),r.a.createElement(U.a,{className:Object(N.a)(t.kanbanCard)},r.a.createElement("div",{className:Object(N.a)("preview",t.preview),ref:function(e){h(e)}}),!i&&r.a.createElement(g.a,{style:{position:"absolute",top:"0",right:"0",zIndex:99}},r.a.createElement(v.a,{onClick:function(){return D(!0)}},r.a.createElement(C.r,null)),r.a.createElement(v.a,{onClick:function(){a.columns.forEach((function(e){e.cards=e.cards.filter((function(e){return e.id!==o.id}))})),e.refreshBoard(a)}},r.a.createElement(C.f,null))),r.a.createElement(z.a,{open:T,onClose:function(){return D(!1)}},r.a.createElement(K.a,null,r.a.createElement(g.a,{className:Object(N.a)(t.editorWrapper),style:{minWidth:"300px",maxWidth:"100%"}},r.a.createElement("textarea",{className:t.textarea,ref:function(e){d(e)}}))),r.a.createElement(Z.a,null,r.a.createElement(v.a,{onClick:function(){o.description=y,e.refreshBoard(e.board),D(!1)}},r.a.createElement(C.j,null)),r.a.createElement(v.a,{onClick:function(){O&&O.setValue(o.description),S(o.description),D(!1)}},r.a.createElement(C.a,null)))))}function nt(e){et(e);var t=Object(u.b)().t,a=Object(n.useState)(e.attributes.board||{columns:[]}),o=Object(m.a)(a,2),i=o[0],c=o[1];"lanes"in i&&(i.columns=i.lanes);var l=function(t){var a=Object.assign({},t);e.setAttributes({board:a}),c(a)};return r.a.createElement("div",null,r.a.createElement(Qe.a,{renderColumnHeader:function(t){return r.a.createElement(tt,{column:t,board:i,refreshBoard:l,isPreview:e.isPreview})},renderCard:function(t,a){a.dragging;return r.a.createElement(at,{card:t,board:i,refreshBoard:l,isPreview:e.isPreview})},allowAddColumn:!e.isPreview,allowAddCard:!e.isPreview,renderColumnAdder:function(){return r.a.createElement(g.a,{style:{marginLeft:"16px",marginTop:"16px"}},r.a.createElement(ee.a,{color:"primary",variant:"outlined",onClick:function(){i.columns.push({id:Date.now(),title:t("general/untitled"),cards:[],wip:!1}),l(i)}},r.a.createElement(C.s,null),t("widget/crossnote.kanban/add-column")),r.a.createElement(ee.a,{color:"primary",onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))},onNewColumnConfirm:function(e){i.columns.push(Object(qe.a)({id:Date.now()},e)),l(i)},disableCardDrag:e.isPreview,disableColumnDrag:e.isPreview,onCardDragEnd:function(e,t,a){var n=t.fromPosition,r=t.fromColumnId,o=a.toPosition,c=a.toColumnId,s=i.columns.filter((function(e){return e.id===r}))[0],u=i.columns.filter((function(e){return e.id===c}))[0];s.cards.splice(n,1),u.cards=[].concat(Object(T.a)(u.cards.slice(0,o)),[e],Object(T.a)(u.cards.slice(o,u.cards.length))),l(i)},onColumnDragEnd:function(e,t,a){var n=t.fromPosition,r=a.toPosition,o=i.columns[n],c=i.columns[r];i.columns[r]=o,i.columns[n]=c,l(i)}},i))}var rt=a(308),ot=a.n(rt),it=(a(5504),Object(j.a)((function(e){return Object(x.a)({card:{padding:e.spacing(2),position:"relative"},editorWrapper:{position:"relative",padding:"2px"},editor:{width:"100%",height:"128px",resize:"none",border:"none"},canvas:{overflow:"auto !important",height:"100% !important"},saveBtn:{position:"absolute",top:"0",right:"0"}})})));function ct(e){var t=e.attributes,a=it(e),o=(Object(u.b)().t,Object(n.useState)("abc-editor-"+Object(R.c)())),i=Object(m.a)(o,1)[0],c=Object(n.useState)("abc-warnings-"+Object(R.c)()),l=Object(m.a)(c,1)[0],s=Object(n.useState)("abc-canvas-"+Object(R.c)()),d=Object(m.a)(s,1)[0],p=Object(n.useState)("abc-audio-"+Object(R.c)()),b=Object(m.a)(p,1)[0],f=Object(n.useState)(null),h=Object(m.a)(f,2),w=h[0],E=h[1],O=Object(n.useState)(null),k=Object(m.a)(O,2),j=k[0],x=k[1],y=Object(n.useState)(null),S=Object(m.a)(y,2),I=S[0],P=S[1],T=Object(n.useState)(null),D=Object(m.a)(T,2),A=D[0],L=D[1],B=Object(n.useState)(e.isPreview),F=Object(m.a)(B,2),W=F[0],M=(F[1],Object(n.useState)(t.abc||"X: 1\nT: Cooley's\nM: 4/4\nL: 1/8\nK: Emin\n|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|")),_=Object(m.a)(M,2),G=_[0],V=_[1];return Object(n.useEffect)((function(){w&&j&&I&&A&&setTimeout((function(){new ot.a.Editor(w.id,{canvas_id:I.id,warnings_id:j.id,generate_warnings:!0,synth:{el:"#".concat(A.id),options:{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}},abcjsParams:{generateDownload:!0}})}),1e3)}),[w,j,I,A]),r.a.createElement(g.a,null,r.a.createElement(U.a,{elevation:2,className:Object(N.a)(a.editorWrapper),style:{display:W?"none":"block"}},r.a.createElement("textarea",{className:Object(N.a)(a.editor),id:i,ref:function(e){E(e)},value:G,onChange:function(e){V(e.target.value)},readOnly:e.isPreview}),!e.isPreview&&t.abc!==G&&r.a.createElement(v.a,{className:Object(N.a)(a.saveBtn),onClick:function(){e.setAttributes(Object.assign(e.attributes,{abc:G}))}},r.a.createElement(C.j,null))),r.a.createElement("div",{id:l,ref:function(e){x(e)}}),r.a.createElement("div",{id:d,className:Object(N.a)(a.canvas),ref:function(e){P(e)}}),r.a.createElement("div",{id:b,ref:function(e){L(e)}}))}window.CodeMirror=a(13),Object(Se.registerWidgetCreator)("crossnote.image",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ae,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.audio",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Be,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.netease_music",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Fe,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.video",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(We,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.bilibili",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(_e,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.youtube",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ve,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.ocr",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ye,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.kanban",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(nt,e),t),t})),Object(Se.registerWidgetCreator)("crossnote.abc",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(ct,e),t),t}));var lt=Object(xe.a)({palette:{primary:ye.a,secondary:Ne.a}}),st=function(){return Object(n.useEffect)((function(){var e=function(e){e.preventDefault(),e.prompt(),e.userChoice.then((function(e){console.log(e)}))};return window.addEventListener("beforeinstallprompt",e),function(){window.removeEventListener("beforeinstallprompt",e)}}),[]),r.a.createElement(Ce.a,{theme:lt},r.a.createElement("div",{className:"App"},r.a.createElement(je,null)))},ut=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function dt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var mt=a(309),pt=new l.a("fs");window.fs=pt;try{var bt=new mt.a({fs:pt});window.crossnote=bt,i.a.render(r.a.createElement(F.Provider,{initialState:{crossnote:bt}},r.a.createElement(st,null)),document.getElementById("root"))}catch(ft){console.log(ft)}!function(e){if("serviceWorker"in navigator){if(new URL("/notehub",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/notehub","/service-worker.js");ut?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):dt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):dt(t,e)}))}}()}},[[5305,1,2]]]);
//# sourceMappingURL=main.7f283afd.chunk.js.map