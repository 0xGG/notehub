/*! For license information please see main.e8bf44c0.chunk.js.LICENSE.txt */
(this.webpackJsonpnotehub=this.webpackJsonpnotehub||[]).push([[0],{5302:function(e,t,a){e.exports=a(5563)},5340:function(e,t,a){},5341:function(e,t,a){},5507:function(e,t){},5563:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(13),i=a.n(o),c=(a(5307),a(5308),a(5309),a(294)),l=a.n(c),s=a(186),u=a(20);a(5628),a(141),a(5630),a(5629);s.a.use(u.a).init({interpolation:{escapeValue:!1},keySeparator:!1,lng:localStorage.getItem("language")||"en-US",fallbackLng:"en-US",resources:{"en-US":{translation:{"title/Crossnote":"Crossnote","search/placeholder":"Search Notes","account/Anonymous":"Anonymous","account/anonymous":"anonymous","general/go-back":"Go back","general/sending":"Sending","general/send":"Send","general/cancel":"Cancel","general/backed-up-at":"Backed up at","general/created-at":"Created at","general/modified-at":"Modified at","general/interacted-at":"Interacted at","general/date-created":"Date created","general/date-modified":"Date modified","general/date-interacted":"Date interacted","general/saved-at":"Saved at","general/loading":"Loading ...","general/loading-notifications":"Loading notifications ...","general/failed-to-set":"Failed to set","general/update":"Update","general/updated":"Updated","general/updating":"Updating","general/close":"Close","general/Note":"Note","general/notes":"notes","general/Settings":"Settings","general/Collaborators":"Collaborators","general/collaborators":"collaborators","general/Backups":"Backups","general/backups":"backups","general/Discussion":"Discussion","general/discussion":"discussion","general/Notifications":"Notifications","general/Username":"Username","general/Email":"Email","general/Password":"Password","general/confirm-password":"Confirm password","general/Continue":"Continue","general/enter-username":"Enter username","general/vickymd":"VickyMD","general/tags":"Tags","general/add-a-tag":"Add a tag","general/private":"Private","general/public":"Public","general/friends-only":"Friends only","general/anonymous":"Anonymous","general/onymous":"Onymous","general/Tag":"Tag","general/no-tags":"No tags","general/Untitled":"Untitled","general/untitled":"untitled","general/Unknown":"Unknown","general/unknown":"unknown","general/Agree":"Agree","general/Disagree":"Disagree","general/Print":"Print",Editor:"Editor",EDITOR:"EDITOR",Viewer:"Viewer",VIEWER:"VIEWER",Admin:"Admin",ADMIN:"ADMIN",ARCHIVED:"ARCHIVED","ATTACHED NOTES":"ATTACHED NOTES",DELETED:"DELETED",PINNED:"PINNED",OTHERS:"OTHERS","PUBLIC NOTES":"PUBLIC NOTES","FOLLOWINGS' NOTES":"FOLLOWINGS' NOTES","SHARED WITH ME":"SHARED WITH ME",BOOKMARKS:"BOOKMARKS","MY TAGS":"MY TAGS","general/enter-fullscreen-mode":"Enter fullscreen mode","general/enter-presentation-mode":"Enter presentation mode","general/math-preview":"Math Preview","general/this-note-is-empty":"This note is empty","general/no-notes-found":"No notes found","general/no-notifications-found":"No notifications found","general/clear-all":"Clear all","general/Save":"Save","general/Delete":"Delete","general/Follow":"Follow","general/Following":"Following","general/Unfollow":"Unfollow","general/my-notes":"My notes","general/public-notes":"Public notes","general/followings-notes":"Followings' notes","general/shared-with-me":"Shared with me","general/Bookmarks":"Bookmarks","general/Archive":"Archive","general/Trash":"Trash","general/new-note":"New note","general/profile-updated":"Profile updated","general/ID":"ID","general/Audio":"Audio","general/Video":"Video","general/source-url":"Source URL","general/sign-in":"Sign in","general/sign-up":"Sign up","general/Link":"Link","general/Upload":"Upload","general/clicks":"clicks","general/Processing":"Processing...","general/please-wait":"please wait...","general/Languages":"Languages","general/track":"Track","general/Publish":"Publish","general/empty":"empty","note/unarchive-note":"Unarchive note","note/archive-note":"Archive note","note/delete-forever":"Delete forever","note/delete-note":"Delete note","note/restore-note":"Restore note","note/report-note":"Report note","note/open-in-crossnote-website":"Open in Crossnote website","note-tags/send-suggestion-failure":"Failed to send suggestion","note-tags/suggestion-sent":"Suggestion sent","note-tags/suggest-a-tag-to-this-note":"Suggest a tag to this note","user-tags/follow-a-tag":"Follow a tag","chat-message/reply-to-this-user":"Reply to this user","chat-message/add-reaction-to-this-message":"Add reaction to this message","chat-message/edit-this-message":"Edit this message","chat-message/modified-message":"modified message","chat-panel/post-message-failure":"Failed to post message","chat-panel/unsubscribe-info":"Unsubscribing from this chat group will stop you from receiving notifications unless someone mentions you","chat-panel/subscribe-info":"Subscribing to this chat group will let you receive notifications whenever someone posts a message","notifications/refresh":"Refresh to see new notifications","settings/about-this-project":"About this project \ud83e\udd14","settings/uploading-cover-image":"Uploading cover image","settings/upload-image-failure":"Failed to upload image","settings/Cover":"Cover","settings/enter-cover-image-url":"Enter cover image URL","settings/upload-image":"Upload image","settings/Avatar":"Avatar","settings/enter-avatar-image-url":"Enter avatar image URL","settings/Name":"Name","settings/enter-name":"Enter your Name (this is not your username)","settings/editor-cursor-color":"Editor cursor color","settings/hello":"Hello, ","settings/world":"world!","settings/linked-with-github-account":"Linked with GitHub account","settings/link-with-github-account":"Link with GitHub account","settings/log-out":"Log out","preview/attach-a-note":"Attach a note","preview/crossnote-untitled":"Crossnote - Untitled","preview/edit-this-note":"Edit this note","profile-card/followings":"followings","profile-card/followers":"followers","profile-card/Followings":"Followings","profile-card/Followers":"Followers","profile-card/notes":"notes","profile-card/follow-user-failure":"Failed to follow user","profile-card/followed-user":"Followed user","profile-card/unfollow-user-failure":"Failed to unfollow user","profile-card/unfollowed-user":"Unfollowed user","tag-card/pin-to-my-notes-page":"Pin to my notes page","interaction-panel/show-attached-notes":"Show attached notes","interaction-panel/add-comment":"Add comment","interaction-panel/add-reaction":"Add reaction","editor/loading-your-note":"Loading your note...","editor/sync-failure":"Failed to sync... Please refresh your page","editor/saving":"Saving...","editor/save-failure":"Failed to save","editor/saved":"Saved","editor/update-note-failure":"Failed to update note","editor/placeholder":"#  Hi \ud83d\ude00 Type '/' for commands","editor/note-control/allow-readers-to-suggest-note-tags":"Allow readers to suggest note tags","editor/note-control/allow-readers-to-attach-notes-under-this-note":"Allow readers to attach notes under this note","editor/note-control/inherit-parent-note-collaborators-list":"Inherit parent note collaborators list","editor/note-control/note-visibility-hint":"All collaborators will be able to see this note","editor/note-control/allow-readers-to-attach-notes-unchecked":"Applies to you and collaborators that can edit and admin","editor/note-control/allow-readers-to-attach-notes-checked":"Applies to anyone that can view this note","editor/note-control/enter-parent-note-id":"Enter parent note ID","editor/note-control/attach-note-failure":"Failed to attach note","editor/note-control/unattach-note-failure":"Failed to unattach note","editor/collaborator-hint":" - note will be visible to them","editor/shareable-link-hint":"people with the link can view/edit this note with no need of login","editor/backups-control/create-backup":"Create backup","editor/backups-control/delete-this-backup":"Delete this backup","editor/backups-control/create-backup-failure":"Failed to create backup","editor/backups-control/backup-created":"Backup created","editor/backups-control/delete-backup-failure":"Failed to delete backup","editor/backups-control/backup-deleted":"Backup deleted","editor/backups-control/cloud-version":"Cloud version","editor/backups-control/backup-name":"Backup name","editor/collaborators-control/set-collaborator-role-failure":"Failed to set collaborator role","editor/collaborators-control/add-collaborator-failure":"Failed to add collaborator","editor/collaborators-control/collaborator-removed":"Collaborator removed","editor/collaborators-control/collaborator-added":"Collaborator added","editor/collaborators-control/can-view":"Can view","editor/collaborators-control/can-edit":"Can edit","editor/collaborators-control/can-administrate":"Can administrate","editor/toolbar/insert-image":"Insert image","editor/toolbar/upload-local-images":"Upload local images","editor/toolbar/capture-webpage":"Capture the whole webpage","editor/toolbar/insert-clock":"Insert clock","editor/toolbar/insert-emoji":"Insert emoji","editor/toolbar/insert-media":"Insert media","editor/toolbar/audio-url":"Audio URL","editor/toolbar/netease-music":"Netease Music","editor/toolbar/video-url":"Video URL","editor/toolbar/youtube":"Youtube","editor/toolbar/bilibili":"Bilibili","editor/toolbar/insert-slide":"Insert slide","editor/toolbar/insert-ocr":"Insert OCR","editor/toolbar/insert-kanban":"Insert Kanban","editor/toolbar/insert-abc-notation":"Insert ABC notation","editor/toolbar/insert-header-1":"Insert header 1","editor/toolbar/insert-header-2":"Insert header 2","editor/toolbar/insert-header-3":"Insert header 3","editor/toolbar/insert-header-4":"Insert header 4","editor/toolbar/insert-header-5":"Insert header 5","editor/toolbar/insert-header-6":"Insert header 6","editor/toolbar/bold":"Bold","editor/toolbar/italic":"Italic","editor/toolbar/strikethrough":"Strikethrough","editor/toolbar/insert-inline-code":"Insert inline code","editor/toolbar/insert-blockquote":"Insert blockquote","editor/toolbar/insert-unordered-list":"Insert unordered list","editor/toolbar/insert-ordered-list":"Insert ordered list","editor/toolbar/insert-link":"Insert link","editor/toolbar/insert-table":"Insert table","editor/note-control/tag-added":"Tag added","editor/note-control/tag-deleted":"Tag deleted","editor/note-control/set-note-visibility-failure":"Failed to set note visibility","editor/note-control/note-visibility-updated":"Note visibility updated","editor/note-control/set-author-visibility-failure":"Failed to set author visibility","editor/note-control/author-visibility-updated":"Author visibility updated","editor/note-control/editor-mode":"Editor mode","editor/note-control/source-code":"Source code","editor/note-control/preview":"Preview","editor/note-control/pin-preview":"Pin preview on the side","editor/note-control/display-modification-records":"Display modification records","editor/note-control/note-visibility":"Note visibility","editor/note-control/author-visibility":"Author visibility","editor/note-control/shareable-link":"Shareable link","editor/note-control/copy-to-clipboard":"Copy to clipboard","editor/note-control/link-to-preview":"Link to preview","editor/note-control/link-to-editor":"Link to editor","editor/note-control/attach-to-note":"Attach to note","editor/note-control/source-added":"URL added","editor/note-control/source-deleted":"URL deleted","editor/note-control/invalid-note-source":"Invalid URL","editor/note-control/add-note-source":"Add related URLs","editor/note-control/note-source-hint":"Notes on the same URL will be grouped together","editor/note-control/enter-note-source":"Enter URL","avatar-panel/this-note-is-private":"This note is private","avatar-panel/this-note-is-public":"This note is visible to public","avatar-panel/this-note-is-friends-only":"This note is only visible to friends","avatar-panel/you-are-anonymous":"You are anonymous","file-exporter/name":"File exporter","file-exporter/orientation":"Orientation","file-exporter/portrait":"portrait","file-exporter/landscape":"landscape","file-exporter/paper-size":"Paper size","file-exporter/unit":"Unit","file-exporter/margin-top":"Margin top","file-exporter/margin-bottom":"Margin bottom","file-exporter/margin-left":"Margin left","file-exporter/margin-right":"Margin right","utils/uploading-image":"Uploading image...","utils/upload-image-failure":"Failed to upload image","notification/replies-to-you-in":"Replies to you in","notification/'s-note":"'s note ","notification/added":"Added","notification/to-your-note":"to your note","notification/add-you-as":"Added you as","notification/of-note":"of note","notification/add-tag-failure":"Failed to add tag","notification/suggested-to-add-tag":"Suggested to add tag","notification/started-following-you":"Started following you","notification/bookmarked-your-note":"Bookmarked your note","github-oauth/wait":"Please wait ...","github-oauth/link-with-github-account-failure":"Failed to link with GitHub account","github-oauth/sign-in-with-github-account-failure":"Failed to sign in with GitHub account","github-oauth/first-time-sign-in":"It seems to be the first time you sign in with GitHub account","github-oauth/first-time-sign-in-small":"Please finish the registeration below","widget/autoplay":"autoplay","widget/controls":"controls","widget/loop":"loop","widget/muted":"muted","widget/crossnote.image/thanks_sm_ms":"Thanks sm.ms for offering free image hosting service.","widget/crossnote.audio/audio_element_fail":"Your browser does not support the audio element.","widget/crossnote.audio/source-url-placeholder":"Enter audio source URL here, then press 'Enter' to insert.","widget/crossnote.video/video_element_fail":"Your browser does not support the video element","widget/crossnote.bilibili/error_message":"Error: Only supported https://www.bilibili.com/video/av79126732 like URL","widget/crossnote.youtube/error_message":"Error: Only supported https://www.youtube.com/watch?v=MmB9b5njVbA like URL","widget/crossnote.auth/welcome":"Welcome to crossnote","widget/crossnote.auth/doesnt-have-account":"Doesn't have an account? Let's create one \ud83d\ude09!","widget/crossnote.auth/forgot_password":"Forgot your password \ud83d\ude23?","widget/crossnote.auth/failed_to_send_code":"Failed to send verification code","widget/crossnote.auth/verification_code_sent":"Verification code has been sent to ","widget/crossnote.auth/failed_to_reset_password":"Failed to reset password","widget/crossnote.auth/password_reset":"Your password has been reset","widget/crossnote.auth/password-mismatch":"Passwords mismatch","widget/crossnote.auth/hello":"Hello, ","widget/crossnote.auth/enter-the-verification-code":"Enter the verification code","widget/crossnote.auth/get-code":"Get code","widget/crossnote.auth/sign-in-with-github-account":"Sign in with GitHub account","widget/crossnote.auth/already-have-an-account":"Already have an account?","widget/crossnote.auth/reset-password":"Reset password","widget/crossnote.auth/Or":"Or","widget/crossnote.bilibili/Bilibili":"Bilibili","widget/crossnote.bilibili/bilibili-video-url":"Bilibili video URL","widget/crossnote.bilibili/url-placeholder":"Enter the Bilibili video URL here, then press 'Enter' to insert.","widget/crossnote.image/image-helper":"Image helper","widget/crossnote.image/set-as-cover-image-in-note-card":"Set as cover image in note card","widget/crossnote.image/image-url-placeholder":"Enter image URL here, then press 'Enter' to insert.","widget/crossnote.image/click-here-to-browse-image-file":"Click here to browse image file","widget/crossnote.neteasemusic/song-id-placeholder":"Enter Netease Music song number ID.","widget/crossnote.video/video-url-placeholder":"Enter video source URL here, then press 'Enter' to insert.","widget/crossnote.video/poster-url":"Poster URL (optional)","widget/crossnote.video/poster-url-placeholder":"Enter poster URL here.","widget/crossnote.youtube/youtube-video-url":"Youtube video URL","widget/crossnote.youtube/youtube-video-url-placeholder":"Enter the Youtube video URL here, then press 'Enter' to insert.","widget/crossnote.ocr/ocr":"OCR - Optical character recognition","widget/crossnote.ocr/local-image":"Local image","widget/crossnote.ocr/recognize-text-in-languages":"Recognize text in languages","widget/crossnote.ocr/start-ocr":"Start OCR","widget/crossnote.ocr/extra-settings":"Extra settings","widget/crossnote.ocr/grayscale":"Grayscale","widget/crossnote.kanban/add-column":"Add new column","tesseract/loading tesseract core":"loading tesseract core","tesseract/initializing tesseract":"initializing tesseract","tesseract/initialized tesseract":"initialized tesseract","tesseract/loading language traineddata":"loading language traineddata","tesseract/loaded language traineddata":"loaded language traineddata","tesseract/initializing api":"initializing api","tesseract/initialized api":"initialized api","tesseract/recognizing text":"recognizing text"}}}});s.a;a(5340),a(5341);var d=a(4),m=a(32),p=a(5608),b=a(5567),f=a(5626),g=a(70),h=a(318),v=a(316),w=a(5620),E=a(5631),O=a(5634),k=a(5597),j=a(5637),x=a(21),y=a(6),C=a(12),N=a(17),S=a(1),P=a.n(S),I=a(2),D=a(298),A=a(33),B=a(40),R=a.n(B),L=a(10),T=a(16);"Bearer ".concat(localStorage.getItem("token"));function F(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===a?n:3&n|8).toString(16)}))}new(function(){function e(){Object(L.a)(this,e),this.cache={}}return Object(T.a)(e,[{key:"hashCode",value:function(e){var t=e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0),a="0."+(t=Math.abs(t)).toString();return parseFloat(a)}},{key:"generateColor",value:function(e){if(e in this.cache)return this.cache[e];var t="#"+((1<<24)*this.hashCode(e)|0).toString(16);return this.cache[e]=t,t}}]),e}());function U(){return Math.random().toString(36).substr(2,9)}var W=Object(D.a)((function(e){Object(u.b)().t;var t=e.crossnote,a=Object(n.useState)([]),r=Object(d.a)(a,2),o=r[0],i=r[1],c=Object(n.useState)(null),l=Object(d.a)(c,2),s=l[0],m=l[1],p=Object(n.useState)([]),b=Object(d.a)(p,2),f=b[0],g=b[1],h=Object(n.useState)({name:".",path:".",children:[]}),v=Object(d.a)(h,2),w=v[0],E=v[1],O=Object(n.useState)([]),k=Object(d.a)(O,2),j=k[0],x=k[1],y=Object(n.useState)(null),C=Object(d.a)(y,2),S=C[0],D=C[1],B=Object(n.useState)(!0),L=Object(d.a)(B,2),T=L[0],F=L[1],W=Object(n.useState)("$notes"),M=Object(d.a)(W,2),_=M[0],$=M[1],V=Object(n.useState)(!1),G=Object(d.a)(V,2),z=G[0],H=G[1],K=Object(n.useState)(!1),J=Object(d.a)(K,2),Y=J[0],q=J[1],X=Object(n.useState)(!1),Q=Object(d.a)(X,2),Z=Q[0],ee=Q[1],te=Object(n.useState)(!1),ae=Object(d.a)(te,2),ne=ae[0],re=ae[1],oe=Object(n.useCallback)((function(e,a,n){x((function(r){return r.map((function(r){return r.filePath===e.filePath?(r.markdown=a,t.writeNote(e.notebook,e.filePath,a,e.config).then((function(){n&&t.getStatus(e).then((function(e){n(e)}))})),r):r}))}))}),[t]),ie=Object(n.useCallback)((function(e){t.deleteNote(s,e.filePath),g((function(a){var n=a.filter((function(t){return t.filePath!==e.filePath}));return n.length!==a.length&&D(n[0]),t.getNotebookDirectoriesFromNotes(n).then((function(e){E(e)})),n})),re(!1)}),[t,s]),ce=Object(n.useCallback)((function(e,a){Object(I.a)(P.a.mark((function n(){var r;return P.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.changeNoteFilePath(s,e,a);case 3:return r=f.map((function(t){return t.filePath===e.filePath?(t.filePath=a,t.config.modifiedAt=new Date,t):t})),g(r),n.t0=E,n.next=8,t.getNotebookDirectoriesFromNotes(r);case 8:n.t1=n.sent,(0,n.t0)(n.t1),n.next=15;break;case 12:n.prev=12,n.t2=n.catch(0),new R.a({type:"error",text:"Failed to change file path",layout:"topRight",theme:"relax",timeout:5e3}).show();case 15:case"end":return n.stop()}}),n,null,[[0,12]])})))()}),[s,t,f]),le=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(I.a)(P.a.mark((function a(){var n,r,o,i;return P.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e||(e=U()),e.endsWith(".md")||(e+=".md"),n=_,r="$notes"===_||"$today"===_||"$todo"===_?e:A.relative(s.dir,A.resolve(s.dir,n,e)),o={id:"",tags:[],modifiedAt:new Date,createdAt:new Date},a.next=7,t.writeNote(s,r,"",o);case 7:i={notebook:s,filePath:r,title:"",markdown:"",config:o},g((function(e){return[i].concat(Object(N.a)(e))})),D(i),re(!0);case 11:case"end":return a.stop()}}),a)})))()}),[s,t,_]),se=Object(n.useCallback)(function(){var e=Object(I.a)(P.a.mark((function e(a,n,r,o,c,l,s){var u;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H(!0),e.prev=1,e.next=4,t.addNotebook({name:a,gitURL:n,branch:r,username:o,password:c,corsProxy:s,rememberCredentials:l});case 4:u=e.sent,i((function(e){return[u].concat(Object(N.a)(e))})),H(!1),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),H(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,a,n,r,o,i,c){return e.apply(this,arguments)}}(),[t]),ue=Object(n.useCallback)(function(){var e=Object(I.a)(P.a.mark((function e(a){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.updateNotebook(a);case 5:i((function(e){return Object(N.a)(e)})),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[t]),de=Object(n.useCallback)(function(){var e=Object(I.a)(P.a.mark((function e(a){var n;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.deleteNotebook(a._id);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:n=null,i((function(e){return e.filter((function(e){return n||e._id===a._id||(n=e),e._id!==a._id}))})),m(n);case 12:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),[t]),me=Object(n.useCallback)(function(){var e=Object(I.a)(P.a.mark((function e(a){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return q(!0),e.prev=3,e.next=6,t.pushNotebook(a);case 6:q(!1),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),q(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),[t]),pe=Object(n.useCallback)(function(){var e=Object(I.a)(P.a.mark((function e(a){var n;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return ee(!0),e.prev=3,e.next=6,t.pullNotebook(a);case 6:return ee(!1),e.next=9,t.listNotes({notebook:a.notebook,dir:"./",includeSubdirectories:!0});case 9:return e.t0=function(e,t){return t.config.modifiedAt.getTime()-e.config.modifiedAt.getTime()},n=e.sent.sort(e.t0),g(n),e.t1=E,e.next=15,t.getNotebookDirectoriesFromNotes(n);case 15:e.t2=e.sent,(0,e.t1)(e.t2),n.find((function(e){return e.filePath===S.filePath}))||D(n[0]),e.next=24;break;case 20:throw e.prev=20,e.t3=e.catch(3),ee(!1),e.t3;case 24:case"end":return e.stop()}}),e,null,[[3,20]])})));return function(t){return e.apply(this,arguments)}}(),[t,S]),be=Object(n.useCallback)(function(){var e=Object(I.a)(P.a.mark((function e(a){var n;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.checkoutNote(a);case 4:(n=e.sent)?(g((function(e){return e.map((function(e){return e.filePath===n.filePath?n:e}))})),x((function(e){return e.map((function(e){return e.filePath===n.filePath?n:e}))})),D(n)):(g((function(e){var n=e.filter((function(e){return e.filePath!==a.filePath}));return t.getNotebookDirectoriesFromNotes(n).then((function(e){E(e)})),n})),x((function(e){var t=e.filter((function(e){return e.filePath!==a.filePath}));return D(t[0]),t})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[t]);Object(n.useEffect)((function(){t&&Object(I.a)(P.a.mark((function e(){var a,n,r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.listNotebooks();case 2:if(a=e.sent,n=null,!a.length){e.next=12;break}i(a),r=localStorage.getItem("selectedNotebookID"),(n=a.find((function(e){return e._id===r})))||(n=a[0]),m(n),e.next=17;break;case 12:return e.next=14,t.addNotebook({name:"Unamed",corsProxy:"https://cors.isomorphic-git.org",gitURL:""});case 14:n=e.sent,i([n]),m(n);case 17:case"end":return e.stop()}}),e)})))()}),[t]),Object(n.useEffect)((function(){t&&Object(I.a)(P.a.mark((function e(){var a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.listNotes({notebook:s,dir:"./",includeSubdirectories:!0});case 2:return e.t0=function(e,t){return t.config.modifiedAt.getTime()-e.config.modifiedAt.getTime()},a=e.sent.sort(e.t0),g(a),e.t1=E,e.next=8,t.getNotebookDirectoriesFromNotes(a);case 8:e.t2=e.sent,(0,e.t1)(e.t2),D(a[0]);case 11:case"end":return e.stop()}}),e)})))()}),[t,s]),Object(n.useEffect)((function(){t&&s&&$("$notes")}),[t,s]),Object(n.useEffect)((function(){if(t&&s&&f){if(f.length&&f[0].notebook._id!==s._id)return;var e=[];e="$notes"===_?Object(N.a)(f):"$todo"===_?f.filter((function(e){return e.markdown.match(/(\*|-|\d+\.)\s\[(\s+|x|X)\]\s/gm)})):"$today"===_?f.filter((function(e){return Date.now()-e.config.modifiedAt.getTime()<=864e5})):T?f.filter((function(e){return 0===e.filePath.indexOf(_+"/")})):f.filter((function(e){return A.dirname(e.filePath)===_})),x(e),S||D(e[0])}}),[_,t,s,T,S,f]);var fe=Object(n.useCallback)((function(e){localStorage.setItem("selectedNotebookID",e._id),m(e)}),[m]);return{crossnote:t,notebooks:o,selectedNotebook:s,setSelectedNotebook:fe,notes:j,selectedNote:S,setSelectedNote:D,updateNoteMarkdown:oe,createNewNote:le,selectedDir:_,setSelectedDir:$,includeSubdirectories:T,setIncludeSubdirectories:F,deleteNote:ie,changeNoteFilePath:ce,notebookDirectories:w,addNotebook:se,isAddingNotebook:z,isPushingNotebook:Y,isPullingNotebook:Z,updateNotebook:ue,deleteNotebook:de,pushNotebook:me,pullNotebook:pe,checkoutNote:be,displayMobileEditor:ne,setDisplayMobileEditor:re}})),M=a(5613),_=a(5570),$=a(150);function V(e){var t=e.match(/^#\s.+$/gim);return t&&t.length?t[0].replace(/^#/,"").trim():""}function G(){return(G=Object(I.a)(P.a.mark((function e(t){var a,n,r,o,i,c,l,s,u;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="","",r="",o=[],!0,t=t.replace(/^---.+?\n---/,""),i=t,(c=t.match(/^#\s.+$/gim))&&c.length&&(a=c[0].replace(/^#/,"").trim(),l=t.slice(0,t.indexOf(c[0])).trim(),i=t.slice(t.indexOf(c[0])+c[0].length,t.length),(s=l.match(/^!\[.*?\]\(.+?\)/gim))&&s.length&&(o.push(s[0].match(/\(([^)"]+?)\)/)[1].trim()),r=o[0])),(u=t.match(/^!\[\s*cover\s*\]\(.+?\)/gim))&&u.length&&(u.forEach((function(e){o.push(e.match(/\(([^)"]+?)\)/)[1].trim())})),o=o.filter((function(e,t,a){return t===a.findIndex((function(t){return t===e}))}))),n=i.split("\n").filter((function(e){return e.trim().length>0&&!e.match(/!\[.*?\]\(.+?\)/)&&!e.match(/`@.+?`/)})).map((function(e){return e.replace(/#+\s(.+)\s*$/,"**$1**").trim()})).slice(0,10).join("  \n"),e.abrupt("return",{title:a,summary:n,coverImage:r,images:o,tags:[],html:"",hasMoreContent:!0,video:""});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=a(5600),H=Object(k.a)((function(e){return Object(j.a)({noteCard:{width:"100%",display:"flex",flexDirection:"row",alignItems:"flex-start",padding:e.spacing(2,.5,0),textAlign:"left",cursor:"default"},selected:{borderLeft:"4px solid ".concat(e.palette.primary.main)},unselected:{borderLeft:"4px solid rgba(0, 0, 0, 0)"},leftPanel:{width:"48px",paddingLeft:e.spacing(.5)},duration:{color:e.palette.text.secondary},rightPanel:{flex:"1",borderBottom:"1px solid #ededed"},header:{marginBottom:e.spacing(2),wordBreak:"break-all"},summary:{color:e.palette.text.secondary,marginBottom:e.spacing(2),paddingRight:e.spacing(2),display:"-webkit-box",lineHeight:"1.3rem !important",textOverflow:"ellipsis !important",overflow:"hidden !important",maxWidth:"100%",maxHeight:"2.6rem","-webkit-line-clamp":2,"-webkit-box-orient":"vertical",wordBreak:"break-all"},filePath:{}})}));function K(e){var t=H(e),a=e.note,o=W.useContainer(),i=Object(n.useState)(""),c=Object(d.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(null),p=Object(d.a)(m,2),b=p[0],h=p[1],v=Object(n.useState)(""),w=Object(d.a)(v,2),E=w[0],O=w[1],k=Object(u.b)().t,j=Object(z.a)(a.config.modifiedAt,Date.now()).replace(/\sseconds?/,"s").replace(/\sminutes?/,"m").replace(/\shours?/,"h").replace(/\sdays?/,"d").replace(/\sweeks?/,"w").replace(/\smonths?/,"mo").replace(/\syears?/,"y");return Object(n.useEffect)((function(){s(V(a.markdown)),function(e){return G.apply(this,arguments)}(a.markdown.trim()||k("general/this-note-is-empty")).then((function(e){h(e)})).catch((function(e){}))}),[a.markdown,k]),Object(n.useEffect)((function(){o.crossnote.getStatus(a).then((function(e){O(e)}))}),[a.markdown,a,o.crossnote]),r.a.createElement($.a,{className:Object(y.a)(t.noteCard,o.selectedNote&&o.selectedNote.filePath===a.filePath?t.selected:t.unselected),onClick:function(){o.setSelectedNote(a),o.setDisplayMobileEditor(!0)}},r.a.createElement(f.a,{className:Object(y.a)(t.leftPanel)},r.a.createElement(g.a,{className:Object(y.a)(t.duration)},j)),r.a.createElement(f.a,{className:Object(y.a)(t.rightPanel)},l&&r.a.createElement(g.a,{style:{fontWeight:"bold"},variant:"body1",className:Object(y.a)(t.header)},l),b&&r.a.createElement(g.a,{className:Object(y.a)(t.summary)},b&&b.summary),r.a.createElement(g.a,{variant:"caption",className:Object(y.a)(t.filePath)},a.filePath+" - "+E)))}var J=a(5602),Y=a(5604),q=a(5605),X=a(5627),Q=a(5636),Z=a(5609),ee=a(5610),te=a(5611),ae=a(5612),ne=a(5566);function re(e){var t=W.useContainer(),a=Object(n.useState)(""),o=Object(d.a)(a,2),i=o[0],c=o[1],l=Object(n.useState)(!1),s=Object(d.a)(l,2),u=s[0],m=s[1],p=Object(n.useState)(""),b=Object(d.a)(p,2),h=b[0],v=b[1],w=Object(n.useState)(""),E=Object(d.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(""),x=Object(d.a)(j,2),y=x[0],N=x[1],S=Object(n.useState)(""),D=Object(d.a)(S,2),A=D[0],B=D[1],R=Object(n.useState)("https://cors.isomorphic-git.org"),L=Object(d.a)(R,2),T=L[0],F=L[1],U=Object(n.useState)(3),M=Object(d.a)(U,2),_=M[0],$=M[1];Object(n.useEffect)((function(){var t=e.notebook;t&&(c(t.name),v(t.gitURL),k(t.gitBranch||"master"),N(t.gitUsername),B(t.gitPassword),F(t.gitCorsProxy))}),[e.notebook]);var V=Object(n.useCallback)(Object(I.a)(P.a.mark((function a(){var n;return P.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.notebook){a.next=4;break}return e.onClose(),a.abrupt("return");case 4:return n.name=i.trim(),n.gitURL=h.trim(),n.gitBranch=O.trim(),n.gitUsername=y.trim(),n.gitPassword=A,n.gitCorsProxy=T.trim(),a.prev=10,a.next=13,t.updateNotebook(n);case 13:a.next=17;break;case 15:a.prev=15,a.t0=a.catch(10);case 17:e.onClose();case 18:case"end":return a.stop()}}),a,null,[[10,15]])}))),[e,e.notebook,i,h,O,y,A,T]),G=Object(n.useCallback)(Object(I.a)(P.a.mark((function a(){var n;return P.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.notebook,a.prev=1,a.next=4,t.deleteNotebook(n);case 4:a.next=8;break;case 6:a.prev=6,a.t0=a.catch(1);case 8:e.onClose();case 9:case"end":return a.stop()}}),a,null,[[1,6]])}))),[e.notebook]);return Object(n.useEffect)((function(){$(3)}),[e.notebook]),r.a.createElement(J.a,{open:e.open,onClose:e.onClose},r.a.createElement(Y.a,null,"Configure a notebook"),r.a.createElement(q.a,null,r.a.createElement(X.a,{label:"Notebook name",value:i,fullWidth:!0,onChange:function(e){c(e.target.value)},style:{marginBottom:"16px"}}),r.a.createElement(Q.a,{elevation:2,expanded:u,onChange:function(){return m(!u)}},r.a.createElement(Z.a,{expandIcon:r.a.createElement(C.c,null)},r.a.createElement(g.a,null,"Git repository (optional)")),r.a.createElement(ee.a,null,r.a.createElement(f.a,null,r.a.createElement(X.a,{label:"url",placeholder:"https://abc/def.git",disabled:!0,fullWidth:!0,value:h,onChange:function(e){return v(e.target.value)}}),r.a.createElement(X.a,{label:"branch",placeholder:"master",disabled:!0,fullWidth:!0,value:O,onChange:function(e){return k(e.target.value)}}),r.a.createElement(X.a,{label:"username (optional)",placeholder:"username (optional)",fullWidth:!0,value:y,onChange:function(e){return N(e.target.value)}}),r.a.createElement(X.a,{label:"password (optional)",placeholder:"password (optional)",type:"password",fullWidth:!0,value:A,onChange:function(e){return B(e.target.value)}}),r.a.createElement(X.a,{label:"cors proxy",placeholder:"https://cors.isomorphic-git.org",fullWidth:!0,value:T,onChange:function(e){return F(e.target.value)}}),r.a.createElement(te.a,{href:"https://github.com/isomorphic-git/isomorphic-git#cors-support",target:"_blank"},"Why we need cors proxy?"))))),r.a.createElement(ae.a,null,r.a.createElement(ne.a,{variant:"contained",color:"secondary",disabled:!_,onClick:function(){1===_?(G(),$(_-1)):$(_-1)}},"Delete"+(_<3?" ".concat(_):"")),r.a.createElement(ne.a,{variant:"contained",color:"primary",onClick:V},"Save"),r.a.createElement(ne.a,{onClick:e.onClose},"Cancel")))}var oe=Object(k.a)((function(e){return Object(j.a)({notes:{display:"flex",flexDirection:"column",height:"100%"},topPanel:{padding:e.spacing(1)},row:{display:"flex",alignItems:"center"},sectionName:{marginLeft:e.spacing(1)},search:Object(m.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(x.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(x.b)(e.palette.common.white,.25)},marginRight:0,marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{}),searchIcon:{width:e.spacing(7),color:"rgba(0, 0, 0, 0.54)",height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",border:"1px solid #bbb",borderRadius:"4px"},inputInput:Object(m.a)({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{}),notesList:{flex:"1",overflowY:"auto",paddingBottom:e.spacing(12)}})}));function ie(e){var t=oe(e),a=Object(u.b)().t,o=W.useContainer(),i=Object(n.useState)(""),c=Object(d.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(!1),p=Object(d.a)(m,2),b=p[0],v=p[1];return r.a.createElement(f.a,{className:Object(y.a)(t.notes)},r.a.createElement(M.a,{className:Object(y.a)(t.topPanel)},r.a.createElement(f.a,{className:Object(y.a)(t.row)},r.a.createElement(E.a,{smUp:!0,implementation:"css"},r.a.createElement(h.a,{onClick:e.toggleDrawer},r.a.createElement(C.q,null))),r.a.createElement("div",{className:t.search},r.a.createElement("div",{className:t.searchIcon},r.a.createElement(C.p,null)),r.a.createElement(_.a,{placeholder:a("search/placeholder"),classes:{root:t.inputRoot,input:t.inputInput},value:l,inputProps:{"aria-label":"search"},onChange:function(e){return s(e.target.value)}})),r.a.createElement(h.a,{onClick:function(){o.createNewNote()}},r.a.createElement(C.l,null))),r.a.createElement(f.a,{className:Object(y.a)(t.row),style:{justifyContent:"space-between"}},"$notes"===o.selectedDir?r.a.createElement(f.a,{className:Object(y.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"notes"},"\ud83d\udcd2"),r.a.createElement(g.a,{className:Object(y.a)(t.sectionName)},o.selectedNotebook&&o.selectedNotebook.name)):"$today"===o.selectedDir?r.a.createElement(f.a,{className:Object(y.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"today-notes"},"\ud83d\uddd3"),r.a.createElement(g.a,{className:Object(y.a)(t.sectionName)}," today")):"$todo"===o.selectedDir?r.a.createElement(f.a,{className:Object(y.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"todo-notes"},"\u2611\ufe0f"),r.a.createElement(g.a,{className:Object(y.a)(t.sectionName)}," todo")):o.selectedDir&&r.a.createElement(f.a,{className:Object(y.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83d\udcc1"),r.a.createElement(g.a,{className:Object(y.a)(t.sectionName)},o.selectedDir)),"$notes"===o.selectedDir&&r.a.createElement(h.a,{onClick:function(){return v(!0)}},r.a.createElement(C.w,null)))),r.a.createElement(re,{open:b,onClose:function(){return v(!1)},notebook:o.selectedNotebook}),r.a.createElement(f.a,{className:Object(y.a)(t.notesList)},o.notes.map((function(e){if(!l.trim().length)return r.a.createElement(K,{key:"note-card-"+e.filePath,note:e});var t=new RegExp("("+l.trim().split(/\s+/g).join("|")+")","i");return e.title.match(t)||e.markdown.match(t)||e.filePath.match(t)?r.a.createElement(K,{key:"note-card-"+e.filePath,note:e}):void 0}))))}var ce=a(5614),le=a(5635),se=a(313),ue=a(5615),de=a(5616),me=a(113);function pe(e){var t=W.useContainer(),a=e.notebook,o=Object(n.useState)(localStorage.getItem("authorName")||"anonymous"),i=Object(d.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(localStorage.getItem("authorEmail")||"anonymous@crossnote.app"),u=Object(d.a)(s,2),m=u[0],p=u[1],b=Object(n.useState)(a.gitUsername),h=Object(d.a)(b,2),v=h[0],w=h[1],E=Object(n.useState)(a.gitPassword),O=Object(d.a)(E,2),k=O[0],j=O[1],x=Object(n.useState)("doc: Updated docs"),y=Object(d.a)(x,2),C=y[0],N=y[1],S=Object(n.useCallback)((function(){t.pushNotebook({notebook:a,authorName:c,authorEmail:m,username:v,password:k,message:C,onAuthFailure:function(){new R.a({type:"error",text:"Authentication failed",layout:"topRight",theme:"relax",timeout:5e3}).show()}}).then((function(){e.onClose(),new R.a({type:"success",text:"Notebook pushed",layout:"topRight",theme:"relax",timeout:2e3}).show()})).catch((function(t){console.log(t),e.onClose(),new R.a({type:"error",text:"Failed to push notebook",layout:"topRight",theme:"relax",timeout:2e3}).show()}))}),[m,c,v,k,a,C,e]);return Object(n.useEffect)((function(){localStorage.setItem("authorName",c)}),[c]),Object(n.useEffect)((function(){localStorage.setItem("authorEmail",m)}),[m]),Object(n.useEffect)((function(){w(a.gitUsername)}),[a.gitUsername,e.open]),Object(n.useEffect)((function(){j(a.gitPassword)}),[a.gitPassword,e.open]),r.a.createElement(J.a,{open:e.open,onClose:function(){t.isPushingNotebook||e.onClose()}},r.a.createElement(Y.a,null,"Push notebook ".concat(a.name," to git repository"),r.a.createElement(f.a,null,r.a.createElement(g.a,{variant:"caption"},a.gitURL+":"+a.gitBranch))),r.a.createElement(q.a,null,r.a.createElement(X.a,{label:"Author name",fullWidth:!0,value:c,onChange:function(e){return l(e.target.value)}}),r.a.createElement(X.a,{label:"Author email",fullWidth:!0,value:m,onChange:function(e){return p(e.target.value)}}),r.a.createElement(X.a,{label:"Commit message",fullWidth:!0,value:C,onChange:function(e){return N(e.target.value)}}),r.a.createElement(X.a,{label:"username",placeholder:"username",fullWidth:!0,value:v,onChange:function(e){return w(e.target.value)}}),r.a.createElement(X.a,{label:"password",placeholder:"password",type:"password",fullWidth:!0,value:k,onChange:function(e){return j(e.target.value)}})),r.a.createElement(ae.a,null,r.a.createElement(ne.a,{variant:"contained",color:"primary",disabled:t.isPushingNotebook,onClick:S},t.isPushingNotebook?"Pushing...":"Push"),r.a.createElement(ne.a,{onClick:e.onClose},"Cancel")))}var be,fe=a(5633),ge=a(164),he=Object(k.a)((function(e){return Object(j.a)({editorPanel:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},topPanel:{position:"relative",padding:e.spacing(.5,1),display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #eee",overflow:"auto"},bottomPanel:{position:"relative",padding:e.spacing(.5,1),display:"flex",alignItems:"center",justifyContent:"space-between",borderTop:"1px solid #eee"},controlBtn:{padding:e.spacing(.5,0),color:e.palette.text.secondary},controlBtnSelected:{color:e.palette.primary.main},row:{display:"flex",flexDirection:"row",alignItems:"center"},cursorPositionInfo:{zIndex:150},editorWrapper:{flex:1,overflow:"auto","& .CodeMirror-gutters":{display:"none"},"& .CodeMirror-code":{width:"100%"},"& .CodeMirror":Object(m.a)({height:"100%",padding:e.spacing(0,2)},e.breakpoints.down("sm"),{padding:e.spacing(0)}),"& .CodeMirror-vscrollbar":{display:"none !important"}},fullScreen:{position:"fixed",width:"100%",height:"100%",left:"0",top:"0",zIndex:2e3,overflow:"auto"},editor:{width:"100%",height:"100%"},preview:{position:"relative",left:"0",top:"0",width:"100%",height:"100%",border:"none",overflow:"auto !important",padding:e.spacing(2),zIndex:99},backBtn:Object(m.a)({marginRight:"8px"},e.breakpoints.up("sm"),{display:"none"}),menuItemOverride:{cursor:"default",padding:"0 0 0 ".concat(e.spacing(2),"px"),"&:hover":{backgroundColor:"inherit"}},menuItemTextField:{paddingRight:e.spacing(2)}})}));function ve(e){var t=e.note,a=he(e),o=Object(n.useState)(null),i=Object(d.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(null),m=Object(d.a)(s,2),p=m[0],b=m[1],v=Object(n.useState)({line:0,ch:0}),w=Object(d.a)(v,2),E=w[0],O=w[1],k=Object(n.useState)(!1),j=Object(d.a)(k,2),x=j[0],S=j[1],D=Object(n.useState)(!1),A=Object(d.a)(D,2),B=A[0],L=A[1],T=Object(n.useState)(!1),F=Object(d.a)(T,2),U=F[0],M=F[1],_=Object(n.useState)(t.filePath),$=Object(d.a)(_,2),V=$[0],G=$[1],z=Object(n.useState)(be.VickyMD),H=Object(d.a)(z,2),K=H[0],Q=H[1],Z=Object(n.useState)(null),ee=Object(d.a)(Z,2),te=ee[0],re=ee[1],oe=Object(n.useState)(""),ie=Object(d.a)(oe,2),ve=ie[0],we=ie[1],Ee=Object(n.useState)(!1),Oe=Object(d.a)(Ee,2),ke=Oe[0],je=Oe[1],xe=Object(n.useState)(null),ye=Object(d.a)(xe,2),Ce=ye[0],Ne=ye[1],Se=Object(n.useState)(""),Pe=Object(d.a)(Se,2),Ie=Pe[0],De=Pe[1],Ae=Object(n.useState)([]),Be=Object(d.a)(Ae,2),Re=Be[0],Le=Be[1],Te=W.useContainer(),Fe=Object(u.b)().t,Ue=Object(n.useCallback)((function(){L(!1),G(t.filePath)}),[t]),We=Object(n.useCallback)((function(e){Object(I.a)(P.a.mark((function a(){return P.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if((e=e.replace(/^\/+/,"")).endsWith(".md")||(e+=".md"),t.filePath===e){a.next=5;break}return a.next=5,Te.changeNoteFilePath(t,e);case 5:G(e),L(!1);case 7:case"end":return a.stop()}}),a)})))()}),[t,Ue]),Me=Object(n.useCallback)((function(){new R.a({type:"info",text:"Pulling notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),Te.pullNotebook({notebook:t.notebook,onAuthFailure:function(){new R.a({type:"error",text:"Authentication failed",layout:"topRight",theme:"relax",timeout:5e3}).show()}}).then((function(){new R.a({type:"success",text:"Notebook pulled",layout:"topRight",theme:"relax",timeout:2e3}).show()})).catch((function(e){console.log(e),new R.a({type:"error",text:"Failed to pull notebook",layout:"topRight",theme:"relax",timeout:2e3}).show()}))}),[t]),_e=Object(n.useCallback)((function(){Te.checkoutNote(t)}),[t]),$e=Object(n.useCallback)((function(){var e=Ie.trim()||"";t&&e.length&&p&&(Le((function(a){var n=a.indexOf(e)>=0?Object(N.a)(a):[e].concat(Object(N.a)(a));return t.config.tags=n.sort((function(e,t){return e.localeCompare(t)})),Te.updateNoteMarkdown(t,p.getValue(),(function(e){we(e)})),n})),De(""))}),[Ie,t,p]),Ve=Object(n.useCallback)((function(e){Le((function(a){var n=a.filter((function(t){return t!==e}));return t.config.tags=n.sort((function(e,t){return e.localeCompare(t)})),Te.updateNoteMarkdown(t,p.getValue(),(function(e){we(e)})),n}))}),[t,p]);return Object(n.useEffect)((function(){G(t.filePath)}),[t.filePath]),Object(n.useEffect)((function(){Te.crossnote.getStatus(t).then((function(e){we(e)}))}),[t,Te.crossnote]),Object(n.useEffect)((function(){Te.displayMobileEditor&&p&&p.setValue(t.markdown||"")}),[Te.displayMobileEditor,p,t.markdown]),Object(n.useEffect)((function(){if(c&&!p){var e=ge.fromTextArea(c,{mode:{name:"hypermd",hashtag:!0},inputStyle:"textarea"});e.setOption("lineNumbers",!1),e.setOption("foldGutter",!1),e.setValue(t.markdown||""),e.on("cursorActivity",(function(e){var t=e.getCursor();t&&O({line:t.line,ch:t.ch})})),b(e)}}),[c,t,p]),Object(n.useEffect)((function(){if(p&&t){Le(t.config.tags),p.setValue(t.markdown);var e=function(){var e=p.getValue();Te.updateNoteMarkdown(t,e,(function(e){we(e)}))};return p.on("changes",e),function(){p.off("changes",e)}}}),[p,t]),Object(n.useEffect)((function(){p&&(K===be.VickyMD?(ge.switchToHyperMD(p),p.getWrapperElement().style.display="block"):K===be.SourceCode?(ge.switchToNormal(p),p.getWrapperElement().style.display="block"):p.getWrapperElement().style.display="none")}),[K,p,t]),Object(n.useEffect)((function(){K===be.Preview&&p&&te&&(Object(me.renderPreview)(te,p.getValue()),te.childElementCount&&"IFRAME"===te.children[0].tagName.toUpperCase()?(te.style.maxWidth="100%",te.style.height="100%",te.style.overflow="hidden !important"):(te.style.height="auto",te.style.overflow="hidden !important"))}),[K,p,te,t]),Object(n.useEffect)((function(){if(p){var e=function(e,t){if(1===t.text.length&&"/"===t.text[0]&&p.showHint({closeOnUnfocus:!1,completeSingle:!1,hint:function(){var e=p.getCursor(),t=p.getTokenAt(e),a=t.string.lastIndexOf("/"),n=e.line,r=e.ch,o=t.string.slice(a+1,r),i=[{text:"# ",displayText:"/h1 - ".concat(Fe("editor/toolbar/insert-header-1"))},{text:"## ",displayText:"/h2 - ".concat(Fe("editor/toolbar/insert-header-2"))},{text:"### ",displayText:"/h3 - ".concat(Fe("editor/toolbar/insert-header-3"))},{text:"#### ",displayText:"/h4 - ".concat(Fe("editor/toolbar/insert-header-4"))},{text:"##### ",displayText:"/h5 - ".concat(Fe("editor/toolbar/insert-header-5"))},{text:"###### ",displayText:"/h6 - ".concat(Fe("editor/toolbar/insert-header-6"))},{text:"> ",displayText:"/blockquote - ".concat(Fe("editor/toolbar/insert-blockquote"))},{text:"* ",displayText:"/ul - ".concat(Fe("editor/toolbar/insert-unordered-list"))},{text:"1. ",displayText:"/ol - ".concat(Fe("editor/toolbar/insert-ordered-list"))},{text:"`@crossnote.image`\n",displayText:"/image - ".concat(Fe("editor/toolbar/insert-image"))},{text:"|   |   |\n|---|---|\n|   |   |\n",displayText:"/table - ".concat(Fe("editor/toolbar/insert-table"))},{text:"`@timer "+JSON.stringify({date:(new Date).toString()}).replace(/^{/,"").replace(/}$/,"")+"`\n",displayText:"/timer - ".concat(Fe("editor/toolbar/insert-clock"))},{text:"",displayText:"/emoji - ".concat(Fe("editor/toolbar/insert-emoji"))},{text:"`@crossnote.audio`  \n",displayText:"/audio - ".concat(Fe("editor/toolbar/audio-url"))},{text:"`@crossnote.netease_music`  \n",displayText:"/netease - ".concat(Fe("editor/toolbar/netease-music"))},{text:"`@crossnote.video`  \n",displayText:"/video - ".concat(Fe("editor/toolbar/video-url"))},{text:"`@crossnote.youtube`  \n",displayText:"/youtube - ".concat(Fe("editor/toolbar/youtube"))},{text:"`@crossnote.bilibili`  \n",displayText:"/bilibili - ".concat(Fe("editor/toolbar/bilibili"))},{text:"\x3c!-- slide --\x3e  \n",displayText:"/slide - ".concat(Fe("editor/toolbar/insert-slide"))},{text:"`@crossnote.ocr`  \n",displayText:"/ocr - ".concat(Fe("editor/toolbar/insert-ocr"))},{text:'`@crossnote.kanban "v":2,"board":{"columns":[]}`  \n',displayText:"/kanban - ".concat(Fe("editor/toolbar/insert-kanban")," (beta)")},{text:"`@crossnote.abc`  \n",displayText:"/abc - ".concat(Fe("editor/toolbar/insert-abc-notation"))}],c=i.filter((function(e){return e.displayText.toLocaleLowerCase().indexOf(o.toLowerCase())>=0}));return{list:c.length?c:i,from:{line:n,ch:a},to:{line:n,ch:r}}}}),t.text.length>0&&t.text[0].startsWith("`@timer ")&&t.removed.length>0&&t.removed[0].startsWith("/")){for(var a=p.getValue().split("\n"),n=[],r=0;r<a.length;r++){var o=a[r].match(/^`@timer\s.+`/);if(o){var i=o[0],c=i.match(/^`@timer\s+(.+)`/);if(!c||!c.length)continue;var l=c[1];try{var s=JSON.parse("{".concat(l,"}")).date;s&&n.push({text:i,line:r,date:new Date(s)})}catch(g){continue}}}for(var u=1;u<n.length;u++){var d=n[u],m=n[u-1],b=Object(fe.a)(d.date,m.date,{includeSeconds:!0}),f="`@timer ".concat(JSON.stringify({date:d.date.toString(),duration:b}).replace(/^{/,"").replace(/}$/,""),"`");p.replaceRange(f,{line:d.line,ch:0},{line:d.line,ch:d.text.length})}}};p.on("change",e);var t=function(e){};return p.on("cursorActivity",t),function(){p.off("change",e),p.off("cursorActivity",t)}}}),[p,t]),r.a.createElement(f.a,{className:Object(y.a)(a.editorPanel)},r.a.createElement(f.a,{className:Object(y.a)(a.topPanel)},r.a.createElement(f.a,{className:Object(y.a)(a.row)},r.a.createElement(ce.a,{className:Object(y.a)(a.backBtn)},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:function(){Te.setDisplayMobileEditor(!1)}},r.a.createElement(C.d,null))),r.a.createElement(ce.a,{variant:"outlined",color:"default","aria-label":"editor mode"},r.a.createElement(le.a,{title:Fe("general/vickymd")},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn,K===be.VickyMD&&a.controlBtnSelected),color:K===be.VickyMD?"primary":"default",onClick:function(){return Q(be.VickyMD)}},r.a.createElement(C.r,null))),r.a.createElement(le.a,{title:Fe("editor/note-control/source-code")},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn,K===be.SourceCode&&a.controlBtnSelected),color:K===be.SourceCode?"primary":"default",onClick:function(){return Q(be.SourceCode)}},r.a.createElement(C.i,null))),r.a.createElement(le.a,{title:Fe("editor/note-control/preview")},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn,K===be.Preview&&a.controlBtnSelected),color:K===be.Preview?"primary":"default",onClick:function(){return Q(be.Preview)}},r.a.createElement(C.m,null)))),r.a.createElement(ce.a,{style:{marginLeft:"8px"}},r.a.createElement(le.a,{title:"Tags"},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:function(e){return Ne(e.currentTarget)}},r.a.createElement(C.x,null)))),r.a.createElement(ce.a,{style:{marginLeft:"8px"}},r.a.createElement(le.a,{title:"Fullscreen"},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:function(){return je(!0)}},r.a.createElement(C.n,null)))),r.a.createElement(ce.a,{style:{marginLeft:"8px"}},r.a.createElement(le.a,{title:"Change file path"},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:function(){return L(!0)}},r.a.createElement(C.u,null))),r.a.createElement(le.a,{title:"Restore (checkout)"},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:_e},r.a.createElement(C.v,null))),r.a.createElement(le.a,{title:"Delete file"},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:function(){return S(!0)}},r.a.createElement(C.k,null)))),t.notebook.gitURL&&r.a.createElement(ce.a,{style:{marginLeft:"8px"}},r.a.createElement(le.a,{title:"Push"},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:function(){return M(!0)}},r.a.createElement(C.h,null))),r.a.createElement(le.a,{title:"Pull"},r.a.createElement(ne.a,{className:Object(y.a)(a.controlBtn),onClick:Me,disabled:Te.isPullingNotebook},r.a.createElement(C.g,null)))),r.a.createElement(se.a,{open:Boolean(Ce),anchorEl:Ce,keepMounted:!0,onClose:function(){return Ne(null)}},r.a.createElement(ue.a,{className:Object(y.a)(a.menuItemOverride,a.menuItemTextField)},r.a.createElement(X.a,{placeholder:"Add tag...",autoFocus:!0,value:Ie,onChange:function(e){return De(e.target.value)},onKeyUp:function(e){13===e.which&&$e()}})),Re.length>0?Re.map((function(e){return r.a.createElement(ue.a,{key:e,className:Object(y.a)(a.menuItemOverride)},r.a.createElement(f.a,{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%"}},r.a.createElement(g.a,null,e),r.a.createElement(h.a,{onClick:function(){return Ve(e)}},r.a.createElement(C.f,null))))})):r.a.createElement(ue.a,{className:Object(y.a)(a.menuItemOverride)},r.a.createElement(g.a,null,"No tags"))))),r.a.createElement(f.a,{className:Object(y.a)(a.editorWrapper,ke?a.fullScreen:null)},r.a.createElement("textarea",{className:Object(y.a)(a.editor,"editor-textarea"),placeholder:Fe("editor/placeholder"),ref:function(e){l(e)}}),K===be.Preview&&p?r.a.createElement("div",{className:Object(y.a)(a.preview,"preview"),id:"preview",ref:function(e){re(e)}}):null,ke&&r.a.createElement(h.a,{style:{position:"fixed",right:"0",top:"0",zIndex:2001},onClick:function(){return je(!1)}},r.a.createElement(C.o,null))),r.a.createElement(f.a,{className:Object(y.a)(a.bottomPanel)},r.a.createElement(f.a,{className:Object(y.a)(a.row)},r.a.createElement(g.a,{variant:"caption",style:{cursor:"pointer"},onClick:function(){L(!0)}},t.filePath),r.a.createElement(g.a,{variant:"caption",style:{marginLeft:"4px"}},"- "+ve)),r.a.createElement(f.a,{className:Object(y.a)(a.cursorPositionInfo)},r.a.createElement(g.a,{variant:"caption"},"Ln ".concat(E.line+1,", Col ").concat(E.ch)))),r.a.createElement(J.a,{open:x,onClose:function(){return S(!1)}},r.a.createElement(Y.a,null,"Are you sure to delete this file?"),r.a.createElement(q.a,null,r.a.createElement(de.a,null,"Can't be undone")),r.a.createElement(ae.a,null,r.a.createElement(ne.a,{style:{color:"red"},onClick:function(){Te.deleteNote(t),S(!1)}},"Delete"),r.a.createElement(ne.a,{onClick:function(){return S(!1)}},"Cancel"))),r.a.createElement(J.a,{open:B,onClose:Ue},r.a.createElement(Y.a,null,"Change file path"),r.a.createElement(q.a,null,r.a.createElement(X.a,{value:V,autoFocus:!0,onChange:function(e){return G(e.target.value)},onKeyUp:function(e){13===e.which&&We(V)}})),r.a.createElement(ae.a,null,r.a.createElement(ne.a,{onClick:function(){return We(V)}},"Save"),r.a.createElement(ne.a,{onClick:Ue},"Cancel"))),r.a.createElement(pe,{open:U,onClose:function(){return M(!1)},notebook:t.notebook}))}!function(e){e.VickyMD="VickyMD",e.SourceCode="SourceCode",e.Preview="Preview"}(be||(be={}));var we=a(5617),Ee=a(5632);function Oe(e){var t=W.useContainer(),a=Object(n.useState)(""),o=Object(d.a)(a,2),i=o[0],c=o[1],l=Object(n.useState)(!1),s=Object(d.a)(l,2),u=s[0],m=s[1],p=Object(n.useState)(""),b=Object(d.a)(p,2),h=b[0],v=b[1],w=Object(n.useState)(""),E=Object(d.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(""),x=Object(d.a)(j,2),y=x[0],N=x[1],S=Object(n.useState)(""),D=Object(d.a)(S,2),A=D[0],B=D[1],L=Object(n.useState)("https://cors.isomorphic-git.org"),T=Object(d.a)(L,2),F=T[0],U=T[1],M=Object(n.useState)(!1),_=Object(d.a)(M,2),$=_[0],V=_[1],G=Object(n.useCallback)(Object(I.a)(P.a.mark((function a(){return P.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,new R.a({type:"info",text:"Getting notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),a.next=4,t.addNotebook(i,h,O,y,A,$,F);case 4:e.onClose(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),new R.a({type:"error",text:"Failed to get notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),e.onClose();case 11:case"end":return a.stop()}}),a,null,[[0,7]])}))),[e,i,h,O,y,A,$,F]);return r.a.createElement(J.a,{open:e.open,onClose:function(){t.isAddingNotebook||e.onClose()}},r.a.createElement(Y.a,null,"Add a notebook"),r.a.createElement(q.a,null,r.a.createElement(X.a,{label:"Notebook name",value:i,fullWidth:!0,onChange:function(e){c(e.target.value)},style:{marginBottom:"16px"}}),r.a.createElement(Q.a,{elevation:2,expanded:u,onChange:function(){return m(!u)}},r.a.createElement(Z.a,{expandIcon:r.a.createElement(C.c,null)},r.a.createElement(g.a,null,"Git repository (optional)")),r.a.createElement(ee.a,null,r.a.createElement(f.a,null,r.a.createElement(X.a,{label:"url",placeholder:"https://abc/def.git",fullWidth:!0,value:h,onChange:function(e){return v(e.target.value)}}),r.a.createElement(X.a,{label:"branch",placeholder:"master",fullWidth:!0,value:O,onChange:function(e){return k(e.target.value)}}),r.a.createElement(X.a,{label:"username (optional)",placeholder:"username (optional)",fullWidth:!0,value:y,onChange:function(e){return N(e.target.value)}}),r.a.createElement(X.a,{label:"password (optional)",placeholder:"password (optional)",type:"password",fullWidth:!0,value:A,onChange:function(e){return B(e.target.value)}}),r.a.createElement(we.a,{control:r.a.createElement(Ee.a,{checked:$,onChange:function(){return V(!$)},value:$}),label:r.a.createElement(g.a,null,"Remember credentials "+($?"(stored locally)":""))}),r.a.createElement(X.a,{label:"cors proxy",placeholder:"https://cors.isomorphic-git.org",fullWidth:!0,value:F,onChange:function(e){return U(e.target.value)}}),r.a.createElement(te.a,{href:"https://github.com/isomorphic-git/isomorphic-git#cors-support",target:"_blank"},"Why we need cors proxy?"))))),r.a.createElement(ae.a,null,r.a.createElement(ne.a,{variant:"contained",color:"primary",onClick:G,disabled:t.isAddingNotebook},t.isAddingNotebook?"Adding...":"Add"),e.canCancel&&r.a.createElement(ne.a,{onClick:e.onClose},"Cancel")))}var ke=a(5618),je=a(5619),xe=Object(k.a)((function(e){return Object(j.a)({treeItemRoot:{paddingLeft:"4px","&:focus > $treeItemContent":{color:"#1a73e8",backgroundColor:"#e8f0fe"},"&:focus > $treeItemLabelIcon":{color:"#1a73e8"}},treeItemContent:{cursor:"default",color:e.palette.text.primary,userSelect:"none",fontWeight:e.typography.fontWeightMedium,"$treeItemExpanded > &":{fontWeight:e.typography.fontWeightRegular}},treeItemGroup:{marginLeft:0,"& $treeItemContent":{}},treeItemExpanded:{},treeItemLabel:{fontWeight:"inherit",color:"inherit"},treeItemLabelRoot:{display:"flex",alignItems:"center",padding:e.spacing(1,0)},treeItemLabelIcon:{color:"rgba(0, 0, 0, 0.54)"},treeItemLabelText:{paddingLeft:"12px",flexGrow:1}})}));function ye(e){var t=xe(),a=W.useContainer(),o=Object(n.useState)([]),i=Object(d.a)(o,2),c=i[0],l=i[1],s=Object(n.useCallback)((function(t,n){t.stopPropagation();var r=t.target;r&&r.tagName&&r.tagName.toUpperCase().match(/^(SVG|PATH|BUTTON)$/)&&(a.setSelectedNotebook(e.notebook),l(n))}),[e.notebook]);return Object(n.useEffect)((function(){a.selectedNotebook!==e.notebook&&l([])}),[a.selectedNotebook,e.notebook]),r.a.createElement(je.a,{defaultExpandIcon:r.a.createElement(h.a,{disableFocusRipple:!0,disableRipple:!0,size:"medium"},r.a.createElement(C.e,null)),defaultCollapseIcon:r.a.createElement(h.a,{disableFocusRipple:!0,disableRipple:!0,size:"medium"},r.a.createElement(C.c,null)),defaultEndIcon:r.a.createElement("div",{style:{width:24}}),expanded:c,onNodeToggle:s,style:{width:"100%"}},r.a.createElement(ke.a,{nodeId:"notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(f.a,{onClick:function(){a.setSelectedNotebook(e.notebook),a.setSelectedDir("$notes")},className:Object(y.a)(t.treeItemLabelRoot)},r.a.createElement(g.a,{color:"inherit",variant:"body1",className:Object(y.a)(t.treeItemLabelText)},e.notebook.name))},r.a.createElement(ke.a,{nodeId:"today-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(f.a,{onClick:function(){a.setSelectedDir("$today")},className:Object(y.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"today-notes"},"\ud83d\uddd3"),r.a.createElement(g.a,{className:Object(y.a)(t.treeItemLabelText)},"today"))}),r.a.createElement(ke.a,{nodeId:"todo-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(f.a,{onClick:function(){a.setSelectedDir("$todo")},className:Object(y.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"todo-notes"},"\u2611\ufe0f"),r.a.createElement(g.a,{className:Object(y.a)(t.treeItemLabelText)},"todo"))}),r.a.createElement(ke.a,{nodeId:"directories",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(f.a,{onClick:function(){a.setSelectedDir("$notes")},className:Object(y.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"directories"},"\ud83d\uddc2"),r.a.createElement(g.a,{className:Object(y.a)(t.treeItemLabelText)},"notes"))},function e(n){return"."===n.name?r.a.createElement(r.a.Fragment,null,n.children.map((function(t){return e(t)}))):r.a.createElement(ke.a,{nodeId:n.name,classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},endIcon:r.a.createElement("div",{style:{width:24}}),key:n.name,label:r.a.createElement(f.a,{onClick:function(){a.setSelectedDir(n.path)},className:Object(y.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83d\udcc1"),r.a.createElement(g.a,{color:"inherit",variant:"body1",className:Object(y.a)(t.treeItemLabelText)},n.name))},n.children.map((function(t){return e(t)})))}(a.notebookDirectories))))}var Ce=Object(k.a)((function(e){var t;return Object(j.a)({page:{display:"flex",width:"100%",height:"100%",backgroundColor:"#2196F1"},appBar:{zIndex:e.zIndex.drawer+1,boxShadow:"none"},toolBar:{display:"flex",flexDirection:"row",justifyContent:"space-between"},search:Object(m.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(x.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(x.b)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:Object(m.a)({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:200}),displayNone:{display:"none"},drawer:Object(m.a)({},e.breakpoints.up("sm"),{width:200,flexShrink:0}),drawerPaper:{width:200},selectedSection:{backgroundColor:"#ccc"},left:{display:"flex",flexDirection:"row",alignItems:"center"},menuButton:{marginRight:e.spacing(2)},mainPanel:{position:"relative",display:"flex",flexDirection:"row",flexGrow:1,overflow:"auto",backgroundColor:"#eee"},notesPanel:Object(m.a)({width:"".concat(350,"px"),maxWidth:"100%",height:"100%"},e.breakpoints.down("xs"),{width:"100%"}),editorPanel:(t={width:"calc(100% - ".concat(350,"px)"),position:"absolute",left:"calc(".concat(350,"px)"),height:"100%"},Object(m.a)(t,e.breakpoints.down("md"),{width:"calc(100% - ".concat(350,"px)"),left:"".concat(350,"px")}),Object(m.a)(t,e.breakpoints.down("xs"),{display:"none",top:"0",left:"0",width:"100%",height:"100%"}),t),toolBarSpace:e.mixins.toolbar})}));function Ne(e){var t=Ce(e),a=W.useContainer(),o=Object(n.useState)(!1),i=Object(d.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(!1),u=Object(d.a)(s,2),m=u[0],k=u[1],j=Object(n.useCallback)((function(){k(!m)}),[m]),x=r.a.createElement("div",null,r.a.createElement(p.a,{disablePadding:!0},r.a.createElement(b.a,{disableGutters:!0},r.a.createElement(f.a,{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:"0 8px"}},r.a.createElement(g.a,{variant:"body1",style:{fontWeight:"bold"}},"Notebooks"),r.a.createElement(h.a,{onClick:function(){return l(!0)}},r.a.createElement(C.t,null)))),a.notebooks.map((function(e){return r.a.createElement(b.a,{disableGutters:!0,style:{padding:"0"},key:e._id},r.a.createElement(ye,{notebook:e}))})))),N=r.a.createElement(v.a,{className:Object(y.a)(t.notesPanel)},r.a.createElement(ie,{toggleDrawer:j}));return r.a.createElement(f.a,{className:Object(y.a)(t.page)},r.a.createElement(w.a,null),r.a.createElement("nav",{className:t.drawer},r.a.createElement(E.a,{smUp:!0,implementation:"css"},r.a.createElement(O.a,{variant:"temporary",open:m,onClose:j,classes:{paper:t.drawerPaper},ModalProps:{keepMounted:!0}},x)),r.a.createElement(E.a,{xsDown:!0,implementation:"css"},r.a.createElement(O.a,{classes:{paper:t.drawerPaper},variant:"permanent",open:!0},x))),r.a.createElement(f.a,{className:Object(y.a)(t.mainPanel),id:"main-panel"},N,r.a.createElement(v.a,{className:Object(y.a)(t.editorPanel),style:{display:a.displayMobileEditor&&a.selectedNote&&"block"}},a.selectedNote&&r.a.createElement(ve,{note:a.selectedNote}))),r.a.createElement(Oe,{open:c,onClose:function(){return l(!1)},canCancel:!0}))}var Se=a(310),Pe=a(145),Ie=a(144),De=a(5625),Ae=(a(14),a(247),a(5440),a(5441),a(256),a(5443),a(5444),a(263),a(5445),a(5446),a(5447),a(164),a(5448),a(162),a(158),a(160),a(163),a(5450),a(55)),Be=a(5621),Re=a(5606);function Le(){return(Le=Object(I.a)(P.a.mark((function e(){var t,a,n,r,o=arguments;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:[],a=[],n=function(e){var n=t[e];if(!n.type.match("image.*"))return"continue";a.push(new Promise((function(e,t){var a=new FormData;a.append("smfile",n),a.append("format","json"),fetch("https://sm.ms/api/v2/upload",{method:"POST",mode:"cors",headers:{},referrer:"",body:a}).then((function(e){return e.json()})).then((function(a){return a.success?e(a.data.url):"image_repeated"===a.code||"exception"===a.code&&a.message.match(/this image exists at:/)?e(a.message.match(/https:\/\/.+$/)[0]):t(a.message)})).catch((function(e){return t("Failed to connect to sm.ms host")}))})))},r=0;case 4:if(!(r<t.length)){e.next=11;break}if("continue"!==n(r)){e.next=8;break}return e.abrupt("continue",8);case 8:r++,e.next=4;break;case 11:return e.next=13,Promise.all(a);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Te=Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function Fe(e){var t=Te(e),a=Object(u.b)().t,o=Object(n.useState)(""),i=Object(d.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(!1),m=Object(d.a)(s,2),p=m[0],b=m[1],v=Object(n.useState)(null),w=Object(d.a)(v,2),E=w[0],O=w[1],k=Object(n.useState)(!1),j=Object(d.a)(k,2),x=j[0],N=j[1];return e.isPreview?r.a.createElement("span",null):r.a.createElement(M.a,{elevation:2,className:Object(y.a)(t.card)},r.a.createElement(g.a,{variant:"h5"},a("widget/crossnote.image/image-helper")),r.a.createElement(f.a,{className:Object(y.a)(t.actionButtons)},r.a.createElement(le.a,{title:a("general/Delete")},r.a.createElement(h.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),!x&&r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(we.a,{label:a("widget/crossnote.image/set-as-cover-image-in-note-card"),control:r.a.createElement(Be.a,{checked:p,onChange:function(){return b(!p)},color:"primary"})})),!x&&r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Link")),r.a.createElement(Re.a,{margin:"dense",placeholder:a("widget/crossnote.image/image-url-placeholder"),value:c,onChange:function(e){l(e.target.value)},onKeyDown:function(t){13===t.which&&e.replaceSelf("![".concat(p?"cover":"","](").concat(c,")\n"))},fullWidth:!0})),r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Upload")),r.a.createElement(f.a,{className:Object(y.a)(t.dropArea,x?t.disabled:null),onClick:function(t){t.preventDefault(),t.stopPropagation(),E&&!x&&(E.onchange=function(t){var n=t.target.files||[];new R.a({type:"info",text:a("utils/uploading-image"),layout:"topRight",theme:"relax",timeout:2e3}).show(),N(!0),function(){return Le.apply(this,arguments)}(n).then((function(t){var a="";t.forEach((function(e){a+="![".concat(p?"cover":"","](").concat(e,")  \n")})),e.replaceSelf(a)})).catch((function(e){N(!1),new R.a({type:"error",text:a("utils/upload-image-failure"),layout:"topRight",theme:"relax",timeout:2e3}).show()}))},E.click())}},r.a.createElement(g.a,null,a(x?"utils/uploading-image":"widget/crossnote.image/click-here-to-browse-image-file")))),r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(g.a,{variant:"caption"},a("widget/crossnote.image/thanks_sm_ms"))),r.a.createElement("input",{type:"file",multiple:!0,style:{display:"none"},ref:function(e){O(e)}}))}var Ue=Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function We(e){var t=e.attributes,a=Ue(e),o=Object(u.b)().t,i=Object(n.useState)(t.source||""),c=Object(d.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(t.autoplay||!1),p=Object(d.a)(m,2),b=p[0],v=p[1],w=Object(n.useState)(t.controls||!0),E=Object(d.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(t.loop||!1),x=Object(d.a)(j,2),N=x[0],S=x[1],P=Object(n.useState)(t.muted||!1),I=Object(d.a)(P,2),D=I[0],A=I[1];return t.src?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement("audio",{autoPlay:t.autoplay||t.autoPlay,controls:t.controls,loop:t.loop,muted:t.muted,style:t.style},o("widget/crossnote.audio/audio_element_fail"),r.a.createElement("source",{src:t.src,type:t.type})),!e.isPreview&&!t.controls&&"\ud83c\udfb5"):e.isPreview?r.a.createElement("span",null):r.a.createElement(M.a,{elevation:2,className:Object(y.a)(a.card)},r.a.createElement(g.a,{variant:"h5"},o("general/Audio")),r.a.createElement(f.a,{className:Object(y.a)(a.actionButtons)},r.a.createElement(le.a,{title:o("general/Delete")},r.a.createElement(h.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/source-url")),r.a.createElement(Re.a,{margin:"dense",placeholder:o("widget/crossnote.audio/source-url-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:b,controls:O,loop:N,muted:D,src:l};e.replaceSelf("`@crossnote.audio ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(we.a,{label:o("widget/autoplay"),control:r.a.createElement(Be.a,{checked:b,onChange:function(){return v(!b)},color:"primary"})}),r.a.createElement(we.a,{label:o("widget/controls"),control:r.a.createElement(Be.a,{checked:O,onChange:function(){return k(!O)},color:"primary"})}),r.a.createElement(we.a,{label:o("widget/loop"),control:r.a.createElement(Be.a,{checked:N,onChange:function(){return S(!N)},color:"primary"})}),r.a.createElement(we.a,{label:o("widget/muted"),control:r.a.createElement(Be.a,{checked:D,onChange:function(){return A(!D)},color:"primary"})})))}var Me=Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function _e(e){var t=e.attributes,a=Me(e),o=Object(u.b)().t,i=Object(n.useState)(t.id||""),c=Object(d.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(t.autoplay||!1),p=Object(d.a)(m,2),b=p[0],v=p[1];return t.id?r.a.createElement("iframe",{title:"netease_music_"+t.id,style:{maxWidth:"100%",width:"333px",height:"86px",border:"none"},src:"https://music.163.com/outchain/player?type=2&id=".concat(t.id,"&auto=").concat(t.autoplay?"1":"0","&height=66")}):e.isPreview?r.a.createElement("span",null):r.a.createElement(M.a,{elevation:2,className:Object(y.a)(a.card)},r.a.createElement(g.a,{variant:"h5"},o("general/Audio")),r.a.createElement(f.a,{className:Object(y.a)(a.actionButtons)},r.a.createElement(le.a,{title:o("general/Delete")},r.a.createElement(h.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/ID")),r.a.createElement(Re.a,{margin:"dense",placeholder:o("widget/crossnote.neteasemusic/song-id-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:b,id:l};e.replaceSelf("`@crossnote.netease_music ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(we.a,{label:o("widget/autoplay"),control:r.a.createElement(Be.a,{checked:b,onChange:function(){return v(!b)},color:"primary"})})))}var $e=Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%"}})}));function Ve(e){var t=e.attributes,a=$e(e),o=Object(u.b)().t,i=Object(n.useState)(t.source||""),c=Object(d.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(t.autoplay||!1),p=Object(d.a)(m,2),b=p[0],v=p[1],w=Object(n.useState)(t.controls||!0),E=Object(d.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(t.loop||!1),x=Object(d.a)(j,2),N=x[0],S=x[1],P=Object(n.useState)(t.muted||!1),I=Object(d.a)(P,2),D=I[0],A=I[1],B=Object(n.useState)(t.poster||""),R=Object(d.a)(B,2),L=R[0],T=R[1];return t.src?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(f.a,{className:Object(y.a)(a.videoWrapper)},r.a.createElement("video",{className:Object(y.a)(a.video),autoPlay:t.autoplay||t.autoPlay,controls:t.controls,loop:t.loop,muted:t.muted,style:t.style,poster:t.poster},o("widget/crossnote.video/video_element_fail"),r.a.createElement("source",{src:t.src,type:t.type})))):e.isPreview?r.a.createElement("span",null):r.a.createElement(M.a,{elevation:2,className:Object(y.a)(a.card)},r.a.createElement(g.a,{variant:"h5"},o("general/Video")),r.a.createElement(f.a,{className:Object(y.a)(a.actionButtons)},r.a.createElement(le.a,{title:o("general/Delete")},r.a.createElement(h.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/source-url")),r.a.createElement(Re.a,{margin:"dense",placeholder:o("widget/crossnote.video/video-url-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:b,controls:O,loop:N,muted:D,src:l,poster:L};e.replaceSelf("`@crossnote.video ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("widget/crossnote.video/poster-url")),r.a.createElement(Re.a,{margin:"dense",placeholder:o("widget/crossnote.video/poster-url-placeholder"),value:L,onChange:function(e){T(e.target.value)},fullWidth:!0})),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(we.a,{label:o("widget/autoplay"),control:r.a.createElement(Be.a,{checked:b,onChange:function(){return v(!b)},color:"primary"})}),r.a.createElement(we.a,{label:o("widget/controls"),control:r.a.createElement(Be.a,{checked:O,onChange:function(){return k(!O)},color:"primary"})}),r.a.createElement(we.a,{label:o("widget/loop"),control:r.a.createElement(Be.a,{checked:N,onChange:function(){return S(!N)},color:"primary"})}),r.a.createElement(we.a,{label:o("widget/muted"),control:r.a.createElement(Be.a,{checked:D,onChange:function(){return A(!D)},color:"primary"})})))}var Ge=Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{backgroundColor:"#ddd",border:"none",position:"absolute",left:"0",top:"0",width:"100%",height:"100%"},errorMessage:{color:"#f44336",marginTop:e.spacing(2)}})}));function ze(e){var t=e.attributes,a=Ge(e),o=Object(u.b)().t,i=Object(n.useState)(""),c=Object(d.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(""),p=Object(d.a)(m,2),b=p[0],v=p[1];return t.aid?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(f.a,{className:Object(y.a)(a.videoWrapper)},r.a.createElement("iframe",{title:"bilibili_"+t.id,className:Object(y.a)(a.video),src:"https://player.bilibili.com/player.html?aid=".concat(t.aid),scrolling:"no",frameBorder:"no",allowFullScreen:!0}))):e.isPreview?r.a.createElement("span",null):r.a.createElement(M.a,{elevation:2,className:Object(y.a)(a.card)},r.a.createElement(g.a,{variant:"h5"},o("widget/crossnote.bilibili/Bilibili")),r.a.createElement(f.a,{className:Object(y.a)(a.actionButtons)},r.a.createElement(le.a,{title:o("general/Delete")},r.a.createElement(h.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("widget/crossnote.bilibili/bilibili-video-url")),r.a.createElement(Re.a,{margin:"dense",placeholder:o("widget/crossnote.bilibili/url-placeholder"),value:l,onChange:function(e){s(e.target.value),v("")},onKeyDown:function(t){if(13===t.which)if(l&&l.match(/bilibili\.com\/video\/av(\d+)/)){var a={aid:l.match(/bilibili\.com\/video\/av(\d+)/)[1]};e.replaceSelf("`@crossnote.bilibili ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}else v(o("widget/crossnote.bilibili/error_message"))},fullWidth:!0}),r.a.createElement(g.a,{className:Object(y.a)(a.errorMessage)},b)))}var He=Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{backgroundColor:"#ddd",border:"none",position:"absolute",left:"0",top:"0",width:"100%",height:"100%"},errorMessage:{color:"#f44336",marginTop:e.spacing(2)}})}));function Ke(e){var t=e.attributes,a=He(e),o=Object(u.b)().t,i=Object(n.useState)(""),c=Object(d.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(""),p=Object(d.a)(m,2),b=p[0],v=p[1];return t.videoID?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(f.a,{className:Object(y.a)(a.videoWrapper)},r.a.createElement("iframe",{title:"youtube_"+t.videoID,className:Object(y.a)(a.video),src:"https://www.youtube.com/embed/".concat(t.videoID),scrolling:"no",frameBorder:"no",allowFullScreen:!0}))):e.isPreview?r.a.createElement("span",null):r.a.createElement(M.a,{elevation:2,className:Object(y.a)(a.card)},r.a.createElement(g.a,{variant:"h5"},o("Youtube")),r.a.createElement(f.a,{className:Object(y.a)(a.actionButtons)},r.a.createElement(le.a,{title:o("general/Delete")},r.a.createElement(h.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(f.a,{className:Object(y.a)(a.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("Youtube video URL")),r.a.createElement(Re.a,{margin:"dense",placeholder:o("widget/crossnote.youtube/youtube-video-url-placeholder"),value:l,onChange:function(e){s(e.target.value),v("")},onKeyDown:function(t){if(13===t.which)if(l&&l.match(/youtube\.com\/watch\?v=(.+?)$/)){var a={videoID:l.match(/youtube\.com\/watch\?v=(.+?)$/)[1]};e.replaceSelf("`@crossnote.youtube ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}else v(o("widget/crossnote.youtube/error_message"))},fullWidth:!0}),r.a.createElement(g.a,{className:Object(y.a)(a.errorMessage)},b)))}var Je=a(5622),Ye=a(5623),qe=a(5624),Xe=a(300),Qe=Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},canvasWrapper:{marginTop:e.spacing(2)},canvas:{maxWidth:"100%"},disabled:{cursor:"not-allowed"}})}));function Ze(e){var t=Qe(e),a=Object(u.b)().t,o=Object(n.useState)(null),i=Object(d.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(""),m=Object(d.a)(s,2),v=m[0],w=m[1],E=Object(n.useState)(""),O=Object(d.a)(E,2),k=O[0],j=O[1],x=Object(n.useState)(""),S=Object(d.a)(x,2),D=S[0],A=S[1],B=Object(n.useState)(null),R=Object(d.a)(B,2),L=R[0],T=R[1],F=Object(n.useState)(!1),U=Object(d.a)(F,2),W=U[0],_=U[1],$=Object(n.useState)([]),V=Object(d.a)($,2),G=V[0],z=V[1],H=Object(n.useState)(function(){try{return JSON.parse(localStorage.getItem("widget/crossnote.ocr/languages")||'["eng"]')}catch(e){return["eng"]}}()),K=Object(d.a)(H,2),J=K[0],Y=K[1],q=Object(n.useState)(!!localStorage.getItem("widget/crossnote.ocr/grayscale")||!0),X=Object(d.a)(q,2),Q=X[0],Z=X[1];function ee(e){Y((function(t){var a=t.indexOf(e);return a>=0?(t.splice(a,1),t=Object(N.a)(t)):t=[].concat(Object(N.a)(t),[e]),localStorage.setItem("widget/crossnote.ocr/languages",JSON.stringify(t)),t}))}return Object(n.useEffect)((function(){if(c&&k){var e=new Image,t=c.getContext("2d");e.onload=function(){c.width=e.width,c.height=e.height,t.clearRect(0,0,c.width,c.height),Q&&(t.fillStyle="#FFF",t.fillRect(0,0,c.width,c.height),t.globalCompositeOperation="luminosity"),t.drawImage(e,0,0),A(c.toDataURL())},e.onerror=function(e){throw e},e.setAttribute("crossOrigin","anonymous"),e.src=k}}),[c,k,Q]),e.isPreview?r.a.createElement("span",null):W?r.a.createElement(M.a,{elevation:2,className:Object(y.a)(t.card)},r.a.createElement(g.a,{variant:"h5"},a("general/Processing")),r.a.createElement(p.a,null,G.length>0&&r.a.createElement(b.a,null,r.a.createElement(Je.a,null,a("tesseract/"+G[G.length-1].status)),r.a.createElement(Ye.a,null,Math.floor(100*G[G.length-1].progress).toString()+"%")))):k?r.a.createElement(M.a,{elevation:2,className:Object(y.a)(t.card)},r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/recognize-text-in-languages")),r.a.createElement(qe.a,null,r.a.createElement(we.a,{control:r.a.createElement(Ee.a,{checked:J.indexOf("eng")>=0,onChange:function(){return ee("eng")},value:"eng"}),label:"English"}),r.a.createElement(we.a,{control:r.a.createElement(Ee.a,{checked:J.indexOf("chi_sim")>=0,onChange:function(){return ee("chi_sim")},value:"chi_sim"}),label:"\u7b80\u4f53\u4e2d\u6587"}),r.a.createElement(we.a,{control:r.a.createElement(Ee.a,{checked:J.indexOf("chi_tra")>=0,onChange:function(){return ee("chi_tra")},value:"chi_tra"}),label:"\u7e41\u9ad4\u4e2d\u6587"}),r.a.createElement(we.a,{control:r.a.createElement(Ee.a,{checked:J.indexOf("jpn")>=0,onChange:function(){return ee("jpn")},value:"jpn"}),label:"\u65e5\u672c\u8a9e"}))),r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/extra-settings")),r.a.createElement(we.a,{control:r.a.createElement(Be.a,{checked:Q,onChange:function(){Q?localStorage.removeItem("widget/crossnote.ocr/grayscale"):localStorage.setItem("widget/crossnote.ocr/grayscale","true"),Z(!Q)},color:"primary"}),label:a("widget/crossnote.ocr/grayscale")})),r.a.createElement(f.a,{className:Object(y.a)(t.canvasWrapper)},r.a.createElement("canvas",{className:Object(y.a)(t.canvas),ref:function(e){return l(e)}})),r.a.createElement(ce.a,null,r.a.createElement(ne.a,{onClick:function(){j(""),A("")}},a("general/go-back")),r.a.createElement(ne.a,{color:"primary",onClick:function(){return function(t){var a=Object(Xe.createWorker)({logger:function(e){z((function(t){return t.length&&t[t.length-1].status===e.status?[].concat(Object(N.a)(t.slice(0,t.length-1)),[e]):[].concat(Object(N.a)(t),[e])}))}});Object(I.a)(P.a.mark((function n(){var r,o,i;return P.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return _(!0),0===(r=J).length&&(r=["eng"]),n.next=5,a.load();case 5:return n.next=7,a.loadLanguage(r.join("+"));case 7:return n.next=9,a.initialize(r.join("+"));case 9:return n.next=11,a.recognize(t);case 11:return o=n.sent,i=o.data.text,e.replaceSelf("\n"+i),n.next=16,a.terminate();case 16:_(!1);case 17:case"end":return n.stop()}}),n)})))()}(D)},disabled:!D},a("widget/crossnote.ocr/start-ocr")))):r.a.createElement(M.a,{elevation:2,className:Object(y.a)(t.card)},r.a.createElement(g.a,{variant:"h5"},a("widget/crossnote.ocr/ocr")),r.a.createElement(f.a,{className:Object(y.a)(t.actionButtons)},r.a.createElement(le.a,{title:a("general/Delete")},r.a.createElement(h.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))),r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Link")),r.a.createElement(Re.a,{margin:"dense",placeholder:a("widget/crossnote.image/image-url-placeholder"),value:v,onChange:function(e){w(e.target.value)},onKeyDown:function(e){13===e.which&&function(){try{j(v)}catch(e){}}()},fullWidth:!0})),r.a.createElement(g.a,{variant:"subtitle1",style:{marginTop:"16px",textAlign:"center"}},a("widget/crossnote.auth/Or")),r.a.createElement(f.a,{className:Object(y.a)(t.section)},r.a.createElement(g.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/local-image")),r.a.createElement(f.a,{className:Object(y.a)(t.dropArea,W?t.disabled:null),onClick:function(e){e.preventDefault(),e.stopPropagation(),L&&!W&&(L.onchange=function(e){var t=e.target.files||[];if(t.length)try{var a=t[0],n=new FileReader;n.readAsDataURL(a),n.onload=function(){j(n.result)},n.onerror=function(e){throw e}}catch(r){}},L.click())}},r.a.createElement(g.a,null,a(W?"utils/uploading-image":"widget/crossnote.image/click-here-to-browse-image-file")))),r.a.createElement("input",{type:"file",style:{display:"none"},ref:function(e){T(e)}}))}var et=a(115),tt=a(301),at=a.n(tt),nt=a(164),rt=Object(k.a)((function(e){return Object(j.a)({columnHeader:{width:"256px",maxWidth:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},kanbanCard:Object(m.a)({width:"256px",maxWidth:"100%",position:"relative"},e.breakpoints.down("sm"),{marginTop:"4px",marginBottom:"4px"}),editorWrapper:{"& .CodeMirror-gutters":{display:"none"}},textarea:{width:"100%",height:"100%"},preview:{padding:e.spacing(2)}})}));function ot(e){var t=rt(e),a=Object(u.b)().t,o=e.column,i=e.board,c=e.isPreview,l=e.refreshBoard,s=Object(n.useState)(!1),m=Object(d.a)(s,2),p=m[0],b=m[1],v=Object(n.useState)(o.title),w=Object(d.a)(v,2),E=w[0],O=w[1];return Object(n.useEffect)((function(){p||E===o.title||(o.title=E||a("general/Untitled"),O(o.title),l(i))}),[p,i,o.title,E,a,l]),r.a.createElement(f.a,{className:Object(y.a)(t.columnHeader)},r.a.createElement(f.a,null,p?r.a.createElement(X.a,{value:E,onChange:function(e){O(e.target.value)},onBlur:function(){b(!1)},onKeyUp:function(e){13===e.which&&b(!1)}}):r.a.createElement(g.a,{variant:"body1",style:{cursor:"text"},onClick:function(){c||b(!0)}},E)),!c&&r.a.createElement(f.a,null,r.a.createElement(h.a,{onClick:function(){var t={id:Date.now(),title:"",description:a("general/empty")};o&&o.cards.push(t),e.refreshBoard(i)}},r.a.createElement(C.b,null)),r.a.createElement(h.a,{onClick:function(){i.columns=i.columns.filter((function(e){return o.id!==e.id})),e.refreshBoard(i)}},r.a.createElement(C.f,null))))}function it(e){var t=rt(e),a=e.board,o=e.card,i=e.isPreview,c=Object(n.useState)(null),l=Object(d.a)(c,2),s=l[0],m=l[1],p=r.a.useState(null),b=Object(d.a)(p,2),g=b[0],v=b[1],w=Object(n.useState)(null),E=Object(d.a)(w,2),O=E[0],k=E[1],j=Object(n.useState)(o.description),x=Object(d.a)(j,2),N=x[0],S=x[1],P=Object(n.useState)(!1),I=Object(d.a)(P,2),D=I[0],A=I[1];Object(u.b)().t;return Object(n.useEffect)((function(){S(o.description)}),[o.description]),Object(n.useEffect)((function(){if(s){var e=nt.fromTextArea(s,{mode:{name:"hypermd",hashtag:!0},inputStyle:"textarea"});e.setValue(o.description),e.setOption("lineNumbers",!1),e.setOption("foldGutter",!1),e.setOption("autofocus",!1),i&&e.setOption("readOnly","nocursor"),e.on("changes",(function(){S(e.getValue())})),e.focus(),k(e)}}),[s]),Object(n.useEffect)((function(){g&&Object(me.renderPreview)(g,o.description)}),[g]),r.a.createElement(M.a,{className:Object(y.a)(t.kanbanCard)},r.a.createElement("div",{className:Object(y.a)("preview",t.preview),ref:function(e){v(e)}}),!i&&r.a.createElement(f.a,{style:{position:"absolute",top:"0",right:"0",zIndex:99}},r.a.createElement(h.a,{onClick:function(){return A(!0)}},r.a.createElement(C.r,null)),r.a.createElement(h.a,{onClick:function(){a.columns.forEach((function(e){e.cards=e.cards.filter((function(e){return e.id!==o.id}))})),e.refreshBoard(a)}},r.a.createElement(C.f,null))),r.a.createElement(J.a,{open:D,onClose:function(){return A(!1)}},r.a.createElement(q.a,null,r.a.createElement(f.a,{className:Object(y.a)(t.editorWrapper),style:{minWidth:"300px",maxWidth:"100%"}},r.a.createElement("textarea",{className:t.textarea,ref:function(e){m(e)}}))),r.a.createElement(ae.a,null,r.a.createElement(h.a,{onClick:function(){o.description=N,e.refreshBoard(e.board),A(!1)}},r.a.createElement(C.j,null)),r.a.createElement(h.a,{onClick:function(){O&&O.setValue(o.description),S(o.description),A(!1)}},r.a.createElement(C.a,null)))))}function ct(e){rt(e);var t=Object(u.b)().t,a=Object(n.useState)(e.attributes.board||{columns:[]}),o=Object(d.a)(a,2),i=o[0],c=o[1];"lanes"in i&&(i.columns=i.lanes);var l=function(t){var a=Object.assign({},t);e.setAttributes({board:a}),c(a)};return r.a.createElement("div",null,r.a.createElement(at.a,{renderColumnHeader:function(t){return r.a.createElement(ot,{column:t,board:i,refreshBoard:l,isPreview:e.isPreview})},renderCard:function(t,a){a.dragging;return r.a.createElement(it,{card:t,board:i,refreshBoard:l,isPreview:e.isPreview})},allowAddColumn:!e.isPreview,allowAddCard:!e.isPreview,renderColumnAdder:function(){return r.a.createElement(f.a,{style:{marginLeft:"16px",marginTop:"16px"}},r.a.createElement(ne.a,{color:"primary",variant:"outlined",onClick:function(){i.columns.push({id:Date.now(),title:t("general/untitled"),cards:[],wip:!1}),l(i)}},r.a.createElement(C.s,null),t("widget/crossnote.kanban/add-column")),r.a.createElement(ne.a,{color:"primary",onClick:function(){return e.removeSelf()}},r.a.createElement(C.y,null)))},onNewColumnConfirm:function(e){i.columns.push(Object(et.a)({id:Date.now()},e)),l(i)},disableCardDrag:e.isPreview,disableColumnDrag:e.isPreview,onCardDragEnd:function(e,t,a){var n=t.fromPosition,r=t.fromColumnId,o=a.toPosition,c=a.toColumnId,s=i.columns.filter((function(e){return e.id===r}))[0],u=i.columns.filter((function(e){return e.id===c}))[0];s.cards.splice(n,1),u.cards=[].concat(Object(N.a)(u.cards.slice(0,o)),[e],Object(N.a)(u.cards.slice(o,u.cards.length))),l(i)},onColumnDragEnd:function(e,t,a){var n=t.fromPosition,r=a.toPosition,o=i.columns[n],c=i.columns[r];i.columns[r]=o,i.columns[n]=c,l(i)}},i))}var lt=a(305),st=a.n(lt),ut=(a(5502),Object(k.a)((function(e){return Object(j.a)({card:{padding:e.spacing(2),position:"relative"},editorWrapper:{position:"relative",padding:"2px"},editor:{width:"100%",height:"128px",resize:"none",border:"none"},canvas:{overflow:"auto !important",height:"100% !important"},saveBtn:{position:"absolute",top:"0",right:"0"}})})));function dt(e){var t=e.attributes,a=ut(e),o=(Object(u.b)().t,Object(n.useState)("abc-editor-"+F())),i=Object(d.a)(o,1)[0],c=Object(n.useState)("abc-warnings-"+F()),l=Object(d.a)(c,1)[0],s=Object(n.useState)("abc-canvas-"+F()),m=Object(d.a)(s,1)[0],p=Object(n.useState)("abc-audio-"+F()),b=Object(d.a)(p,1)[0],g=Object(n.useState)(null),v=Object(d.a)(g,2),w=v[0],E=v[1],O=Object(n.useState)(null),k=Object(d.a)(O,2),j=k[0],x=k[1],N=Object(n.useState)(null),S=Object(d.a)(N,2),P=S[0],I=S[1],D=Object(n.useState)(null),A=Object(d.a)(D,2),B=A[0],R=A[1],L=Object(n.useState)(e.isPreview),T=Object(d.a)(L,2),U=T[0],W=(T[1],Object(n.useState)(t.abc||"X: 1\nT: Cooley's\nM: 4/4\nL: 1/8\nK: Emin\n|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|")),_=Object(d.a)(W,2),$=_[0],V=_[1];return Object(n.useEffect)((function(){w&&j&&P&&B&&setTimeout((function(){new st.a.Editor(w.id,{canvas_id:P.id,warnings_id:j.id,generate_warnings:!0,synth:{el:"#".concat(B.id),options:{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}},abcjsParams:{generateDownload:!0}})}),1e3)}),[w,j,P,B]),r.a.createElement(f.a,null,r.a.createElement(M.a,{elevation:2,className:Object(y.a)(a.editorWrapper),style:{display:U?"none":"block"}},r.a.createElement("textarea",{className:Object(y.a)(a.editor),id:i,ref:function(e){E(e)},value:$,onChange:function(e){V(e.target.value)},readOnly:e.isPreview}),!e.isPreview&&t.abc!==$&&r.a.createElement(h.a,{className:Object(y.a)(a.saveBtn),onClick:function(){e.setAttributes(Object.assign(e.attributes,{abc:$}))}},r.a.createElement(C.j,null))),r.a.createElement("div",{id:l,ref:function(e){x(e)}}),r.a.createElement("div",{id:m,className:Object(y.a)(a.canvas),ref:function(e){I(e)}}),r.a.createElement("div",{id:b,ref:function(e){R(e)}}))}window.CodeMirror=a(14),Object(Ae.registerWidgetCreator)("crossnote.image",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Fe,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.audio",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(We,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.netease_music",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(_e,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.video",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ve,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.bilibili",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(ze,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.youtube",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ke,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.ocr",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ze,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.kanban",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(ct,e),t),t})),Object(Ae.registerWidgetCreator)("crossnote.abc",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(dt,e),t),t}));var mt=Object(Se.a)({palette:{primary:Pe.a,secondary:Ie.a}}),pt=function(){return Object(n.useEffect)((function(){var e=function(e){e.preventDefault(),e.prompt(),e.userChoice.then((function(e){console.log(e)}))};return window.addEventListener("beforeinstallprompt",e),function(){window.removeEventListener("beforeinstallprompt",e)}}),[]),r.a.createElement(De.a,{theme:mt},r.a.createElement("div",{className:"App"},r.a.createElement(Ne,null)))},bt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ft(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var gt=a(50),ht=a(146),vt=a(181),wt=a(311),Et=a(147),Ot=a.n(Et),kt=function(){function e(t){Object(L.a)(this,e),this.fs=void 0,this.readFile=void 0,this.writeFile=void 0,this.readdir=void 0,this.unlink=void 0,this.stats=void 0,this.mkdir=void 0,this.exists=void 0,this.rename=void 0,this.rmdir=void 0,this.notebookDB=void 0,this.fs=t.fs,this.setUpFSMethods(),vt.a.plugin(wt.a),this.notebookDB=new vt.a("notebooks"),this.notebookDB.createIndex({index:{fields:["gitURL"]}})}return Object(T.a)(e,[{key:"setUpFSMethods",value:function(){var e=this;this.readFile=function(t){return new Promise((function(a,n){e.fs.readFile(t,{encoding:"utf8"},(function(e,t){return e?n(e):a(t.toString())}))}))},this.writeFile=function(t,a){return new Promise((function(n,r){e.fs.writeFile(t,a,{encoding:"utf8"},(function(e){return e?r(e):n()}))}))},this.readdir=function(t){return new Promise((function(a,n){e.fs.readdir(t,(function(e,t){return e?n(e):a(t)}))}))},this.unlink=function(t){return new Promise((function(a,n){e.fs.unlink(t,(function(e){return e?n(e):a()}))}))},this.stats=function(t){return new Promise((function(a,n){e.fs.stat(t,(function(e,t){return e?n(e):a(t)}))}))},this.mkdir=function(t){return new Promise((function(a,n){e.fs.mkdir(t,"0777",(function(e){return e?n(e):a()}))}))},this.exists=function(t){return new Promise((function(a,n){e.fs.stat(t,(function(e,t){return a(!e)}))}))},this.rename=function(t,a){return new Promise((function(n,r){e.fs.rename(t,a,(function(e){return e?r(e):n()}))}))};var t=function(t){return new Promise((function(a,n){e.fs.rmdir(t,(function(e){return e?n(e):a()}))}))};this.rmdir=function(){var a=Object(I.a)(P.a.mark((function a(n){var r,o,i,c;return P.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.readdir(n);case 2:r=a.sent,o=0;case 4:if(!(o<r.length)){a.next=20;break}return i=r[o],c=A.resolve(n,i),a.next=9,e.stats(c);case 9:if(!a.sent.isDirectory()){a.next=15;break}return a.next=13,e.rmdir(c);case 13:a.next=17;break;case 15:return a.next=17,e.unlink(c);case 17:o++,a.next=4;break;case 20:return a.next=22,t(n);case 22:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}},{key:"addNotebook",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a,n,r,o,i,c,l,s,u,d,m,p,b,f,g,h,v;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,n=void 0===a?"":a,r=t.corsProxy,o=t.gitURL,i=t.branch,c=void 0===i?"master":i,l=t.username,s=void 0===l?"":l,u=t.password,d=void 0===u?"":u,m=t.depth,p=void 0===m?3:m,b=t.rememberCredentials,f=void 0!==b&&b,!o){e.next=7;break}return e.next=4,this.cloneNotebook({name:n,corsProxy:r,gitURL:o,branch:c,username:s,password:d,depth:p,rememberCredentials:f});case 4:return e.abrupt("return",e.sent);case 7:return g=U(),h="/notebooks/".concat(g),v={_id:g,dir:h,name:n.trim()||"Unnamed",gitURL:o.trim(),gitBranch:c.trim(),gitCorsProxy:r.trim(),gitUsername:f?s.trim():"",gitPassword:f?d:""},e.next=12,this.exists("/notebooks");case 12:if(e.sent){e.next=15;break}return e.next=15,this.mkdir("/notebooks");case 15:return e.next=17,this.exists(h);case 17:if(e.sent){e.next=20;break}return e.next=20,this.mkdir(h);case 20:return e.next=22,gt.e({fs:this.fs,dir:h});case 22:return e.prev=22,e.next=25,this.notebookDB.put(v);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e.catch(22),e.next=31,this.rmdir(h);case 31:return e.abrupt("return",v);case 32:case"end":return e.stop()}}),e,this,[[22,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cloneNotebook",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a,n,r,o,i,c,l,s,u,d,m,p,b,f,g,h,v;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,n=void 0===a?"":a,r=t.corsProxy,o=t.gitURL,i=t.branch,c=void 0===i?"master":i,l=t.username,s=void 0===l?"":l,u=t.password,d=void 0===u?"":u,m=t.depth,p=void 0===m?10:m,b=t.rememberCredentials,f=void 0!==b&&b,o.match(/^https?:\/\//)){e.next=3;break}throw new Error("error/invalid-git-url-prefix");case 3:return g=U(),h="/notebooks/".concat(g),e.next=7,gt.c({fs:this.fs,http:ht.a,dir:h,corsProxy:r,url:o,ref:c,depth:p,singleBranch:!0,onAuth:function(e,t){return{username:s,password:d}}});case 7:return v={_id:g,dir:h,name:n||this.getDefaultNotebookNameFromGitURL(o),gitURL:o,gitBranch:c,gitCorsProxy:r,gitUsername:f?s:"",gitPassword:f?d:""},e.prev=8,e.next=11,this.notebookDB.put(v);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(8),e.next=17,this.rmdir(h);case 17:return e.abrupt("return",v);case 18:case"end":return e.stop()}}),e,this,[[8,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"exportNotebookToJSON",value:function(){var e=Object(I.a)(P.a.mark((function e(t){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"importNotebookFromJSON",value:function(){var e=Object(I.a)(P.a.mark((function e(t){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteNotebook",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.get(t);case 2:return a=e.sent,e.next=5,this.rmdir(a.dir);case 5:return e.next=7,this.notebookDB.remove(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateNotebook",value:function(){var e=Object(I.a)(P.a.mark((function e(t){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.put(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeNoteFilePath",value:function(){var e=Object(I.a)(P.a.mark((function e(t,a,n){var r,o,i,c,l;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=n.replace(/^\/+/,"")).endsWith(".md")||(n+=".md"),e.prev=2,e.next=5,gt.i({fs:this.fs,dir:t.dir,filepath:a.filePath});case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:r=A.dirname(A.resolve(t.dir,n)),o=r.split("/").slice(1),i=0;case 12:if(!(i<o.length)){e.next=23;break}for(c=["/"],l=0;l<=i;l++)c.push(o[l]);return e.next=17,this.exists(c.join("/"));case 17:if(e.sent){e.next=20;break}return e.next=20,this.mkdir(c.join("/"));case 20:i++,e.next=12;break;case 23:return e.next=25,this.exists(A.resolve(t.dir,n));case 25:if(!e.sent){e.next=28;break}throw new Error("target file already exists");case 28:return e.next=30,this.rename(A.resolve(t.dir,a.filePath),A.resolve(t.dir,n));case 30:return e.next=32,gt.a({fs:this.fs,dir:t.dir,filepath:n});case 32:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"pushNotebook",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a,n,r,o,i,c,l,s,u,d,m,p,b,f,g,h;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.notebook,n=t.authorName,r=void 0===n?"crossnote":n,o=t.authorEmail,i=void 0===o?"anonymous@crossnote.com":o,c=t.username,l=t.password,s=t.message,u=void 0===s?"doc: Updated docs":s,d=t.onProgress,m=t.onMessage,p=t.onAuthFailure,b=t.onAuthSuccess,e.next=3,this.listFiles(a);case 3:if((f=e.sent).length){e.next=6;break}return e.abrupt("return",{ok:!0,error:null,refs:{}});case 6:return e.next=8,gt.d({fs:this.fs,dir:a.dir,author:{name:r,email:i},message:u});case 8:return e.sent,e.next=11,gt.h({fs:this.fs,http:ht.a,onAuth:function(e,t){return{username:c,password:l}},onProgress:function(e){d&&d(e)},onMessage:function(e){m&&m(e)},onAuthFailure:function(e,t){p&&p(e)},onAuthSuccess:function(e,t){b&&b(e)},url:a.gitURL,dir:a.dir,ref:a.gitBranch,corsProxy:a.gitCorsProxy});case 11:if(!(g=e.sent).ok){e.next=20;break}h=0;case 14:if(!(h<f.length)){e.next=20;break}return e.next=17,gt.i({fs:this.fs,dir:a.dir,filepath:f[h]});case 17:h++,e.next=14;break;case 20:return e.abrupt("return",g);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"pullNotebook",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a,n,r,o,i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.notebook,n=t.onProgress,r=t.onAuthFailure,o=t.onAuthSuccess,i=t.onMessage,e.next=3,gt.g({fs:this.fs,http:ht.a,dir:a.dir,singleBranch:!0,corsProxy:a.gitCorsProxy,ref:a.gitBranch,author:{name:"anonymous",email:"anonymous@crossnote.app"},onAuth:function(e,t){return{username:a.gitUsername,password:a.gitPassword}},onProgress:n,onAuthFailure:r,onAuthSuccess:o,onMessage:i});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkoutNote",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,gt.b({fs:this.fs,dir:t.notebook.dir,filepaths:[t.filePath],force:!0});case 3:return e.next=5,this.exists(A.resolve(t.notebook.dir,t.filePath));case 5:if(!e.sent){e.next=8;break}return e.next=8,gt.a({fs:this.fs,dir:t.notebook.dir,filepath:t.filePath});case 8:return e.next=10,this.getNote(t.notebook,t.filePath);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"listNotebooks",value:function(){var e=Object(I.a)(P.a.mark((function e(){var t;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.find({selector:{gitURL:{$gt:null}}});case 2:return t=e.sent.docs,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"listFiles",value:function(){var e=Object(I.a)(P.a.mark((function e(t){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gt.f({fs:this.fs,dir:t.dir});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNote",value:function(){var e=Object(I.a)(P.a.mark((function e(t,a,n){var r,o,i,c,l;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=A.resolve(t.dir,a),n){e.next=11;break}return e.prev=2,e.next=5,this.stats(r);case 5:n=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",null);case 11:if(!n.isFile()||!a.endsWith(".md")){e.next=23;break}return e.next=14,this.readFile(r);case 14:return o=e.sent,i={createdAt:new Date(n.ctimeMs),modifiedAt:new Date(n.mtimeMs),tags:[]},c=Ot.a(o),i=Object.assign(i,c.data.note||{}),o=c.content,l={notebook:t,filePath:A.relative(t.dir,r),title:V(o),markdown:o,config:i},e.abrupt("return",l);case 23:return e.abrupt("return",null);case 24:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"listNotes",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a,n,r,o,i,c,l,s,u,d,m,p;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.notebook,n=t.dir,r=void 0===n?"./":n,o=t.includeSubdirectories,i=void 0!==o&&o,c=[],l=[],e.prev=3,e.next=6,this.readdir(A.resolve(a.dir,r));case 6:l=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),l=[];case 12:s=0;case 13:if(!(s<l.length)){e.next=32;break}return u=l[s],d=A.resolve(a.dir,r,u),e.next=18,this.stats(d);case 18:return m=e.sent,e.next=21,this.getNote(a,A.relative(a.dir,d),m);case 21:if((p=e.sent)&&c.push(p),!m.isDirectory()||".git"===u||!i){e.next=29;break}return e.t1=c,e.next=27,this.listNotes({notebook:a,dir:A.relative(a.dir,d),includeSubdirectories:i});case 27:e.t2=e.sent,c=e.t1.concat.call(e.t1,e.t2);case 29:s++,e.next=13;break;case 32:return e.abrupt("return",c);case 33:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"writeNote",value:function(){var e=Object(I.a)(P.a.mark((function e(t,a,n,r){var o;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.modifiedAt=new Date,e.prev=1,o=Ot.a(n),n=Ot.a.stringify(n,Object.assign(o.data||{},{note:r})),e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return");case 9:return e.next=11,this.writeFile(A.resolve(t.dir,a),n);case 11:return e.next=13,gt.a({fs:this.fs,dir:t.dir,filepath:a});case 13:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"deleteNote",value:function(){var e=Object(I.a)(P.a.mark((function e(t,a){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists(A.resolve(t.dir,a));case 2:if(!e.sent){e.next=7;break}return e.next=5,gt.i({fs:this.fs,dir:t.dir,filepath:a});case 5:return e.next=7,this.unlink(A.resolve(t.dir,a));case 7:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getNotebookDirectoriesFromNotes",value:function(){var e=Object(I.a)(P.a.mark((function e(t){var a,n,r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a={name:".",path:".",children:[]},n=new Set([]),r=0;r<t.length;r++)n.add(A.dirname(t[r].filePath));return n.forEach((function(e){for(var t=e.split("/"),n=a,r=function(e){if("."===t[e])return"break";var a=n.children.filter((function(a){return a.name===t[e]}))[0];if(a)n=a;else{for(var r=[],o=0;o<=e;o++)r.push(t[o]);a={name:t[e],path:r.join("/"),children:[]},n.children.push(a),n=a}},o=0;o<t.length;o++){if("break"===r(o))break}})),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultNotebookNameFromGitURL",value:function(e){var t=e.lastIndexOf("/");return e.slice(t+1).replace(/\.git/,"")}},{key:"getStatus",value:function(){var e=Object(I.a)(P.a.mark((function e(t){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gt.j({fs:this.fs,dir:t.notebook.dir,filepath:t.filePath});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),jt=new l.a("fs");window.fs=jt;try{var xt=new kt({fs:jt});window.crossnote=xt,i.a.render(r.a.createElement(W.Provider,{initialState:{crossnote:xt}},r.a.createElement(pt,null)),document.getElementById("root"))}catch(yt){console.log(yt)}!function(e){if("serviceWorker"in navigator){if(new URL("/notehub",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/notehub","/service-worker.js");bt?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ft(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ft(t,e)}))}}()}},[[5302,1,2]]]);
//# sourceMappingURL=main.e8bf44c0.chunk.js.map