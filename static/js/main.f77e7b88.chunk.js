/*! For license information please see main.f77e7b88.chunk.js.LICENSE.txt */
(this.webpackJsonpnotehub=this.webpackJsonpnotehub||[]).push([[0],{412:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return w}));var n=a(1),r=a.n(n),o=a(2),i=a(10),c=a(18),l=a(35),s=a(179),u=a(20),d=a(231),m=a(417),p=a(174),b=a.n(p),f=a(62),g=a(164),h=a.n(g),v=a(235),O=a.n(v),E=a(66),w=function(){function t(e){Object(i.a)(this,t),this.fs=void 0,this.readFile=void 0,this.writeFile=void 0,this.readdir=void 0,this.unlink=void 0,this.stats=void 0,this.mkdir=void 0,this.exists=void 0,this.rename=void 0,this.rmdir=void 0,this.notebookDB=void 0,this.fs=e.fs,this.setUpFSMethods(),d.a.plugin(m.a),this.notebookDB=new d.a("notebooks"),this.notebookDB.createIndex({index:{fields:["gitURL"]}})}return Object(c.a)(t,[{key:"setUpFSMethods",value:function(){var e=this;this.readFile=function(t){return new Promise((function(a,n){e.fs.readFile(t,{encoding:"utf8"},(function(e,t){return e?n(e):a(t.toString())}))}))},this.writeFile=function(t,a){return new Promise((function(n,r){e.fs.writeFile(t,a,{encoding:"utf8"},(function(e){return e?r(e):n()}))}))},this.readdir=function(t){return new Promise((function(a,n){e.fs.readdir(t,(function(e,t){return e?n(e):a(t)}))}))},this.unlink=function(t){return new Promise((function(a,n){e.fs.unlink(t,(function(e){return e?n(e):a()}))}))},this.stats=function(t){return new Promise((function(a,n){e.fs.stat(t,(function(e,t){return e?n(e):a(t)}))}))},this.mkdir=function(t){return new Promise((function(a,n){e.fs.mkdir(t,"0777",(function(e){return e?n(e):a()}))}))},this.exists=function(t){return new Promise((function(a,n){e.fs.stat(t,(function(e,t){return a(!e)}))}))},this.rename=function(t,a){return new Promise((function(n,r){e.fs.rename(t,a,(function(e){return e?r(e):n()}))}))};var t=function(t){return new Promise((function(a,n){e.fs.rmdir(t,(function(e){return e?n(e):a()}))}))};this.rmdir=function(){var a=Object(o.a)(r.a.mark((function a(n){var o,i,c,l;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.readdir(n);case 2:o=a.sent,i=0;case 4:if(!(i<o.length)){a.next=20;break}return c=o[i],l=u.resolve(n,c),a.next=9,e.stats(l);case 9:if(!a.sent.isDirectory()){a.next=15;break}return a.next=13,e.rmdir(l);case 13:a.next=17;break;case 15:return a.next=17,e.unlink(l);case 17:i++,a.next=4;break;case 20:return a.next=22,t(n);case 22:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}},{key:"addNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,s,u,d,m,p,b,g,h,v,O,E,w;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,n=void 0===a?"":a,o=t.corsProxy,i=t.gitURL,c=t.branch,s=void 0===c?"master":c,u=t.username,d=void 0===u?"":u,m=t.password,p=void 0===m?"":m,b=t.depth,g=void 0===b?3:b,h=t.rememberCredentials,v=void 0!==h&&h,!i){e.next=7;break}return e.next=4,this.cloneNotebook({name:n,corsProxy:o,gitURL:i,branch:s,username:d,password:p,depth:g,rememberCredentials:v});case 4:return e.abrupt("return",e.sent);case 7:return O=Object(f.d)(),E="/notebooks/".concat(O),w={_id:O,dir:E,name:n.trim()||"Unnamed",gitURL:i.trim(),gitBranch:s.trim()||"master",gitCorsProxy:o.trim(),gitUsername:v?d.trim():"",gitPassword:v?p:""},e.next=12,this.exists("/notebooks");case 12:if(e.sent){e.next=15;break}return e.next=15,this.mkdir("/notebooks");case 15:return e.next=17,this.exists(E);case 17:if(e.sent){e.next=20;break}return e.next=20,this.mkdir(E);case 20:return e.next=22,l.e({fs:this.fs,dir:E});case 22:return e.prev=22,e.next=25,this.notebookDB.put(w);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e.catch(22),e.next=31,this.rmdir(E);case 31:return e.abrupt("return",w);case 32:case"end":return e.stop()}}),e,this,[[22,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cloneNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,u,d,m,p,b,g,h,v,O,E,w,k;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,n=void 0===a?"":a,o=t.corsProxy,i=t.gitURL,c=t.branch,u=void 0===c?"master":c,d=t.username,m=void 0===d?"":d,p=t.password,b=void 0===p?"":p,g=t.depth,h=void 0===g?10:g,v=t.rememberCredentials,O=void 0!==v&&v,i.match(/^https?:\/\//)){e.next=3;break}throw new Error("error/invalid-git-url-prefix");case 3:return E=Object(f.d)(),w="/notebooks/".concat(E),e.next=7,l.c({fs:this.fs,http:s.a,dir:w,corsProxy:o,url:i,ref:u.trim()||"master",depth:h,singleBranch:!0,onAuth:function(e,t){return{username:m,password:b}}});case 7:return k={_id:E,dir:w,name:n||this.getDefaultNotebookNameFromGitURL(i),gitURL:i,gitBranch:u.trim()||"master",gitCorsProxy:o,gitUsername:O?m:"",gitPassword:O?b:""},e.prev=8,e.next=11,this.notebookDB.put(k);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(8),e.next=17,this.rmdir(w);case 17:return e.abrupt("return",k);case 18:case"end":return e.stop()}}),e,this,[[8,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"exportNotebookToJSON",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"importNotebookFromJSON",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.get(t);case 2:return a=e.sent,e.next=5,this.rmdir(a.dir);case 5:return e.next=7,this.notebookDB.remove(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.put(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeNoteFilePath",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a,n){var o,i,c,s,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=n.replace(/^\/+/,"")).endsWith(".md")||(n+=".md"),e.prev=2,e.next=5,l.k({fs:this.fs,dir:t.dir,filepath:a.filePath});case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:o=u.dirname(u.resolve(t.dir,n)),i=o.split("/").slice(1),c=0;case 12:if(!(c<i.length)){e.next=23;break}for(s=["/"],d=0;d<=c;d++)s.push(i[d]);return e.next=17,this.exists(s.join("/"));case 17:if(e.sent){e.next=20;break}return e.next=20,this.mkdir(s.join("/"));case 20:c++,e.next=12;break;case 23:return e.next=25,this.exists(u.resolve(t.dir,n));case 25:if(!e.sent){e.next=28;break}throw new Error("target file already exists");case 28:return e.next=30,this.rename(u.resolve(t.dir,a.filePath),u.resolve(t.dir,n));case 30:return e.next=32,l.a({fs:this.fs,dir:t.dir,filepath:n});case 32:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"pushNotebook",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,i,c,d,m,p,b,f,g,h,v,O,E,w,k,y,j=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.notebook,n=t.authorName,i=void 0===n?"crossnote":n,c=t.authorEmail,d=void 0===c?"anonymous@crossnote.com":c,m=t.username,p=t.password,b=t.message,f=void 0===b?"doc: Updated docs":b,g=t.onProgress,h=t.onMessage,v=t.onAuthFailure,O=t.onAuthSuccess,e.next=3,this.listFiles(a);case 3:if(e.sent.length){e.next=6;break}return e.abrupt("return",{ok:!0,error:null,refs:{}});case 6:return e.next=8,this.pullNotebook({notebook:a,onProgress:g,onAuthFailure:v,onAuthSuccess:O,onMessage:h});case 8:if(!(e.sent.numConflicts>0)){e.next=11;break}throw new Error("error/please-resolve-conflicts");case 11:return e.next=13,l.g({fs:this.fs,dir:a.dir,ref:"origin/".concat(a.gitBranch||"master"),depth:5});case 13:return E=e.sent,w=E&&E[0]&&E[0].oid||"",e.next=17,l.d({fs:this.fs,dir:a.dir,author:{name:i,email:d},message:f});case 17:return e.sent,k=function(){var e=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.gitBranch||"master",e.next=3,j.writeFile(u.resolve(a.dir,".git/refs/heads/".concat(t)),w);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=21,l.i({fs:this.fs,http:s.a,onAuth:function(e,t){return{username:m,password:p}},onProgress:function(e){g&&g(e)},onMessage:function(e){h&&h(e)},onAuthFailure:function(e,t){v&&v(e),k()},onAuthSuccess:function(e,t){O&&O(e)},url:a.gitURL,dir:a.dir,ref:a.gitBranch,corsProxy:a.gitCorsProxy});case 21:return(y=e.sent).error&&k(),y.ok,e.abrupt("return",y);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"pullNotebook",value:function(){var t=Object(o.a)(r.a.mark((function t(a){var n,o,i,c,d,m,p,f,g,h,v,O,E,w,k,y,j,x,C,N,S,P,I,D,A,T,B,L,R,F,U,W,M,_,V,H,G;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.notebook,o=a.onProgress,i=a.onAuthFailure,c=a.onAuthSuccess,d=a.onMessage,t.next=3,l.f({fs:this.fs,dir:n.dir});case 3:m=t.sent,p={},f=0;case 6:if(!(f<m.length)){t.next=19;break}return t.next=9,l.l({fs:this.fs,dir:n.dir,filepath:m[f]});case 9:if(!(g=t.sent).match(/^\*?(modified|added)/)){t.next=16;break}return t.t0=g,t.next=14,this.readFile(u.resolve(n.dir,m[f]));case 14:t.t1=t.sent,p[m[f]]={status:t.t0,markdown:t.t1};case 16:f++,t.next=6;break;case 19:return t.next=21,l.g({fs:this.fs,dir:n.dir,ref:"origin/".concat(n.gitBranch||"master"),depth:5});case 21:return h=t.sent,v=(h&&h[0]&&h[0]).oid,t.next=25,l.h({fs:this.fs,http:s.a,dir:n.dir,singleBranch:!0,corsProxy:n.gitCorsProxy,ref:n.gitBranch||"master",author:{name:"anonymous",email:"anonymous@crossnote.app"},onAuth:function(e,t){return{username:n.gitUsername,password:n.gitPassword}},onProgress:o,onAuthFailure:i,onAuthSuccess:c,onMessage:d});case 25:return t.next=27,l.g({fs:this.fs,dir:n.dir,ref:"origin/".concat(n.gitBranch||"master"),depth:5});case 27:if(h=t.sent,O=(h&&h[0]&&h[0]).oid,E=0,v!==O){t.next=44;break}t.t2=r.a.keys(p);case 32:if((t.t3=t.t2()).done){t.next=42;break}return w=t.t3.value,k=p[w].markdown,t.next=37,this.writeFile(u.resolve(n.dir,w),k);case 37:return t.next=39,l.a({fs:this.fs,dir:n.dir,filepath:w});case 39:this.markdownHasConflicts(k)&&(E+=1),t.next=32;break;case 42:t.next=101;break;case 44:y=/^.*(\r?\n|$)/gm,j=7,x="ours",C="theirs",t.t4=r.a.keys(p);case 49:if((t.t5=t.t4()).done){t.next=101;break}return N=t.t5.value,S=p[N].markdown,t.next=54,this.exists(u.resolve(n.dir,N));case 54:if(!t.sent){t.next=94;break}return t.next=57,this.readFile(u.resolve(n.dir,N));case 57:return P=t.sent,t.next=60,l.j({fs:this.fs,dir:n.dir,oid:v,filepath:N});case 60:for(I=t.sent,D=e.from(I.blob).toString("utf8"),A=S.match(y),T=D.match(y),B=P.match(y),L=b()(A,T,B),R="",F=!1,U=!0,W=!1,M=void 0,t.prev=71,_=L[Symbol.iterator]();!(U=(V=_.next()).done);U=!0)(H=V.value).ok&&(R+=H.ok.join("")),H.conflict&&(F=!0,R+="\\<".concat("<".repeat(j-1)," ").concat(x,"\n"),R+=H.conflict.a.join(""),R+="\\=".concat("=".repeat(j-1),"\n"),R+=H.conflict.b.join(""),R+="\\>".concat(">".repeat(j-1)," ").concat(C,"\n"));t.next=79;break;case 75:t.prev=75,t.t6=t.catch(71),W=!0,M=t.t6;case 79:t.prev=79,t.prev=80,U||null==_.return||_.return();case 82:if(t.prev=82,!W){t.next=85;break}throw M;case 85:return t.finish(82);case 86:return t.finish(79);case 87:return F&&(E+=1),t.next=90,this.writeFile(u.resolve(n.dir,N),R);case 90:return t.next=92,l.a({fs:this.fs,dir:n.dir,filepath:N});case 92:t.next=99;break;case 94:return G=p[N].markdown,t.next=97,this.writeFile(u.resolve(n.dir,N),G);case 97:return t.next=99,l.a({fs:this.fs,dir:n.dir,filepath:N});case 99:t.next=49;break;case 101:return t.abrupt("return",{numConflicts:E});case 102:case"end":return t.stop()}}),t,this,[[71,75,79,87],[80,,82,86]])})));return function(e){return t.apply(this,arguments)}}()},{key:"markdownHasConflicts",value:function(e){var t=e.match(/^\\<+\s/gm),a=e.match(/^\\=+\s/gm),n=e.match(/^\\>+\s/gm);return t&&t.length>0&&a&&a.length>0&&n&&n.length>0}},{key:"checkoutNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.b({fs:this.fs,dir:t.notebook.dir,filepaths:[t.filePath],force:!0});case 3:return e.next=5,this.exists(u.resolve(t.notebook.dir,t.filePath));case 5:if(!e.sent){e.next=8;break}return e.next=8,l.a({fs:this.fs,dir:t.notebook.dir,filepath:t.filePath});case 8:return e.next=10,this.getNote(t.notebook,t.filePath);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"listNotebooks",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t,a,n,o,i,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.notebookDB.find({selector:{gitURL:{$gt:null}}});case 2:t=e.sent.docs,a=0;case 4:if(!(a<t.length)){e.next=18;break}if(!((n=t[a]).gitURL.trim().length<=0)){e.next=8;break}return e.abrupt("continue",15);case 8:return o=n.gitBranch||"master",e.next=11,l.g({fs:this.fs,dir:n.dir,ref:"origin/".concat(o),depth:5});case 11:return i=e.sent,c=i&&i[0]&&i[0].oid||"",e.next=15,this.writeFile(u.resolve(n.dir,".git/refs/heads/".concat(o)),c);case 15:a++,e.next=4;break;case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"listFiles",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.f({fs:this.fs,dir:t.dir});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"matterStringify",value:function(e,t){t=t||{};var a=window.YAML.stringify(t).trim();return"{}"!==a&&a?"---\n".concat(a,"\n---\n").concat(e):e}},{key:"getNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a,n){var o,i,c,l,s,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=u.resolve(t.dir,a),n){e.next=11;break}return e.prev=2,e.next=5,this.stats(o);case 5:n=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",null);case 11:if(!n.isFile()||!a.endsWith(".md")){e.next=21;break}return e.next=14,this.readFile(o);case 14:i=e.sent,c={createdAt:new Date(n.ctimeMs),modifiedAt:new Date(n.mtimeMs),tags:[]};try{l=O()(i),c=Object.assign(c,l.data.note||{}),delete(s=Object.assign({},l.data)).note,i=this.matterStringify(l.content,s)}catch(r){i="Please fix front-matter. (\ud83d\udc48 Don't forget to delete this line)\n\n"+i}return d={notebook:t,filePath:u.relative(t.dir,o),markdown:i,config:c},e.abrupt("return",d);case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"listNotes",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,l,s,d,m,p,b,f;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.notebook,n=t.dir,o=void 0===n?"./":n,i=t.includeSubdirectories,c=void 0!==i&&i,l=[],s=[],e.prev=3,e.next=6,this.readdir(u.resolve(a.dir,o));case 6:s=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),s=[];case 12:d=0;case 13:if(!(d<s.length)){e.next=32;break}return m=s[d],p=u.resolve(a.dir,o,m),e.next=18,this.stats(p);case 18:return b=e.sent,e.next=21,this.getNote(a,u.relative(a.dir,p),b);case 21:if((f=e.sent)&&l.push(f),!b.isDirectory()||".git"===m||!c){e.next=29;break}return e.t1=l,e.next=27,this.listNotes({notebook:a,dir:u.relative(a.dir,p),includeSubdirectories:c});case 27:e.t2=e.sent,l=e.t1.concat.call(e.t1,e.t2);case 29:d++,e.next=13;break;case 32:return e.abrupt("return",l);case 33:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"writeNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a,n,o,i){var c,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.modifiedAt=new Date;try{(c=O()(n)).data.note&&c.data.note instanceof Object&&(o=Object.assign({},o,c.data.note||{})),s=Object.assign(c.data||{},{note:o}),n=c.content,o.encryption&&(o.encryption.title=Object(E.b)(n),n=h.a.encrypt(JSON.stringify({markdown:n}),i||"").toString()),n=this.matterStringify(n,s)}catch(r){o.encryption&&(o.encryption.title=Object(E.b)(n),n=h.a.encrypt(JSON.stringify({markdown:n}),i||"").toString()),n=this.matterStringify(n,{note:o})}return e.next=4,this.writeFile(u.resolve(t.dir,a),n);case 4:return e.next=6,l.a({fs:this.fs,dir:t.dir,filepath:a});case 6:return e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,o){return e.apply(this,arguments)}}()},{key:"deleteNote",value:function(){var e=Object(o.a)(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists(u.resolve(t.dir,a));case 2:if(!e.sent){e.next=7;break}return e.next=5,l.k({fs:this.fs,dir:t.dir,filepath:a});case 5:return e.next=7,this.unlink(u.resolve(t.dir,a));case 7:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getNotebookDirectoriesFromNotes",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a={name:".",path:".",children:[]},n=new Set([]),o=0;o<t.length;o++)n.add(u.dirname(t[o].filePath));return n.forEach((function(e){for(var t=e.split("/"),n=a,r=function(e){if("."===t[e])return"break";var a=n.children.filter((function(a){return a.name===t[e]}))[0];if(a)n=a;else{for(var r=[],o=0;o<=e;o++)r.push(t[o]);a={name:t[e],path:r.join("/"),children:[]},n.children.push(a),n=a}},o=0;o<t.length;o++){if("break"===r(o))break}})),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNotebookTagNodeFromNotes",value:function(e){for(var t={name:".",path:".",children:[]},a=0;a<e.length;a++){(e[a].config.tags||[]).forEach((function(e){var a=t;e.split("/").forEach((function(e,t){e=e.toLocaleLowerCase().replace(/\s+/g," ");var n=a.children.findIndex((function(t){return t.name===e}));if(n>=0)a=a.children[n];else{var r={name:e,path:"."===a.name?e:a.path+"/"+e,children:[]};a.children.push(r),a.children.sort((function(e,t){return e.name.localeCompare(t.name)})),a=r}}))}))}return t}},{key:"getDefaultNotebookNameFromGitURL",value:function(e){var t=e.lastIndexOf("/");return e.slice(t+1).replace(/\.git/,"")}},{key:"getStatus",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.l({fs:this.fs,dir:t.notebook.dir,filepath:t.filePath});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}()}).call(this,a(39).Buffer)},5398:function(e,t,a){e.exports=a(5753)},5436:function(e,t,a){},5437:function(e,t,a){},5441:function(e,t){},5443:function(e,t){},5474:function(e,t){},5475:function(e,t){},5702:function(e,t){},5753:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(14),i=a.n(o),c=(a(5403),a(5404),a(5405),a(399)),l=a.n(c),s=a(236),u=a(24);a(5819),a(96),a(5820),a(5821);s.a.use(u.a).init({interpolation:{escapeValue:!1},keySeparator:!1,lng:localStorage.getItem("language")||"en-US",fallbackLng:"en-US",resources:{"en-US":{translation:{"title/Crossnote":"Crossnote","search/placeholder":"Search Notes","account/Anonymous":"Anonymous","account/anonymous":"anonymous","general/go-back":"Go back","general/sending":"Sending","general/send":"Send","general/cancel":"Cancel","general/backed-up-at":"Backed up at","general/created-at":"Created at","general/modified-at":"Modified at","general/interacted-at":"Interacted at","general/date-created":"Date created","general/date-modified":"Date modified","general/date-interacted":"Date interacted","general/saved-at":"Saved at","general/loading":"Loading ...","general/loading-notifications":"Loading notifications ...","general/failed-to-set":"Failed to set","general/update":"Update","general/updated":"Updated","general/updating":"Updating","general/close":"Close","general/Note":"Note","general/notes":"notes","general/Settings":"Settings","general/Collaborators":"Collaborators","general/collaborators":"collaborators","general/Backups":"Backups","general/backups":"backups","general/Discussion":"Discussion","general/discussion":"discussion","general/Notifications":"Notifications","general/Username":"Username","general/Email":"Email","general/Password":"Password","general/confirm-password":"Confirm password","general/Continue":"Continue","general/enter-username":"Enter username","general/vickymd":"VickyMD","general/tags":"Tags","general/add-a-tag":"Add a tag","general/private":"Private","general/public":"Public","general/friends-only":"Friends only","general/anonymous":"Anonymous","general/onymous":"Onymous","general/Tag":"Tag","general/no-tags":"No tags","general/Untitled":"Untitled","general/untitled":"untitled","general/Unknown":"Unknown","general/unknown":"unknown","general/Agree":"Agree","general/Disagree":"Disagree","general/Print":"Print",Editor:"Editor",EDITOR:"EDITOR",Viewer:"Viewer",VIEWER:"VIEWER",Admin:"Admin",ADMIN:"ADMIN",ARCHIVED:"ARCHIVED","ATTACHED NOTES":"ATTACHED NOTES",DELETED:"DELETED",PINNED:"PINNED",OTHERS:"OTHERS","PUBLIC NOTES":"PUBLIC NOTES","FOLLOWINGS' NOTES":"FOLLOWINGS' NOTES","SHARED WITH ME":"SHARED WITH ME",BOOKMARKS:"BOOKMARKS","MY TAGS":"MY TAGS","general/enter-fullscreen-mode":"Enter fullscreen mode","general/enter-presentation-mode":"Enter presentation mode","general/math-preview":"Math Preview","general/this-note-is-empty":"This note is empty","general/no-notes-found":"No notes found","general/no-notifications-found":"No notifications found","general/clear-all":"Clear all","general/Save":"Save","general/Delete":"Delete","general/Follow":"Follow","general/Following":"Following","general/Unfollow":"Unfollow","general/my-notes":"My notes","general/public-notes":"Public notes","general/followings-notes":"Followings' notes","general/shared-with-me":"Shared with me","general/Bookmarks":"Bookmarks","general/Archive":"Archive","general/Trash":"Trash","general/new-note":"New note","general/profile-updated":"Profile updated","general/ID":"ID","general/Audio":"Audio","general/Video":"Video","general/source-url":"Source URL","general/sign-in":"Sign in","general/sign-up":"Sign up","general/Link":"Link","general/Upload":"Upload","general/clicks":"clicks","general/Processing":"Processing...","general/please-wait":"please wait...","general/Languages":"Languages","general/track":"Track","general/Publish":"Publish","general/empty":"empty","note/unarchive-note":"Unarchive note","note/archive-note":"Archive note","note/delete-forever":"Delete forever","note/delete-note":"Delete note","note/restore-note":"Restore note","note/report-note":"Report note","note/open-in-crossnote-website":"Open in Crossnote website","note-tags/send-suggestion-failure":"Failed to send suggestion","note-tags/suggestion-sent":"Suggestion sent","note-tags/suggest-a-tag-to-this-note":"Suggest a tag to this note","user-tags/follow-a-tag":"Follow a tag","chat-message/reply-to-this-user":"Reply to this user","chat-message/add-reaction-to-this-message":"Add reaction to this message","chat-message/edit-this-message":"Edit this message","chat-message/modified-message":"modified message","chat-panel/post-message-failure":"Failed to post message","chat-panel/unsubscribe-info":"Unsubscribing from this chat group will stop you from receiving notifications unless someone mentions you","chat-panel/subscribe-info":"Subscribing to this chat group will let you receive notifications whenever someone posts a message","notifications/refresh":"Refresh to see new notifications","settings/about-this-project":"About this project \ud83e\udd14","settings/uploading-cover-image":"Uploading cover image","settings/upload-image-failure":"Failed to upload image","settings/Cover":"Cover","settings/enter-cover-image-url":"Enter cover image URL","settings/upload-image":"Upload image","settings/Avatar":"Avatar","settings/enter-avatar-image-url":"Enter avatar image URL","settings/Name":"Name","settings/enter-name":"Enter your Name (this is not your username)","settings/editor-cursor-color":"Editor cursor color","settings/hello":"Hello, ","settings/world":"world!","settings/linked-with-github-account":"Linked with GitHub account","settings/link-with-github-account":"Link with GitHub account","settings/log-out":"Log out","preview/attach-a-note":"Attach a note","preview/crossnote-untitled":"Crossnote - Untitled","preview/edit-this-note":"Edit this note","profile-card/followings":"followings","profile-card/followers":"followers","profile-card/Followings":"Followings","profile-card/Followers":"Followers","profile-card/notes":"notes","profile-card/follow-user-failure":"Failed to follow user","profile-card/followed-user":"Followed user","profile-card/unfollow-user-failure":"Failed to unfollow user","profile-card/unfollowed-user":"Unfollowed user","tag-card/pin-to-my-notes-page":"Pin to my notes page","interaction-panel/show-attached-notes":"Show attached notes","interaction-panel/add-comment":"Add comment","interaction-panel/add-reaction":"Add reaction","editor/loading-your-note":"Loading your note...","editor/sync-failure":"Failed to sync... Please refresh your page","editor/saving":"Saving...","editor/save-failure":"Failed to save","editor/saved":"Saved","editor/update-note-failure":"Failed to update note","editor/placeholder":"#  Hi \ud83d\ude00 Type '/' for commands","editor/note-control/allow-readers-to-suggest-note-tags":"Allow readers to suggest note tags","editor/note-control/allow-readers-to-attach-notes-under-this-note":"Allow readers to attach notes under this note","editor/note-control/inherit-parent-note-collaborators-list":"Inherit parent note collaborators list","editor/note-control/note-visibility-hint":"All collaborators will be able to see this note","editor/note-control/allow-readers-to-attach-notes-unchecked":"Applies to you and collaborators that can edit and admin","editor/note-control/allow-readers-to-attach-notes-checked":"Applies to anyone that can view this note","editor/note-control/enter-parent-note-id":"Enter parent note ID","editor/note-control/attach-note-failure":"Failed to attach note","editor/note-control/unattach-note-failure":"Failed to unattach note","editor/collaborator-hint":" - note will be visible to them","editor/shareable-link-hint":"people with the link can view/edit this note with no need of login","editor/backups-control/create-backup":"Create backup","editor/backups-control/delete-this-backup":"Delete this backup","editor/backups-control/create-backup-failure":"Failed to create backup","editor/backups-control/backup-created":"Backup created","editor/backups-control/delete-backup-failure":"Failed to delete backup","editor/backups-control/backup-deleted":"Backup deleted","editor/backups-control/cloud-version":"Cloud version","editor/backups-control/backup-name":"Backup name","editor/collaborators-control/set-collaborator-role-failure":"Failed to set collaborator role","editor/collaborators-control/add-collaborator-failure":"Failed to add collaborator","editor/collaborators-control/collaborator-removed":"Collaborator removed","editor/collaborators-control/collaborator-added":"Collaborator added","editor/collaborators-control/can-view":"Can view","editor/collaborators-control/can-edit":"Can edit","editor/collaborators-control/can-administrate":"Can administrate","editor/toolbar/insert-image":"Insert image","editor/toolbar/upload-local-images":"Upload local images","editor/toolbar/capture-webpage":"Capture the whole webpage","editor/toolbar/insert-clock":"Insert clock","editor/toolbar/insert-emoji":"Insert emoji","editor/toolbar/insert-media":"Insert media","editor/toolbar/audio-url":"Audio URL","editor/toolbar/netease-music":"Netease Music","editor/toolbar/video-url":"Video URL","editor/toolbar/youtube":"Youtube","editor/toolbar/bilibili":"Bilibili","editor/toolbar/insert-slide":"Insert slide","editor/toolbar/insert-ocr":"Insert OCR","editor/toolbar/insert-kanban":"Insert Kanban","editor/toolbar/insert-abc-notation":"Insert ABC notation","editor/toolbar/insert-header-1":"Insert header 1","editor/toolbar/insert-header-2":"Insert header 2","editor/toolbar/insert-header-3":"Insert header 3","editor/toolbar/insert-header-4":"Insert header 4","editor/toolbar/insert-header-5":"Insert header 5","editor/toolbar/insert-header-6":"Insert header 6","editor/toolbar/bold":"Bold","editor/toolbar/italic":"Italic","editor/toolbar/strikethrough":"Strikethrough","editor/toolbar/insert-inline-code":"Insert inline code","editor/toolbar/insert-blockquote":"Insert blockquote","editor/toolbar/insert-unordered-list":"Insert unordered list","editor/toolbar/insert-ordered-list":"Insert ordered list","editor/toolbar/insert-link":"Insert link","editor/toolbar/insert-table":"Insert table","editor/note-control/tag-added":"Tag added","editor/note-control/tag-deleted":"Tag deleted","editor/note-control/set-note-visibility-failure":"Failed to set note visibility","editor/note-control/note-visibility-updated":"Note visibility updated","editor/note-control/set-author-visibility-failure":"Failed to set author visibility","editor/note-control/author-visibility-updated":"Author visibility updated","editor/note-control/editor-mode":"Editor mode","editor/note-control/source-code":"Source code","editor/note-control/preview":"Preview","editor/note-control/pin-preview":"Pin preview on the side","editor/note-control/display-modification-records":"Display modification records","editor/note-control/note-visibility":"Note visibility","editor/note-control/author-visibility":"Author visibility","editor/note-control/shareable-link":"Shareable link","editor/note-control/copy-to-clipboard":"Copy to clipboard","editor/note-control/link-to-preview":"Link to preview","editor/note-control/link-to-editor":"Link to editor","editor/note-control/attach-to-note":"Attach to note","editor/note-control/source-added":"URL added","editor/note-control/source-deleted":"URL deleted","editor/note-control/invalid-note-source":"Invalid URL","editor/note-control/add-note-source":"Add related URLs","editor/note-control/note-source-hint":"Notes on the same URL will be grouped together","editor/note-control/enter-note-source":"Enter URL","avatar-panel/this-note-is-private":"This note is private","avatar-panel/this-note-is-public":"This note is visible to public","avatar-panel/this-note-is-friends-only":"This note is only visible to friends","avatar-panel/you-are-anonymous":"You are anonymous","file-exporter/name":"File exporter","file-exporter/orientation":"Orientation","file-exporter/portrait":"portrait","file-exporter/landscape":"landscape","file-exporter/paper-size":"Paper size","file-exporter/unit":"Unit","file-exporter/margin-top":"Margin top","file-exporter/margin-bottom":"Margin bottom","file-exporter/margin-left":"Margin left","file-exporter/margin-right":"Margin right","utils/uploading-image":"Uploading image...","utils/upload-image-failure":"Failed to upload image","notification/replies-to-you-in":"Replies to you in","notification/'s-note":"'s note ","notification/added":"Added","notification/to-your-note":"to your note","notification/add-you-as":"Added you as","notification/of-note":"of note","notification/add-tag-failure":"Failed to add tag","notification/suggested-to-add-tag":"Suggested to add tag","notification/started-following-you":"Started following you","notification/bookmarked-your-note":"Bookmarked your note","github-oauth/wait":"Please wait ...","github-oauth/link-with-github-account-failure":"Failed to link with GitHub account","github-oauth/sign-in-with-github-account-failure":"Failed to sign in with GitHub account","github-oauth/first-time-sign-in":"It seems to be the first time you sign in with GitHub account","github-oauth/first-time-sign-in-small":"Please finish the registeration below","widget/autoplay":"autoplay","widget/controls":"controls","widget/loop":"loop","widget/muted":"muted","widget/crossnote.image/thanks_sm_ms":"Thanks sm.ms for offering free image hosting service.","widget/crossnote.audio/audio_element_fail":"Your browser does not support the audio element.","widget/crossnote.audio/source-url-placeholder":"Enter audio source URL here, then press 'Enter' to insert.","widget/crossnote.video/video_element_fail":"Your browser does not support the video element","widget/crossnote.bilibili/error_message":"Error: Only supported https://www.bilibili.com/video/av79126732 like URL","widget/crossnote.youtube/error_message":"Error: Only supported https://www.youtube.com/watch?v=MmB9b5njVbA like URL","widget/crossnote.auth/welcome":"Welcome to crossnote","widget/crossnote.auth/doesnt-have-account":"Doesn't have an account? Let's create one \ud83d\ude09!","widget/crossnote.auth/forgot_password":"Forgot your password \ud83d\ude23?","widget/crossnote.auth/failed_to_send_code":"Failed to send verification code","widget/crossnote.auth/verification_code_sent":"Verification code has been sent to ","widget/crossnote.auth/failed_to_reset_password":"Failed to reset password","widget/crossnote.auth/password_reset":"Your password has been reset","widget/crossnote.auth/password-mismatch":"Passwords mismatch","widget/crossnote.auth/hello":"Hello, ","widget/crossnote.auth/enter-the-verification-code":"Enter the verification code","widget/crossnote.auth/get-code":"Get code","widget/crossnote.auth/sign-in-with-github-account":"Sign in with GitHub account","widget/crossnote.auth/already-have-an-account":"Already have an account?","widget/crossnote.auth/reset-password":"Reset password","widget/crossnote.auth/Or":"Or","widget/crossnote.bilibili/Bilibili":"Bilibili","widget/crossnote.bilibili/bilibili-video-url":"Bilibili video URL","widget/crossnote.bilibili/url-placeholder":"Enter the Bilibili video URL here, then press 'Enter' to insert.","widget/crossnote.image/image-helper":"Image helper","widget/crossnote.image/image-url-placeholder":"Enter image URL here, then press 'Enter' to insert.","widget/crossnote.image/click-here-to-browse-image-file":"Click here to browse image file","widget/crossnote.neteasemusic/song-id-placeholder":"Enter Netease Music song number ID.","widget/crossnote.video/video-url-placeholder":"Enter video source URL here, then press 'Enter' to insert.","widget/crossnote.video/poster-url":"Poster URL (optional)","widget/crossnote.video/poster-url-placeholder":"Enter poster URL here.","widget/crossnote.youtube/youtube-video-url":"Youtube video URL","widget/crossnote.youtube/youtube-video-url-placeholder":"Enter the Youtube video URL here, then press 'Enter' to insert.","widget/crossnote.ocr/ocr":"OCR - Optical character recognition","widget/crossnote.ocr/local-image":"Local image","widget/crossnote.ocr/recognize-text-in-languages":"Recognize text in languages","widget/crossnote.ocr/start-ocr":"Start OCR","widget/crossnote.ocr/extra-settings":"Extra settings","widget/crossnote.ocr/grayscale":"Grayscale","widget/crossnote.kanban/add-column":"Add new column","tesseract/loading tesseract core":"loading tesseract core","tesseract/initializing tesseract":"initializing tesseract","tesseract/initialized tesseract":"initialized tesseract","tesseract/loading language traineddata":"loading language traineddata","tesseract/loaded language traineddata":"loaded language traineddata","tesseract/initializing api":"initializing api","tesseract/initialized api":"initialized api","tesseract/recognizing text":"recognizing text"}}}});s.a;a(5436),a(5437);var d,m,p,b=a(5),f=a(32),g=a(5793),h=a(5797),v=a(5817),O=a(87),E=a(422),w=a(237),k=a(5811),y=a(5822),j=a(5828),x=a(5795),C=a(5827),N=a(26),S=a(3),P=a(9),I=a(19),D=a(1),A=a.n(D),T=a(2),B=a(404),L=a(20),R=a(42),F=a.n(R),U=a(403),W=a(62),M=a(66);!function(e){e.Notes="Notes",e.Today="Today",e.Todo="Todo",e.Tagged="Tagged",e.Untagged="Untagged",e.Directory="Directory",e.Tag="Tag",e.Conflicted="Conflicted",e.Encrypted="Encrypted"}(d||(d={})),function(e){e.CreatedAt="CreatedAt",e.ModifiedAt="ModifiedAt",e.Title="Title"}(m||(m={})),function(e){e.ASC="ASC",e.DESC="DESC"}(p||(p={}));var _=Object(B.a)((function(e){Object(u.b)().t;var t=e.crossnote,a=Object(n.useState)([]),r=Object(b.a)(a,2),o=r[0],i=r[1],c=Object(n.useState)(null),l=Object(b.a)(c,2),s=l[0],f=l[1],g=Object(n.useState)([]),h=Object(b.a)(g,2),v=h[0],O=h[1],E=Object(n.useState)({name:".",path:".",children:[]}),w=Object(b.a)(E,2),k=w[0],y=w[1],j=Object(n.useState)({name:".",path:".",children:[]}),x=Object(b.a)(j,2),C=x[0],N=x[1],S=Object(n.useState)([]),P=Object(b.a)(S,2),D=P[0],B=P[1],R=Object(n.useState)(null),_=Object(b.a)(R,2),V=_[0],H=_[1],G=Object(n.useState)(!0),z=Object(b.a)(G,2),$=z[0],J=z[1],K=Object(n.useState)({type:d.Notes}),Y=Object(b.a)(K,2),q=Y[0],X=Y[1],Q=Object(n.useState)(!1),Z=Object(b.a)(Q,2),ee=Z[0],te=Z[1],ae=Object(n.useState)(!1),ne=Object(b.a)(ae,2),re=ne[0],oe=ne[1],ie=Object(n.useState)(!1),ce=Object(b.a)(ie,2),le=ce[0],se=ce[1],ue=Object(n.useState)(!1),de=Object(b.a)(ue,2),me=de[0],pe=de[1],be=Object(n.useState)(!1),fe=Object(b.a)(be,2),ge=fe[0],he=fe[1],ve=Object(n.useState)(!1),Oe=Object(b.a)(ve,2),Ee=Oe[0],we=Oe[1],ke=Object(n.useState)(m.ModifiedAt),ye=Object(b.a)(ke,2),je=ye[0],xe=ye[1],Ce=Object(n.useState)(p.DESC),Ne=Object(b.a)(Ce,2),Se=Ne[0],Pe=Ne[1],Ie=Object(n.useCallback)((function(e,a,n,r){t.writeNote(e.notebook,e.filePath,a,e.config,n).then((function(n){e.config=n,e.markdown=a,r&&t.getStatus(e).then((function(e){r(e)})),he(!0)}))}),[t]),De=Object(n.useCallback)((function(e){t.deleteNote(s,e.filePath),O((function(a){var n=a.filter((function(t){return t.filePath!==e.filePath}));return n.length!==a.length&&H(n[0]),t.getNotebookDirectoriesFromNotes(n).then((function(e){y(e)})),N(t.getNotebookTagNodeFromNotes(n)),n})),pe(!1)}),[t,s]),Ae=Object(n.useCallback)((function(e,a){Object(T.a)(A.a.mark((function n(){var r;return A.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.changeNoteFilePath(s,e,a);case 3:return r=v.map((function(t){return t.filePath===e.filePath?(t.filePath=a,t.config.modifiedAt=new Date,t):t})),O(r),n.t0=y,n.next=8,t.getNotebookDirectoriesFromNotes(r);case 8:n.t1=n.sent,(0,n.t0)(n.t1),N(t.getNotebookTagNodeFromNotes(r)),n.next=16;break;case 13:n.prev=13,n.t2=n.catch(0),new F.a({type:"error",text:"Failed to change file path",layout:"topRight",theme:"relax",timeout:5e3}).show();case 16:case"end":return n.stop()}}),n,null,[[0,13]])})))()}),[s,t,v]),Te=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(T.a)(A.a.mark((function a(){var n,r,o,i;return A.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e||(e=Object(W.d)()),e.endsWith(".md")||(e+=".md"),r=[],q.type===d.Notes||q.type===d.Today||q.type===d.Todo||q.type===d.Tagged||q.type===d.Untagged?n=e:q.type===d.Tag?(n=e,r=[q.path]):n=L.relative(s.dir,L.resolve(s.dir,q.path,e)),o={id:"",tags:r,modifiedAt:new Date,createdAt:new Date},a.next=7,t.writeNote(s,n,"",o);case 7:i={notebook:s,filePath:n,markdown:"",config:o},O((function(e){return[i].concat(Object(I.a)(e))})),H(i),pe(!0);case 11:case"end":return a.stop()}}),a)})))()}),[s,t,q]),Be=Object(n.useCallback)(function(){var e=Object(T.a)(A.a.mark((function e(a,n,r,o,c,l,s){var u;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return te(!0),e.prev=1,e.next=4,t.addNotebook({name:a,gitURL:n,branch:r,username:o,password:c,corsProxy:s,rememberCredentials:l});case 4:u=e.sent,i((function(e){return[u].concat(Object(I.a)(e))})),te(!1),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),te(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,a,n,r,o,i,c){return e.apply(this,arguments)}}(),[t]),Le=Object(n.useCallback)(function(){var e=Object(T.a)(A.a.mark((function e(a){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.updateNotebook(a);case 5:i((function(e){return Object(I.a)(e)})),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[t]),Re=Object(n.useCallback)(function(){var e=Object(T.a)(A.a.mark((function e(a){var n;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.deleteNotebook(a._id);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:n=null,i((function(e){return e.filter((function(e){return n||e._id===a._id||(n=e),e._id!==a._id}))})),He(n);case 12:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),[t]),Fe=Object(n.useCallback)(function(){var e=Object(T.a)(A.a.mark((function e(a){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return oe(!0),e.prev=3,e.next=6,t.pushNotebook(a);case 6:oe(!1),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),oe(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),[t]),Ue=Object(n.useCallback)(function(){var e=Object(T.a)(A.a.mark((function e(a){var n,r;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return se(!0),e.prev=3,e.next=6,t.pullNotebook(a);case 6:return se(!1),e.next=9,t.listNotes({notebook:a.notebook,dir:"./",includeSubdirectories:!0});case 9:return n=e.sent,O(n),e.t0=y,e.next=14,t.getNotebookDirectoriesFromNotes(n);case 14:e.t1=e.sent,(0,e.t0)(e.t1),N(t.getNotebookTagNodeFromNotes(n)),r=n.find((function(e){return e.filePath===V.filePath})),H(r||n[0]),e.next=25;break;case 21:throw e.prev=21,e.t2=e.catch(3),se(!1),e.t2;case 25:case"end":return e.stop()}}),e,null,[[3,21]])})));return function(t){return e.apply(this,arguments)}}(),[t,V]),We=Object(n.useCallback)(function(){var e=Object(T.a)(A.a.mark((function e(a){var n;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.checkoutNote(a);case 4:(n=e.sent)?(O((function(e){return e.map((function(e){return e.filePath===n.filePath?n:e}))})),B((function(e){return e.map((function(e){return e.filePath===n.filePath?n:e}))})),H(n)):(O((function(e){var n=e.filter((function(e){return e.filePath!==a.filePath}));return t.getNotebookDirectoriesFromNotes(n).then((function(e){y(e)})),N(t.getNotebookTagNodeFromNotes(n)),n})),B((function(e){var t=e.filter((function(e){return e.filePath!==a.filePath}));return H(t[0]),t})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[t]),Me=Object(n.useCallback)((function(){t&&N(t.getNotebookTagNodeFromNotes(v))}),[v,t]),_e=Object(n.useCallback)(function(){var e=Object(T.a)(A.a.mark((function e(a,n){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.getNote(a,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),[t]),Ve=Object(n.useCallback)((function(e){if(t){var a=v.find((function(t){return t.filePath===e}));a&&H(a)}}),[t,v]);Object(n.useEffect)((function(){t&&Object(T.a)(A.a.mark((function e(){var a,n,r;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.listNotebooks();case 2:if(a=e.sent,n=null,!a.length){e.next=12;break}i(a),r=localStorage.getItem("selectedNotebookID"),(n=a.find((function(e){return e._id===r})))||(n=a[0]),He(n),e.next=17;break;case 12:return e.next=14,t.addNotebook({name:"Unamed",corsProxy:"https://cors.isomorphic-git.org",gitURL:""});case 14:n=e.sent,i([n]),He(n);case 17:case"end":return e.stop()}}),e)})))()}),[t]),Object(n.useEffect)((function(){t&&Object(T.a)(A.a.mark((function e(){var a;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return we(!0),O([]),y({name:".",path:".",children:[]}),N({name:".",path:".",children:[]}),e.next=6,t.listNotes({notebook:s,dir:"./",includeSubdirectories:!0});case 6:return a=e.sent,O(a),e.t0=y,e.next=11,t.getNotebookDirectoriesFromNotes(a);case 11:e.t1=e.sent,(0,e.t0)(e.t1),N(t.getNotebookTagNodeFromNotes(a)),H(null),we(!1);case 16:case"end":return e.stop()}}),e)})))()}),[t,s]),Object(n.useEffect)((function(){t&&s&&X({type:d.Notes})}),[t,s]),Object(n.useEffect)((function(){if(t&&s&&v){if(v.length&&v[0].notebook._id!==s._id)return;var e=[];e=q.type===d.Notes?Object(I.a)(v):q.type===d.Todo?v.filter((function(e){return e.markdown.match(/(\*|-|\d+\.)\s\[(\s+|x|X)\]\s/gm)})):q.type===d.Today?v.filter((function(e){return Date.now()-e.config.modifiedAt.getTime()<=W.a})):q.type===d.Tagged?v.filter((function(e){return e.config.tags.length>0})):q.type===d.Untagged?v.filter((function(e){return 0===e.config.tags.length})):q.type===d.Tag?v.filter((function(e){return e.config.tags.find((function(e){return 0===(e.toLocaleLowerCase()+"/").indexOf(q.path+"/")}))})):q.type===d.Conflicted?v.filter((function(e){return t.markdownHasConflicts(e.markdown)})):q.type===d.Encrypted?v.filter((function(e){return e.config.encryption})):$?v.filter((function(e){return 0===e.filePath.indexOf(q.path+"/")})):v.filter((function(e){return L.dirname(e.filePath)===q.path})),je===m.ModifiedAt?Se===p.DESC?e.sort((function(e,t){return t.config.modifiedAt.getTime()-e.config.modifiedAt.getTime()})):e.sort((function(e,t){return e.config.modifiedAt.getTime()-t.config.modifiedAt.getTime()})):je===m.CreatedAt?Se===p.DESC?e.sort((function(e,t){return t.config.createdAt.getTime()-e.config.createdAt.getTime()})):e.sort((function(e,t){return e.config.createdAt.getTime()-t.config.createdAt.getTime()})):je===m.Title&&(Se===p.DESC?e.sort((function(e,t){return Object(M.b)(t.markdown).localeCompare(Object(M.b)(e.markdown))})):e.sort((function(e,t){return Object(M.b)(e.markdown).localeCompare(Object(M.b)(t.markdown))}))),B(e),V||H(e[0])}}),[q,t,s,$,V,v,je,Se]),Object(U.a)((function(){ge&&(he(!1),B((function(e){return Object(I.a)(e)})))}),4e3);var He=Object(n.useCallback)((function(e){localStorage.setItem("selectedNotebookID",e._id),f(e)}),[f]);return{crossnote:t,notebooks:o,selectedNotebook:s,setSelectedNotebook:He,notes:D,selectedNote:V,setSelectedNote:H,updateNoteMarkdown:Ie,createNewNote:Te,selectedSection:q,setSelectedSection:X,includeSubdirectories:$,setIncludeSubdirectories:J,deleteNote:De,changeNoteFilePath:Ae,notebookDirectories:k,notebookTagNode:C,addNotebook:Be,isAddingNotebook:ee,isPushingNotebook:re,isPullingNotebook:le,updateNotebook:Le,deleteNotebook:Re,pushNotebook:Fe,pullNotebook:Ue,checkoutNote:We,displayMobileEditor:me,setDisplayMobileEditor:pe,updateNotebookTagNode:Me,getNote:_e,isLoadingNotebook:Ee,openNoteAtPath:Ve,orderBy:je,setOrderBy:xe,orderDirection:Se,setOrderDirection:Pe}})),V=a(144),H=a(5796),G=a(5757),z=a(5826),$=a(5792),J=a(5818),K=a(5785),Y=a(5789),q=a(5790),X=a(5798),Q=a(5794),Z=a(104);function ee(e){var t=_.useContainer(),a=e.notebook,o=Object(n.useState)(localStorage.getItem("authorName")||"anonymous"),i=Object(b.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(localStorage.getItem("authorEmail")||"anonymous@crossnote.app"),d=Object(b.a)(s,2),m=d[0],p=d[1],f=Object(n.useState)(a.gitUsername),g=Object(b.a)(f,2),h=g[0],E=g[1],w=Object(n.useState)(a.gitPassword),k=Object(b.a)(w,2),y=k[0],j=k[1],x=Object(n.useState)("doc: Updated docs"),C=Object(b.a)(x,2),N=C[0],S=C[1],P=Object(u.b)().t,I=Object(n.useCallback)((function(){t.pushNotebook({notebook:a,authorName:c,authorEmail:m,username:h,password:y,message:N,onAuthFailure:function(){new F.a({type:"error",text:"Authentication failed",layout:"topRight",theme:"relax",timeout:5e3}).show()}}).then((function(){e.onClose(),new F.a({type:"success",text:"Notebook pushed",layout:"topRight",theme:"relax",timeout:2e3}).show()})).catch((function(t){e.onClose(),new F.a({type:"error",text:t.message.match(/^error\//)?P(t.message):"Failed to push notebook",layout:"topRight",theme:"relax",timeout:2e3}).show()}))}),[m,c,h,y,a,N,e]);return Object(n.useEffect)((function(){localStorage.setItem("authorName",c)}),[c]),Object(n.useEffect)((function(){localStorage.setItem("authorEmail",m)}),[m]),Object(n.useEffect)((function(){E(a.gitUsername)}),[a.gitUsername,e.open]),Object(n.useEffect)((function(){j(a.gitPassword)}),[a.gitPassword,e.open]),r.a.createElement(K.a,{open:e.open,onClose:function(){t.isPushingNotebook||e.onClose()}},r.a.createElement(Y.a,null,"Push notebook ".concat(a.name," to git repository"),r.a.createElement(v.a,null,r.a.createElement(O.a,{variant:"caption"},a.gitURL+":"+a.gitBranch))),r.a.createElement(q.a,null,r.a.createElement(J.a,{label:"Author name",fullWidth:!0,value:c,onChange:function(e){return l(e.target.value)}}),r.a.createElement(J.a,{label:"Author email",fullWidth:!0,value:m,onChange:function(e){return p(e.target.value)}}),r.a.createElement(J.a,{label:"Commit message",fullWidth:!0,value:N,onChange:function(e){return S(e.target.value)}}),r.a.createElement(J.a,{label:"username",placeholder:"username",fullWidth:!0,value:h,onChange:function(e){return E(e.target.value)}}),r.a.createElement(J.a,{label:"password",placeholder:"password",type:"password",fullWidth:!0,value:y,onChange:function(e){return j(e.target.value)}})),r.a.createElement(Q.a,null,r.a.createElement(G.a,{variant:"contained",color:"primary",disabled:t.isPushingNotebook,onClick:I},t.isPushingNotebook?"Pushing...":"Push"),r.a.createElement(G.a,{onClick:e.onClose},"Cancel")))}var te=Object(x.a)((function(e){return Object(C.a)({imageWrapper:{textAlign:"center"},imagePreview:{maxWidth:"100%",maxHeight:"400px"}})}));function ae(e){var t=te(e),a=e.editor,o=e.marker,i=e.imageElement,c=Object(n.useState)(""),l=Object(b.a)(c,2),s=l[0],u=l[1],d=Object(n.useState)(""),m=Object(b.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(""),h=Object(b.a)(g,2),O=h[0],E=h[1],w=Object(n.useCallback)((function(){if(i&&a&&o){var t=o.find();a.replaceRange("",t.from,t.to),e.onClose()}}),[i,a,o,e]),k=Object(n.useCallback)((function(){if(i&&a&&o){var t=o.find();t&&(O.trim().length?a.replaceRange("![".concat(p.trim(),"](").concat(s.trim()," ").concat(JSON.stringify(O),")"),t.from,t.to):a.replaceRange("![".concat(p.trim(),"](").concat(s.trim(),")"),t.from,t.to),e.onClose())}}),[i,a,o,e,p,s,O]);return Object(n.useEffect)((function(){i&&o&&a&&(u(i.src||""),E(i.title||""),f(i.alt||""))}),[i,o,a]),a&&o&&i?r.a.createElement(K.a,{open:e.open,onClose:e.onClose},r.a.createElement(Y.a,null,"Edit image"),r.a.createElement(q.a,{style:{width:"400px",maxWidth:"100%"}},r.a.createElement(v.a,{className:Object(S.a)(t.imageWrapper)},r.a.createElement("img",{className:Object(S.a)(t.imagePreview),src:s,alt:p,title:O})," "),r.a.createElement(J.a,{autoFocus:!0,value:s,helperText:"image URL",fullWidth:!0,onChange:function(e){return u(e.target.value)}}),r.a.createElement(J.a,{autoFocus:!0,value:O,helperText:"image title",fullWidth:!0,onChange:function(e){return E(e.target.value)}}),r.a.createElement(J.a,{autoFocus:!0,value:p,helperText:"image alt text",fullWidth:!0,onChange:function(e){return f(e.target.value)}})),r.a.createElement(Q.a,null,r.a.createElement(G.a,{variant:"contained",color:"primary",onClick:k},"Update"),r.a.createElement(G.a,{variant:"contained",color:"secondary",onClick:w},"Delete"),r.a.createElement(G.a,{onClick:e.onClose},"Cancel"))):null}var ne=a(5824);var re,oe=a(214),ie=a(5631),ce=Object(x.a)((function(e){return Object(C.a)({editorPanel:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},topPanel:{position:"relative",padding:e.spacing(.5,1),display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #eee",overflow:"auto"},bottomPanel:{position:"relative",padding:e.spacing(.5,1),display:"flex",alignItems:"center",justifyContent:"space-between",borderTop:"1px solid #eee"},controlBtn:{padding:e.spacing(.5,0),color:e.palette.text.secondary},controlBtnSelected:{color:e.palette.primary.main},controlBtnSelectedSecondary:{color:e.palette.secondary.main},row:{display:"flex",flexDirection:"row",alignItems:"center"},cursorPositionInfo:{zIndex:150},editorWrapper:Object(f.a)({flex:1,overflow:"auto","& .CodeMirror-gutters":{display:"none"},"& .CodeMirror-code":{width:"100%"},"& .CodeMirror":Object(f.a)({height:"100%",padding:e.spacing(0,2)},e.breakpoints.down("sm"),{padding:e.spacing(0)}),"& .CodeMirror-vscrollbar":{display:"none !important"}},e.breakpoints.down("sm"),{padding:e.spacing(1)}),fullScreen:{position:"fixed",width:"100%",height:"100%",left:"0",top:"0",zIndex:2e3,overflow:"auto",padding:"0"},editor:{width:"100%",height:"100%"},preview:Object(f.a)({position:"relative",left:"0",top:"0",width:"100%",height:"100%",border:"none",overflow:"auto !important",padding:e.spacing(2),zIndex:99},e.breakpoints.down("sm"),{padding:e.spacing(1)}),backBtn:Object(f.a)({marginRight:"8px"},e.breakpoints.up("sm"),{display:"none"}),menuItemOverride:{cursor:"default",padding:"0 0 0 ".concat(e.spacing(2),"px"),"&:hover":{backgroundColor:"inherit"}},menuItemTextField:{paddingRight:e.spacing(2)}})}));function le(e){var t=e.note,a=ce(e),o=Object(n.useState)(null),i=Object(b.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(null),d=Object(b.a)(s,2),m=d[0],p=d[1],f=Object(n.useState)({line:0,ch:0}),w=Object(b.a)(f,2),k=w[0],j=w[1],x=Object(n.useState)(!1),C=Object(b.a)(x,2),N=C[0],D=C[1],B=Object(n.useState)(!1),R=Object(b.a)(B,2),U=R[0],W=R[1],te=Object(n.useState)(!1),le=Object(b.a)(te,2),se=le[0],ue=le[1],de=Object(n.useState)(t&&t.filePath||""),me=Object(b.a)(de,2),pe=me[0],be=me[1],fe=Object(n.useState)(re.VickyMD),ge=Object(b.a)(fe,2),he=ge[0],ve=ge[1],Oe=Object(n.useState)(null),Ee=Object(b.a)(Oe,2),we=Ee[0],ke=Ee[1],ye=Object(n.useState)(""),je=Object(b.a)(ye,2),xe=je[0],Ce=je[1],Ne=Object(n.useState)(!1),Se=Object(b.a)(Ne,2),Pe=Se[0],Ie=Se[1],De=Object(n.useState)(null),Ae=Object(b.a)(De,2),Te=Ae[0],Be=Ae[1],Le=Object(n.useState)(""),Re=Object(b.a)(Le,2),Fe=Re[0],Ue=Re[1],We=Object(n.useState)([]),Me=Object(b.a)(We,2),_e=Me[0],Ve=Me[1],He=Object(n.useState)(!1),Ge=Object(b.a)(He,2),ze=Ge[0],$e=Ge[1],Je=Object(n.useState)(""),Ke=Object(b.a)(Je,2),Ye=Ke[0],qe=Ke[1],Xe=Object(n.useState)(!1),Qe=Object(b.a)(Xe,2),Ze=Qe[0],et=Qe[1],tt=Object(n.useState)(""),at=Object(b.a)(tt,2),nt=at[0],rt=at[1],ot=Object(n.useState)(!1),it=Object(b.a)(ot,2),ct=it[0],lt=it[1],st=Object(n.useState)(!1),ut=Object(b.a)(st,2),dt=ut[0],mt=ut[1],pt=Object(n.useState)(null),bt=Object(b.a)(pt,2),ft=bt[0],gt=bt[1],ht=Object(n.useState)(null),vt=Object(b.a)(ht,2),Ot=vt[0],Et=vt[1],wt=Object(n.useState)(!1),kt=Object(b.a)(wt,2),yt=kt[0],jt=kt[1],xt=_.useContainer(),Ct=Object(u.b)().t,Nt=Object(n.useCallback)((function(){t&&(W(!1),be(t.filePath))}),[t]),St=Object(n.useCallback)((function(){qe(""),$e(!1)}),[]),Pt=Object(n.useCallback)((function(){rt(""),et(!1)}),[]),It=Object(n.useCallback)((function(e){t&&Object(T.a)(A.a.mark((function a(){return A.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if((e=e.replace(/^\/+/,"")).endsWith(".md")||(e+=".md"),t.filePath===e){a.next=5;break}return a.next=5,xt.changeNoteFilePath(t,e);case 5:be(e),W(!1);case 7:case"end":return a.stop()}}),a)})))()}),[t,Nt]),Dt=Object(n.useCallback)((function(){new F.a({type:"info",text:"Pulling notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),t&&xt.pullNotebook({notebook:t.notebook,onAuthFailure:function(){new F.a({type:"error",text:"Authentication failed",layout:"topRight",theme:"relax",timeout:5e3}).show()}}).then((function(){new F.a({type:"success",text:"Notebook pulled",layout:"topRight",theme:"relax",timeout:2e3}).show()})).catch((function(e){console.log(e),new F.a({type:"error",text:"Failed to pull notebook",layout:"topRight",theme:"relax",timeout:2e3}).show()}))}),[t]),At=Object(n.useCallback)((function(){t&&xt.checkoutNote(t)}),[t]),Tt=Object(n.useCallback)((function(){var e=Fe.trim()||"";t&&e.length&&m&&ct&&(e=e.replace(/\s+/g," ").split("/").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).join("/"),Ve((function(a){var n=a.indexOf(e)>=0?Object(I.a)(a):[e].concat(Object(I.a)(a));return t.config.tags=n.sort((function(e,t){return e.localeCompare(t)})),xt.updateNoteMarkdown(t,m.getValue(),t.config.encryption?nt:"",(function(e){Ce(e)})),xt.updateNotebookTagNode(),n})),Ue(""))}),[Fe,t,m,nt,ct]),Bt=Object(n.useCallback)((function(e){t&&m&&ct&&Ve((function(a){var n=a.filter((function(t){return t!==e}));return t.config.tags=n.sort((function(e,t){return e.localeCompare(t)})),xt.updateNoteMarkdown(t,m.getValue(),t.config.encryption?nt:"",(function(e){Ce(e)})),xt.updateNotebookTagNode(),n}))}),[t,m,nt,ct]),Lt=Object(n.useCallback)((function(){if(t&&m){var e=m.getValue();t.config.encryption?xt.getNote(t.notebook,t.filePath).then((function(e){try{var a=V.AES.decrypt(e.markdown.trim(),Ye),n=JSON.parse(a.toString(V.enc.Utf8));t.config.encryption=null,delete t.config.encryption,xt.updateNoteMarkdown(t,n.markdown,"",(function(e){Ce(e),rt(""),lt(!0),St(),m.setValue(n.markdown),m.setOption("readOnly",!1)}))}catch(r){new F.a({type:"error",text:"Failed to disable encryption",layout:"topRight",theme:"relax",timeout:5e3}).show()}})).catch((function(e){new F.a({type:"error",text:"Failed to disable encryption",layout:"topRight",theme:"relax",timeout:5e3}).show()})):(t.config.encryption={title:Object(M.b)(e)},xt.updateNoteMarkdown(t,m.getValue(),Ye,(function(e){rt(Ye),lt(!0),Ce(e),St()})))}}),[t,m,St,Ye]),Rt=Object(n.useCallback)((function(){t&&m&&xt.getNote(t.notebook,t.filePath).then((function(e){try{var t=V.AES.decrypt(e.markdown.trim(),nt),a=JSON.parse(t.toString(V.enc.Utf8));m.setOption("readOnly",!1),m.setValue(a.markdown),lt(!0),et(!1)}catch(n){new F.a({type:"error",text:"Decryption failed",layout:"topRight",theme:"relax",timeout:5e3}).show(),lt(!1)}})).catch((function(e){lt(!1),console.log(e)}))}),[t,m,nt,Pt]),Ft=Object(n.useCallback)((function(){t&&m&&ct&&(t.config.pinned=!t.config.pinned,t.config.pinned||delete t.config.pinned,xt.updateNoteMarkdown(t,m.getValue(),t.config.encryption?nt:"",(function(e){Ce(e)})))}),[t,m,nt,ct]),Ut=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(t&&m&&e)if(e.match(/https?:\/\//))window.open(e,"_blank");else if(e.startsWith("/")){var a=L.relative(t.notebook.dir,L.resolve(t.notebook.dir,e.replace(/^\//,"")));xt.openNoteAtPath(a)}else{var n=L.relative(t.notebook.dir,L.resolve(L.dirname(L.resolve(t.notebook.dir,t.filePath)),e));xt.openNoteAtPath(n)}}),[t,m]);return Object(n.useEffect)((function(){if(!t)return function(){p(null),l(null),ke(null)}}),[t]),Object(n.useEffect)((function(){t&&be(t.filePath)}),[t]),Object(n.useEffect)((function(){t&&xt.crossnote.getStatus(t).then((function(e){Ce(e)}))}),[t,xt.crossnote]),Object(n.useEffect)((function(){m&&t&&(t.config.encryption?(lt(!1),rt(""),m.setOption("readOnly",!0),m.setValue("\ud83d\udd10 encrypted"),et(!0)):(lt(!0),rt(""),m.setOption("readOnly",!1),m.setValue(t.markdown)))}),[m,t]),Object(n.useEffect)((function(){if(c&&!m&&t){var e=oe.fromTextArea(c,{mode:{name:"hypermd",hashtag:!0},inputStyle:"textarea"});e.setOption("lineNumbers",!1),e.setOption("foldGutter",!1),e.setValue(t.markdown||""),e.on("cursorActivity",(function(e){var t=e.getCursor();t&&j({line:t.line,ch:t.ch})})),p(e)}}),[c,t,m]),Object(n.useEffect)((function(){if(m&&t){Ve(t.config.tags||[]);var e=function(){if(!m.getOption("readOnly")&&ct){var e=m.getValue();(t.config.encryption||e!==t.markdown)&&xt.updateNoteMarkdown(t,e,t.config.encryption?nt:"",(function(e){Ce(e),Ve(t.config.tags||[])}))}};m.on("changes",e);var a=function(){!ct&&t.config.encryption&&et(!0)};m.on("keyup",a);var n=function(e){var t=e.element.getAttribute("data-url");Ut(t||"")};m.on("linkIconClicked",n);var r=function(e){var t=e.marker,a=e.element;a.setAttribute("data-marker-position",JSON.stringify(t.find())),gt(a),Et(t),jt(!0)};return m.on("imageClicked",r),function(){m.off("changes",e),m.off("keyup",a),m.off("linkIconClicked",n),m.off("imageClicked",r)}}}),[m,t,nt,ct]),Object(n.useEffect)((function(){if(m&&t){var e=function(){var e=m.getOption("readOnly");m.setOption("readOnly",!0),m.setValue(ct?t.markdown:"\ud83d\udd10 encrypted"),m.setOption("readOnly",e)};he===re.VickyMD?(oe.switchToHyperMD(m),m.getWrapperElement().style.display="block",e()):he===re.SourceCode?(oe.switchToNormal(m),m.getWrapperElement().style.display="block",e()):m.getWrapperElement().style.display="none"}}),[he,m,t,ct]),Object(n.useEffect)((function(){if(he===re.Preview&&m&&t&&we)if(ct){var e=function(e){for(var t=e.getElementsByTagName("A"),a=function(e){var a=t[e];a.onclick=function(e){e.preventDefault(),Ut(a.getAttribute("href"))}},n=0;n<t.length;n++)a(n)};Object(Z.renderPreview)(we,m.getValue()),we.childElementCount&&"IFRAME"===we.children[0].tagName.toUpperCase()?(we.style.maxWidth="100%",we.style.height="100%",we.style.overflow="hidden !important",e(we.children[0].contentDocument.body)):(we.style.height="100%",we.style.overflow="hidden !important",e(we))}else we.innerHTML="\ud83d\udd10 encrypted"}),[he,m,we,t,ct]),Object(n.useEffect)((function(){if(m&&t){var e=function(e,t){if(1===t.text.length&&"/"===t.text[0]&&m.showHint({closeOnUnfocus:!1,completeSingle:!1,hint:function(){var e=m.getCursor(),t=m.getTokenAt(e),a=t.string.lastIndexOf("/"),n=e.line,r=e.ch,o=t.string.slice(a+1,r),i=[{text:"# ",displayText:"/h1 - ".concat(Ct("editor/toolbar/insert-header-1"))},{text:"## ",displayText:"/h2 - ".concat(Ct("editor/toolbar/insert-header-2"))},{text:"### ",displayText:"/h3 - ".concat(Ct("editor/toolbar/insert-header-3"))},{text:"#### ",displayText:"/h4 - ".concat(Ct("editor/toolbar/insert-header-4"))},{text:"##### ",displayText:"/h5 - ".concat(Ct("editor/toolbar/insert-header-5"))},{text:"###### ",displayText:"/h6 - ".concat(Ct("editor/toolbar/insert-header-6"))},{text:"> ",displayText:"/blockquote - ".concat(Ct("editor/toolbar/insert-blockquote"))},{text:"* ",displayText:"/ul - ".concat(Ct("editor/toolbar/insert-unordered-list"))},{text:"1. ",displayText:"/ol - ".concat(Ct("editor/toolbar/insert-ordered-list"))},{text:"`@crossnote.image`\n",displayText:"/image - ".concat(Ct("editor/toolbar/insert-image"))},{text:"|   |   |\n|---|---|\n|   |   |\n",displayText:"/table - ".concat(Ct("editor/toolbar/insert-table"))},{text:"`@timer "+JSON.stringify({date:(new Date).toString()}).replace(/^{/,"").replace(/}$/,"")+"`\n",displayText:"/timer - ".concat(Ct("editor/toolbar/insert-clock"))},{text:"",displayText:"/emoji - ".concat(Ct("editor/toolbar/insert-emoji"))},{text:"`@crossnote.audio`  \n",displayText:"/audio - ".concat(Ct("editor/toolbar/audio-url"))},{text:"`@crossnote.netease_music`  \n",displayText:"/netease - ".concat(Ct("editor/toolbar/netease-music"))},{text:"`@crossnote.video`  \n",displayText:"/video - ".concat(Ct("editor/toolbar/video-url"))},{text:"`@crossnote.youtube`  \n",displayText:"/youtube - ".concat(Ct("editor/toolbar/youtube"))},{text:"`@crossnote.bilibili`  \n",displayText:"/bilibili - ".concat(Ct("editor/toolbar/bilibili"))},{text:"\x3c!-- slide --\x3e  \n",displayText:"/slide - ".concat(Ct("editor/toolbar/insert-slide"))},{text:"`@crossnote.ocr`  \n",displayText:"/ocr - ".concat(Ct("editor/toolbar/insert-ocr"))},{text:'`@crossnote.kanban "v":2,"board":{"columns":[]}`  \n',displayText:"/kanban - ".concat(Ct("editor/toolbar/insert-kanban")," (beta)")},{text:"`@crossnote.abc`  \n",displayText:"/abc - ".concat(Ct("editor/toolbar/insert-abc-notation"))}],c=i.filter((function(e){return e.displayText.toLocaleLowerCase().indexOf(o.toLowerCase())>=0}));return{list:c.length?c:i,from:{line:n,ch:a},to:{line:n,ch:r}}}}),t.text.length>0&&t.text[0].startsWith("`@timer ")&&t.removed.length>0&&t.removed[0].startsWith("/")){for(var a=m.getValue().split("\n"),n=[],r=0;r<a.length;r++){var o=a[r].match(/^`@timer\s.+`/);if(o){var i=o[0],c=i.match(/^`@timer\s+(.+)`/);if(!c||!c.length)continue;var l=c[1];try{var s=JSON.parse("{".concat(l,"}")).date;s&&n.push({text:i,line:r,date:new Date(s)})}catch(g){continue}}}for(var u=1;u<n.length;u++){var d=n[u],p=n[u-1],b=Object(ne.a)(d.date,p.date,{includeSeconds:!0}),f="`@timer ".concat(JSON.stringify({date:d.date.toString(),duration:b}).replace(/^{/,"").replace(/}$/,""),"`");m.replaceRange(f,{line:d.line,ch:0},{line:d.line,ch:d.text.length})}}};m.on("change",e);var a=function(e){};return m.on("cursorActivity",a),function(){m.off("change",e),m.off("cursorActivity",a)}}}),[m,t]),Object(n.useEffect)((function(){if(t&&m&&dt)if(he===re.Preview&&we){var e=function(){mt(!1),we.style.zIndex="".concat(99)};(function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3;return Object(Z.printPreview)(e,t,["#main-panel","#editor-main-panel","#editor-card"],"\n  #notes-panel,\n  .editor-bottom-panel,\n  .drawer,\n  .CodeMirror,\n  .editor-textarea,\n  .control-panel-wrapper {\n    display: none;\n  }\n  #editor-card {\n    width: 100%;\n    height: 100%;\n    box-shadow: none;\n  }\n  .editor-panel, #main-panel {\n    background-color: #fff;\n    box-shadow: none;\n    border: none;\n  }\n",a)})(we).then((function(){e()})).catch((function(){e()}))}else ve(re.Preview)}),[dt,he,t,m,we]),t?r.a.createElement(v.a,{className:Object(S.a)(a.editorPanel,"editor-panel")},r.a.createElement(v.a,{className:Object(S.a)(a.topPanel)},r.a.createElement(v.a,{className:Object(S.a)(a.row)},r.a.createElement(H.a,{className:Object(S.a)(a.backBtn)},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(){xt.setDisplayMobileEditor(!1)}},r.a.createElement(P.d,null))),r.a.createElement(H.a,{variant:"outlined",color:"default","aria-label":"editor mode"},r.a.createElement(z.a,{title:Ct("general/vickymd")},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn,he===re.VickyMD&&a.controlBtnSelected),color:he===re.VickyMD?"primary":"default",onClick:function(){return ve(re.VickyMD)}},r.a.createElement(P.u,null))),r.a.createElement(z.a,{title:Ct("editor/note-control/source-code")},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn,he===re.SourceCode&&a.controlBtnSelected),color:he===re.SourceCode?"primary":"default",onClick:function(){return ve(re.SourceCode)}},r.a.createElement(P.i,null))),r.a.createElement(z.a,{title:Ct("editor/note-control/preview")},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn,he===re.Preview&&a.controlBtnSelected),color:he===re.Preview?"primary":"default",onClick:function(){return ve(re.Preview)}},r.a.createElement(P.m,null)))),r.a.createElement(H.a,{style:{marginLeft:"8px"}},ct&&r.a.createElement(z.a,{title:"Tags"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(e){return Be(e.currentTarget)}},r.a.createElement(P.G,null))),ct&&r.a.createElement(z.a,{title:"Pin"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn,t.config.pinned&&a.controlBtnSelectedSecondary),onClick:Ft},t.config.pinned?r.a.createElement(P.v,null):r.a.createElement(P.w,null))),r.a.createElement(z.a,{title:"Encryption"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn,t.config.encryption&&a.controlBtnSelectedSecondary),onClick:function(){return $e(!0)}},t.config.encryption?r.a.createElement(P.p,null):r.a.createElement(P.r,null)))),r.a.createElement(H.a,{style:{marginLeft:"8px"}},r.a.createElement(z.a,{title:"Change file path"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(){return W(!0)}},r.a.createElement(P.A,null))),r.a.createElement(z.a,{title:"Restore (checkout)"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:At},r.a.createElement(P.B,null))),r.a.createElement(z.a,{title:"Delete file"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(){return D(!0)}},r.a.createElement(P.k,null))),ie.desktop()&&r.a.createElement(z.a,{title:"Print"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(){return mt(!0)}},r.a.createElement(P.z,null)))),r.a.createElement(H.a,{style:{marginLeft:"8px"}},r.a.createElement(z.a,{title:"Fullscreen"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(){return Ie(!0)}},r.a.createElement(P.n,null)))),t.notebook.gitURL&&r.a.createElement(H.a,{style:{marginLeft:"8px"}},r.a.createElement(z.a,{title:"Upload (Push)"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(){return ue(!0)},disabled:xt.isPullingNotebook||xt.isPushingNotebook},r.a.createElement(P.h,null))),r.a.createElement(z.a,{title:"Download (Pull)"},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:Dt,disabled:xt.isPullingNotebook||xt.isPushingNotebook},r.a.createElement(P.g,null)))),r.a.createElement($.a,{open:Boolean(Te),anchorEl:Te,keepMounted:!0,onClose:function(){return Be(null)}},r.a.createElement(g.a,null,r.a.createElement(h.a,{className:Object(S.a)(a.menuItemOverride,a.menuItemTextField)},r.a.createElement(J.a,{placeholder:"Add tag...",autoFocus:!0,value:Fe,onChange:function(e){e.stopPropagation(),Ue(e.target.value)},onKeyUp:function(e){13===e.which&&Tt()}})),_e.length>0?_e.map((function(e){return r.a.createElement(h.a,{key:e,className:Object(S.a)(a.menuItemOverride)},r.a.createElement(v.a,{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%"}},r.a.createElement(O.a,null,e),r.a.createElement(E.a,{onClick:function(){return Bt(e)}},r.a.createElement(P.f,null))))})):r.a.createElement(h.a,{className:Object(S.a)(a.menuItemOverride)},r.a.createElement(O.a,{style:{margin:"8px 0"}},"No tags")))))),r.a.createElement(v.a,{className:Object(S.a)(a.editorWrapper,Pe?a.fullScreen:null)},r.a.createElement("textarea",{className:Object(S.a)(a.editor,"editor-textarea"),placeholder:Ct("editor/placeholder"),ref:function(e){l(e)}}),he===re.Preview&&m?r.a.createElement("div",{className:Object(S.a)(a.preview,"preview"),id:"preview",ref:function(e){ke(e)}}):null,Pe&&r.a.createElement(E.a,{style:{position:"fixed",right:"0",top:"0",zIndex:2001},onClick:function(){return Ie(!1)}},r.a.createElement(P.o,null))),r.a.createElement(v.a,{className:Object(S.a)(a.bottomPanel,"editor-bottom-panel")},r.a.createElement(v.a,{className:Object(S.a)(a.row)},r.a.createElement(O.a,{variant:"caption",style:{cursor:"pointer"},onClick:function(){W(!0)}},t.filePath),r.a.createElement(O.a,{variant:"caption",style:{marginLeft:"4px"}},"- "+xe)),r.a.createElement(v.a,{className:Object(S.a)(a.cursorPositionInfo)},r.a.createElement(O.a,{variant:"caption"},"Ln ".concat(k.line+1,", Col ").concat(k.ch)))),r.a.createElement(K.a,{open:N,onClose:function(){return D(!1)}},r.a.createElement(Y.a,null,"Are you sure to delete this file?"),r.a.createElement(q.a,null,r.a.createElement(X.a,null,"Can't be undone")),r.a.createElement(Q.a,null,r.a.createElement(G.a,{style:{color:"red"},onClick:function(){xt.deleteNote(t),D(!1)}},"Delete"),r.a.createElement(G.a,{onClick:function(){return D(!1)}},"Cancel"))),r.a.createElement(K.a,{open:U,onClose:Nt},r.a.createElement(Y.a,null,"Change file path"),r.a.createElement(q.a,null,r.a.createElement(J.a,{value:pe,autoFocus:!0,onChange:function(e){return be(e.target.value)},onKeyUp:function(e){13===e.which&&It(pe)}})),r.a.createElement(Q.a,null,r.a.createElement(G.a,{onClick:function(){return It(pe)}},"Save"),r.a.createElement(G.a,{onClick:Nt},"Cancel"))),r.a.createElement(K.a,{open:ze,onClose:St},r.a.createElement(Y.a,null,t.config.encryption?"Disable the encryption":"Encrypt this note with password"),r.a.createElement(q.a,null,r.a.createElement(J.a,{value:Ye,autoFocus:!0,onChange:function(e){return qe(e.target.value)},onKeyUp:function(e){13===e.which&&Lt()},placeholder:"password",type:"password"})),r.a.createElement(Q.a,null,r.a.createElement(G.a,{variant:"contained",color:"primary",onClick:Lt},t.config.encryption?r.a.createElement(P.p,null):r.a.createElement(P.q,null),t.config.encryption?"Disable encryption":"Encrypt"),r.a.createElement(G.a,{onClick:St},"Cancel"))),r.a.createElement(K.a,{open:Ze,onClose:Pt},r.a.createElement(Y.a,null,"Decrypt this note"),r.a.createElement(q.a,null,r.a.createElement(J.a,{value:nt,autoFocus:!0,onChange:function(e){return rt(e.target.value)},placeholder:"password",type:"password",onKeyUp:function(e){13===e.which&&Rt()}})),r.a.createElement(Q.a,null,r.a.createElement(G.a,{variant:"contained",color:"primary",onClick:Rt},"Decrypt"),r.a.createElement(G.a,{onClick:Pt},"Cancel"))),r.a.createElement(ee,{open:se,onClose:function(){return ue(!1)},notebook:t.notebook}),r.a.createElement(ae,{open:yt,onClose:function(){return jt(!1)},editor:m,imageElement:ft,marker:Ot})):r.a.createElement(v.a,{className:Object(S.a)(a.editorPanel,"editor-panel")},r.a.createElement(y.a,{smUp:!0},r.a.createElement(v.a,{className:Object(S.a)(a.topPanel)},r.a.createElement(v.a,{className:Object(S.a)(a.row)},r.a.createElement(H.a,{className:Object(S.a)(a.backBtn)},r.a.createElement(G.a,{className:Object(S.a)(a.controlBtn),onClick:function(){xt.setDisplayMobileEditor(!1)}},r.a.createElement(P.d,null)))))),r.a.createElement(G.a,{style:{margin:"0 auto",top:"50%",position:"relative"},onClick:function(){return xt.createNewNote()},disabled:xt.isLoadingNotebook,variant:"outlined"},r.a.createElement(O.a,null,"\ud83d\udcdd Create a note")))}!function(e){e.VickyMD="VickyMD",e.SourceCode="SourceCode",e.Preview="Preview"}(re||(re={}));var se=a(5825),ue=a(5799),de=a(5800),me=a(5801),pe=a(5823),be=a(5802);function fe(e){var t=_.useContainer(),a=Object(n.useState)(""),o=Object(b.a)(a,2),i=o[0],c=o[1],l=Object(n.useState)(!1),s=Object(b.a)(l,2),u=s[0],d=s[1],m=Object(n.useState)(""),p=Object(b.a)(m,2),f=p[0],g=p[1],h=Object(n.useState)(""),E=Object(b.a)(h,2),w=E[0],k=E[1],y=Object(n.useState)(""),j=Object(b.a)(y,2),x=j[0],C=j[1],N=Object(n.useState)(""),S=Object(b.a)(N,2),I=S[0],D=S[1],B=Object(n.useState)("https://cors.isomorphic-git.org"),L=Object(b.a)(B,2),R=L[0],U=L[1],W=Object(n.useState)(!1),M=Object(b.a)(W,2),V=M[0],H=M[1],z=Object(n.useCallback)(Object(T.a)(A.a.mark((function a(){return A.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,new F.a({type:"info",text:"Getting notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),a.next=4,t.addNotebook(i,f,w,x,I,V,R);case 4:e.onClose(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),new F.a({type:"error",text:"Failed to get notebook...",layout:"topRight",theme:"relax",timeout:2e3}).show(),e.onClose();case 11:case"end":return a.stop()}}),a,null,[[0,7]])}))),[e,i,f,w,x,I,V,R]);return r.a.createElement(K.a,{open:e.open,onClose:function(){t.isAddingNotebook||e.onClose()}},r.a.createElement(Y.a,null,"Add a notebook"),r.a.createElement(q.a,null,r.a.createElement(J.a,{label:"Notebook name",value:i,fullWidth:!0,onChange:function(e){c(e.target.value)},style:{marginBottom:"16px"}}),r.a.createElement(se.a,{elevation:2,expanded:u,onChange:function(){return d(!u)}},r.a.createElement(ue.a,{expandIcon:r.a.createElement(P.c,null)},r.a.createElement(O.a,null,"Git repository (optional)")),r.a.createElement(de.a,null,r.a.createElement(v.a,null,r.a.createElement(J.a,{label:"url",placeholder:"https://abc/def.git",fullWidth:!0,value:f,onChange:function(e){return g(e.target.value)}}),r.a.createElement(J.a,{label:"branch",placeholder:"master",fullWidth:!0,value:w,onChange:function(e){return k(e.target.value)}}),r.a.createElement(J.a,{label:"username (optional)",placeholder:"username (optional)",fullWidth:!0,value:x,onChange:function(e){return C(e.target.value)}}),r.a.createElement(J.a,{label:"password (optional)",placeholder:"password (optional)",type:"password",fullWidth:!0,value:I,onChange:function(e){return D(e.target.value)}}),r.a.createElement(me.a,{control:r.a.createElement(pe.a,{checked:V,onChange:function(){return H(!V)},value:V}),label:r.a.createElement(O.a,null,"Remember credentials "+(V?"(stored locally)":""))}),r.a.createElement(J.a,{label:"cors proxy",placeholder:"https://cors.isomorphic-git.org",fullWidth:!0,value:R,onChange:function(e){return U(e.target.value)}}),r.a.createElement(be.a,{href:"https://github.com/isomorphic-git/isomorphic-git#cors-support",target:"_blank"},"Why we need cors proxy?"))))),r.a.createElement(Q.a,null,r.a.createElement(G.a,{variant:"contained",color:"primary",onClick:z,disabled:t.isAddingNotebook},t.isAddingNotebook?"Adding...":"Add"),e.canCancel&&r.a.createElement(G.a,{onClick:e.onClose},"Cancel")))}var ge=a(5803),he=a(5804),ve=Object(x.a)((function(e){return Object(C.a)({treeItemRoot:{paddingLeft:"4px","&:focus > $treeItemContent":{color:"#1a73e8",backgroundColor:"#e8f0fe"},"&:focus > $treeItemLabelIcon":{color:"#1a73e8"}},treeItemContent:{cursor:"default",color:e.palette.text.primary,userSelect:"none",fontWeight:e.typography.fontWeightMedium,"$treeItemExpanded > &":{fontWeight:e.typography.fontWeightRegular}},treeItemGroup:{marginLeft:0,"& $treeItemContent":{}},treeItemExpanded:{},treeItemLabel:{fontWeight:"inherit",color:"inherit"},treeItemLabelRoot:{display:"flex",alignItems:"center",padding:e.spacing(1,0)},treeItemLabelIcon:{color:"rgba(0, 0, 0, 0.54)"},treeItemLabelText:{paddingLeft:"12px",flexGrow:1}})}));function Oe(e){var t=ve(),a=_.useContainer(),o=Object(n.useState)([]),i=Object(b.a)(o,2),c=i[0],l=i[1],s=Object(n.useCallback)((function(t,n){t.stopPropagation();var r=t.target;r&&r.tagName&&r.tagName.toUpperCase().match(/^(SVG|PATH|BUTTON)$/)&&(a.setSelectedNotebook(e.notebook),l(n))}),[e.notebook]);return Object(n.useEffect)((function(){a.selectedNotebook!==e.notebook&&l([])}),[a.selectedNotebook,e.notebook]),r.a.createElement(he.a,{defaultExpandIcon:r.a.createElement(E.a,{disableFocusRipple:!0,disableRipple:!0,size:"medium"},r.a.createElement(P.e,null)),defaultCollapseIcon:r.a.createElement(E.a,{disableFocusRipple:!0,disableRipple:!0,size:"medium"},r.a.createElement(P.c,null)),defaultEndIcon:r.a.createElement("div",{style:{width:24}}),expanded:c,onNodeToggle:s,style:{width:"100%"}},r.a.createElement(ge.a,{nodeId:"notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedNotebook(e.notebook),a.setSelectedSection({type:d.Notes})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement(O.a,{color:"inherit",variant:"body1",className:Object(S.a)(t.treeItemLabelText)},e.notebook.name))},r.a.createElement(ge.a,{nodeId:"today-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Today})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"today-notes"},"\ud83d\uddd3"),r.a.createElement(O.a,{className:Object(S.a)(t.treeItemLabelText)},"today"))}),r.a.createElement(ge.a,{nodeId:"todo-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Todo})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"todo-notes"},"\u2611\ufe0f"),r.a.createElement(O.a,{className:Object(S.a)(t.treeItemLabelText)},"todo"))}),r.a.createElement(ge.a,{nodeId:"directories",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Notes})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"directories"},"\ud83d\uddc2"),r.a.createElement(O.a,{className:Object(S.a)(t.treeItemLabelText)},"notes"))},function e(n){return"."===n.name?0===n.children.length?null:r.a.createElement(r.a.Fragment,null,n.children.map((function(t){return e(t)}))):r.a.createElement(ge.a,{nodeId:n.name,classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},endIcon:r.a.createElement("div",{style:{width:24}}),key:n.name,label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Directory,path:n.path})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83d\udcc1"),r.a.createElement(O.a,{color:"inherit",variant:"body1",className:Object(S.a)(t.treeItemLabelText)},n.name))},n.children.map((function(t){return e(t)})))}(a.notebookDirectories)),r.a.createElement(ge.a,{nodeId:"tagged-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Tagged})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"tagged-notes"},"\ud83c\udff7\ufe0f"),r.a.createElement(O.a,{className:Object(S.a)(t.treeItemLabelText)},"tagged"))},function e(n){return"."===n.name?0===n.children.length?null:r.a.createElement(r.a.Fragment,null,n.children.map((function(t){return e(t)}))):r.a.createElement(ge.a,{nodeId:n.path,classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},endIcon:r.a.createElement("div",{style:{width:24}}),key:n.path,label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Tag,path:n.path})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83c\udff7\ufe0f"),r.a.createElement(O.a,{color:"inherit",variant:"body1",className:Object(S.a)(t.treeItemLabelText)},n.name))},n.children.map((function(t){return e(t)})))}(a.notebookTagNode)),r.a.createElement(ge.a,{nodeId:"untagged-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Untagged})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"untagged-notes"},"\ud83c\ude1a"),r.a.createElement(O.a,{className:Object(S.a)(t.treeItemLabelText)},"untagged"))}),r.a.createElement(ge.a,{nodeId:"encrypted-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Encrypted})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"encrypted-notes"},"\ud83d\udd10"),r.a.createElement(O.a,{className:Object(S.a)(t.treeItemLabelText)},"encrypted"))}),r.a.createElement(ge.a,{nodeId:"conflicted-notes",classes:{root:t.treeItemRoot,content:t.treeItemContent,expanded:t.treeItemExpanded,group:t.treeItemGroup,label:t.treeItemLabel},label:r.a.createElement(v.a,{onClick:function(){a.setSelectedSection({type:d.Conflicted})},className:Object(S.a)(t.treeItemLabelRoot)},r.a.createElement("span",{role:"img","aria-label":"conflicted-notes"},"\u26a0\ufe0f"),r.a.createElement(O.a,{className:Object(S.a)(t.treeItemLabelText)},"conflicted"))})))}var Ee=a(5806),we=a(5760),ke=a(5807),ye=a(5808),je=a(5809),xe=a(5810);function Ce(e){var t=_.useContainer(),a=Object(n.useState)(""),o=Object(b.a)(a,2),i=o[0],c=o[1],l=Object(n.useState)(!1),s=Object(b.a)(l,2),u=s[0],d=s[1],m=Object(n.useState)(""),p=Object(b.a)(m,2),f=p[0],g=p[1],h=Object(n.useState)(""),E=Object(b.a)(h,2),w=E[0],k=E[1],y=Object(n.useState)(""),j=Object(b.a)(y,2),x=j[0],C=j[1],N=Object(n.useState)(""),S=Object(b.a)(N,2),I=S[0],D=S[1],B=Object(n.useState)("https://cors.isomorphic-git.org"),L=Object(b.a)(B,2),R=L[0],F=L[1],U=Object(n.useState)(3),W=Object(b.a)(U,2),M=W[0],V=W[1];Object(n.useEffect)((function(){var t=e.notebook;t&&(c(t.name),g(t.gitURL),k(t.gitBranch||"master"),C(t.gitUsername),D(t.gitPassword),F(t.gitCorsProxy))}),[e.notebook]);var H=Object(n.useCallback)(Object(T.a)(A.a.mark((function a(){var n;return A.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.notebook){a.next=4;break}return e.onClose(),a.abrupt("return");case 4:return n.name=i.trim(),n.gitURL=f.trim(),n.gitBranch=w.trim(),n.gitUsername=x.trim(),n.gitPassword=I,n.gitCorsProxy=R.trim(),a.prev=10,a.next=13,t.updateNotebook(n);case 13:a.next=17;break;case 15:a.prev=15,a.t0=a.catch(10);case 17:e.onClose();case 18:case"end":return a.stop()}}),a,null,[[10,15]])}))),[e,e.notebook,i,f,w,x,I,R]),z=Object(n.useCallback)(Object(T.a)(A.a.mark((function a(){var n;return A.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.notebook,a.prev=1,a.next=4,t.deleteNotebook(n);case 4:a.next=8;break;case 6:a.prev=6,a.t0=a.catch(1);case 8:e.onClose();case 9:case"end":return a.stop()}}),a,null,[[1,6]])}))),[e.notebook]);return Object(n.useEffect)((function(){V(3)}),[e.notebook]),r.a.createElement(K.a,{open:e.open,onClose:M?e.onClose:null},r.a.createElement(Y.a,null,"Configure a notebook"),r.a.createElement(q.a,null,r.a.createElement(J.a,{label:"Notebook name",value:i,fullWidth:!0,onChange:function(e){c(e.target.value)},style:{marginBottom:"16px"}}),r.a.createElement(se.a,{elevation:2,expanded:u,onChange:function(){return d(!u)}},r.a.createElement(ue.a,{expandIcon:r.a.createElement(P.c,null)},r.a.createElement(O.a,null,"Git repository (optional)")),r.a.createElement(de.a,null,r.a.createElement(v.a,null,r.a.createElement(J.a,{label:"url",placeholder:"https://abc/def.git",disabled:!0,fullWidth:!0,value:f,onChange:function(e){return g(e.target.value)}}),r.a.createElement(J.a,{label:"branch",placeholder:"master",disabled:!0,fullWidth:!0,value:w,onChange:function(e){return k(e.target.value)}}),r.a.createElement(J.a,{label:"username (optional)",placeholder:"username (optional)",fullWidth:!0,value:x,onChange:function(e){return C(e.target.value)}}),r.a.createElement(J.a,{label:"password (optional)",placeholder:"password (optional)",type:"password",fullWidth:!0,value:I,onChange:function(e){return D(e.target.value)}}),r.a.createElement(J.a,{label:"cors proxy",placeholder:"https://cors.isomorphic-git.org",fullWidth:!0,value:R,onChange:function(e){return F(e.target.value)}}),r.a.createElement(be.a,{href:"https://github.com/isomorphic-git/isomorphic-git#cors-support",target:"_blank"},"Why we need cors proxy?"))))),r.a.createElement(Q.a,null,r.a.createElement(G.a,{variant:"contained",color:"secondary",disabled:!M,onClick:function(){1===M?(z(),V(M-1)):V(M-1)}},"Delete"+(M<3?" ".concat(M):"")),r.a.createElement(G.a,{variant:"contained",color:"primary",onClick:H,disabled:!M},"Save"),r.a.createElement(G.a,{onClick:e.onClose,disabled:!M},"Cancel")))}var Ne=a(182),Se=a(5805),Pe=a(5816),Ie=Object(x.a)((function(e){return Object(C.a)({noteCard:{width:"100%",display:"flex",flexDirection:"row",alignItems:"flex-start",padding:e.spacing(2,.5,0),textAlign:"left",cursor:"default"},selected:{borderLeft:"4px solid ".concat(e.palette.primary.main)},unselected:{borderLeft:"4px solid rgba(0, 0, 0, 0)"},leftPanel:{width:"48px",paddingLeft:e.spacing(.5)},duration:{color:e.palette.text.secondary},rightPanel:{width:"calc(100% - 48px)",borderBottom:"1px solid #ededed"},header:{marginBottom:e.spacing(1),wordBreak:"break-all"},summary:{color:e.palette.text.secondary,marginBottom:e.spacing(1),paddingRight:e.spacing(2),display:"-webkit-box",lineHeight:"1.3rem !important",textOverflow:"ellipsis !important",overflow:"hidden !important",maxWidth:"100%",maxHeight:"2.6rem","-webkit-line-clamp":2,"-webkit-box-orient":"vertical",wordBreak:"break-all"},filePath:{},images:{display:"flex",width:"100%",overflow:"hidden",position:"relative",marginBottom:e.spacing(1)},imagesWrapper:{display:"flex",alignItems:"center",flexDirection:"row"},image:{width:"128px",height:"80px",marginRight:e.spacing(1),position:"relative",backgroundSize:"cover",backgroundPosition:"center",display:"block",borderRadius:"6px"},pin:{color:e.palette.secondary.main,marginTop:e.spacing(1)}})}));function De(e){var t=Ie(e),a=e.note,o=_.useContainer(),i=Object(n.useState)(""),c=Object(b.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(null),m=Object(b.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)([]),h=Object(b.a)(g,2),E=h[0],w=h[1],k=Object(n.useState)(""),y=Object(b.a)(k,2),j=y[0],x=y[1],C=Object(u.b)().t,N=Object(Se.a)(a.config.modifiedAt,Date.now()).replace(/\sseconds?/,"s").replace(/\sminutes?/,"m").replace(/\shours?/,"h").replace(/\sdays?/,"d").replace(/\sweeks?/,"w").replace(/\smonths?/,"mo").replace(/\syears?/,"y");return Object(n.useEffect)((function(){s(a.config.encryption&&a.config.encryption.title||Object(M.b)(a.markdown)),Object(M.a)(a.config.encryption?"\ud83d\udd10 encrypted":a.markdown.trim()||C("general/this-note-is-empty")).then((function(e){f(e);var t=e.images.filter((function(e){return e.startsWith("https://")})).slice(0,3);w(t)})).catch((function(e){}))}),[a.markdown,a.config.encryption,C]),Object(n.useEffect)((function(){o.crossnote.getStatus(a).then((function(e){x(e)}))}),[a.markdown,a.config.modifiedAt,a,o.crossnote]),r.a.createElement(Ne.a,{className:Object(S.a)(t.noteCard,o.selectedNote&&o.selectedNote.filePath===a.filePath?t.selected:t.unselected),onClick:function(){o.setSelectedNote(a),o.setDisplayMobileEditor(!0)}},r.a.createElement(v.a,{className:Object(S.a)(t.leftPanel)},r.a.createElement(z.a,{title:r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,C("general/created-at")+" "+Object(Pe.a)(new Date(a.config.createdAt),new Date)),r.a.createElement("p",null,C("general/modified-at")+" "+Object(Pe.a)(new Date(a.config.modifiedAt),new Date))),arrow:!0},r.a.createElement(O.a,{className:Object(S.a)(t.duration)},N)),a.config.pinned&&r.a.createElement(P.v,{className:Object(S.a)(t.pin)})),r.a.createElement(v.a,{className:Object(S.a)(t.rightPanel)},l&&r.a.createElement(O.a,{style:{fontWeight:"bold"},variant:"body1",className:Object(S.a)(t.header)},l),p&&p.summary.trim().length>0&&r.a.createElement(O.a,{className:Object(S.a)(t.summary)},p&&p.summary),E.length>0&&r.a.createElement(v.a,{className:Object(S.a)(t.images)},r.a.createElement(v.a,{className:Object(S.a)(t.imagesWrapper)},E.map((function(e){return r.a.createElement("div",{key:e,className:Object(S.a)(t.image),style:{backgroundImage:"url(".concat(e,")")}})})))),r.a.createElement(O.a,{variant:"caption",className:Object(S.a)(t.filePath)},a.filePath+" - "+j)))}var Ae=Object(x.a)((function(e){return Object(C.a)({notesList:{position:"relative",flex:"1",overflowY:"auto",paddingBottom:e.spacing(12)}})}));function Te(e){var t=Ae(e),a=(Object(u.b)().t,_.useContainer()),o=Object(n.useState)([]),i=Object(b.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(null),d=Object(b.a)(s,2),m=d[0],p=d[1],f=e.searchValue;return Object(n.useEffect)((function(){var e=[],t=[];a.notes.forEach((function(a){if(f.trim().length){var n=new RegExp("("+f.trim().split(/\s+/g).join("|")+")","i");(a.markdown.match(n)||a.filePath.match(n))&&(a.config.pinned?e.push(a):t.push(a))}else a.config.pinned?e.push(a):t.push(a)})),l([].concat(e,t))}),[a.notes,f]),Object(n.useEffect)((function(){if(m){var e=function(e){var t=a.selectedNote,n=a.notes||[];if(t)if(40===e.which){var r=n.findIndex((function(e){return e.filePath===t.filePath}));r>=0&&r<n.length-1&&a.setSelectedNote(n[r+1])}else if(38===e.which){var o=n.findIndex((function(e){return e.filePath===t.filePath}));o>0&&o<n.length&&a.setSelectedNote(n[o-1])}};return m.addEventListener("keydown",e),function(){m.removeEventListener("keydown",e)}}}),[m,a.notes]),r.a.createElement("div",{className:Object(S.a)(t.notesList),ref:function(e){p(e)}},(c||[]).map((function(e){return r.a.createElement(De,{key:"note-card-"+e.filePath,note:e})})))}var Be=Object(x.a)((function(e){return Object(C.a)({notesPanel:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},topPanel:{padding:e.spacing(1)},row:{display:"flex",alignItems:"center"},sectionName:{marginLeft:e.spacing(1)},search:Object(f.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(N.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(N.b)(e.palette.common.white,.25)},marginRight:0,marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{}),searchIcon:{width:e.spacing(7),color:"rgba(0, 0, 0, 0.54)",height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",border:"1px solid #bbb",borderRadius:"4px"},inputInput:Object(f.a)({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{}),notesList:{position:"relative",flex:"1",overflowY:"auto",paddingBottom:e.spacing(12)},loading:{position:"absolute",top:"30%",left:"50%",transform:"translateX(-50%)"},sortSelected:{color:e.palette.primary.main,"& svg":{color:e.palette.primary.main}}})}));function Le(e){var t=Be(e),a=Object(u.b)().t,o=Object(n.useState)(null),i=Object(b.a)(o,2),c=i[0],l=i[1],s=_.useContainer(),f=Object(n.useState)(""),w=Object(b.a)(f,2),k=w[0],j=w[1],x=Object(n.useState)(!1),C=Object(b.a)(x,2),N=C[0],I=C[1];return r.a.createElement(v.a,{className:Object(S.a)(t.notesPanel)},r.a.createElement(Ee.a,{className:Object(S.a)(t.topPanel)},r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement(y.a,{smUp:!0,implementation:"css"},r.a.createElement(E.a,{onClick:e.toggleDrawer},r.a.createElement(P.t,null))),r.a.createElement("div",{className:t.search},r.a.createElement("div",{className:t.searchIcon},r.a.createElement(P.s,null)),r.a.createElement(we.a,{placeholder:a("search/placeholder"),classes:{root:t.inputRoot,input:t.inputInput},value:k,inputProps:{"aria-label":"search"},onChange:function(e){return j(e.target.value)}})),r.a.createElement(E.a,{onClick:function(){s.createNewNote()}},r.a.createElement(P.l,null))),r.a.createElement(v.a,{className:Object(S.a)(t.row),style:{justifyContent:"space-between"}},s.selectedSection.type===d.Notes?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"notes"},"\ud83d\udcd2"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)},s.selectedNotebook&&s.selectedNotebook.name)):s.selectedSection.type===d.Today?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"today-notes"},"\ud83d\uddd3"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)}," today")):s.selectedSection.type===d.Todo?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"todo-notes"},"\u2611\ufe0f"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)}," todo")):s.selectedSection.type===d.Tagged?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"tagged-notes"},"\ud83c\udff7\ufe0f"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)}," tagged")):s.selectedSection.type===d.Untagged?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"untagged-notes"},"\ud83c\ude1a"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)}," untagged")):s.selectedSection.type===d.Tag?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"tag"},"\ud83c\udff7\ufe0f"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)},s.selectedSection.path)):s.selectedSection.type===d.Encrypted?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"encrypted-notes"},"\ud83d\udd10"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)}," encrypted")):s.selectedSection.type===d.Conflicted?r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"conflicted-notes"},"\u26a0\ufe0f"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)}," conflicted")):s.selectedSection.type===d.Directory&&r.a.createElement(v.a,{className:Object(S.a)(t.row)},r.a.createElement("span",{role:"img","aria-label":"folder"},"\ud83d\udcc1"),r.a.createElement(O.a,{className:Object(S.a)(t.sectionName)},s.selectedSection.path)),r.a.createElement(v.a,null,s.selectedSection.type===d.Notes&&r.a.createElement(E.a,{onClick:function(){return I(!0)}},r.a.createElement(P.C,null)),r.a.createElement(E.a,{onClick:function(e){return l(e.currentTarget)}},r.a.createElement(P.F,null)),r.a.createElement($.a,{anchorEl:c,keepMounted:!0,open:Boolean(c),onClose:function(){return l(null)}},r.a.createElement(g.a,null,r.a.createElement(h.a,{button:!0,onClick:function(){return s.setOrderBy(m.ModifiedAt)},className:Object(S.a)(s.orderBy===m.ModifiedAt&&t.sortSelected)},r.a.createElement(ke.a,{primary:"Date modified"})),r.a.createElement(h.a,{button:!0,onClick:function(){return s.setOrderBy(m.CreatedAt)},className:Object(S.a)(s.orderBy===m.CreatedAt&&t.sortSelected)},r.a.createElement(ke.a,{primary:"Date created"})),r.a.createElement(h.a,{button:!0,onClick:function(){return s.setOrderBy(m.Title)},className:Object(S.a)(s.orderBy===m.Title&&t.sortSelected)},r.a.createElement(ke.a,{primary:"Title"})),r.a.createElement(ye.a,null),r.a.createElement(h.a,{button:!0,onClick:function(){return s.setOrderDirection(p.DESC)},className:Object(S.a)(s.orderDirection===p.DESC&&t.sortSelected)},r.a.createElement(ke.a,{primary:"Desc"}),r.a.createElement(je.a,null,r.a.createElement(P.E,null))),r.a.createElement(h.a,{button:!0,onClick:function(){return s.setOrderDirection(p.ASC)},className:Object(S.a)(s.orderDirection===p.ASC&&t.sortSelected)},r.a.createElement(ke.a,{primary:"Asc"}),r.a.createElement(je.a,null,r.a.createElement(P.D,null)))))))),r.a.createElement(Ce,{open:N,onClose:function(){return I(!1)},notebook:s.selectedNotebook}),s.isLoadingNotebook&&r.a.createElement(xe.a,{className:Object(S.a)(t.loading)}),r.a.createElement(Te,{searchValue:k}))}var Re=Object(x.a)((function(e){var t;return Object(C.a)({page:{display:"flex",width:"100%",height:"100%",backgroundColor:"#2196F1"},appBar:{zIndex:e.zIndex.drawer+1,boxShadow:"none"},toolBar:{display:"flex",flexDirection:"row",justifyContent:"space-between"},search:Object(f.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(N.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(N.b)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:Object(f.a)({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:200}),displayNone:{display:"none"},drawer:Object(f.a)({},e.breakpoints.up("sm"),{width:200,flexShrink:0}),drawerPaper:{width:200},selectedSection:{backgroundColor:"#ccc"},left:{display:"flex",flexDirection:"row",alignItems:"center"},menuButton:{marginRight:e.spacing(2)},mainPanel:{position:"relative",display:"flex",flexDirection:"row",flexGrow:1,overflow:"auto",backgroundColor:"#eee"},notesPanel:Object(f.a)({width:"".concat(350,"px"),maxWidth:"100%",height:"100%"},e.breakpoints.down("xs"),{width:"100%"}),editorPanel:(t={width:"calc(100% - ".concat(350,"px)"),position:"absolute",left:"calc(".concat(350,"px)"),height:"100%"},Object(f.a)(t,e.breakpoints.down("md"),{width:"calc(100% - ".concat(350,"px)"),left:"".concat(350,"px")}),Object(f.a)(t,e.breakpoints.down("xs"),{display:"none",top:"0",left:"0",width:"100%",height:"100%"}),t),toolBarSpace:e.mixins.toolbar})}));function Fe(e){var t=Re(e),a=_.useContainer(),o=Object(n.useState)(!1),i=Object(b.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(!1),u=Object(b.a)(s,2),d=u[0],m=u[1],p=Object(n.useCallback)((function(){m(!d)}),[d]),f=r.a.createElement("div",null,r.a.createElement(g.a,{disablePadding:!0},r.a.createElement(h.a,{disableGutters:!0},r.a.createElement(v.a,{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:"0 8px"}},r.a.createElement(O.a,{variant:"body1",style:{fontWeight:"bold"}},"Notebooks"),r.a.createElement(E.a,{onClick:function(){return l(!0)}},r.a.createElement(P.y,null)))),a.notebooks.map((function(e){return r.a.createElement(h.a,{disableGutters:!0,style:{padding:"0"},key:e._id},r.a.createElement(Oe,{notebook:e}))})))),x=r.a.createElement(w.a,{className:Object(S.a)(t.notesPanel),id:"notes-panel"},r.a.createElement(Le,{toggleDrawer:p}));return r.a.createElement(v.a,{className:Object(S.a)(t.page)},r.a.createElement(k.a,null),r.a.createElement("nav",{className:Object(S.a)(t.drawer,"drawer")},r.a.createElement(y.a,{smUp:!0,implementation:"css"},r.a.createElement(j.a,{variant:"temporary",open:d,onClose:p,classes:{paper:t.drawerPaper},ModalProps:{keepMounted:!0}},f)),r.a.createElement(y.a,{xsDown:!0,implementation:"css"},r.a.createElement(j.a,{classes:{paper:t.drawerPaper},variant:"permanent",open:!0},f))),r.a.createElement(v.a,{className:Object(S.a)(t.mainPanel),id:"main-panel"},x,r.a.createElement(w.a,{className:Object(S.a)(t.editorPanel,"editor-panel"),style:{display:a.displayMobileEditor&&"block"}},r.a.createElement(le,{note:a.selectedNote}))),r.a.createElement(fe,{open:c,onClose:function(){return l(!1)},canCancel:!0}))}var Ue=a(416),We=a(178),Me=a(177),_e=a(5815),Ve=(a(16),a(314),a(5632),a(5633),a(323),a(5635),a(5636),a(365),a(5637),a(5638),a(5639),a(214),a(5640),a(212),a(208),a(210),a(213),a(5642),a(67)),He=a(5791);function Ge(){return(Ge=Object(T.a)(A.a.mark((function e(){var t,a,n,r,o=arguments;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:[],a=[],n=function(e){var n=t[e];if(!n.type.match("image.*"))return"continue";a.push(new Promise((function(e,t){var a=new FormData;a.append("smfile",n),a.append("format","json"),fetch("https://sm.ms/api/v2/upload",{method:"POST",mode:"cors",headers:{},referrer:"",body:a}).then((function(e){return e.json()})).then((function(a){return a.success?e(a.data.url):"image_repeated"===a.code||"exception"===a.code&&a.message.match(/this image exists at:/)?e(a.message.match(/https:\/\/.+$/)[0]):t(a.message)})).catch((function(e){return t("Failed to connect to sm.ms host")}))})))},r=0;case 4:if(!(r<t.length)){e.next=11;break}if("continue"!==n(r)){e.next=8;break}return e.abrupt("continue",8);case 8:r++,e.next=4;break;case 11:return e.next=13,Promise.all(a);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function $e(e){var t=ze(e),a=Object(u.b)().t,o=Object(n.useState)(""),i=Object(b.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(null),d=Object(b.a)(s,2),m=d[0],p=d[1],f=Object(n.useState)(!1),g=Object(b.a)(f,2),h=g[0],w=g[1];return e.isPreview?r.a.createElement("span",null):r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(t.card)},r.a.createElement(O.a,{variant:"h5"},a("widget/crossnote.image/image-helper")),r.a.createElement(v.a,{className:Object(S.a)(t.actionButtons)},r.a.createElement(z.a,{title:a("general/Delete")},r.a.createElement(E.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))),!h&&r.a.createElement(v.a,{className:Object(S.a)(t.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},"URL"),r.a.createElement(He.a,{margin:"dense",placeholder:a("widget/crossnote.image/image-url-placeholder"),value:c,onChange:function(e){l(e.target.value)},onKeyDown:function(t){13===t.which&&e.replaceSelf("![](".concat(c,")\n"))},fullWidth:!0})),r.a.createElement(v.a,{className:Object(S.a)(t.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Upload")),r.a.createElement(v.a,{className:Object(S.a)(t.dropArea,h?t.disabled:null),onClick:function(t){t.preventDefault(),t.stopPropagation(),m&&!h&&(m.onchange=function(t){var n=t.target.files||[];new F.a({type:"info",text:a("utils/uploading-image"),layout:"topRight",theme:"relax",timeout:2e3}).show(),w(!0),function(){return Ge.apply(this,arguments)}(n).then((function(t){var a="";t.forEach((function(e){a+="![](".concat(e,")  \n")})),e.replaceSelf(a)})).catch((function(e){w(!1),new F.a({type:"error",text:a("utils/upload-image-failure"),layout:"topRight",theme:"relax",timeout:2e3}).show()}))},m.click())}},r.a.createElement(O.a,null,a(h?"utils/uploading-image":"widget/crossnote.image/click-here-to-browse-image-file")))),r.a.createElement(v.a,{className:Object(S.a)(t.section)},r.a.createElement(O.a,{variant:"caption"},a("widget/crossnote.image/thanks_sm_ms"))),r.a.createElement("input",{type:"file",multiple:!0,style:{display:"none"},ref:function(e){p(e)}}))}var Je=a(5812),Ke=Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function Ye(e){var t=e.attributes,a=Ke(e),o=Object(u.b)().t,i=Object(n.useState)(t.source||""),c=Object(b.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(t.autoplay||!1),m=Object(b.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(t.controls||!0),h=Object(b.a)(g,2),w=h[0],k=h[1],y=Object(n.useState)(t.loop||!1),j=Object(b.a)(y,2),x=j[0],C=j[1],N=Object(n.useState)(t.muted||!1),I=Object(b.a)(N,2),D=I[0],A=I[1];return t.src?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement("audio",{autoPlay:t.autoplay||t.autoPlay,controls:t.controls,loop:t.loop,muted:t.muted,style:t.style},o("widget/crossnote.audio/audio_element_fail"),r.a.createElement("source",{src:t.src,type:t.type})),!e.isPreview&&!t.controls&&"\ud83c\udfb5"):e.isPreview?r.a.createElement("span",null):r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(a.card)},r.a.createElement(O.a,{variant:"h5"},o("general/Audio")),r.a.createElement(v.a,{className:Object(S.a)(a.actionButtons)},r.a.createElement(z.a,{title:o("general/Delete")},r.a.createElement(E.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/source-url")),r.a.createElement(He.a,{margin:"dense",placeholder:o("widget/crossnote.audio/source-url-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:p,controls:w,loop:x,muted:D,src:l};e.replaceSelf("`@crossnote.audio ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(me.a,{label:o("widget/autoplay"),control:r.a.createElement(Je.a,{checked:p,onChange:function(){return f(!p)},color:"primary"})}),r.a.createElement(me.a,{label:o("widget/controls"),control:r.a.createElement(Je.a,{checked:w,onChange:function(){return k(!w)},color:"primary"})}),r.a.createElement(me.a,{label:o("widget/loop"),control:r.a.createElement(Je.a,{checked:x,onChange:function(){return C(!x)},color:"primary"})}),r.a.createElement(me.a,{label:o("widget/muted"),control:r.a.createElement(Je.a,{checked:D,onChange:function(){return A(!D)},color:"primary"})})))}var qe=Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},disabled:{cursor:"not-allowed"}})}));function Xe(e){var t=e.attributes,a=qe(e),o=Object(u.b)().t,i=Object(n.useState)(t.id||""),c=Object(b.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(t.autoplay||!1),m=Object(b.a)(d,2),p=m[0],f=m[1];return t.id?r.a.createElement("iframe",{title:"netease_music_"+t.id,style:{maxWidth:"100%",width:"333px",height:"86px",border:"none"},src:"https://music.163.com/outchain/player?type=2&id=".concat(t.id,"&auto=").concat(t.autoplay?"1":"0","&height=66")}):e.isPreview?r.a.createElement("span",null):r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(a.card)},r.a.createElement(O.a,{variant:"h5"},o("general/Audio")),r.a.createElement(v.a,{className:Object(S.a)(a.actionButtons)},r.a.createElement(z.a,{title:o("general/Delete")},r.a.createElement(E.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/ID")),r.a.createElement(He.a,{margin:"dense",placeholder:o("widget/crossnote.neteasemusic/song-id-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:p,id:l};e.replaceSelf("`@crossnote.netease_music ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(me.a,{label:o("widget/autoplay"),control:r.a.createElement(Je.a,{checked:p,onChange:function(){return f(!p)},color:"primary"})})))}var Qe=Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%"}})}));function Ze(e){var t=e.attributes,a=Qe(e),o=Object(u.b)().t,i=Object(n.useState)(t.source||""),c=Object(b.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(t.autoplay||!1),m=Object(b.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(t.controls||!0),h=Object(b.a)(g,2),w=h[0],k=h[1],y=Object(n.useState)(t.loop||!1),j=Object(b.a)(y,2),x=j[0],C=j[1],N=Object(n.useState)(t.muted||!1),I=Object(b.a)(N,2),D=I[0],A=I[1],T=Object(n.useState)(t.poster||""),B=Object(b.a)(T,2),L=B[0],R=B[1];return t.src?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(v.a,{className:Object(S.a)(a.videoWrapper)},r.a.createElement("video",{className:Object(S.a)(a.video),autoPlay:t.autoplay||t.autoPlay,controls:t.controls,loop:t.loop,muted:t.muted,style:t.style,poster:t.poster},o("widget/crossnote.video/video_element_fail"),r.a.createElement("source",{src:t.src,type:t.type})))):e.isPreview?r.a.createElement("span",null):r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(a.card)},r.a.createElement(O.a,{variant:"h5"},o("general/Video")),r.a.createElement(v.a,{className:Object(S.a)(a.actionButtons)},r.a.createElement(z.a,{title:o("general/Delete")},r.a.createElement(E.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("general/source-url")),r.a.createElement(He.a,{margin:"dense",placeholder:o("widget/crossnote.video/video-url-placeholder"),value:l,onChange:function(e){s(e.target.value)},onKeyDown:function(t){if(13===t.which&&l){var a={autoplay:p,controls:w,loop:x,muted:D,src:l,poster:L};e.replaceSelf("`@crossnote.video ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}},fullWidth:!0})),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("widget/crossnote.video/poster-url")),r.a.createElement(He.a,{margin:"dense",placeholder:o("widget/crossnote.video/poster-url-placeholder"),value:L,onChange:function(e){R(e.target.value)},fullWidth:!0})),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(me.a,{label:o("widget/autoplay"),control:r.a.createElement(Je.a,{checked:p,onChange:function(){return f(!p)},color:"primary"})}),r.a.createElement(me.a,{label:o("widget/controls"),control:r.a.createElement(Je.a,{checked:w,onChange:function(){return k(!w)},color:"primary"})}),r.a.createElement(me.a,{label:o("widget/loop"),control:r.a.createElement(Je.a,{checked:x,onChange:function(){return C(!x)},color:"primary"})}),r.a.createElement(me.a,{label:o("widget/muted"),control:r.a.createElement(Je.a,{checked:D,onChange:function(){return A(!D)},color:"primary"})})))}var et=Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{backgroundColor:"#ddd",border:"none",position:"absolute",left:"0",top:"0",width:"100%",height:"100%"},errorMessage:{color:"#f44336",marginTop:e.spacing(2)}})}));function tt(e){var t=e.attributes,a=et(e),o=Object(u.b)().t,i=Object(n.useState)(""),c=Object(b.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(""),m=Object(b.a)(d,2),p=m[0],f=m[1];return t.aid?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(v.a,{className:Object(S.a)(a.videoWrapper)},r.a.createElement("iframe",{title:"bilibili_"+t.id,className:Object(S.a)(a.video),src:"https://player.bilibili.com/player.html?aid=".concat(t.aid),scrolling:"no",frameBorder:"no",allowFullScreen:!0}))):e.isPreview?r.a.createElement("span",null):r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(a.card)},r.a.createElement(O.a,{variant:"h5"},o("widget/crossnote.bilibili/Bilibili")),r.a.createElement(v.a,{className:Object(S.a)(a.actionButtons)},r.a.createElement(z.a,{title:o("general/Delete")},r.a.createElement(E.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("widget/crossnote.bilibili/bilibili-video-url")),r.a.createElement(He.a,{margin:"dense",placeholder:o("widget/crossnote.bilibili/url-placeholder"),value:l,onChange:function(e){s(e.target.value),f("")},onKeyDown:function(t){if(13===t.which)if(l&&l.match(/bilibili\.com\/video\/av(\d+)/)){var a={aid:l.match(/bilibili\.com\/video\/av(\d+)/)[1]};e.replaceSelf("`@crossnote.bilibili ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}else f(o("widget/crossnote.bilibili/error_message"))},fullWidth:!0}),r.a.createElement(O.a,{className:Object(S.a)(a.errorMessage)},p)))}var at=Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},videoWrapper:{cursor:"default",position:"relative",width:"100%",height:"0",paddingTop:"56.25%"},video:{backgroundColor:"#ddd",border:"none",position:"absolute",left:"0",top:"0",width:"100%",height:"100%"},errorMessage:{color:"#f44336",marginTop:e.spacing(2)}})}));function nt(e){var t=e.attributes,a=at(e),o=Object(u.b)().t,i=Object(n.useState)(""),c=Object(b.a)(i,2),l=c[0],s=c[1],d=Object(n.useState)(""),m=Object(b.a)(d,2),p=m[0],f=m[1];return t.videoID?r.a.createElement("span",{style:{cursor:"default"}},r.a.createElement(v.a,{className:Object(S.a)(a.videoWrapper)},r.a.createElement("iframe",{title:"youtube_"+t.videoID,className:Object(S.a)(a.video),src:"https://www.youtube.com/embed/".concat(t.videoID),scrolling:"no",frameBorder:"no",allowFullScreen:!0}))):e.isPreview?r.a.createElement("span",null):r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(a.card)},r.a.createElement(O.a,{variant:"h5"},o("Youtube")),r.a.createElement(v.a,{className:Object(S.a)(a.actionButtons)},r.a.createElement(z.a,{title:o("general/Delete")},r.a.createElement(E.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))),r.a.createElement(v.a,{className:Object(S.a)(a.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},o("Youtube video URL")),r.a.createElement(He.a,{margin:"dense",placeholder:o("widget/crossnote.youtube/youtube-video-url-placeholder"),value:l,onChange:function(e){s(e.target.value),f("")},onKeyDown:function(t){if(13===t.which)if(l&&l.match(/youtube\.com\/watch\?v=(.+?)$/)){var a={videoID:l.match(/youtube\.com\/watch\?v=(.+?)$/)[1]};e.replaceSelf("`@crossnote.youtube ".concat(JSON.stringify(a).replace(/^{/,"").replace(/}$/,""),"`"))}else f(o("widget/crossnote.youtube/error_message"))},fullWidth:!0}),r.a.createElement(O.a,{className:Object(S.a)(a.errorMessage)},p)))}var rt=a(5813),ot=a(5814),it=a(406),ct=Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},actionButtons:{position:"absolute",top:"0",right:"0"},section:{marginTop:e.spacing(2)},dropArea:{textAlign:"center",padding:"24px",border:"4px dotted #c7c7c7",backgroundColor:"#f1f1f1",cursor:"pointer","&:hover":{backgroundColor:"#eee"}},canvasWrapper:{marginTop:e.spacing(2)},canvas:{maxWidth:"100%"},disabled:{cursor:"not-allowed"}})}));function lt(e){var t=ct(e),a=Object(u.b)().t,o=Object(n.useState)(null),i=Object(b.a)(o,2),c=i[0],l=i[1],s=Object(n.useState)(""),d=Object(b.a)(s,2),m=d[0],p=d[1],f=Object(n.useState)(""),w=Object(b.a)(f,2),k=w[0],y=w[1],j=Object(n.useState)(""),x=Object(b.a)(j,2),C=x[0],N=x[1],D=Object(n.useState)(null),B=Object(b.a)(D,2),L=B[0],R=B[1],F=Object(n.useState)(!1),U=Object(b.a)(F,2),W=U[0],M=U[1],_=Object(n.useState)([]),V=Object(b.a)(_,2),$=V[0],J=V[1],K=Object(n.useState)(function(){try{return JSON.parse(localStorage.getItem("widget/crossnote.ocr/languages")||'["eng"]')}catch(e){return["eng"]}}()),Y=Object(b.a)(K,2),q=Y[0],X=Y[1],Q=Object(n.useState)(!!localStorage.getItem("widget/crossnote.ocr/grayscale")||!0),Z=Object(b.a)(Q,2),ee=Z[0],te=Z[1];function ae(e){X((function(t){var a=t.indexOf(e);return a>=0?(t.splice(a,1),t=Object(I.a)(t)):t=[].concat(Object(I.a)(t),[e]),localStorage.setItem("widget/crossnote.ocr/languages",JSON.stringify(t)),t}))}return Object(n.useEffect)((function(){if(c&&k){var e=new Image,t=c.getContext("2d");e.onload=function(){c.width=e.width,c.height=e.height,t.clearRect(0,0,c.width,c.height),ee&&(t.fillStyle="#FFF",t.fillRect(0,0,c.width,c.height),t.globalCompositeOperation="luminosity"),t.drawImage(e,0,0),N(c.toDataURL())},e.onerror=function(e){throw e},e.setAttribute("crossOrigin","anonymous"),e.src=k}}),[c,k,ee]),e.isPreview?r.a.createElement("span",null):W?r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(t.card)},r.a.createElement(O.a,{variant:"h5"},a("general/Processing")),r.a.createElement(g.a,null,$.length>0&&r.a.createElement(h.a,null,r.a.createElement(ke.a,null,a("tesseract/"+$[$.length-1].status)),r.a.createElement(rt.a,null,Math.floor(100*$[$.length-1].progress).toString()+"%")))):k?r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(t.card)},r.a.createElement(v.a,{className:Object(S.a)(t.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/recognize-text-in-languages")),r.a.createElement(ot.a,null,r.a.createElement(me.a,{control:r.a.createElement(pe.a,{checked:q.indexOf("eng")>=0,onChange:function(){return ae("eng")},value:"eng"}),label:"English"}),r.a.createElement(me.a,{control:r.a.createElement(pe.a,{checked:q.indexOf("chi_sim")>=0,onChange:function(){return ae("chi_sim")},value:"chi_sim"}),label:"\u7b80\u4f53\u4e2d\u6587"}),r.a.createElement(me.a,{control:r.a.createElement(pe.a,{checked:q.indexOf("chi_tra")>=0,onChange:function(){return ae("chi_tra")},value:"chi_tra"}),label:"\u7e41\u9ad4\u4e2d\u6587"}),r.a.createElement(me.a,{control:r.a.createElement(pe.a,{checked:q.indexOf("jpn")>=0,onChange:function(){return ae("jpn")},value:"jpn"}),label:"\u65e5\u672c\u8a9e"}))),r.a.createElement(v.a,{className:Object(S.a)(t.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/extra-settings")),r.a.createElement(me.a,{control:r.a.createElement(Je.a,{checked:ee,onChange:function(){ee?localStorage.removeItem("widget/crossnote.ocr/grayscale"):localStorage.setItem("widget/crossnote.ocr/grayscale","true"),te(!ee)},color:"primary"}),label:a("widget/crossnote.ocr/grayscale")})),r.a.createElement(v.a,{className:Object(S.a)(t.canvasWrapper)},r.a.createElement("canvas",{className:Object(S.a)(t.canvas),ref:function(e){return l(e)}})),r.a.createElement(H.a,null,r.a.createElement(G.a,{onClick:function(){y(""),N("")}},a("general/go-back")),r.a.createElement(G.a,{color:"primary",onClick:function(){return function(t){var a=Object(it.createWorker)({logger:function(e){J((function(t){return t.length&&t[t.length-1].status===e.status?[].concat(Object(I.a)(t.slice(0,t.length-1)),[e]):[].concat(Object(I.a)(t),[e])}))}});Object(T.a)(A.a.mark((function n(){var r,o,i;return A.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return M(!0),0===(r=q).length&&(r=["eng"]),n.next=5,a.load();case 5:return n.next=7,a.loadLanguage(r.join("+"));case 7:return n.next=9,a.initialize(r.join("+"));case 9:return n.next=11,a.recognize(t);case 11:return o=n.sent,i=o.data.text,e.replaceSelf("\n"+i),n.next=16,a.terminate();case 16:M(!1);case 17:case"end":return n.stop()}}),n)})))()}(C)},disabled:!C},a("widget/crossnote.ocr/start-ocr")))):r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(t.card)},r.a.createElement(O.a,{variant:"h5"},a("widget/crossnote.ocr/ocr")),r.a.createElement(v.a,{className:Object(S.a)(t.actionButtons)},r.a.createElement(z.a,{title:a("general/Delete")},r.a.createElement(E.a,{onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))),r.a.createElement(v.a,{className:Object(S.a)(t.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("general/Link")),r.a.createElement(He.a,{margin:"dense",placeholder:a("widget/crossnote.image/image-url-placeholder"),value:m,onChange:function(e){p(e.target.value)},onKeyDown:function(e){13===e.which&&function(){try{y(m)}catch(e){}}()},fullWidth:!0})),r.a.createElement(O.a,{variant:"subtitle1",style:{marginTop:"16px",textAlign:"center"}},a("widget/crossnote.auth/Or")),r.a.createElement(v.a,{className:Object(S.a)(t.section)},r.a.createElement(O.a,{variant:"subtitle1",style:{marginBottom:"8px"}},a("widget/crossnote.ocr/local-image")),r.a.createElement(v.a,{className:Object(S.a)(t.dropArea,W?t.disabled:null),onClick:function(e){e.preventDefault(),e.stopPropagation(),L&&!W&&(L.onchange=function(e){var t=e.target.files||[];if(t.length)try{var a=t[0],n=new FileReader;n.readAsDataURL(a),n.onload=function(){y(n.result)},n.onerror=function(e){throw e}}catch(r){}},L.click())}},r.a.createElement(O.a,null,a(W?"utils/uploading-image":"widget/crossnote.image/click-here-to-browse-image-file")))),r.a.createElement("input",{type:"file",style:{display:"none"},ref:function(e){R(e)}}))}var st=a(141),ut=a(407),dt=a.n(ut),mt=a(214),pt=Object(x.a)((function(e){return Object(C.a)({columnHeader:{width:"256px",maxWidth:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},kanbanCard:Object(f.a)({width:"256px",maxWidth:"100%",position:"relative"},e.breakpoints.down("sm"),{marginTop:"4px",marginBottom:"4px"}),editorWrapper:{"& .CodeMirror-gutters":{display:"none"}},textarea:{width:"100%",height:"100%"},preview:{padding:e.spacing(2)}})}));function bt(e){var t=pt(e),a=Object(u.b)().t,o=e.column,i=e.board,c=e.isPreview,l=e.refreshBoard,s=Object(n.useState)(!1),d=Object(b.a)(s,2),m=d[0],p=d[1],f=Object(n.useState)(o.title),g=Object(b.a)(f,2),h=g[0],w=g[1];return Object(n.useEffect)((function(){m||h===o.title||(o.title=h||a("general/Untitled"),w(o.title),l(i))}),[m,i,o.title,h,a,l]),r.a.createElement(v.a,{className:Object(S.a)(t.columnHeader)},r.a.createElement(v.a,null,m?r.a.createElement(J.a,{value:h,onChange:function(e){w(e.target.value)},onBlur:function(){p(!1)},onKeyUp:function(e){13===e.which&&p(!1)}}):r.a.createElement(O.a,{variant:"body1",style:{cursor:"text"},onClick:function(){c||p(!0)}},h)),!c&&r.a.createElement(v.a,null,r.a.createElement(E.a,{onClick:function(){var t={id:Date.now(),title:"",description:a("general/empty")};o&&o.cards.push(t),e.refreshBoard(i)}},r.a.createElement(P.b,null)),r.a.createElement(E.a,{onClick:function(){i.columns=i.columns.filter((function(e){return o.id!==e.id})),e.refreshBoard(i)}},r.a.createElement(P.f,null))))}function ft(e){var t=pt(e),a=e.board,o=e.card,i=e.isPreview,c=Object(n.useState)(null),l=Object(b.a)(c,2),s=l[0],d=l[1],m=r.a.useState(null),p=Object(b.a)(m,2),f=p[0],g=p[1],h=Object(n.useState)(null),O=Object(b.a)(h,2),w=O[0],k=O[1],y=Object(n.useState)(o.description),j=Object(b.a)(y,2),x=j[0],C=j[1],N=Object(n.useState)(!1),I=Object(b.a)(N,2),D=I[0],A=I[1];Object(u.b)().t;return Object(n.useEffect)((function(){C(o.description)}),[o.description]),Object(n.useEffect)((function(){if(s){var e=mt.fromTextArea(s,{mode:{name:"hypermd",hashtag:!0},inputStyle:"textarea"});e.setValue(o.description),e.setOption("lineNumbers",!1),e.setOption("foldGutter",!1),e.setOption("autofocus",!1),i&&e.setOption("readOnly","nocursor"),e.on("changes",(function(){C(e.getValue())})),e.focus(),k(e)}}),[s]),Object(n.useEffect)((function(){f&&Object(Z.renderPreview)(f,o.description)}),[f]),r.a.createElement(Ee.a,{className:Object(S.a)(t.kanbanCard)},r.a.createElement("div",{className:Object(S.a)("preview",t.preview),ref:function(e){g(e)}}),!i&&r.a.createElement(v.a,{style:{position:"absolute",top:"0",right:"0",zIndex:99}},r.a.createElement(E.a,{onClick:function(){return A(!0)}},r.a.createElement(P.u,null)),r.a.createElement(E.a,{onClick:function(){a.columns.forEach((function(e){e.cards=e.cards.filter((function(e){return e.id!==o.id}))})),e.refreshBoard(a)}},r.a.createElement(P.f,null))),r.a.createElement(K.a,{open:D,onClose:function(){return A(!1)}},r.a.createElement(q.a,null,r.a.createElement(v.a,{className:Object(S.a)(t.editorWrapper),style:{minWidth:"300px",maxWidth:"100%"}},r.a.createElement("textarea",{className:t.textarea,ref:function(e){d(e)}}))),r.a.createElement(Q.a,null,r.a.createElement(E.a,{onClick:function(){o.description=x,e.refreshBoard(e.board),A(!1)}},r.a.createElement(P.j,null)),r.a.createElement(E.a,{onClick:function(){w&&w.setValue(o.description),C(o.description),A(!1)}},r.a.createElement(P.a,null)))))}function gt(e){pt(e);var t=Object(u.b)().t,a=Object(n.useState)(e.attributes.board||{columns:[]}),o=Object(b.a)(a,2),i=o[0],c=o[1];"lanes"in i&&(i.columns=i.lanes);var l=function(t){var a=Object.assign({},t);e.setAttributes({board:a}),c(a)};return r.a.createElement("div",null,r.a.createElement(dt.a,{renderColumnHeader:function(t){return r.a.createElement(bt,{column:t,board:i,refreshBoard:l,isPreview:e.isPreview})},renderCard:function(t,a){a.dragging;return r.a.createElement(ft,{card:t,board:i,refreshBoard:l,isPreview:e.isPreview})},allowAddColumn:!e.isPreview,allowAddCard:!e.isPreview,renderColumnAdder:function(){return r.a.createElement(v.a,{style:{marginLeft:"16px",marginTop:"16px"}},r.a.createElement(G.a,{color:"primary",variant:"outlined",onClick:function(){i.columns.push({id:Date.now(),title:t("general/untitled"),cards:[],wip:!1}),l(i)}},r.a.createElement(P.x,null),t("widget/crossnote.kanban/add-column")),r.a.createElement(G.a,{color:"primary",onClick:function(){return e.removeSelf()}},r.a.createElement(P.H,null)))},onNewColumnConfirm:function(e){i.columns.push(Object(st.a)({id:Date.now()},e)),l(i)},disableCardDrag:e.isPreview,disableColumnDrag:e.isPreview,onCardDragEnd:function(e,t,a){var n=t.fromPosition,r=t.fromColumnId,o=a.toPosition,c=a.toColumnId,s=i.columns.filter((function(e){return e.id===r}))[0],u=i.columns.filter((function(e){return e.id===c}))[0];s.cards.splice(n,1),u.cards=[].concat(Object(I.a)(u.cards.slice(0,o)),[e],Object(I.a)(u.cards.slice(o,u.cards.length))),l(i)},onColumnDragEnd:function(e,t,a){var n=t.fromPosition,r=a.toPosition,o=i.columns[n],c=i.columns[r];i.columns[r]=o,i.columns[n]=c,l(i)}},i))}var ht=a(411),vt=a.n(ht),Ot=(a(5696),Object(x.a)((function(e){return Object(C.a)({card:{padding:e.spacing(2),position:"relative"},editorWrapper:{position:"relative",padding:"2px"},editor:{width:"100%",height:"128px",resize:"none",border:"none"},canvas:{overflow:"auto !important",height:"100% !important"},saveBtn:{position:"absolute",top:"0",right:"0"}})})));function Et(e){var t=e.attributes,a=Ot(e),o=(Object(u.b)().t,Object(n.useState)("abc-editor-"+Object(W.c)())),i=Object(b.a)(o,1)[0],c=Object(n.useState)("abc-warnings-"+Object(W.c)()),l=Object(b.a)(c,1)[0],s=Object(n.useState)("abc-canvas-"+Object(W.c)()),d=Object(b.a)(s,1)[0],m=Object(n.useState)("abc-audio-"+Object(W.c)()),p=Object(b.a)(m,1)[0],f=Object(n.useState)(null),g=Object(b.a)(f,2),h=g[0],O=g[1],w=Object(n.useState)(null),k=Object(b.a)(w,2),y=k[0],j=k[1],x=Object(n.useState)(null),C=Object(b.a)(x,2),N=C[0],I=C[1],D=Object(n.useState)(null),A=Object(b.a)(D,2),T=A[0],B=A[1],L=Object(n.useState)(e.isPreview),R=Object(b.a)(L,2),F=R[0],U=(R[1],Object(n.useState)(t.abc||"X: 1\nT: Cooley's\nM: 4/4\nL: 1/8\nK: Emin\n|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|")),M=Object(b.a)(U,2),_=M[0],V=M[1];return Object(n.useEffect)((function(){h&&y&&N&&T&&setTimeout((function(){new vt.a.Editor(h.id,{canvas_id:N.id,warnings_id:y.id,generate_warnings:!0,synth:{el:"#".concat(T.id),options:{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}},abcjsParams:{generateDownload:!0}})}),1e3)}),[h,y,N,T]),r.a.createElement(v.a,null,r.a.createElement(Ee.a,{elevation:2,className:Object(S.a)(a.editorWrapper),style:{display:F?"none":"block"}},r.a.createElement("textarea",{className:Object(S.a)(a.editor),id:i,ref:function(e){O(e)},value:_,onChange:function(e){V(e.target.value)},readOnly:e.isPreview}),!e.isPreview&&t.abc!==_&&r.a.createElement(E.a,{className:Object(S.a)(a.saveBtn),onClick:function(){e.setAttributes(Object.assign(e.attributes,{abc:_}))}},r.a.createElement(P.j,null))),r.a.createElement("div",{id:l,ref:function(e){j(e)}}),r.a.createElement("div",{id:d,className:Object(S.a)(a.canvas),ref:function(e){I(e)}}),r.a.createElement("div",{id:p,ref:function(e){B(e)}}))}window.CodeMirror=a(16),Object(Ve.registerWidgetCreator)("crossnote.image",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement($e,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.audio",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ye,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.netease_music",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Xe,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.video",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Ze,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.bilibili",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(tt,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.youtube",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(nt,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.ocr",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(lt,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.kanban",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(gt,e),t),t})),Object(Ve.registerWidgetCreator)("crossnote.abc",(function(e){var t=document.createElement("span");return i.a.render(r.a.createElement(Et,e),t),t}));var wt=Object(Ue.a)({palette:{primary:We.a,secondary:Me.a}}),kt=function(){return Object(n.useEffect)((function(){var e=function(e){e.preventDefault(),e.prompt(),e.userChoice.then((function(e){console.log(e)}))};return window.addEventListener("beforeinstallprompt",e),function(){window.removeEventListener("beforeinstallprompt",e)}}),[]),r.a.createElement(_e.a,{theme:wt},r.a.createElement("div",{className:"App"},r.a.createElement(Fe,null)))},yt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function jt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var xt=a(412),Ct=new l.a("fs");window.fs=Ct;try{var Nt=new xt.a({fs:Ct});window.crossnote=Nt,i.a.render(r.a.createElement(_.Provider,{initialState:{crossnote:Nt}},r.a.createElement(kt,null)),document.getElementById("root"))}catch(St){console.log(St)}!function(e){if("serviceWorker"in navigator){if(new URL("/notehub",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/notehub","/service-worker.js");yt?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):jt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):jt(t,e)}))}}()},62:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return c})),a.d(t,"d",(function(){return l}));var n=a(10),r=a(18);var o="00000000-0000-0000-0000-000000000000",i=864e5;"Bearer ".concat(localStorage.getItem("token"));function c(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===a?n:3&n|8).toString(16)}))}new(function(){function e(){Object(n.a)(this,e),this.cache={}}return Object(r.a)(e,[{key:"hashCode",value:function(e){var t=e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0),a="0."+(t=Math.abs(t)).toString();return parseFloat(a)}},{key:"generateColor",value:function(e){if(e in this.cache)return this.cache[e];var t="#"+((1<<24)*this.hashCode(e)|0).toString(16);return this.cache[e]=t,t}}]),e}());function l(){return Math.random().toString(36).substr(2,9)}},66:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return l}));var n=a(1),r=a.n(n),o=a(2),i=a(62);function c(e){var t=e.match(/^#\s.+$/gim);return t&&t.length?t[0].replace(/^#/,"").trim():""}function l(e){return s.apply(this,arguments)}function s(){return(s=Object(o.a)(r.a.mark((function e(t){var a,n,o,i,c,l,s,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="","",o=[],t=t.replace(/^---([\w\W]+?\n---)/,"").trim(),i=t,(c=t.match(/^#\s.+$/gim))&&c.length&&(a=c[0].replace(/^#/,"").trim(),l=t.slice(0,t.indexOf(c[0])).trim(),i=t.slice(t.indexOf(c[0])+c[0].length,t.length),(s=l.match(/^!\[.*?\]\(.+?\)/gim))&&s.length&&o.push(s[0].match(/\(([^)"]+?)\)/)[1].trim())),(u=t.match(/^!\[.*?\]\(.+?\)/gim))&&u.length&&(u.forEach((function(e){o.push(e.match(/\(([^)"]+?)\)/)[1].trim())})),o=o.filter((function(e,t,a){return t===a.findIndex((function(t){return t===e}))}))),n=i.split("\n").filter((function(e){return e.trim().length>0&&!e.match(/!\[.*?\]\(.+?\)/)&&!e.match(/`@.+?`/)})).map((function(e){return e.replace(/#+\s(.+)\s*$/,"**$1**").trim()})).slice(0,10).join("  \n"),e.abrupt("return",{title:a,summary:n,images:o,tags:[],html:""});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}i.b,i.b}},[[5398,1,2]]]);
//# sourceMappingURL=main.f77e7b88.chunk.js.map